(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const b of document.querySelectorAll('link[rel="modulepreload"]'))_(b);new MutationObserver(b=>{for(const I of b)if(I.type==="childList")for(const S of I.addedNodes)S.tagName==="LINK"&&S.rel==="modulepreload"&&_(S)}).observe(document,{childList:!0,subtree:!0});function h(b){const I={};return b.integrity&&(I.integrity=b.integrity),b.referrerPolicy&&(I.referrerPolicy=b.referrerPolicy),b.crossOrigin==="use-credentials"?I.credentials="include":b.crossOrigin==="anonymous"?I.credentials="omit":I.credentials="same-origin",I}function _(b){if(b.ep)return;b.ep=!0;const I=h(b);fetch(b.href,I)}})();var ib=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Jm(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var $v={exports:{}},Qd={},Zv={exports:{}},It={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Hc=Symbol.for("react.element"),nb=Symbol.for("react.portal"),sb=Symbol.for("react.fragment"),ob=Symbol.for("react.strict_mode"),ab=Symbol.for("react.profiler"),lb=Symbol.for("react.provider"),ub=Symbol.for("react.context"),cb=Symbol.for("react.forward_ref"),hb=Symbol.for("react.suspense"),db=Symbol.for("react.memo"),pb=Symbol.for("react.lazy"),zy=Symbol.iterator;function fb(i){return i===null||typeof i!="object"?null:(i=zy&&i[zy]||i["@@iterator"],typeof i=="function"?i:null)}var qv={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Gv=Object.assign,Hv={};function Jl(i,o,h){this.props=i,this.context=o,this.refs=Hv,this.updater=h||qv}Jl.prototype.isReactComponent={};Jl.prototype.setState=function(i,o){if(typeof i!="object"&&typeof i!="function"&&i!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,i,o,"setState")};Jl.prototype.forceUpdate=function(i){this.updater.enqueueForceUpdate(this,i,"forceUpdate")};function Wv(){}Wv.prototype=Jl.prototype;function Qm(i,o,h){this.props=i,this.context=o,this.refs=Hv,this.updater=h||qv}var eg=Qm.prototype=new Wv;eg.constructor=Qm;Gv(eg,Jl.prototype);eg.isPureReactComponent=!0;var My=Array.isArray,Xv=Object.prototype.hasOwnProperty,tg={current:null},Kv={key:!0,ref:!0,__self:!0,__source:!0};function Yv(i,o,h){var _,b={},I=null,S=null;if(o!=null)for(_ in o.ref!==void 0&&(S=o.ref),o.key!==void 0&&(I=""+o.key),o)Xv.call(o,_)&&!Kv.hasOwnProperty(_)&&(b[_]=o[_]);var d=arguments.length-2;if(d===1)b.children=h;else if(1<d){for(var H=Array(d),le=0;le<d;le++)H[le]=arguments[le+2];b.children=H}if(i&&i.defaultProps)for(_ in d=i.defaultProps,d)b[_]===void 0&&(b[_]=d[_]);return{$$typeof:Hc,type:i,key:I,ref:S,props:b,_owner:tg.current}}function mb(i,o){return{$$typeof:Hc,type:i.type,key:o,ref:i.ref,props:i.props,_owner:i._owner}}function rg(i){return typeof i=="object"&&i!==null&&i.$$typeof===Hc}function gb(i){var o={"=":"=0",":":"=2"};return"$"+i.replace(/[=:]/g,function(h){return o[h]})}var Ay=/\/+/g;function Af(i,o){return typeof i=="object"&&i!==null&&i.key!=null?gb(""+i.key):o.toString(36)}function _d(i,o,h,_,b){var I=typeof i;(I==="undefined"||I==="boolean")&&(i=null);var S=!1;if(i===null)S=!0;else switch(I){case"string":case"number":S=!0;break;case"object":switch(i.$$typeof){case Hc:case nb:S=!0}}if(S)return S=i,b=b(S),i=_===""?"."+Af(S,0):_,My(b)?(h="",i!=null&&(h=i.replace(Ay,"$&/")+"/"),_d(b,o,h,"",function(le){return le})):b!=null&&(rg(b)&&(b=mb(b,h+(!b.key||S&&S.key===b.key?"":(""+b.key).replace(Ay,"$&/")+"/")+i)),o.push(b)),1;if(S=0,_=_===""?".":_+":",My(i))for(var d=0;d<i.length;d++){I=i[d];var H=_+Af(I,d);S+=_d(I,o,h,H,b)}else if(H=fb(i),typeof H=="function")for(i=H.call(i),d=0;!(I=i.next()).done;)I=I.value,H=_+Af(I,d++),S+=_d(I,o,h,H,b);else if(I==="object")throw o=String(i),Error("Objects are not valid as a React child (found: "+(o==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":o)+"). If you meant to render a collection of children, use an array instead.");return S}function ed(i,o,h){if(i==null)return i;var _=[],b=0;return _d(i,_,"","",function(I){return o.call(h,I,b++)}),_}function _b(i){if(i._status===-1){var o=i._result;o=o(),o.then(function(h){(i._status===0||i._status===-1)&&(i._status=1,i._result=h)},function(h){(i._status===0||i._status===-1)&&(i._status=2,i._result=h)}),i._status===-1&&(i._status=0,i._result=o)}if(i._status===1)return i._result.default;throw i._result}var Ti={current:null},yd={transition:null},yb={ReactCurrentDispatcher:Ti,ReactCurrentBatchConfig:yd,ReactCurrentOwner:tg};function Jv(){throw Error("act(...) is not supported in production builds of React.")}It.Children={map:ed,forEach:function(i,o,h){ed(i,function(){o.apply(this,arguments)},h)},count:function(i){var o=0;return ed(i,function(){o++}),o},toArray:function(i){return ed(i,function(o){return o})||[]},only:function(i){if(!rg(i))throw Error("React.Children.only expected to receive a single React element child.");return i}};It.Component=Jl;It.Fragment=sb;It.Profiler=ab;It.PureComponent=Qm;It.StrictMode=ob;It.Suspense=hb;It.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=yb;It.act=Jv;It.cloneElement=function(i,o,h){if(i==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+i+".");var _=Gv({},i.props),b=i.key,I=i.ref,S=i._owner;if(o!=null){if(o.ref!==void 0&&(I=o.ref,S=tg.current),o.key!==void 0&&(b=""+o.key),i.type&&i.type.defaultProps)var d=i.type.defaultProps;for(H in o)Xv.call(o,H)&&!Kv.hasOwnProperty(H)&&(_[H]=o[H]===void 0&&d!==void 0?d[H]:o[H])}var H=arguments.length-2;if(H===1)_.children=h;else if(1<H){d=Array(H);for(var le=0;le<H;le++)d[le]=arguments[le+2];_.children=d}return{$$typeof:Hc,type:i.type,key:b,ref:I,props:_,_owner:S}};It.createContext=function(i){return i={$$typeof:ub,_currentValue:i,_currentValue2:i,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},i.Provider={$$typeof:lb,_context:i},i.Consumer=i};It.createElement=Yv;It.createFactory=function(i){var o=Yv.bind(null,i);return o.type=i,o};It.createRef=function(){return{current:null}};It.forwardRef=function(i){return{$$typeof:cb,render:i}};It.isValidElement=rg;It.lazy=function(i){return{$$typeof:pb,_payload:{_status:-1,_result:i},_init:_b}};It.memo=function(i,o){return{$$typeof:db,type:i,compare:o===void 0?null:o}};It.startTransition=function(i){var o=yd.transition;yd.transition={};try{i()}finally{yd.transition=o}};It.unstable_act=Jv;It.useCallback=function(i,o){return Ti.current.useCallback(i,o)};It.useContext=function(i){return Ti.current.useContext(i)};It.useDebugValue=function(){};It.useDeferredValue=function(i){return Ti.current.useDeferredValue(i)};It.useEffect=function(i,o){return Ti.current.useEffect(i,o)};It.useId=function(){return Ti.current.useId()};It.useImperativeHandle=function(i,o,h){return Ti.current.useImperativeHandle(i,o,h)};It.useInsertionEffect=function(i,o){return Ti.current.useInsertionEffect(i,o)};It.useLayoutEffect=function(i,o){return Ti.current.useLayoutEffect(i,o)};It.useMemo=function(i,o){return Ti.current.useMemo(i,o)};It.useReducer=function(i,o,h){return Ti.current.useReducer(i,o,h)};It.useRef=function(i){return Ti.current.useRef(i)};It.useState=function(i){return Ti.current.useState(i)};It.useSyncExternalStore=function(i,o,h){return Ti.current.useSyncExternalStore(i,o,h)};It.useTransition=function(){return Ti.current.useTransition()};It.version="18.3.1";Zv.exports=It;var Nn=Zv.exports;const Qv=Jm(Nn);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var vb=Nn,xb=Symbol.for("react.element"),wb=Symbol.for("react.fragment"),bb=Object.prototype.hasOwnProperty,Sb=vb.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Tb={key:!0,ref:!0,__self:!0,__source:!0};function ex(i,o,h){var _,b={},I=null,S=null;h!==void 0&&(I=""+h),o.key!==void 0&&(I=""+o.key),o.ref!==void 0&&(S=o.ref);for(_ in o)bb.call(o,_)&&!Tb.hasOwnProperty(_)&&(b[_]=o[_]);if(i&&i.defaultProps)for(_ in o=i.defaultProps,o)b[_]===void 0&&(b[_]=o[_]);return{$$typeof:xb,type:i,key:I,ref:S,props:b,_owner:Sb.current}}Qd.Fragment=wb;Qd.jsx=ex;Qd.jsxs=ex;$v.exports=Qd;var jr=$v.exports,sm={},tx={exports:{}},an={},rx={exports:{}},ix={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(i){function o(Ge,ut){var ct=Ge.length;Ge.push(ut);e:for(;0<ct;){var St=ct-1>>>1,Rt=Ge[St];if(0<b(Rt,ut))Ge[St]=ut,Ge[ct]=Rt,ct=St;else break e}}function h(Ge){return Ge.length===0?null:Ge[0]}function _(Ge){if(Ge.length===0)return null;var ut=Ge[0],ct=Ge.pop();if(ct!==ut){Ge[0]=ct;e:for(var St=0,Rt=Ge.length,ji=Rt>>>1;St<ji;){var Mr=2*(St+1)-1,Qr=Ge[Mr],ei=Mr+1,xr=Ge[ei];if(0>b(Qr,ct))ei<Rt&&0>b(xr,Qr)?(Ge[St]=xr,Ge[ei]=ct,St=ei):(Ge[St]=Qr,Ge[Mr]=ct,St=Mr);else if(ei<Rt&&0>b(xr,ct))Ge[St]=xr,Ge[ei]=ct,St=ei;else break e}}return ut}function b(Ge,ut){var ct=Ge.sortIndex-ut.sortIndex;return ct!==0?ct:Ge.id-ut.id}if(typeof performance=="object"&&typeof performance.now=="function"){var I=performance;i.unstable_now=function(){return I.now()}}else{var S=Date,d=S.now();i.unstable_now=function(){return S.now()-d}}var H=[],le=[],ye=1,re=null,q=3,ke=!1,Pe=!1,Fe=!1,Ct=typeof setTimeout=="function"?setTimeout:null,ce=typeof clearTimeout=="function"?clearTimeout:null,ie=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function de(Ge){for(var ut=h(le);ut!==null;){if(ut.callback===null)_(le);else if(ut.startTime<=Ge)_(le),ut.sortIndex=ut.expirationTime,o(H,ut);else break;ut=h(le)}}function Te(Ge){if(Fe=!1,de(Ge),!Pe)if(h(H)!==null)Pe=!0,cn(je);else{var ut=h(le);ut!==null&&Jr(Te,ut.startTime-Ge)}}function je(Ge,ut){Pe=!1,Fe&&(Fe=!1,ce(rt),rt=-1),ke=!0;var ct=q;try{for(de(ut),re=h(H);re!==null&&(!(re.expirationTime>ut)||Ge&&!_t());){var St=re.callback;if(typeof St=="function"){re.callback=null,q=re.priorityLevel;var Rt=St(re.expirationTime<=ut);ut=i.unstable_now(),typeof Rt=="function"?re.callback=Rt:re===h(H)&&_(H),de(ut)}else _(H);re=h(H)}if(re!==null)var ji=!0;else{var Mr=h(le);Mr!==null&&Jr(Te,Mr.startTime-ut),ji=!1}return ji}finally{re=null,q=ct,ke=!1}}var Xe=!1,qe=null,rt=-1,At=5,gt=-1;function _t(){return!(i.unstable_now()-gt<At)}function un(){if(qe!==null){var Ge=i.unstable_now();gt=Ge;var ut=!0;try{ut=qe(!0,Ge)}finally{ut?ir():(Xe=!1,qe=null)}}else Xe=!1}var ir;if(typeof ie=="function")ir=function(){ie(un)};else if(typeof MessageChannel<"u"){var vr=new MessageChannel,Vi=vr.port2;vr.port1.onmessage=un,ir=function(){Vi.postMessage(null)}}else ir=function(){Ct(un,0)};function cn(Ge){qe=Ge,Xe||(Xe=!0,ir())}function Jr(Ge,ut){rt=Ct(function(){Ge(i.unstable_now())},ut)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(Ge){Ge.callback=null},i.unstable_continueExecution=function(){Pe||ke||(Pe=!0,cn(je))},i.unstable_forceFrameRate=function(Ge){0>Ge||125<Ge?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):At=0<Ge?Math.floor(1e3/Ge):5},i.unstable_getCurrentPriorityLevel=function(){return q},i.unstable_getFirstCallbackNode=function(){return h(H)},i.unstable_next=function(Ge){switch(q){case 1:case 2:case 3:var ut=3;break;default:ut=q}var ct=q;q=ut;try{return Ge()}finally{q=ct}},i.unstable_pauseExecution=function(){},i.unstable_requestPaint=function(){},i.unstable_runWithPriority=function(Ge,ut){switch(Ge){case 1:case 2:case 3:case 4:case 5:break;default:Ge=3}var ct=q;q=Ge;try{return ut()}finally{q=ct}},i.unstable_scheduleCallback=function(Ge,ut,ct){var St=i.unstable_now();switch(typeof ct=="object"&&ct!==null?(ct=ct.delay,ct=typeof ct=="number"&&0<ct?St+ct:St):ct=St,Ge){case 1:var Rt=-1;break;case 2:Rt=250;break;case 5:Rt=1073741823;break;case 4:Rt=1e4;break;default:Rt=5e3}return Rt=ct+Rt,Ge={id:ye++,callback:ut,priorityLevel:Ge,startTime:ct,expirationTime:Rt,sortIndex:-1},ct>St?(Ge.sortIndex=ct,o(le,Ge),h(H)===null&&Ge===h(le)&&(Fe?(ce(rt),rt=-1):Fe=!0,Jr(Te,ct-St))):(Ge.sortIndex=Rt,o(H,Ge),Pe||ke||(Pe=!0,cn(je))),Ge},i.unstable_shouldYield=_t,i.unstable_wrapCallback=function(Ge){var ut=q;return function(){var ct=q;q=ut;try{return Ge.apply(this,arguments)}finally{q=ct}}}})(ix);rx.exports=ix;var kb=rx.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ib=Nn,on=kb;function Ee(i){for(var o="https://reactjs.org/docs/error-decoder.html?invariant="+i,h=1;h<arguments.length;h++)o+="&args[]="+encodeURIComponent(arguments[h]);return"Minified React error #"+i+"; visit "+o+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var nx=new Set,zc={};function Ca(i,o){Zl(i,o),Zl(i+"Capture",o)}function Zl(i,o){for(zc[i]=o,i=0;i<o.length;i++)nx.add(o[i])}var As=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),om=Object.prototype.hasOwnProperty,Eb=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Dy={},Ly={};function Pb(i){return om.call(Ly,i)?!0:om.call(Dy,i)?!1:Eb.test(i)?Ly[i]=!0:(Dy[i]=!0,!1)}function Cb(i,o,h,_){if(h!==null&&h.type===0)return!1;switch(typeof o){case"function":case"symbol":return!0;case"boolean":return _?!1:h!==null?!h.acceptsBooleans:(i=i.toLowerCase().slice(0,5),i!=="data-"&&i!=="aria-");default:return!1}}function zb(i,o,h,_){if(o===null||typeof o>"u"||Cb(i,o,h,_))return!0;if(_)return!1;if(h!==null)switch(h.type){case 3:return!o;case 4:return o===!1;case 5:return isNaN(o);case 6:return isNaN(o)||1>o}return!1}function ki(i,o,h,_,b,I,S){this.acceptsBooleans=o===2||o===3||o===4,this.attributeName=_,this.attributeNamespace=b,this.mustUseProperty=h,this.propertyName=i,this.type=o,this.sanitizeURL=I,this.removeEmptyString=S}var Yr={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(i){Yr[i]=new ki(i,0,!1,i,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(i){var o=i[0];Yr[o]=new ki(o,1,!1,i[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(i){Yr[i]=new ki(i,2,!1,i.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(i){Yr[i]=new ki(i,2,!1,i,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(i){Yr[i]=new ki(i,3,!1,i.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(i){Yr[i]=new ki(i,3,!0,i,null,!1,!1)});["capture","download"].forEach(function(i){Yr[i]=new ki(i,4,!1,i,null,!1,!1)});["cols","rows","size","span"].forEach(function(i){Yr[i]=new ki(i,6,!1,i,null,!1,!1)});["rowSpan","start"].forEach(function(i){Yr[i]=new ki(i,5,!1,i.toLowerCase(),null,!1,!1)});var ig=/[\-:]([a-z])/g;function ng(i){return i[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(i){var o=i.replace(ig,ng);Yr[o]=new ki(o,1,!1,i,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(i){var o=i.replace(ig,ng);Yr[o]=new ki(o,1,!1,i,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(i){var o=i.replace(ig,ng);Yr[o]=new ki(o,1,!1,i,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(i){Yr[i]=new ki(i,1,!1,i.toLowerCase(),null,!1,!1)});Yr.xlinkHref=new ki("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(i){Yr[i]=new ki(i,1,!1,i.toLowerCase(),null,!0,!0)});function sg(i,o,h,_){var b=Yr.hasOwnProperty(o)?Yr[o]:null;(b!==null?b.type!==0:_||!(2<o.length)||o[0]!=="o"&&o[0]!=="O"||o[1]!=="n"&&o[1]!=="N")&&(zb(o,h,b,_)&&(h=null),_||b===null?Pb(o)&&(h===null?i.removeAttribute(o):i.setAttribute(o,""+h)):b.mustUseProperty?i[b.propertyName]=h===null?b.type===3?!1:"":h:(o=b.attributeName,_=b.attributeNamespace,h===null?i.removeAttribute(o):(b=b.type,h=b===3||b===4&&h===!0?"":""+h,_?i.setAttributeNS(_,o,h):i.setAttribute(o,h))))}var Fs=Ib.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,td=Symbol.for("react.element"),Il=Symbol.for("react.portal"),El=Symbol.for("react.fragment"),og=Symbol.for("react.strict_mode"),am=Symbol.for("react.profiler"),sx=Symbol.for("react.provider"),ox=Symbol.for("react.context"),ag=Symbol.for("react.forward_ref"),lm=Symbol.for("react.suspense"),um=Symbol.for("react.suspense_list"),lg=Symbol.for("react.memo"),xo=Symbol.for("react.lazy"),ax=Symbol.for("react.offscreen"),Ry=Symbol.iterator;function uc(i){return i===null||typeof i!="object"?null:(i=Ry&&i[Ry]||i["@@iterator"],typeof i=="function"?i:null)}var dr=Object.assign,Df;function _c(i){if(Df===void 0)try{throw Error()}catch(h){var o=h.stack.trim().match(/\n( *(at )?)/);Df=o&&o[1]||""}return`
`+Df+i}var Lf=!1;function Rf(i,o){if(!i||Lf)return"";Lf=!0;var h=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(o)if(o=function(){throw Error()},Object.defineProperty(o.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(o,[])}catch(le){var _=le}Reflect.construct(i,[],o)}else{try{o.call()}catch(le){_=le}i.call(o.prototype)}else{try{throw Error()}catch(le){_=le}i()}}catch(le){if(le&&_&&typeof le.stack=="string"){for(var b=le.stack.split(`
`),I=_.stack.split(`
`),S=b.length-1,d=I.length-1;1<=S&&0<=d&&b[S]!==I[d];)d--;for(;1<=S&&0<=d;S--,d--)if(b[S]!==I[d]){if(S!==1||d!==1)do if(S--,d--,0>d||b[S]!==I[d]){var H=`
`+b[S].replace(" at new "," at ");return i.displayName&&H.includes("<anonymous>")&&(H=H.replace("<anonymous>",i.displayName)),H}while(1<=S&&0<=d);break}}}finally{Lf=!1,Error.prepareStackTrace=h}return(i=i?i.displayName||i.name:"")?_c(i):""}function Mb(i){switch(i.tag){case 5:return _c(i.type);case 16:return _c("Lazy");case 13:return _c("Suspense");case 19:return _c("SuspenseList");case 0:case 2:case 15:return i=Rf(i.type,!1),i;case 11:return i=Rf(i.type.render,!1),i;case 1:return i=Rf(i.type,!0),i;default:return""}}function cm(i){if(i==null)return null;if(typeof i=="function")return i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case El:return"Fragment";case Il:return"Portal";case am:return"Profiler";case og:return"StrictMode";case lm:return"Suspense";case um:return"SuspenseList"}if(typeof i=="object")switch(i.$$typeof){case ox:return(i.displayName||"Context")+".Consumer";case sx:return(i._context.displayName||"Context")+".Provider";case ag:var o=i.render;return i=i.displayName,i||(i=o.displayName||o.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case lg:return o=i.displayName||null,o!==null?o:cm(i.type)||"Memo";case xo:o=i._payload,i=i._init;try{return cm(i(o))}catch{}}return null}function Ab(i){var o=i.type;switch(i.tag){case 24:return"Cache";case 9:return(o.displayName||"Context")+".Consumer";case 10:return(o._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return i=o.render,i=i.displayName||i.name||"",o.displayName||(i!==""?"ForwardRef("+i+")":"ForwardRef");case 7:return"Fragment";case 5:return o;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return cm(o);case 8:return o===og?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof o=="function")return o.displayName||o.name||null;if(typeof o=="string")return o}return null}function Lo(i){switch(typeof i){case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function lx(i){var o=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(o==="checkbox"||o==="radio")}function Db(i){var o=lx(i)?"checked":"value",h=Object.getOwnPropertyDescriptor(i.constructor.prototype,o),_=""+i[o];if(!i.hasOwnProperty(o)&&typeof h<"u"&&typeof h.get=="function"&&typeof h.set=="function"){var b=h.get,I=h.set;return Object.defineProperty(i,o,{configurable:!0,get:function(){return b.call(this)},set:function(S){_=""+S,I.call(this,S)}}),Object.defineProperty(i,o,{enumerable:h.enumerable}),{getValue:function(){return _},setValue:function(S){_=""+S},stopTracking:function(){i._valueTracker=null,delete i[o]}}}}function rd(i){i._valueTracker||(i._valueTracker=Db(i))}function ux(i){if(!i)return!1;var o=i._valueTracker;if(!o)return!0;var h=o.getValue(),_="";return i&&(_=lx(i)?i.checked?"true":"false":i.value),i=_,i!==h?(o.setValue(i),!0):!1}function Cd(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}function hm(i,o){var h=o.checked;return dr({},o,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:h??i._wrapperState.initialChecked})}function Fy(i,o){var h=o.defaultValue==null?"":o.defaultValue,_=o.checked!=null?o.checked:o.defaultChecked;h=Lo(o.value!=null?o.value:h),i._wrapperState={initialChecked:_,initialValue:h,controlled:o.type==="checkbox"||o.type==="radio"?o.checked!=null:o.value!=null}}function cx(i,o){o=o.checked,o!=null&&sg(i,"checked",o,!1)}function dm(i,o){cx(i,o);var h=Lo(o.value),_=o.type;if(h!=null)_==="number"?(h===0&&i.value===""||i.value!=h)&&(i.value=""+h):i.value!==""+h&&(i.value=""+h);else if(_==="submit"||_==="reset"){i.removeAttribute("value");return}o.hasOwnProperty("value")?pm(i,o.type,h):o.hasOwnProperty("defaultValue")&&pm(i,o.type,Lo(o.defaultValue)),o.checked==null&&o.defaultChecked!=null&&(i.defaultChecked=!!o.defaultChecked)}function By(i,o,h){if(o.hasOwnProperty("value")||o.hasOwnProperty("defaultValue")){var _=o.type;if(!(_!=="submit"&&_!=="reset"||o.value!==void 0&&o.value!==null))return;o=""+i._wrapperState.initialValue,h||o===i.value||(i.value=o),i.defaultValue=o}h=i.name,h!==""&&(i.name=""),i.defaultChecked=!!i._wrapperState.initialChecked,h!==""&&(i.name=h)}function pm(i,o,h){(o!=="number"||Cd(i.ownerDocument)!==i)&&(h==null?i.defaultValue=""+i._wrapperState.initialValue:i.defaultValue!==""+h&&(i.defaultValue=""+h))}var yc=Array.isArray;function Ol(i,o,h,_){if(i=i.options,o){o={};for(var b=0;b<h.length;b++)o["$"+h[b]]=!0;for(h=0;h<i.length;h++)b=o.hasOwnProperty("$"+i[h].value),i[h].selected!==b&&(i[h].selected=b),b&&_&&(i[h].defaultSelected=!0)}else{for(h=""+Lo(h),o=null,b=0;b<i.length;b++){if(i[b].value===h){i[b].selected=!0,_&&(i[b].defaultSelected=!0);return}o!==null||i[b].disabled||(o=i[b])}o!==null&&(o.selected=!0)}}function fm(i,o){if(o.dangerouslySetInnerHTML!=null)throw Error(Ee(91));return dr({},o,{value:void 0,defaultValue:void 0,children:""+i._wrapperState.initialValue})}function Oy(i,o){var h=o.value;if(h==null){if(h=o.children,o=o.defaultValue,h!=null){if(o!=null)throw Error(Ee(92));if(yc(h)){if(1<h.length)throw Error(Ee(93));h=h[0]}o=h}o==null&&(o=""),h=o}i._wrapperState={initialValue:Lo(h)}}function hx(i,o){var h=Lo(o.value),_=Lo(o.defaultValue);h!=null&&(h=""+h,h!==i.value&&(i.value=h),o.defaultValue==null&&i.defaultValue!==h&&(i.defaultValue=h)),_!=null&&(i.defaultValue=""+_)}function Ny(i){var o=i.textContent;o===i._wrapperState.initialValue&&o!==""&&o!==null&&(i.value=o)}function dx(i){switch(i){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function mm(i,o){return i==null||i==="http://www.w3.org/1999/xhtml"?dx(o):i==="http://www.w3.org/2000/svg"&&o==="foreignObject"?"http://www.w3.org/1999/xhtml":i}var id,px=function(i){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(o,h,_,b){MSApp.execUnsafeLocalFunction(function(){return i(o,h,_,b)})}:i}(function(i,o){if(i.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in i)i.innerHTML=o;else{for(id=id||document.createElement("div"),id.innerHTML="<svg>"+o.valueOf().toString()+"</svg>",o=id.firstChild;i.firstChild;)i.removeChild(i.firstChild);for(;o.firstChild;)i.appendChild(o.firstChild)}});function Mc(i,o){if(o){var h=i.firstChild;if(h&&h===i.lastChild&&h.nodeType===3){h.nodeValue=o;return}}i.textContent=o}var wc={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Lb=["Webkit","ms","Moz","O"];Object.keys(wc).forEach(function(i){Lb.forEach(function(o){o=o+i.charAt(0).toUpperCase()+i.substring(1),wc[o]=wc[i]})});function fx(i,o,h){return o==null||typeof o=="boolean"||o===""?"":h||typeof o!="number"||o===0||wc.hasOwnProperty(i)&&wc[i]?(""+o).trim():o+"px"}function mx(i,o){i=i.style;for(var h in o)if(o.hasOwnProperty(h)){var _=h.indexOf("--")===0,b=fx(h,o[h],_);h==="float"&&(h="cssFloat"),_?i.setProperty(h,b):i[h]=b}}var Rb=dr({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function gm(i,o){if(o){if(Rb[i]&&(o.children!=null||o.dangerouslySetInnerHTML!=null))throw Error(Ee(137,i));if(o.dangerouslySetInnerHTML!=null){if(o.children!=null)throw Error(Ee(60));if(typeof o.dangerouslySetInnerHTML!="object"||!("__html"in o.dangerouslySetInnerHTML))throw Error(Ee(61))}if(o.style!=null&&typeof o.style!="object")throw Error(Ee(62))}}function _m(i,o){if(i.indexOf("-")===-1)return typeof o.is=="string";switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ym=null;function ug(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var vm=null,Nl=null,Vl=null;function Vy(i){if(i=Kc(i)){if(typeof vm!="function")throw Error(Ee(280));var o=i.stateNode;o&&(o=np(o),vm(i.stateNode,i.type,o))}}function gx(i){Nl?Vl?Vl.push(i):Vl=[i]:Nl=i}function _x(){if(Nl){var i=Nl,o=Vl;if(Vl=Nl=null,Vy(i),o)for(i=0;i<o.length;i++)Vy(o[i])}}function yx(i,o){return i(o)}function vx(){}var Ff=!1;function xx(i,o,h){if(Ff)return i(o,h);Ff=!0;try{return yx(i,o,h)}finally{Ff=!1,(Nl!==null||Vl!==null)&&(vx(),_x())}}function Ac(i,o){var h=i.stateNode;if(h===null)return null;var _=np(h);if(_===null)return null;h=_[o];e:switch(o){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(_=!_.disabled)||(i=i.type,_=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!_;break e;default:i=!1}if(i)return null;if(h&&typeof h!="function")throw Error(Ee(231,o,typeof h));return h}var xm=!1;if(As)try{var cc={};Object.defineProperty(cc,"passive",{get:function(){xm=!0}}),window.addEventListener("test",cc,cc),window.removeEventListener("test",cc,cc)}catch{xm=!1}function Fb(i,o,h,_,b,I,S,d,H){var le=Array.prototype.slice.call(arguments,3);try{o.apply(h,le)}catch(ye){this.onError(ye)}}var bc=!1,zd=null,Md=!1,wm=null,Bb={onError:function(i){bc=!0,zd=i}};function Ob(i,o,h,_,b,I,S,d,H){bc=!1,zd=null,Fb.apply(Bb,arguments)}function Nb(i,o,h,_,b,I,S,d,H){if(Ob.apply(this,arguments),bc){if(bc){var le=zd;bc=!1,zd=null}else throw Error(Ee(198));Md||(Md=!0,wm=le)}}function za(i){var o=i,h=i;if(i.alternate)for(;o.return;)o=o.return;else{i=o;do o=i,o.flags&4098&&(h=o.return),i=o.return;while(i)}return o.tag===3?h:null}function wx(i){if(i.tag===13){var o=i.memoizedState;if(o===null&&(i=i.alternate,i!==null&&(o=i.memoizedState)),o!==null)return o.dehydrated}return null}function jy(i){if(za(i)!==i)throw Error(Ee(188))}function Vb(i){var o=i.alternate;if(!o){if(o=za(i),o===null)throw Error(Ee(188));return o!==i?null:i}for(var h=i,_=o;;){var b=h.return;if(b===null)break;var I=b.alternate;if(I===null){if(_=b.return,_!==null){h=_;continue}break}if(b.child===I.child){for(I=b.child;I;){if(I===h)return jy(b),i;if(I===_)return jy(b),o;I=I.sibling}throw Error(Ee(188))}if(h.return!==_.return)h=b,_=I;else{for(var S=!1,d=b.child;d;){if(d===h){S=!0,h=b,_=I;break}if(d===_){S=!0,_=b,h=I;break}d=d.sibling}if(!S){for(d=I.child;d;){if(d===h){S=!0,h=I,_=b;break}if(d===_){S=!0,_=I,h=b;break}d=d.sibling}if(!S)throw Error(Ee(189))}}if(h.alternate!==_)throw Error(Ee(190))}if(h.tag!==3)throw Error(Ee(188));return h.stateNode.current===h?i:o}function bx(i){return i=Vb(i),i!==null?Sx(i):null}function Sx(i){if(i.tag===5||i.tag===6)return i;for(i=i.child;i!==null;){var o=Sx(i);if(o!==null)return o;i=i.sibling}return null}var Tx=on.unstable_scheduleCallback,Uy=on.unstable_cancelCallback,jb=on.unstable_shouldYield,Ub=on.unstable_requestPaint,yr=on.unstable_now,$b=on.unstable_getCurrentPriorityLevel,cg=on.unstable_ImmediatePriority,kx=on.unstable_UserBlockingPriority,Ad=on.unstable_NormalPriority,Zb=on.unstable_LowPriority,Ix=on.unstable_IdlePriority,ep=null,ss=null;function qb(i){if(ss&&typeof ss.onCommitFiberRoot=="function")try{ss.onCommitFiberRoot(ep,i,void 0,(i.current.flags&128)===128)}catch{}}var Vn=Math.clz32?Math.clz32:Wb,Gb=Math.log,Hb=Math.LN2;function Wb(i){return i>>>=0,i===0?32:31-(Gb(i)/Hb|0)|0}var nd=64,sd=4194304;function vc(i){switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return i&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return i}}function Dd(i,o){var h=i.pendingLanes;if(h===0)return 0;var _=0,b=i.suspendedLanes,I=i.pingedLanes,S=h&268435455;if(S!==0){var d=S&~b;d!==0?_=vc(d):(I&=S,I!==0&&(_=vc(I)))}else S=h&~b,S!==0?_=vc(S):I!==0&&(_=vc(I));if(_===0)return 0;if(o!==0&&o!==_&&!(o&b)&&(b=_&-_,I=o&-o,b>=I||b===16&&(I&4194240)!==0))return o;if(_&4&&(_|=h&16),o=i.entangledLanes,o!==0)for(i=i.entanglements,o&=_;0<o;)h=31-Vn(o),b=1<<h,_|=i[h],o&=~b;return _}function Xb(i,o){switch(i){case 1:case 2:case 4:return o+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Kb(i,o){for(var h=i.suspendedLanes,_=i.pingedLanes,b=i.expirationTimes,I=i.pendingLanes;0<I;){var S=31-Vn(I),d=1<<S,H=b[S];H===-1?(!(d&h)||d&_)&&(b[S]=Xb(d,o)):H<=o&&(i.expiredLanes|=d),I&=~d}}function bm(i){return i=i.pendingLanes&-1073741825,i!==0?i:i&1073741824?1073741824:0}function Ex(){var i=nd;return nd<<=1,!(nd&4194240)&&(nd=64),i}function Bf(i){for(var o=[],h=0;31>h;h++)o.push(i);return o}function Wc(i,o,h){i.pendingLanes|=o,o!==536870912&&(i.suspendedLanes=0,i.pingedLanes=0),i=i.eventTimes,o=31-Vn(o),i[o]=h}function Yb(i,o){var h=i.pendingLanes&~o;i.pendingLanes=o,i.suspendedLanes=0,i.pingedLanes=0,i.expiredLanes&=o,i.mutableReadLanes&=o,i.entangledLanes&=o,o=i.entanglements;var _=i.eventTimes;for(i=i.expirationTimes;0<h;){var b=31-Vn(h),I=1<<b;o[b]=0,_[b]=-1,i[b]=-1,h&=~I}}function hg(i,o){var h=i.entangledLanes|=o;for(i=i.entanglements;h;){var _=31-Vn(h),b=1<<_;b&o|i[_]&o&&(i[_]|=o),h&=~b}}var Zt=0;function Px(i){return i&=-i,1<i?4<i?i&268435455?16:536870912:4:1}var Cx,dg,zx,Mx,Ax,Sm=!1,od=[],Io=null,Eo=null,Po=null,Dc=new Map,Lc=new Map,bo=[],Jb="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function $y(i,o){switch(i){case"focusin":case"focusout":Io=null;break;case"dragenter":case"dragleave":Eo=null;break;case"mouseover":case"mouseout":Po=null;break;case"pointerover":case"pointerout":Dc.delete(o.pointerId);break;case"gotpointercapture":case"lostpointercapture":Lc.delete(o.pointerId)}}function hc(i,o,h,_,b,I){return i===null||i.nativeEvent!==I?(i={blockedOn:o,domEventName:h,eventSystemFlags:_,nativeEvent:I,targetContainers:[b]},o!==null&&(o=Kc(o),o!==null&&dg(o)),i):(i.eventSystemFlags|=_,o=i.targetContainers,b!==null&&o.indexOf(b)===-1&&o.push(b),i)}function Qb(i,o,h,_,b){switch(o){case"focusin":return Io=hc(Io,i,o,h,_,b),!0;case"dragenter":return Eo=hc(Eo,i,o,h,_,b),!0;case"mouseover":return Po=hc(Po,i,o,h,_,b),!0;case"pointerover":var I=b.pointerId;return Dc.set(I,hc(Dc.get(I)||null,i,o,h,_,b)),!0;case"gotpointercapture":return I=b.pointerId,Lc.set(I,hc(Lc.get(I)||null,i,o,h,_,b)),!0}return!1}function Dx(i){var o=va(i.target);if(o!==null){var h=za(o);if(h!==null){if(o=h.tag,o===13){if(o=wx(h),o!==null){i.blockedOn=o,Ax(i.priority,function(){zx(h)});return}}else if(o===3&&h.stateNode.current.memoizedState.isDehydrated){i.blockedOn=h.tag===3?h.stateNode.containerInfo:null;return}}}i.blockedOn=null}function vd(i){if(i.blockedOn!==null)return!1;for(var o=i.targetContainers;0<o.length;){var h=Tm(i.domEventName,i.eventSystemFlags,o[0],i.nativeEvent);if(h===null){h=i.nativeEvent;var _=new h.constructor(h.type,h);ym=_,h.target.dispatchEvent(_),ym=null}else return o=Kc(h),o!==null&&dg(o),i.blockedOn=h,!1;o.shift()}return!0}function Zy(i,o,h){vd(i)&&h.delete(o)}function e2(){Sm=!1,Io!==null&&vd(Io)&&(Io=null),Eo!==null&&vd(Eo)&&(Eo=null),Po!==null&&vd(Po)&&(Po=null),Dc.forEach(Zy),Lc.forEach(Zy)}function dc(i,o){i.blockedOn===o&&(i.blockedOn=null,Sm||(Sm=!0,on.unstable_scheduleCallback(on.unstable_NormalPriority,e2)))}function Rc(i){function o(b){return dc(b,i)}if(0<od.length){dc(od[0],i);for(var h=1;h<od.length;h++){var _=od[h];_.blockedOn===i&&(_.blockedOn=null)}}for(Io!==null&&dc(Io,i),Eo!==null&&dc(Eo,i),Po!==null&&dc(Po,i),Dc.forEach(o),Lc.forEach(o),h=0;h<bo.length;h++)_=bo[h],_.blockedOn===i&&(_.blockedOn=null);for(;0<bo.length&&(h=bo[0],h.blockedOn===null);)Dx(h),h.blockedOn===null&&bo.shift()}var jl=Fs.ReactCurrentBatchConfig,Ld=!0;function t2(i,o,h,_){var b=Zt,I=jl.transition;jl.transition=null;try{Zt=1,pg(i,o,h,_)}finally{Zt=b,jl.transition=I}}function r2(i,o,h,_){var b=Zt,I=jl.transition;jl.transition=null;try{Zt=4,pg(i,o,h,_)}finally{Zt=b,jl.transition=I}}function pg(i,o,h,_){if(Ld){var b=Tm(i,o,h,_);if(b===null)Hf(i,o,_,Rd,h),$y(i,_);else if(Qb(b,i,o,h,_))_.stopPropagation();else if($y(i,_),o&4&&-1<Jb.indexOf(i)){for(;b!==null;){var I=Kc(b);if(I!==null&&Cx(I),I=Tm(i,o,h,_),I===null&&Hf(i,o,_,Rd,h),I===b)break;b=I}b!==null&&_.stopPropagation()}else Hf(i,o,_,null,h)}}var Rd=null;function Tm(i,o,h,_){if(Rd=null,i=ug(_),i=va(i),i!==null)if(o=za(i),o===null)i=null;else if(h=o.tag,h===13){if(i=wx(o),i!==null)return i;i=null}else if(h===3){if(o.stateNode.current.memoizedState.isDehydrated)return o.tag===3?o.stateNode.containerInfo:null;i=null}else o!==i&&(i=null);return Rd=i,null}function Lx(i){switch(i){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch($b()){case cg:return 1;case kx:return 4;case Ad:case Zb:return 16;case Ix:return 536870912;default:return 16}default:return 16}}var To=null,fg=null,xd=null;function Rx(){if(xd)return xd;var i,o=fg,h=o.length,_,b="value"in To?To.value:To.textContent,I=b.length;for(i=0;i<h&&o[i]===b[i];i++);var S=h-i;for(_=1;_<=S&&o[h-_]===b[I-_];_++);return xd=b.slice(i,1<_?1-_:void 0)}function wd(i){var o=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&o===13&&(i=13)):i=o,i===10&&(i=13),32<=i||i===13?i:0}function ad(){return!0}function qy(){return!1}function ln(i){function o(h,_,b,I,S){this._reactName=h,this._targetInst=b,this.type=_,this.nativeEvent=I,this.target=S,this.currentTarget=null;for(var d in i)i.hasOwnProperty(d)&&(h=i[d],this[d]=h?h(I):I[d]);return this.isDefaultPrevented=(I.defaultPrevented!=null?I.defaultPrevented:I.returnValue===!1)?ad:qy,this.isPropagationStopped=qy,this}return dr(o.prototype,{preventDefault:function(){this.defaultPrevented=!0;var h=this.nativeEvent;h&&(h.preventDefault?h.preventDefault():typeof h.returnValue!="unknown"&&(h.returnValue=!1),this.isDefaultPrevented=ad)},stopPropagation:function(){var h=this.nativeEvent;h&&(h.stopPropagation?h.stopPropagation():typeof h.cancelBubble!="unknown"&&(h.cancelBubble=!0),this.isPropagationStopped=ad)},persist:function(){},isPersistent:ad}),o}var Ql={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},mg=ln(Ql),Xc=dr({},Ql,{view:0,detail:0}),i2=ln(Xc),Of,Nf,pc,tp=dr({},Xc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:gg,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==pc&&(pc&&i.type==="mousemove"?(Of=i.screenX-pc.screenX,Nf=i.screenY-pc.screenY):Nf=Of=0,pc=i),Of)},movementY:function(i){return"movementY"in i?i.movementY:Nf}}),Gy=ln(tp),n2=dr({},tp,{dataTransfer:0}),s2=ln(n2),o2=dr({},Xc,{relatedTarget:0}),Vf=ln(o2),a2=dr({},Ql,{animationName:0,elapsedTime:0,pseudoElement:0}),l2=ln(a2),u2=dr({},Ql,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),c2=ln(u2),h2=dr({},Ql,{data:0}),Hy=ln(h2),d2={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},p2={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},f2={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function m2(i){var o=this.nativeEvent;return o.getModifierState?o.getModifierState(i):(i=f2[i])?!!o[i]:!1}function gg(){return m2}var g2=dr({},Xc,{key:function(i){if(i.key){var o=d2[i.key]||i.key;if(o!=="Unidentified")return o}return i.type==="keypress"?(i=wd(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?p2[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:gg,charCode:function(i){return i.type==="keypress"?wd(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?wd(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),_2=ln(g2),y2=dr({},tp,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Wy=ln(y2),v2=dr({},Xc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:gg}),x2=ln(v2),w2=dr({},Ql,{propertyName:0,elapsedTime:0,pseudoElement:0}),b2=ln(w2),S2=dr({},tp,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),T2=ln(S2),k2=[9,13,27,32],_g=As&&"CompositionEvent"in window,Sc=null;As&&"documentMode"in document&&(Sc=document.documentMode);var I2=As&&"TextEvent"in window&&!Sc,Fx=As&&(!_g||Sc&&8<Sc&&11>=Sc),Xy=" ",Ky=!1;function Bx(i,o){switch(i){case"keyup":return k2.indexOf(o.keyCode)!==-1;case"keydown":return o.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Ox(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var Pl=!1;function E2(i,o){switch(i){case"compositionend":return Ox(o);case"keypress":return o.which!==32?null:(Ky=!0,Xy);case"textInput":return i=o.data,i===Xy&&Ky?null:i;default:return null}}function P2(i,o){if(Pl)return i==="compositionend"||!_g&&Bx(i,o)?(i=Rx(),xd=fg=To=null,Pl=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(o.ctrlKey||o.altKey||o.metaKey)||o.ctrlKey&&o.altKey){if(o.char&&1<o.char.length)return o.char;if(o.which)return String.fromCharCode(o.which)}return null;case"compositionend":return Fx&&o.locale!=="ko"?null:o.data;default:return null}}var C2={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Yy(i){var o=i&&i.nodeName&&i.nodeName.toLowerCase();return o==="input"?!!C2[i.type]:o==="textarea"}function Nx(i,o,h,_){gx(_),o=Fd(o,"onChange"),0<o.length&&(h=new mg("onChange","change",null,h,_),i.push({event:h,listeners:o}))}var Tc=null,Fc=null;function z2(i){Kx(i,0)}function rp(i){var o=Ml(i);if(ux(o))return i}function M2(i,o){if(i==="change")return o}var Vx=!1;if(As){var jf;if(As){var Uf="oninput"in document;if(!Uf){var Jy=document.createElement("div");Jy.setAttribute("oninput","return;"),Uf=typeof Jy.oninput=="function"}jf=Uf}else jf=!1;Vx=jf&&(!document.documentMode||9<document.documentMode)}function Qy(){Tc&&(Tc.detachEvent("onpropertychange",jx),Fc=Tc=null)}function jx(i){if(i.propertyName==="value"&&rp(Fc)){var o=[];Nx(o,Fc,i,ug(i)),xx(z2,o)}}function A2(i,o,h){i==="focusin"?(Qy(),Tc=o,Fc=h,Tc.attachEvent("onpropertychange",jx)):i==="focusout"&&Qy()}function D2(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return rp(Fc)}function L2(i,o){if(i==="click")return rp(o)}function R2(i,o){if(i==="input"||i==="change")return rp(o)}function F2(i,o){return i===o&&(i!==0||1/i===1/o)||i!==i&&o!==o}var Un=typeof Object.is=="function"?Object.is:F2;function Bc(i,o){if(Un(i,o))return!0;if(typeof i!="object"||i===null||typeof o!="object"||o===null)return!1;var h=Object.keys(i),_=Object.keys(o);if(h.length!==_.length)return!1;for(_=0;_<h.length;_++){var b=h[_];if(!om.call(o,b)||!Un(i[b],o[b]))return!1}return!0}function ev(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function tv(i,o){var h=ev(i);i=0;for(var _;h;){if(h.nodeType===3){if(_=i+h.textContent.length,i<=o&&_>=o)return{node:h,offset:o-i};i=_}e:{for(;h;){if(h.nextSibling){h=h.nextSibling;break e}h=h.parentNode}h=void 0}h=ev(h)}}function Ux(i,o){return i&&o?i===o?!0:i&&i.nodeType===3?!1:o&&o.nodeType===3?Ux(i,o.parentNode):"contains"in i?i.contains(o):i.compareDocumentPosition?!!(i.compareDocumentPosition(o)&16):!1:!1}function $x(){for(var i=window,o=Cd();o instanceof i.HTMLIFrameElement;){try{var h=typeof o.contentWindow.location.href=="string"}catch{h=!1}if(h)i=o.contentWindow;else break;o=Cd(i.document)}return o}function yg(i){var o=i&&i.nodeName&&i.nodeName.toLowerCase();return o&&(o==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||o==="textarea"||i.contentEditable==="true")}function B2(i){var o=$x(),h=i.focusedElem,_=i.selectionRange;if(o!==h&&h&&h.ownerDocument&&Ux(h.ownerDocument.documentElement,h)){if(_!==null&&yg(h)){if(o=_.start,i=_.end,i===void 0&&(i=o),"selectionStart"in h)h.selectionStart=o,h.selectionEnd=Math.min(i,h.value.length);else if(i=(o=h.ownerDocument||document)&&o.defaultView||window,i.getSelection){i=i.getSelection();var b=h.textContent.length,I=Math.min(_.start,b);_=_.end===void 0?I:Math.min(_.end,b),!i.extend&&I>_&&(b=_,_=I,I=b),b=tv(h,I);var S=tv(h,_);b&&S&&(i.rangeCount!==1||i.anchorNode!==b.node||i.anchorOffset!==b.offset||i.focusNode!==S.node||i.focusOffset!==S.offset)&&(o=o.createRange(),o.setStart(b.node,b.offset),i.removeAllRanges(),I>_?(i.addRange(o),i.extend(S.node,S.offset)):(o.setEnd(S.node,S.offset),i.addRange(o)))}}for(o=[],i=h;i=i.parentNode;)i.nodeType===1&&o.push({element:i,left:i.scrollLeft,top:i.scrollTop});for(typeof h.focus=="function"&&h.focus(),h=0;h<o.length;h++)i=o[h],i.element.scrollLeft=i.left,i.element.scrollTop=i.top}}var O2=As&&"documentMode"in document&&11>=document.documentMode,Cl=null,km=null,kc=null,Im=!1;function rv(i,o,h){var _=h.window===h?h.document:h.nodeType===9?h:h.ownerDocument;Im||Cl==null||Cl!==Cd(_)||(_=Cl,"selectionStart"in _&&yg(_)?_={start:_.selectionStart,end:_.selectionEnd}:(_=(_.ownerDocument&&_.ownerDocument.defaultView||window).getSelection(),_={anchorNode:_.anchorNode,anchorOffset:_.anchorOffset,focusNode:_.focusNode,focusOffset:_.focusOffset}),kc&&Bc(kc,_)||(kc=_,_=Fd(km,"onSelect"),0<_.length&&(o=new mg("onSelect","select",null,o,h),i.push({event:o,listeners:_}),o.target=Cl)))}function ld(i,o){var h={};return h[i.toLowerCase()]=o.toLowerCase(),h["Webkit"+i]="webkit"+o,h["Moz"+i]="moz"+o,h}var zl={animationend:ld("Animation","AnimationEnd"),animationiteration:ld("Animation","AnimationIteration"),animationstart:ld("Animation","AnimationStart"),transitionend:ld("Transition","TransitionEnd")},$f={},Zx={};As&&(Zx=document.createElement("div").style,"AnimationEvent"in window||(delete zl.animationend.animation,delete zl.animationiteration.animation,delete zl.animationstart.animation),"TransitionEvent"in window||delete zl.transitionend.transition);function ip(i){if($f[i])return $f[i];if(!zl[i])return i;var o=zl[i],h;for(h in o)if(o.hasOwnProperty(h)&&h in Zx)return $f[i]=o[h];return i}var qx=ip("animationend"),Gx=ip("animationiteration"),Hx=ip("animationstart"),Wx=ip("transitionend"),Xx=new Map,iv="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Fo(i,o){Xx.set(i,o),Ca(o,[i])}for(var Zf=0;Zf<iv.length;Zf++){var qf=iv[Zf],N2=qf.toLowerCase(),V2=qf[0].toUpperCase()+qf.slice(1);Fo(N2,"on"+V2)}Fo(qx,"onAnimationEnd");Fo(Gx,"onAnimationIteration");Fo(Hx,"onAnimationStart");Fo("dblclick","onDoubleClick");Fo("focusin","onFocus");Fo("focusout","onBlur");Fo(Wx,"onTransitionEnd");Zl("onMouseEnter",["mouseout","mouseover"]);Zl("onMouseLeave",["mouseout","mouseover"]);Zl("onPointerEnter",["pointerout","pointerover"]);Zl("onPointerLeave",["pointerout","pointerover"]);Ca("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ca("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ca("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ca("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ca("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ca("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var xc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),j2=new Set("cancel close invalid load scroll toggle".split(" ").concat(xc));function nv(i,o,h){var _=i.type||"unknown-event";i.currentTarget=h,Nb(_,o,void 0,i),i.currentTarget=null}function Kx(i,o){o=(o&4)!==0;for(var h=0;h<i.length;h++){var _=i[h],b=_.event;_=_.listeners;e:{var I=void 0;if(o)for(var S=_.length-1;0<=S;S--){var d=_[S],H=d.instance,le=d.currentTarget;if(d=d.listener,H!==I&&b.isPropagationStopped())break e;nv(b,d,le),I=H}else for(S=0;S<_.length;S++){if(d=_[S],H=d.instance,le=d.currentTarget,d=d.listener,H!==I&&b.isPropagationStopped())break e;nv(b,d,le),I=H}}}if(Md)throw i=wm,Md=!1,wm=null,i}function tr(i,o){var h=o[Mm];h===void 0&&(h=o[Mm]=new Set);var _=i+"__bubble";h.has(_)||(Yx(o,i,2,!1),h.add(_))}function Gf(i,o,h){var _=0;o&&(_|=4),Yx(h,i,_,o)}var ud="_reactListening"+Math.random().toString(36).slice(2);function Oc(i){if(!i[ud]){i[ud]=!0,nx.forEach(function(h){h!=="selectionchange"&&(j2.has(h)||Gf(h,!1,i),Gf(h,!0,i))});var o=i.nodeType===9?i:i.ownerDocument;o===null||o[ud]||(o[ud]=!0,Gf("selectionchange",!1,o))}}function Yx(i,o,h,_){switch(Lx(o)){case 1:var b=t2;break;case 4:b=r2;break;default:b=pg}h=b.bind(null,o,h,i),b=void 0,!xm||o!=="touchstart"&&o!=="touchmove"&&o!=="wheel"||(b=!0),_?b!==void 0?i.addEventListener(o,h,{capture:!0,passive:b}):i.addEventListener(o,h,!0):b!==void 0?i.addEventListener(o,h,{passive:b}):i.addEventListener(o,h,!1)}function Hf(i,o,h,_,b){var I=_;if(!(o&1)&&!(o&2)&&_!==null)e:for(;;){if(_===null)return;var S=_.tag;if(S===3||S===4){var d=_.stateNode.containerInfo;if(d===b||d.nodeType===8&&d.parentNode===b)break;if(S===4)for(S=_.return;S!==null;){var H=S.tag;if((H===3||H===4)&&(H=S.stateNode.containerInfo,H===b||H.nodeType===8&&H.parentNode===b))return;S=S.return}for(;d!==null;){if(S=va(d),S===null)return;if(H=S.tag,H===5||H===6){_=I=S;continue e}d=d.parentNode}}_=_.return}xx(function(){var le=I,ye=ug(h),re=[];e:{var q=Xx.get(i);if(q!==void 0){var ke=mg,Pe=i;switch(i){case"keypress":if(wd(h)===0)break e;case"keydown":case"keyup":ke=_2;break;case"focusin":Pe="focus",ke=Vf;break;case"focusout":Pe="blur",ke=Vf;break;case"beforeblur":case"afterblur":ke=Vf;break;case"click":if(h.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ke=Gy;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ke=s2;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ke=x2;break;case qx:case Gx:case Hx:ke=l2;break;case Wx:ke=b2;break;case"scroll":ke=i2;break;case"wheel":ke=T2;break;case"copy":case"cut":case"paste":ke=c2;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ke=Wy}var Fe=(o&4)!==0,Ct=!Fe&&i==="scroll",ce=Fe?q!==null?q+"Capture":null:q;Fe=[];for(var ie=le,de;ie!==null;){de=ie;var Te=de.stateNode;if(de.tag===5&&Te!==null&&(de=Te,ce!==null&&(Te=Ac(ie,ce),Te!=null&&Fe.push(Nc(ie,Te,de)))),Ct)break;ie=ie.return}0<Fe.length&&(q=new ke(q,Pe,null,h,ye),re.push({event:q,listeners:Fe}))}}if(!(o&7)){e:{if(q=i==="mouseover"||i==="pointerover",ke=i==="mouseout"||i==="pointerout",q&&h!==ym&&(Pe=h.relatedTarget||h.fromElement)&&(va(Pe)||Pe[Ds]))break e;if((ke||q)&&(q=ye.window===ye?ye:(q=ye.ownerDocument)?q.defaultView||q.parentWindow:window,ke?(Pe=h.relatedTarget||h.toElement,ke=le,Pe=Pe?va(Pe):null,Pe!==null&&(Ct=za(Pe),Pe!==Ct||Pe.tag!==5&&Pe.tag!==6)&&(Pe=null)):(ke=null,Pe=le),ke!==Pe)){if(Fe=Gy,Te="onMouseLeave",ce="onMouseEnter",ie="mouse",(i==="pointerout"||i==="pointerover")&&(Fe=Wy,Te="onPointerLeave",ce="onPointerEnter",ie="pointer"),Ct=ke==null?q:Ml(ke),de=Pe==null?q:Ml(Pe),q=new Fe(Te,ie+"leave",ke,h,ye),q.target=Ct,q.relatedTarget=de,Te=null,va(ye)===le&&(Fe=new Fe(ce,ie+"enter",Pe,h,ye),Fe.target=de,Fe.relatedTarget=Ct,Te=Fe),Ct=Te,ke&&Pe)t:{for(Fe=ke,ce=Pe,ie=0,de=Fe;de;de=kl(de))ie++;for(de=0,Te=ce;Te;Te=kl(Te))de++;for(;0<ie-de;)Fe=kl(Fe),ie--;for(;0<de-ie;)ce=kl(ce),de--;for(;ie--;){if(Fe===ce||ce!==null&&Fe===ce.alternate)break t;Fe=kl(Fe),ce=kl(ce)}Fe=null}else Fe=null;ke!==null&&sv(re,q,ke,Fe,!1),Pe!==null&&Ct!==null&&sv(re,Ct,Pe,Fe,!0)}}e:{if(q=le?Ml(le):window,ke=q.nodeName&&q.nodeName.toLowerCase(),ke==="select"||ke==="input"&&q.type==="file")var je=M2;else if(Yy(q))if(Vx)je=R2;else{je=D2;var Xe=A2}else(ke=q.nodeName)&&ke.toLowerCase()==="input"&&(q.type==="checkbox"||q.type==="radio")&&(je=L2);if(je&&(je=je(i,le))){Nx(re,je,h,ye);break e}Xe&&Xe(i,q,le),i==="focusout"&&(Xe=q._wrapperState)&&Xe.controlled&&q.type==="number"&&pm(q,"number",q.value)}switch(Xe=le?Ml(le):window,i){case"focusin":(Yy(Xe)||Xe.contentEditable==="true")&&(Cl=Xe,km=le,kc=null);break;case"focusout":kc=km=Cl=null;break;case"mousedown":Im=!0;break;case"contextmenu":case"mouseup":case"dragend":Im=!1,rv(re,h,ye);break;case"selectionchange":if(O2)break;case"keydown":case"keyup":rv(re,h,ye)}var qe;if(_g)e:{switch(i){case"compositionstart":var rt="onCompositionStart";break e;case"compositionend":rt="onCompositionEnd";break e;case"compositionupdate":rt="onCompositionUpdate";break e}rt=void 0}else Pl?Bx(i,h)&&(rt="onCompositionEnd"):i==="keydown"&&h.keyCode===229&&(rt="onCompositionStart");rt&&(Fx&&h.locale!=="ko"&&(Pl||rt!=="onCompositionStart"?rt==="onCompositionEnd"&&Pl&&(qe=Rx()):(To=ye,fg="value"in To?To.value:To.textContent,Pl=!0)),Xe=Fd(le,rt),0<Xe.length&&(rt=new Hy(rt,i,null,h,ye),re.push({event:rt,listeners:Xe}),qe?rt.data=qe:(qe=Ox(h),qe!==null&&(rt.data=qe)))),(qe=I2?E2(i,h):P2(i,h))&&(le=Fd(le,"onBeforeInput"),0<le.length&&(ye=new Hy("onBeforeInput","beforeinput",null,h,ye),re.push({event:ye,listeners:le}),ye.data=qe))}Kx(re,o)})}function Nc(i,o,h){return{instance:i,listener:o,currentTarget:h}}function Fd(i,o){for(var h=o+"Capture",_=[];i!==null;){var b=i,I=b.stateNode;b.tag===5&&I!==null&&(b=I,I=Ac(i,h),I!=null&&_.unshift(Nc(i,I,b)),I=Ac(i,o),I!=null&&_.push(Nc(i,I,b))),i=i.return}return _}function kl(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5);return i||null}function sv(i,o,h,_,b){for(var I=o._reactName,S=[];h!==null&&h!==_;){var d=h,H=d.alternate,le=d.stateNode;if(H!==null&&H===_)break;d.tag===5&&le!==null&&(d=le,b?(H=Ac(h,I),H!=null&&S.unshift(Nc(h,H,d))):b||(H=Ac(h,I),H!=null&&S.push(Nc(h,H,d)))),h=h.return}S.length!==0&&i.push({event:o,listeners:S})}var U2=/\r\n?/g,$2=/\u0000|\uFFFD/g;function ov(i){return(typeof i=="string"?i:""+i).replace(U2,`
`).replace($2,"")}function cd(i,o,h){if(o=ov(o),ov(i)!==o&&h)throw Error(Ee(425))}function Bd(){}var Em=null,Pm=null;function Cm(i,o){return i==="textarea"||i==="noscript"||typeof o.children=="string"||typeof o.children=="number"||typeof o.dangerouslySetInnerHTML=="object"&&o.dangerouslySetInnerHTML!==null&&o.dangerouslySetInnerHTML.__html!=null}var zm=typeof setTimeout=="function"?setTimeout:void 0,Z2=typeof clearTimeout=="function"?clearTimeout:void 0,av=typeof Promise=="function"?Promise:void 0,q2=typeof queueMicrotask=="function"?queueMicrotask:typeof av<"u"?function(i){return av.resolve(null).then(i).catch(G2)}:zm;function G2(i){setTimeout(function(){throw i})}function Wf(i,o){var h=o,_=0;do{var b=h.nextSibling;if(i.removeChild(h),b&&b.nodeType===8)if(h=b.data,h==="/$"){if(_===0){i.removeChild(b),Rc(o);return}_--}else h!=="$"&&h!=="$?"&&h!=="$!"||_++;h=b}while(h);Rc(o)}function Co(i){for(;i!=null;i=i.nextSibling){var o=i.nodeType;if(o===1||o===3)break;if(o===8){if(o=i.data,o==="$"||o==="$!"||o==="$?")break;if(o==="/$")return null}}return i}function lv(i){i=i.previousSibling;for(var o=0;i;){if(i.nodeType===8){var h=i.data;if(h==="$"||h==="$!"||h==="$?"){if(o===0)return i;o--}else h==="/$"&&o++}i=i.previousSibling}return null}var eu=Math.random().toString(36).slice(2),ns="__reactFiber$"+eu,Vc="__reactProps$"+eu,Ds="__reactContainer$"+eu,Mm="__reactEvents$"+eu,H2="__reactListeners$"+eu,W2="__reactHandles$"+eu;function va(i){var o=i[ns];if(o)return o;for(var h=i.parentNode;h;){if(o=h[Ds]||h[ns]){if(h=o.alternate,o.child!==null||h!==null&&h.child!==null)for(i=lv(i);i!==null;){if(h=i[ns])return h;i=lv(i)}return o}i=h,h=i.parentNode}return null}function Kc(i){return i=i[ns]||i[Ds],!i||i.tag!==5&&i.tag!==6&&i.tag!==13&&i.tag!==3?null:i}function Ml(i){if(i.tag===5||i.tag===6)return i.stateNode;throw Error(Ee(33))}function np(i){return i[Vc]||null}var Am=[],Al=-1;function Bo(i){return{current:i}}function rr(i){0>Al||(i.current=Am[Al],Am[Al]=null,Al--)}function Yt(i,o){Al++,Am[Al]=i.current,i.current=o}var Ro={},pi=Bo(Ro),Bi=Bo(!1),Ta=Ro;function ql(i,o){var h=i.type.contextTypes;if(!h)return Ro;var _=i.stateNode;if(_&&_.__reactInternalMemoizedUnmaskedChildContext===o)return _.__reactInternalMemoizedMaskedChildContext;var b={},I;for(I in h)b[I]=o[I];return _&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=o,i.__reactInternalMemoizedMaskedChildContext=b),b}function Oi(i){return i=i.childContextTypes,i!=null}function Od(){rr(Bi),rr(pi)}function uv(i,o,h){if(pi.current!==Ro)throw Error(Ee(168));Yt(pi,o),Yt(Bi,h)}function Jx(i,o,h){var _=i.stateNode;if(o=o.childContextTypes,typeof _.getChildContext!="function")return h;_=_.getChildContext();for(var b in _)if(!(b in o))throw Error(Ee(108,Ab(i)||"Unknown",b));return dr({},h,_)}function Nd(i){return i=(i=i.stateNode)&&i.__reactInternalMemoizedMergedChildContext||Ro,Ta=pi.current,Yt(pi,i),Yt(Bi,Bi.current),!0}function cv(i,o,h){var _=i.stateNode;if(!_)throw Error(Ee(169));h?(i=Jx(i,o,Ta),_.__reactInternalMemoizedMergedChildContext=i,rr(Bi),rr(pi),Yt(pi,i)):rr(Bi),Yt(Bi,h)}var Ps=null,sp=!1,Xf=!1;function Qx(i){Ps===null?Ps=[i]:Ps.push(i)}function X2(i){sp=!0,Qx(i)}function Oo(){if(!Xf&&Ps!==null){Xf=!0;var i=0,o=Zt;try{var h=Ps;for(Zt=1;i<h.length;i++){var _=h[i];do _=_(!0);while(_!==null)}Ps=null,sp=!1}catch(b){throw Ps!==null&&(Ps=Ps.slice(i+1)),Tx(cg,Oo),b}finally{Zt=o,Xf=!1}}return null}var Dl=[],Ll=0,Vd=null,jd=0,wn=[],bn=0,ka=null,Cs=1,zs="";function _a(i,o){Dl[Ll++]=jd,Dl[Ll++]=Vd,Vd=i,jd=o}function e0(i,o,h){wn[bn++]=Cs,wn[bn++]=zs,wn[bn++]=ka,ka=i;var _=Cs;i=zs;var b=32-Vn(_)-1;_&=~(1<<b),h+=1;var I=32-Vn(o)+b;if(30<I){var S=b-b%5;I=(_&(1<<S)-1).toString(32),_>>=S,b-=S,Cs=1<<32-Vn(o)+b|h<<b|_,zs=I+i}else Cs=1<<I|h<<b|_,zs=i}function vg(i){i.return!==null&&(_a(i,1),e0(i,1,0))}function xg(i){for(;i===Vd;)Vd=Dl[--Ll],Dl[Ll]=null,jd=Dl[--Ll],Dl[Ll]=null;for(;i===ka;)ka=wn[--bn],wn[bn]=null,zs=wn[--bn],wn[bn]=null,Cs=wn[--bn],wn[bn]=null}var sn=null,nn=null,ar=!1,On=null;function t0(i,o){var h=Sn(5,null,null,0);h.elementType="DELETED",h.stateNode=o,h.return=i,o=i.deletions,o===null?(i.deletions=[h],i.flags|=16):o.push(h)}function hv(i,o){switch(i.tag){case 5:var h=i.type;return o=o.nodeType!==1||h.toLowerCase()!==o.nodeName.toLowerCase()?null:o,o!==null?(i.stateNode=o,sn=i,nn=Co(o.firstChild),!0):!1;case 6:return o=i.pendingProps===""||o.nodeType!==3?null:o,o!==null?(i.stateNode=o,sn=i,nn=null,!0):!1;case 13:return o=o.nodeType!==8?null:o,o!==null?(h=ka!==null?{id:Cs,overflow:zs}:null,i.memoizedState={dehydrated:o,treeContext:h,retryLane:1073741824},h=Sn(18,null,null,0),h.stateNode=o,h.return=i,i.child=h,sn=i,nn=null,!0):!1;default:return!1}}function Dm(i){return(i.mode&1)!==0&&(i.flags&128)===0}function Lm(i){if(ar){var o=nn;if(o){var h=o;if(!hv(i,o)){if(Dm(i))throw Error(Ee(418));o=Co(h.nextSibling);var _=sn;o&&hv(i,o)?t0(_,h):(i.flags=i.flags&-4097|2,ar=!1,sn=i)}}else{if(Dm(i))throw Error(Ee(418));i.flags=i.flags&-4097|2,ar=!1,sn=i}}}function dv(i){for(i=i.return;i!==null&&i.tag!==5&&i.tag!==3&&i.tag!==13;)i=i.return;sn=i}function hd(i){if(i!==sn)return!1;if(!ar)return dv(i),ar=!0,!1;var o;if((o=i.tag!==3)&&!(o=i.tag!==5)&&(o=i.type,o=o!=="head"&&o!=="body"&&!Cm(i.type,i.memoizedProps)),o&&(o=nn)){if(Dm(i))throw r0(),Error(Ee(418));for(;o;)t0(i,o),o=Co(o.nextSibling)}if(dv(i),i.tag===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(Ee(317));e:{for(i=i.nextSibling,o=0;i;){if(i.nodeType===8){var h=i.data;if(h==="/$"){if(o===0){nn=Co(i.nextSibling);break e}o--}else h!=="$"&&h!=="$!"&&h!=="$?"||o++}i=i.nextSibling}nn=null}}else nn=sn?Co(i.stateNode.nextSibling):null;return!0}function r0(){for(var i=nn;i;)i=Co(i.nextSibling)}function Gl(){nn=sn=null,ar=!1}function wg(i){On===null?On=[i]:On.push(i)}var K2=Fs.ReactCurrentBatchConfig;function fc(i,o,h){if(i=h.ref,i!==null&&typeof i!="function"&&typeof i!="object"){if(h._owner){if(h=h._owner,h){if(h.tag!==1)throw Error(Ee(309));var _=h.stateNode}if(!_)throw Error(Ee(147,i));var b=_,I=""+i;return o!==null&&o.ref!==null&&typeof o.ref=="function"&&o.ref._stringRef===I?o.ref:(o=function(S){var d=b.refs;S===null?delete d[I]:d[I]=S},o._stringRef=I,o)}if(typeof i!="string")throw Error(Ee(284));if(!h._owner)throw Error(Ee(290,i))}return i}function dd(i,o){throw i=Object.prototype.toString.call(o),Error(Ee(31,i==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":i))}function pv(i){var o=i._init;return o(i._payload)}function i0(i){function o(ce,ie){if(i){var de=ce.deletions;de===null?(ce.deletions=[ie],ce.flags|=16):de.push(ie)}}function h(ce,ie){if(!i)return null;for(;ie!==null;)o(ce,ie),ie=ie.sibling;return null}function _(ce,ie){for(ce=new Map;ie!==null;)ie.key!==null?ce.set(ie.key,ie):ce.set(ie.index,ie),ie=ie.sibling;return ce}function b(ce,ie){return ce=Do(ce,ie),ce.index=0,ce.sibling=null,ce}function I(ce,ie,de){return ce.index=de,i?(de=ce.alternate,de!==null?(de=de.index,de<ie?(ce.flags|=2,ie):de):(ce.flags|=2,ie)):(ce.flags|=1048576,ie)}function S(ce){return i&&ce.alternate===null&&(ce.flags|=2),ce}function d(ce,ie,de,Te){return ie===null||ie.tag!==6?(ie=rm(de,ce.mode,Te),ie.return=ce,ie):(ie=b(ie,de),ie.return=ce,ie)}function H(ce,ie,de,Te){var je=de.type;return je===El?ye(ce,ie,de.props.children,Te,de.key):ie!==null&&(ie.elementType===je||typeof je=="object"&&je!==null&&je.$$typeof===xo&&pv(je)===ie.type)?(Te=b(ie,de.props),Te.ref=fc(ce,ie,de),Te.return=ce,Te):(Te=Pd(de.type,de.key,de.props,null,ce.mode,Te),Te.ref=fc(ce,ie,de),Te.return=ce,Te)}function le(ce,ie,de,Te){return ie===null||ie.tag!==4||ie.stateNode.containerInfo!==de.containerInfo||ie.stateNode.implementation!==de.implementation?(ie=im(de,ce.mode,Te),ie.return=ce,ie):(ie=b(ie,de.children||[]),ie.return=ce,ie)}function ye(ce,ie,de,Te,je){return ie===null||ie.tag!==7?(ie=Sa(de,ce.mode,Te,je),ie.return=ce,ie):(ie=b(ie,de),ie.return=ce,ie)}function re(ce,ie,de){if(typeof ie=="string"&&ie!==""||typeof ie=="number")return ie=rm(""+ie,ce.mode,de),ie.return=ce,ie;if(typeof ie=="object"&&ie!==null){switch(ie.$$typeof){case td:return de=Pd(ie.type,ie.key,ie.props,null,ce.mode,de),de.ref=fc(ce,null,ie),de.return=ce,de;case Il:return ie=im(ie,ce.mode,de),ie.return=ce,ie;case xo:var Te=ie._init;return re(ce,Te(ie._payload),de)}if(yc(ie)||uc(ie))return ie=Sa(ie,ce.mode,de,null),ie.return=ce,ie;dd(ce,ie)}return null}function q(ce,ie,de,Te){var je=ie!==null?ie.key:null;if(typeof de=="string"&&de!==""||typeof de=="number")return je!==null?null:d(ce,ie,""+de,Te);if(typeof de=="object"&&de!==null){switch(de.$$typeof){case td:return de.key===je?H(ce,ie,de,Te):null;case Il:return de.key===je?le(ce,ie,de,Te):null;case xo:return je=de._init,q(ce,ie,je(de._payload),Te)}if(yc(de)||uc(de))return je!==null?null:ye(ce,ie,de,Te,null);dd(ce,de)}return null}function ke(ce,ie,de,Te,je){if(typeof Te=="string"&&Te!==""||typeof Te=="number")return ce=ce.get(de)||null,d(ie,ce,""+Te,je);if(typeof Te=="object"&&Te!==null){switch(Te.$$typeof){case td:return ce=ce.get(Te.key===null?de:Te.key)||null,H(ie,ce,Te,je);case Il:return ce=ce.get(Te.key===null?de:Te.key)||null,le(ie,ce,Te,je);case xo:var Xe=Te._init;return ke(ce,ie,de,Xe(Te._payload),je)}if(yc(Te)||uc(Te))return ce=ce.get(de)||null,ye(ie,ce,Te,je,null);dd(ie,Te)}return null}function Pe(ce,ie,de,Te){for(var je=null,Xe=null,qe=ie,rt=ie=0,At=null;qe!==null&&rt<de.length;rt++){qe.index>rt?(At=qe,qe=null):At=qe.sibling;var gt=q(ce,qe,de[rt],Te);if(gt===null){qe===null&&(qe=At);break}i&&qe&&gt.alternate===null&&o(ce,qe),ie=I(gt,ie,rt),Xe===null?je=gt:Xe.sibling=gt,Xe=gt,qe=At}if(rt===de.length)return h(ce,qe),ar&&_a(ce,rt),je;if(qe===null){for(;rt<de.length;rt++)qe=re(ce,de[rt],Te),qe!==null&&(ie=I(qe,ie,rt),Xe===null?je=qe:Xe.sibling=qe,Xe=qe);return ar&&_a(ce,rt),je}for(qe=_(ce,qe);rt<de.length;rt++)At=ke(qe,ce,rt,de[rt],Te),At!==null&&(i&&At.alternate!==null&&qe.delete(At.key===null?rt:At.key),ie=I(At,ie,rt),Xe===null?je=At:Xe.sibling=At,Xe=At);return i&&qe.forEach(function(_t){return o(ce,_t)}),ar&&_a(ce,rt),je}function Fe(ce,ie,de,Te){var je=uc(de);if(typeof je!="function")throw Error(Ee(150));if(de=je.call(de),de==null)throw Error(Ee(151));for(var Xe=je=null,qe=ie,rt=ie=0,At=null,gt=de.next();qe!==null&&!gt.done;rt++,gt=de.next()){qe.index>rt?(At=qe,qe=null):At=qe.sibling;var _t=q(ce,qe,gt.value,Te);if(_t===null){qe===null&&(qe=At);break}i&&qe&&_t.alternate===null&&o(ce,qe),ie=I(_t,ie,rt),Xe===null?je=_t:Xe.sibling=_t,Xe=_t,qe=At}if(gt.done)return h(ce,qe),ar&&_a(ce,rt),je;if(qe===null){for(;!gt.done;rt++,gt=de.next())gt=re(ce,gt.value,Te),gt!==null&&(ie=I(gt,ie,rt),Xe===null?je=gt:Xe.sibling=gt,Xe=gt);return ar&&_a(ce,rt),je}for(qe=_(ce,qe);!gt.done;rt++,gt=de.next())gt=ke(qe,ce,rt,gt.value,Te),gt!==null&&(i&&gt.alternate!==null&&qe.delete(gt.key===null?rt:gt.key),ie=I(gt,ie,rt),Xe===null?je=gt:Xe.sibling=gt,Xe=gt);return i&&qe.forEach(function(un){return o(ce,un)}),ar&&_a(ce,rt),je}function Ct(ce,ie,de,Te){if(typeof de=="object"&&de!==null&&de.type===El&&de.key===null&&(de=de.props.children),typeof de=="object"&&de!==null){switch(de.$$typeof){case td:e:{for(var je=de.key,Xe=ie;Xe!==null;){if(Xe.key===je){if(je=de.type,je===El){if(Xe.tag===7){h(ce,Xe.sibling),ie=b(Xe,de.props.children),ie.return=ce,ce=ie;break e}}else if(Xe.elementType===je||typeof je=="object"&&je!==null&&je.$$typeof===xo&&pv(je)===Xe.type){h(ce,Xe.sibling),ie=b(Xe,de.props),ie.ref=fc(ce,Xe,de),ie.return=ce,ce=ie;break e}h(ce,Xe);break}else o(ce,Xe);Xe=Xe.sibling}de.type===El?(ie=Sa(de.props.children,ce.mode,Te,de.key),ie.return=ce,ce=ie):(Te=Pd(de.type,de.key,de.props,null,ce.mode,Te),Te.ref=fc(ce,ie,de),Te.return=ce,ce=Te)}return S(ce);case Il:e:{for(Xe=de.key;ie!==null;){if(ie.key===Xe)if(ie.tag===4&&ie.stateNode.containerInfo===de.containerInfo&&ie.stateNode.implementation===de.implementation){h(ce,ie.sibling),ie=b(ie,de.children||[]),ie.return=ce,ce=ie;break e}else{h(ce,ie);break}else o(ce,ie);ie=ie.sibling}ie=im(de,ce.mode,Te),ie.return=ce,ce=ie}return S(ce);case xo:return Xe=de._init,Ct(ce,ie,Xe(de._payload),Te)}if(yc(de))return Pe(ce,ie,de,Te);if(uc(de))return Fe(ce,ie,de,Te);dd(ce,de)}return typeof de=="string"&&de!==""||typeof de=="number"?(de=""+de,ie!==null&&ie.tag===6?(h(ce,ie.sibling),ie=b(ie,de),ie.return=ce,ce=ie):(h(ce,ie),ie=rm(de,ce.mode,Te),ie.return=ce,ce=ie),S(ce)):h(ce,ie)}return Ct}var Hl=i0(!0),n0=i0(!1),Ud=Bo(null),$d=null,Rl=null,bg=null;function Sg(){bg=Rl=$d=null}function Tg(i){var o=Ud.current;rr(Ud),i._currentValue=o}function Rm(i,o,h){for(;i!==null;){var _=i.alternate;if((i.childLanes&o)!==o?(i.childLanes|=o,_!==null&&(_.childLanes|=o)):_!==null&&(_.childLanes&o)!==o&&(_.childLanes|=o),i===h)break;i=i.return}}function Ul(i,o){$d=i,bg=Rl=null,i=i.dependencies,i!==null&&i.firstContext!==null&&(i.lanes&o&&(Fi=!0),i.firstContext=null)}function kn(i){var o=i._currentValue;if(bg!==i)if(i={context:i,memoizedValue:o,next:null},Rl===null){if($d===null)throw Error(Ee(308));Rl=i,$d.dependencies={lanes:0,firstContext:i}}else Rl=Rl.next=i;return o}var xa=null;function kg(i){xa===null?xa=[i]:xa.push(i)}function s0(i,o,h,_){var b=o.interleaved;return b===null?(h.next=h,kg(o)):(h.next=b.next,b.next=h),o.interleaved=h,Ls(i,_)}function Ls(i,o){i.lanes|=o;var h=i.alternate;for(h!==null&&(h.lanes|=o),h=i,i=i.return;i!==null;)i.childLanes|=o,h=i.alternate,h!==null&&(h.childLanes|=o),h=i,i=i.return;return h.tag===3?h.stateNode:null}var wo=!1;function Ig(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function o0(i,o){i=i.updateQueue,o.updateQueue===i&&(o.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,effects:i.effects})}function Ms(i,o){return{eventTime:i,lane:o,tag:0,payload:null,callback:null,next:null}}function zo(i,o,h){var _=i.updateQueue;if(_===null)return null;if(_=_.shared,Lt&2){var b=_.pending;return b===null?o.next=o:(o.next=b.next,b.next=o),_.pending=o,Ls(i,h)}return b=_.interleaved,b===null?(o.next=o,kg(_)):(o.next=b.next,b.next=o),_.interleaved=o,Ls(i,h)}function bd(i,o,h){if(o=o.updateQueue,o!==null&&(o=o.shared,(h&4194240)!==0)){var _=o.lanes;_&=i.pendingLanes,h|=_,o.lanes=h,hg(i,h)}}function fv(i,o){var h=i.updateQueue,_=i.alternate;if(_!==null&&(_=_.updateQueue,h===_)){var b=null,I=null;if(h=h.firstBaseUpdate,h!==null){do{var S={eventTime:h.eventTime,lane:h.lane,tag:h.tag,payload:h.payload,callback:h.callback,next:null};I===null?b=I=S:I=I.next=S,h=h.next}while(h!==null);I===null?b=I=o:I=I.next=o}else b=I=o;h={baseState:_.baseState,firstBaseUpdate:b,lastBaseUpdate:I,shared:_.shared,effects:_.effects},i.updateQueue=h;return}i=h.lastBaseUpdate,i===null?h.firstBaseUpdate=o:i.next=o,h.lastBaseUpdate=o}function Zd(i,o,h,_){var b=i.updateQueue;wo=!1;var I=b.firstBaseUpdate,S=b.lastBaseUpdate,d=b.shared.pending;if(d!==null){b.shared.pending=null;var H=d,le=H.next;H.next=null,S===null?I=le:S.next=le,S=H;var ye=i.alternate;ye!==null&&(ye=ye.updateQueue,d=ye.lastBaseUpdate,d!==S&&(d===null?ye.firstBaseUpdate=le:d.next=le,ye.lastBaseUpdate=H))}if(I!==null){var re=b.baseState;S=0,ye=le=H=null,d=I;do{var q=d.lane,ke=d.eventTime;if((_&q)===q){ye!==null&&(ye=ye.next={eventTime:ke,lane:0,tag:d.tag,payload:d.payload,callback:d.callback,next:null});e:{var Pe=i,Fe=d;switch(q=o,ke=h,Fe.tag){case 1:if(Pe=Fe.payload,typeof Pe=="function"){re=Pe.call(ke,re,q);break e}re=Pe;break e;case 3:Pe.flags=Pe.flags&-65537|128;case 0:if(Pe=Fe.payload,q=typeof Pe=="function"?Pe.call(ke,re,q):Pe,q==null)break e;re=dr({},re,q);break e;case 2:wo=!0}}d.callback!==null&&d.lane!==0&&(i.flags|=64,q=b.effects,q===null?b.effects=[d]:q.push(d))}else ke={eventTime:ke,lane:q,tag:d.tag,payload:d.payload,callback:d.callback,next:null},ye===null?(le=ye=ke,H=re):ye=ye.next=ke,S|=q;if(d=d.next,d===null){if(d=b.shared.pending,d===null)break;q=d,d=q.next,q.next=null,b.lastBaseUpdate=q,b.shared.pending=null}}while(!0);if(ye===null&&(H=re),b.baseState=H,b.firstBaseUpdate=le,b.lastBaseUpdate=ye,o=b.shared.interleaved,o!==null){b=o;do S|=b.lane,b=b.next;while(b!==o)}else I===null&&(b.shared.lanes=0);Ea|=S,i.lanes=S,i.memoizedState=re}}function mv(i,o,h){if(i=o.effects,o.effects=null,i!==null)for(o=0;o<i.length;o++){var _=i[o],b=_.callback;if(b!==null){if(_.callback=null,_=h,typeof b!="function")throw Error(Ee(191,b));b.call(_)}}}var Yc={},os=Bo(Yc),jc=Bo(Yc),Uc=Bo(Yc);function wa(i){if(i===Yc)throw Error(Ee(174));return i}function Eg(i,o){switch(Yt(Uc,o),Yt(jc,i),Yt(os,Yc),i=o.nodeType,i){case 9:case 11:o=(o=o.documentElement)?o.namespaceURI:mm(null,"");break;default:i=i===8?o.parentNode:o,o=i.namespaceURI||null,i=i.tagName,o=mm(o,i)}rr(os),Yt(os,o)}function Wl(){rr(os),rr(jc),rr(Uc)}function a0(i){wa(Uc.current);var o=wa(os.current),h=mm(o,i.type);o!==h&&(Yt(jc,i),Yt(os,h))}function Pg(i){jc.current===i&&(rr(os),rr(jc))}var cr=Bo(0);function qd(i){for(var o=i;o!==null;){if(o.tag===13){var h=o.memoizedState;if(h!==null&&(h=h.dehydrated,h===null||h.data==="$?"||h.data==="$!"))return o}else if(o.tag===19&&o.memoizedProps.revealOrder!==void 0){if(o.flags&128)return o}else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===i)break;for(;o.sibling===null;){if(o.return===null||o.return===i)return null;o=o.return}o.sibling.return=o.return,o=o.sibling}return null}var Kf=[];function Cg(){for(var i=0;i<Kf.length;i++)Kf[i]._workInProgressVersionPrimary=null;Kf.length=0}var Sd=Fs.ReactCurrentDispatcher,Yf=Fs.ReactCurrentBatchConfig,Ia=0,hr=null,Cr=null,Vr=null,Gd=!1,Ic=!1,$c=0,Y2=0;function ci(){throw Error(Ee(321))}function zg(i,o){if(o===null)return!1;for(var h=0;h<o.length&&h<i.length;h++)if(!Un(i[h],o[h]))return!1;return!0}function Mg(i,o,h,_,b,I){if(Ia=I,hr=o,o.memoizedState=null,o.updateQueue=null,o.lanes=0,Sd.current=i===null||i.memoizedState===null?tS:rS,i=h(_,b),Ic){I=0;do{if(Ic=!1,$c=0,25<=I)throw Error(Ee(301));I+=1,Vr=Cr=null,o.updateQueue=null,Sd.current=iS,i=h(_,b)}while(Ic)}if(Sd.current=Hd,o=Cr!==null&&Cr.next!==null,Ia=0,Vr=Cr=hr=null,Gd=!1,o)throw Error(Ee(300));return i}function Ag(){var i=$c!==0;return $c=0,i}function is(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Vr===null?hr.memoizedState=Vr=i:Vr=Vr.next=i,Vr}function In(){if(Cr===null){var i=hr.alternate;i=i!==null?i.memoizedState:null}else i=Cr.next;var o=Vr===null?hr.memoizedState:Vr.next;if(o!==null)Vr=o,Cr=i;else{if(i===null)throw Error(Ee(310));Cr=i,i={memoizedState:Cr.memoizedState,baseState:Cr.baseState,baseQueue:Cr.baseQueue,queue:Cr.queue,next:null},Vr===null?hr.memoizedState=Vr=i:Vr=Vr.next=i}return Vr}function Zc(i,o){return typeof o=="function"?o(i):o}function Jf(i){var o=In(),h=o.queue;if(h===null)throw Error(Ee(311));h.lastRenderedReducer=i;var _=Cr,b=_.baseQueue,I=h.pending;if(I!==null){if(b!==null){var S=b.next;b.next=I.next,I.next=S}_.baseQueue=b=I,h.pending=null}if(b!==null){I=b.next,_=_.baseState;var d=S=null,H=null,le=I;do{var ye=le.lane;if((Ia&ye)===ye)H!==null&&(H=H.next={lane:0,action:le.action,hasEagerState:le.hasEagerState,eagerState:le.eagerState,next:null}),_=le.hasEagerState?le.eagerState:i(_,le.action);else{var re={lane:ye,action:le.action,hasEagerState:le.hasEagerState,eagerState:le.eagerState,next:null};H===null?(d=H=re,S=_):H=H.next=re,hr.lanes|=ye,Ea|=ye}le=le.next}while(le!==null&&le!==I);H===null?S=_:H.next=d,Un(_,o.memoizedState)||(Fi=!0),o.memoizedState=_,o.baseState=S,o.baseQueue=H,h.lastRenderedState=_}if(i=h.interleaved,i!==null){b=i;do I=b.lane,hr.lanes|=I,Ea|=I,b=b.next;while(b!==i)}else b===null&&(h.lanes=0);return[o.memoizedState,h.dispatch]}function Qf(i){var o=In(),h=o.queue;if(h===null)throw Error(Ee(311));h.lastRenderedReducer=i;var _=h.dispatch,b=h.pending,I=o.memoizedState;if(b!==null){h.pending=null;var S=b=b.next;do I=i(I,S.action),S=S.next;while(S!==b);Un(I,o.memoizedState)||(Fi=!0),o.memoizedState=I,o.baseQueue===null&&(o.baseState=I),h.lastRenderedState=I}return[I,_]}function l0(){}function u0(i,o){var h=hr,_=In(),b=o(),I=!Un(_.memoizedState,b);if(I&&(_.memoizedState=b,Fi=!0),_=_.queue,Dg(d0.bind(null,h,_,i),[i]),_.getSnapshot!==o||I||Vr!==null&&Vr.memoizedState.tag&1){if(h.flags|=2048,qc(9,h0.bind(null,h,_,b,o),void 0,null),Ur===null)throw Error(Ee(349));Ia&30||c0(h,o,b)}return b}function c0(i,o,h){i.flags|=16384,i={getSnapshot:o,value:h},o=hr.updateQueue,o===null?(o={lastEffect:null,stores:null},hr.updateQueue=o,o.stores=[i]):(h=o.stores,h===null?o.stores=[i]:h.push(i))}function h0(i,o,h,_){o.value=h,o.getSnapshot=_,p0(o)&&f0(i)}function d0(i,o,h){return h(function(){p0(o)&&f0(i)})}function p0(i){var o=i.getSnapshot;i=i.value;try{var h=o();return!Un(i,h)}catch{return!0}}function f0(i){var o=Ls(i,1);o!==null&&jn(o,i,1,-1)}function gv(i){var o=is();return typeof i=="function"&&(i=i()),o.memoizedState=o.baseState=i,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Zc,lastRenderedState:i},o.queue=i,i=i.dispatch=eS.bind(null,hr,i),[o.memoizedState,i]}function qc(i,o,h,_){return i={tag:i,create:o,destroy:h,deps:_,next:null},o=hr.updateQueue,o===null?(o={lastEffect:null,stores:null},hr.updateQueue=o,o.lastEffect=i.next=i):(h=o.lastEffect,h===null?o.lastEffect=i.next=i:(_=h.next,h.next=i,i.next=_,o.lastEffect=i)),i}function m0(){return In().memoizedState}function Td(i,o,h,_){var b=is();hr.flags|=i,b.memoizedState=qc(1|o,h,void 0,_===void 0?null:_)}function op(i,o,h,_){var b=In();_=_===void 0?null:_;var I=void 0;if(Cr!==null){var S=Cr.memoizedState;if(I=S.destroy,_!==null&&zg(_,S.deps)){b.memoizedState=qc(o,h,I,_);return}}hr.flags|=i,b.memoizedState=qc(1|o,h,I,_)}function _v(i,o){return Td(8390656,8,i,o)}function Dg(i,o){return op(2048,8,i,o)}function g0(i,o){return op(4,2,i,o)}function _0(i,o){return op(4,4,i,o)}function y0(i,o){if(typeof o=="function")return i=i(),o(i),function(){o(null)};if(o!=null)return i=i(),o.current=i,function(){o.current=null}}function v0(i,o,h){return h=h!=null?h.concat([i]):null,op(4,4,y0.bind(null,o,i),h)}function Lg(){}function x0(i,o){var h=In();o=o===void 0?null:o;var _=h.memoizedState;return _!==null&&o!==null&&zg(o,_[1])?_[0]:(h.memoizedState=[i,o],i)}function w0(i,o){var h=In();o=o===void 0?null:o;var _=h.memoizedState;return _!==null&&o!==null&&zg(o,_[1])?_[0]:(i=i(),h.memoizedState=[i,o],i)}function b0(i,o,h){return Ia&21?(Un(h,o)||(h=Ex(),hr.lanes|=h,Ea|=h,i.baseState=!0),o):(i.baseState&&(i.baseState=!1,Fi=!0),i.memoizedState=h)}function J2(i,o){var h=Zt;Zt=h!==0&&4>h?h:4,i(!0);var _=Yf.transition;Yf.transition={};try{i(!1),o()}finally{Zt=h,Yf.transition=_}}function S0(){return In().memoizedState}function Q2(i,o,h){var _=Ao(i);if(h={lane:_,action:h,hasEagerState:!1,eagerState:null,next:null},T0(i))k0(o,h);else if(h=s0(i,o,h,_),h!==null){var b=Si();jn(h,i,_,b),I0(h,o,_)}}function eS(i,o,h){var _=Ao(i),b={lane:_,action:h,hasEagerState:!1,eagerState:null,next:null};if(T0(i))k0(o,b);else{var I=i.alternate;if(i.lanes===0&&(I===null||I.lanes===0)&&(I=o.lastRenderedReducer,I!==null))try{var S=o.lastRenderedState,d=I(S,h);if(b.hasEagerState=!0,b.eagerState=d,Un(d,S)){var H=o.interleaved;H===null?(b.next=b,kg(o)):(b.next=H.next,H.next=b),o.interleaved=b;return}}catch{}finally{}h=s0(i,o,b,_),h!==null&&(b=Si(),jn(h,i,_,b),I0(h,o,_))}}function T0(i){var o=i.alternate;return i===hr||o!==null&&o===hr}function k0(i,o){Ic=Gd=!0;var h=i.pending;h===null?o.next=o:(o.next=h.next,h.next=o),i.pending=o}function I0(i,o,h){if(h&4194240){var _=o.lanes;_&=i.pendingLanes,h|=_,o.lanes=h,hg(i,h)}}var Hd={readContext:kn,useCallback:ci,useContext:ci,useEffect:ci,useImperativeHandle:ci,useInsertionEffect:ci,useLayoutEffect:ci,useMemo:ci,useReducer:ci,useRef:ci,useState:ci,useDebugValue:ci,useDeferredValue:ci,useTransition:ci,useMutableSource:ci,useSyncExternalStore:ci,useId:ci,unstable_isNewReconciler:!1},tS={readContext:kn,useCallback:function(i,o){return is().memoizedState=[i,o===void 0?null:o],i},useContext:kn,useEffect:_v,useImperativeHandle:function(i,o,h){return h=h!=null?h.concat([i]):null,Td(4194308,4,y0.bind(null,o,i),h)},useLayoutEffect:function(i,o){return Td(4194308,4,i,o)},useInsertionEffect:function(i,o){return Td(4,2,i,o)},useMemo:function(i,o){var h=is();return o=o===void 0?null:o,i=i(),h.memoizedState=[i,o],i},useReducer:function(i,o,h){var _=is();return o=h!==void 0?h(o):o,_.memoizedState=_.baseState=o,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:o},_.queue=i,i=i.dispatch=Q2.bind(null,hr,i),[_.memoizedState,i]},useRef:function(i){var o=is();return i={current:i},o.memoizedState=i},useState:gv,useDebugValue:Lg,useDeferredValue:function(i){return is().memoizedState=i},useTransition:function(){var i=gv(!1),o=i[0];return i=J2.bind(null,i[1]),is().memoizedState=i,[o,i]},useMutableSource:function(){},useSyncExternalStore:function(i,o,h){var _=hr,b=is();if(ar){if(h===void 0)throw Error(Ee(407));h=h()}else{if(h=o(),Ur===null)throw Error(Ee(349));Ia&30||c0(_,o,h)}b.memoizedState=h;var I={value:h,getSnapshot:o};return b.queue=I,_v(d0.bind(null,_,I,i),[i]),_.flags|=2048,qc(9,h0.bind(null,_,I,h,o),void 0,null),h},useId:function(){var i=is(),o=Ur.identifierPrefix;if(ar){var h=zs,_=Cs;h=(_&~(1<<32-Vn(_)-1)).toString(32)+h,o=":"+o+"R"+h,h=$c++,0<h&&(o+="H"+h.toString(32)),o+=":"}else h=Y2++,o=":"+o+"r"+h.toString(32)+":";return i.memoizedState=o},unstable_isNewReconciler:!1},rS={readContext:kn,useCallback:x0,useContext:kn,useEffect:Dg,useImperativeHandle:v0,useInsertionEffect:g0,useLayoutEffect:_0,useMemo:w0,useReducer:Jf,useRef:m0,useState:function(){return Jf(Zc)},useDebugValue:Lg,useDeferredValue:function(i){var o=In();return b0(o,Cr.memoizedState,i)},useTransition:function(){var i=Jf(Zc)[0],o=In().memoizedState;return[i,o]},useMutableSource:l0,useSyncExternalStore:u0,useId:S0,unstable_isNewReconciler:!1},iS={readContext:kn,useCallback:x0,useContext:kn,useEffect:Dg,useImperativeHandle:v0,useInsertionEffect:g0,useLayoutEffect:_0,useMemo:w0,useReducer:Qf,useRef:m0,useState:function(){return Qf(Zc)},useDebugValue:Lg,useDeferredValue:function(i){var o=In();return Cr===null?o.memoizedState=i:b0(o,Cr.memoizedState,i)},useTransition:function(){var i=Qf(Zc)[0],o=In().memoizedState;return[i,o]},useMutableSource:l0,useSyncExternalStore:u0,useId:S0,unstable_isNewReconciler:!1};function Fn(i,o){if(i&&i.defaultProps){o=dr({},o),i=i.defaultProps;for(var h in i)o[h]===void 0&&(o[h]=i[h]);return o}return o}function Fm(i,o,h,_){o=i.memoizedState,h=h(_,o),h=h==null?o:dr({},o,h),i.memoizedState=h,i.lanes===0&&(i.updateQueue.baseState=h)}var ap={isMounted:function(i){return(i=i._reactInternals)?za(i)===i:!1},enqueueSetState:function(i,o,h){i=i._reactInternals;var _=Si(),b=Ao(i),I=Ms(_,b);I.payload=o,h!=null&&(I.callback=h),o=zo(i,I,b),o!==null&&(jn(o,i,b,_),bd(o,i,b))},enqueueReplaceState:function(i,o,h){i=i._reactInternals;var _=Si(),b=Ao(i),I=Ms(_,b);I.tag=1,I.payload=o,h!=null&&(I.callback=h),o=zo(i,I,b),o!==null&&(jn(o,i,b,_),bd(o,i,b))},enqueueForceUpdate:function(i,o){i=i._reactInternals;var h=Si(),_=Ao(i),b=Ms(h,_);b.tag=2,o!=null&&(b.callback=o),o=zo(i,b,_),o!==null&&(jn(o,i,_,h),bd(o,i,_))}};function yv(i,o,h,_,b,I,S){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(_,I,S):o.prototype&&o.prototype.isPureReactComponent?!Bc(h,_)||!Bc(b,I):!0}function E0(i,o,h){var _=!1,b=Ro,I=o.contextType;return typeof I=="object"&&I!==null?I=kn(I):(b=Oi(o)?Ta:pi.current,_=o.contextTypes,I=(_=_!=null)?ql(i,b):Ro),o=new o(h,I),i.memoizedState=o.state!==null&&o.state!==void 0?o.state:null,o.updater=ap,i.stateNode=o,o._reactInternals=i,_&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=b,i.__reactInternalMemoizedMaskedChildContext=I),o}function vv(i,o,h,_){i=o.state,typeof o.componentWillReceiveProps=="function"&&o.componentWillReceiveProps(h,_),typeof o.UNSAFE_componentWillReceiveProps=="function"&&o.UNSAFE_componentWillReceiveProps(h,_),o.state!==i&&ap.enqueueReplaceState(o,o.state,null)}function Bm(i,o,h,_){var b=i.stateNode;b.props=h,b.state=i.memoizedState,b.refs={},Ig(i);var I=o.contextType;typeof I=="object"&&I!==null?b.context=kn(I):(I=Oi(o)?Ta:pi.current,b.context=ql(i,I)),b.state=i.memoizedState,I=o.getDerivedStateFromProps,typeof I=="function"&&(Fm(i,o,I,h),b.state=i.memoizedState),typeof o.getDerivedStateFromProps=="function"||typeof b.getSnapshotBeforeUpdate=="function"||typeof b.UNSAFE_componentWillMount!="function"&&typeof b.componentWillMount!="function"||(o=b.state,typeof b.componentWillMount=="function"&&b.componentWillMount(),typeof b.UNSAFE_componentWillMount=="function"&&b.UNSAFE_componentWillMount(),o!==b.state&&ap.enqueueReplaceState(b,b.state,null),Zd(i,h,b,_),b.state=i.memoizedState),typeof b.componentDidMount=="function"&&(i.flags|=4194308)}function Xl(i,o){try{var h="",_=o;do h+=Mb(_),_=_.return;while(_);var b=h}catch(I){b=`
Error generating stack: `+I.message+`
`+I.stack}return{value:i,source:o,stack:b,digest:null}}function em(i,o,h){return{value:i,source:null,stack:h??null,digest:o??null}}function Om(i,o){try{console.error(o.value)}catch(h){setTimeout(function(){throw h})}}var nS=typeof WeakMap=="function"?WeakMap:Map;function P0(i,o,h){h=Ms(-1,h),h.tag=3,h.payload={element:null};var _=o.value;return h.callback=function(){Xd||(Xd=!0,Wm=_),Om(i,o)},h}function C0(i,o,h){h=Ms(-1,h),h.tag=3;var _=i.type.getDerivedStateFromError;if(typeof _=="function"){var b=o.value;h.payload=function(){return _(b)},h.callback=function(){Om(i,o)}}var I=i.stateNode;return I!==null&&typeof I.componentDidCatch=="function"&&(h.callback=function(){Om(i,o),typeof _!="function"&&(Mo===null?Mo=new Set([this]):Mo.add(this));var S=o.stack;this.componentDidCatch(o.value,{componentStack:S!==null?S:""})}),h}function xv(i,o,h){var _=i.pingCache;if(_===null){_=i.pingCache=new nS;var b=new Set;_.set(o,b)}else b=_.get(o),b===void 0&&(b=new Set,_.set(o,b));b.has(h)||(b.add(h),i=yS.bind(null,i,o,h),o.then(i,i))}function wv(i){do{var o;if((o=i.tag===13)&&(o=i.memoizedState,o=o!==null?o.dehydrated!==null:!0),o)return i;i=i.return}while(i!==null);return null}function bv(i,o,h,_,b){return i.mode&1?(i.flags|=65536,i.lanes=b,i):(i===o?i.flags|=65536:(i.flags|=128,h.flags|=131072,h.flags&=-52805,h.tag===1&&(h.alternate===null?h.tag=17:(o=Ms(-1,1),o.tag=2,zo(h,o,1))),h.lanes|=1),i)}var sS=Fs.ReactCurrentOwner,Fi=!1;function bi(i,o,h,_){o.child=i===null?n0(o,null,h,_):Hl(o,i.child,h,_)}function Sv(i,o,h,_,b){h=h.render;var I=o.ref;return Ul(o,b),_=Mg(i,o,h,_,I,b),h=Ag(),i!==null&&!Fi?(o.updateQueue=i.updateQueue,o.flags&=-2053,i.lanes&=~b,Rs(i,o,b)):(ar&&h&&vg(o),o.flags|=1,bi(i,o,_,b),o.child)}function Tv(i,o,h,_,b){if(i===null){var I=h.type;return typeof I=="function"&&!Ug(I)&&I.defaultProps===void 0&&h.compare===null&&h.defaultProps===void 0?(o.tag=15,o.type=I,z0(i,o,I,_,b)):(i=Pd(h.type,null,_,o,o.mode,b),i.ref=o.ref,i.return=o,o.child=i)}if(I=i.child,!(i.lanes&b)){var S=I.memoizedProps;if(h=h.compare,h=h!==null?h:Bc,h(S,_)&&i.ref===o.ref)return Rs(i,o,b)}return o.flags|=1,i=Do(I,_),i.ref=o.ref,i.return=o,o.child=i}function z0(i,o,h,_,b){if(i!==null){var I=i.memoizedProps;if(Bc(I,_)&&i.ref===o.ref)if(Fi=!1,o.pendingProps=_=I,(i.lanes&b)!==0)i.flags&131072&&(Fi=!0);else return o.lanes=i.lanes,Rs(i,o,b)}return Nm(i,o,h,_,b)}function M0(i,o,h){var _=o.pendingProps,b=_.children,I=i!==null?i.memoizedState:null;if(_.mode==="hidden")if(!(o.mode&1))o.memoizedState={baseLanes:0,cachePool:null,transitions:null},Yt(Bl,rn),rn|=h;else{if(!(h&1073741824))return i=I!==null?I.baseLanes|h:h,o.lanes=o.childLanes=1073741824,o.memoizedState={baseLanes:i,cachePool:null,transitions:null},o.updateQueue=null,Yt(Bl,rn),rn|=i,null;o.memoizedState={baseLanes:0,cachePool:null,transitions:null},_=I!==null?I.baseLanes:h,Yt(Bl,rn),rn|=_}else I!==null?(_=I.baseLanes|h,o.memoizedState=null):_=h,Yt(Bl,rn),rn|=_;return bi(i,o,b,h),o.child}function A0(i,o){var h=o.ref;(i===null&&h!==null||i!==null&&i.ref!==h)&&(o.flags|=512,o.flags|=2097152)}function Nm(i,o,h,_,b){var I=Oi(h)?Ta:pi.current;return I=ql(o,I),Ul(o,b),h=Mg(i,o,h,_,I,b),_=Ag(),i!==null&&!Fi?(o.updateQueue=i.updateQueue,o.flags&=-2053,i.lanes&=~b,Rs(i,o,b)):(ar&&_&&vg(o),o.flags|=1,bi(i,o,h,b),o.child)}function kv(i,o,h,_,b){if(Oi(h)){var I=!0;Nd(o)}else I=!1;if(Ul(o,b),o.stateNode===null)kd(i,o),E0(o,h,_),Bm(o,h,_,b),_=!0;else if(i===null){var S=o.stateNode,d=o.memoizedProps;S.props=d;var H=S.context,le=h.contextType;typeof le=="object"&&le!==null?le=kn(le):(le=Oi(h)?Ta:pi.current,le=ql(o,le));var ye=h.getDerivedStateFromProps,re=typeof ye=="function"||typeof S.getSnapshotBeforeUpdate=="function";re||typeof S.UNSAFE_componentWillReceiveProps!="function"&&typeof S.componentWillReceiveProps!="function"||(d!==_||H!==le)&&vv(o,S,_,le),wo=!1;var q=o.memoizedState;S.state=q,Zd(o,_,S,b),H=o.memoizedState,d!==_||q!==H||Bi.current||wo?(typeof ye=="function"&&(Fm(o,h,ye,_),H=o.memoizedState),(d=wo||yv(o,h,d,_,q,H,le))?(re||typeof S.UNSAFE_componentWillMount!="function"&&typeof S.componentWillMount!="function"||(typeof S.componentWillMount=="function"&&S.componentWillMount(),typeof S.UNSAFE_componentWillMount=="function"&&S.UNSAFE_componentWillMount()),typeof S.componentDidMount=="function"&&(o.flags|=4194308)):(typeof S.componentDidMount=="function"&&(o.flags|=4194308),o.memoizedProps=_,o.memoizedState=H),S.props=_,S.state=H,S.context=le,_=d):(typeof S.componentDidMount=="function"&&(o.flags|=4194308),_=!1)}else{S=o.stateNode,o0(i,o),d=o.memoizedProps,le=o.type===o.elementType?d:Fn(o.type,d),S.props=le,re=o.pendingProps,q=S.context,H=h.contextType,typeof H=="object"&&H!==null?H=kn(H):(H=Oi(h)?Ta:pi.current,H=ql(o,H));var ke=h.getDerivedStateFromProps;(ye=typeof ke=="function"||typeof S.getSnapshotBeforeUpdate=="function")||typeof S.UNSAFE_componentWillReceiveProps!="function"&&typeof S.componentWillReceiveProps!="function"||(d!==re||q!==H)&&vv(o,S,_,H),wo=!1,q=o.memoizedState,S.state=q,Zd(o,_,S,b);var Pe=o.memoizedState;d!==re||q!==Pe||Bi.current||wo?(typeof ke=="function"&&(Fm(o,h,ke,_),Pe=o.memoizedState),(le=wo||yv(o,h,le,_,q,Pe,H)||!1)?(ye||typeof S.UNSAFE_componentWillUpdate!="function"&&typeof S.componentWillUpdate!="function"||(typeof S.componentWillUpdate=="function"&&S.componentWillUpdate(_,Pe,H),typeof S.UNSAFE_componentWillUpdate=="function"&&S.UNSAFE_componentWillUpdate(_,Pe,H)),typeof S.componentDidUpdate=="function"&&(o.flags|=4),typeof S.getSnapshotBeforeUpdate=="function"&&(o.flags|=1024)):(typeof S.componentDidUpdate!="function"||d===i.memoizedProps&&q===i.memoizedState||(o.flags|=4),typeof S.getSnapshotBeforeUpdate!="function"||d===i.memoizedProps&&q===i.memoizedState||(o.flags|=1024),o.memoizedProps=_,o.memoizedState=Pe),S.props=_,S.state=Pe,S.context=H,_=le):(typeof S.componentDidUpdate!="function"||d===i.memoizedProps&&q===i.memoizedState||(o.flags|=4),typeof S.getSnapshotBeforeUpdate!="function"||d===i.memoizedProps&&q===i.memoizedState||(o.flags|=1024),_=!1)}return Vm(i,o,h,_,I,b)}function Vm(i,o,h,_,b,I){A0(i,o);var S=(o.flags&128)!==0;if(!_&&!S)return b&&cv(o,h,!1),Rs(i,o,I);_=o.stateNode,sS.current=o;var d=S&&typeof h.getDerivedStateFromError!="function"?null:_.render();return o.flags|=1,i!==null&&S?(o.child=Hl(o,i.child,null,I),o.child=Hl(o,null,d,I)):bi(i,o,d,I),o.memoizedState=_.state,b&&cv(o,h,!0),o.child}function D0(i){var o=i.stateNode;o.pendingContext?uv(i,o.pendingContext,o.pendingContext!==o.context):o.context&&uv(i,o.context,!1),Eg(i,o.containerInfo)}function Iv(i,o,h,_,b){return Gl(),wg(b),o.flags|=256,bi(i,o,h,_),o.child}var jm={dehydrated:null,treeContext:null,retryLane:0};function Um(i){return{baseLanes:i,cachePool:null,transitions:null}}function L0(i,o,h){var _=o.pendingProps,b=cr.current,I=!1,S=(o.flags&128)!==0,d;if((d=S)||(d=i!==null&&i.memoizedState===null?!1:(b&2)!==0),d?(I=!0,o.flags&=-129):(i===null||i.memoizedState!==null)&&(b|=1),Yt(cr,b&1),i===null)return Lm(o),i=o.memoizedState,i!==null&&(i=i.dehydrated,i!==null)?(o.mode&1?i.data==="$!"?o.lanes=8:o.lanes=1073741824:o.lanes=1,null):(S=_.children,i=_.fallback,I?(_=o.mode,I=o.child,S={mode:"hidden",children:S},!(_&1)&&I!==null?(I.childLanes=0,I.pendingProps=S):I=cp(S,_,0,null),i=Sa(i,_,h,null),I.return=o,i.return=o,I.sibling=i,o.child=I,o.child.memoizedState=Um(h),o.memoizedState=jm,i):Rg(o,S));if(b=i.memoizedState,b!==null&&(d=b.dehydrated,d!==null))return oS(i,o,S,_,d,b,h);if(I){I=_.fallback,S=o.mode,b=i.child,d=b.sibling;var H={mode:"hidden",children:_.children};return!(S&1)&&o.child!==b?(_=o.child,_.childLanes=0,_.pendingProps=H,o.deletions=null):(_=Do(b,H),_.subtreeFlags=b.subtreeFlags&14680064),d!==null?I=Do(d,I):(I=Sa(I,S,h,null),I.flags|=2),I.return=o,_.return=o,_.sibling=I,o.child=_,_=I,I=o.child,S=i.child.memoizedState,S=S===null?Um(h):{baseLanes:S.baseLanes|h,cachePool:null,transitions:S.transitions},I.memoizedState=S,I.childLanes=i.childLanes&~h,o.memoizedState=jm,_}return I=i.child,i=I.sibling,_=Do(I,{mode:"visible",children:_.children}),!(o.mode&1)&&(_.lanes=h),_.return=o,_.sibling=null,i!==null&&(h=o.deletions,h===null?(o.deletions=[i],o.flags|=16):h.push(i)),o.child=_,o.memoizedState=null,_}function Rg(i,o){return o=cp({mode:"visible",children:o},i.mode,0,null),o.return=i,i.child=o}function pd(i,o,h,_){return _!==null&&wg(_),Hl(o,i.child,null,h),i=Rg(o,o.pendingProps.children),i.flags|=2,o.memoizedState=null,i}function oS(i,o,h,_,b,I,S){if(h)return o.flags&256?(o.flags&=-257,_=em(Error(Ee(422))),pd(i,o,S,_)):o.memoizedState!==null?(o.child=i.child,o.flags|=128,null):(I=_.fallback,b=o.mode,_=cp({mode:"visible",children:_.children},b,0,null),I=Sa(I,b,S,null),I.flags|=2,_.return=o,I.return=o,_.sibling=I,o.child=_,o.mode&1&&Hl(o,i.child,null,S),o.child.memoizedState=Um(S),o.memoizedState=jm,I);if(!(o.mode&1))return pd(i,o,S,null);if(b.data==="$!"){if(_=b.nextSibling&&b.nextSibling.dataset,_)var d=_.dgst;return _=d,I=Error(Ee(419)),_=em(I,_,void 0),pd(i,o,S,_)}if(d=(S&i.childLanes)!==0,Fi||d){if(_=Ur,_!==null){switch(S&-S){case 4:b=2;break;case 16:b=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:b=32;break;case 536870912:b=268435456;break;default:b=0}b=b&(_.suspendedLanes|S)?0:b,b!==0&&b!==I.retryLane&&(I.retryLane=b,Ls(i,b),jn(_,i,b,-1))}return jg(),_=em(Error(Ee(421))),pd(i,o,S,_)}return b.data==="$?"?(o.flags|=128,o.child=i.child,o=vS.bind(null,i),b._reactRetry=o,null):(i=I.treeContext,nn=Co(b.nextSibling),sn=o,ar=!0,On=null,i!==null&&(wn[bn++]=Cs,wn[bn++]=zs,wn[bn++]=ka,Cs=i.id,zs=i.overflow,ka=o),o=Rg(o,_.children),o.flags|=4096,o)}function Ev(i,o,h){i.lanes|=o;var _=i.alternate;_!==null&&(_.lanes|=o),Rm(i.return,o,h)}function tm(i,o,h,_,b){var I=i.memoizedState;I===null?i.memoizedState={isBackwards:o,rendering:null,renderingStartTime:0,last:_,tail:h,tailMode:b}:(I.isBackwards=o,I.rendering=null,I.renderingStartTime=0,I.last=_,I.tail=h,I.tailMode=b)}function R0(i,o,h){var _=o.pendingProps,b=_.revealOrder,I=_.tail;if(bi(i,o,_.children,h),_=cr.current,_&2)_=_&1|2,o.flags|=128;else{if(i!==null&&i.flags&128)e:for(i=o.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&Ev(i,h,o);else if(i.tag===19)Ev(i,h,o);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===o)break e;for(;i.sibling===null;){if(i.return===null||i.return===o)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}_&=1}if(Yt(cr,_),!(o.mode&1))o.memoizedState=null;else switch(b){case"forwards":for(h=o.child,b=null;h!==null;)i=h.alternate,i!==null&&qd(i)===null&&(b=h),h=h.sibling;h=b,h===null?(b=o.child,o.child=null):(b=h.sibling,h.sibling=null),tm(o,!1,b,h,I);break;case"backwards":for(h=null,b=o.child,o.child=null;b!==null;){if(i=b.alternate,i!==null&&qd(i)===null){o.child=b;break}i=b.sibling,b.sibling=h,h=b,b=i}tm(o,!0,h,null,I);break;case"together":tm(o,!1,null,null,void 0);break;default:o.memoizedState=null}return o.child}function kd(i,o){!(o.mode&1)&&i!==null&&(i.alternate=null,o.alternate=null,o.flags|=2)}function Rs(i,o,h){if(i!==null&&(o.dependencies=i.dependencies),Ea|=o.lanes,!(h&o.childLanes))return null;if(i!==null&&o.child!==i.child)throw Error(Ee(153));if(o.child!==null){for(i=o.child,h=Do(i,i.pendingProps),o.child=h,h.return=o;i.sibling!==null;)i=i.sibling,h=h.sibling=Do(i,i.pendingProps),h.return=o;h.sibling=null}return o.child}function aS(i,o,h){switch(o.tag){case 3:D0(o),Gl();break;case 5:a0(o);break;case 1:Oi(o.type)&&Nd(o);break;case 4:Eg(o,o.stateNode.containerInfo);break;case 10:var _=o.type._context,b=o.memoizedProps.value;Yt(Ud,_._currentValue),_._currentValue=b;break;case 13:if(_=o.memoizedState,_!==null)return _.dehydrated!==null?(Yt(cr,cr.current&1),o.flags|=128,null):h&o.child.childLanes?L0(i,o,h):(Yt(cr,cr.current&1),i=Rs(i,o,h),i!==null?i.sibling:null);Yt(cr,cr.current&1);break;case 19:if(_=(h&o.childLanes)!==0,i.flags&128){if(_)return R0(i,o,h);o.flags|=128}if(b=o.memoizedState,b!==null&&(b.rendering=null,b.tail=null,b.lastEffect=null),Yt(cr,cr.current),_)break;return null;case 22:case 23:return o.lanes=0,M0(i,o,h)}return Rs(i,o,h)}var F0,$m,B0,O0;F0=function(i,o){for(var h=o.child;h!==null;){if(h.tag===5||h.tag===6)i.appendChild(h.stateNode);else if(h.tag!==4&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===o)break;for(;h.sibling===null;){if(h.return===null||h.return===o)return;h=h.return}h.sibling.return=h.return,h=h.sibling}};$m=function(){};B0=function(i,o,h,_){var b=i.memoizedProps;if(b!==_){i=o.stateNode,wa(os.current);var I=null;switch(h){case"input":b=hm(i,b),_=hm(i,_),I=[];break;case"select":b=dr({},b,{value:void 0}),_=dr({},_,{value:void 0}),I=[];break;case"textarea":b=fm(i,b),_=fm(i,_),I=[];break;default:typeof b.onClick!="function"&&typeof _.onClick=="function"&&(i.onclick=Bd)}gm(h,_);var S;h=null;for(le in b)if(!_.hasOwnProperty(le)&&b.hasOwnProperty(le)&&b[le]!=null)if(le==="style"){var d=b[le];for(S in d)d.hasOwnProperty(S)&&(h||(h={}),h[S]="")}else le!=="dangerouslySetInnerHTML"&&le!=="children"&&le!=="suppressContentEditableWarning"&&le!=="suppressHydrationWarning"&&le!=="autoFocus"&&(zc.hasOwnProperty(le)?I||(I=[]):(I=I||[]).push(le,null));for(le in _){var H=_[le];if(d=b!=null?b[le]:void 0,_.hasOwnProperty(le)&&H!==d&&(H!=null||d!=null))if(le==="style")if(d){for(S in d)!d.hasOwnProperty(S)||H&&H.hasOwnProperty(S)||(h||(h={}),h[S]="");for(S in H)H.hasOwnProperty(S)&&d[S]!==H[S]&&(h||(h={}),h[S]=H[S])}else h||(I||(I=[]),I.push(le,h)),h=H;else le==="dangerouslySetInnerHTML"?(H=H?H.__html:void 0,d=d?d.__html:void 0,H!=null&&d!==H&&(I=I||[]).push(le,H)):le==="children"?typeof H!="string"&&typeof H!="number"||(I=I||[]).push(le,""+H):le!=="suppressContentEditableWarning"&&le!=="suppressHydrationWarning"&&(zc.hasOwnProperty(le)?(H!=null&&le==="onScroll"&&tr("scroll",i),I||d===H||(I=[])):(I=I||[]).push(le,H))}h&&(I=I||[]).push("style",h);var le=I;(o.updateQueue=le)&&(o.flags|=4)}};O0=function(i,o,h,_){h!==_&&(o.flags|=4)};function mc(i,o){if(!ar)switch(i.tailMode){case"hidden":o=i.tail;for(var h=null;o!==null;)o.alternate!==null&&(h=o),o=o.sibling;h===null?i.tail=null:h.sibling=null;break;case"collapsed":h=i.tail;for(var _=null;h!==null;)h.alternate!==null&&(_=h),h=h.sibling;_===null?o||i.tail===null?i.tail=null:i.tail.sibling=null:_.sibling=null}}function hi(i){var o=i.alternate!==null&&i.alternate.child===i.child,h=0,_=0;if(o)for(var b=i.child;b!==null;)h|=b.lanes|b.childLanes,_|=b.subtreeFlags&14680064,_|=b.flags&14680064,b.return=i,b=b.sibling;else for(b=i.child;b!==null;)h|=b.lanes|b.childLanes,_|=b.subtreeFlags,_|=b.flags,b.return=i,b=b.sibling;return i.subtreeFlags|=_,i.childLanes=h,o}function lS(i,o,h){var _=o.pendingProps;switch(xg(o),o.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return hi(o),null;case 1:return Oi(o.type)&&Od(),hi(o),null;case 3:return _=o.stateNode,Wl(),rr(Bi),rr(pi),Cg(),_.pendingContext&&(_.context=_.pendingContext,_.pendingContext=null),(i===null||i.child===null)&&(hd(o)?o.flags|=4:i===null||i.memoizedState.isDehydrated&&!(o.flags&256)||(o.flags|=1024,On!==null&&(Ym(On),On=null))),$m(i,o),hi(o),null;case 5:Pg(o);var b=wa(Uc.current);if(h=o.type,i!==null&&o.stateNode!=null)B0(i,o,h,_,b),i.ref!==o.ref&&(o.flags|=512,o.flags|=2097152);else{if(!_){if(o.stateNode===null)throw Error(Ee(166));return hi(o),null}if(i=wa(os.current),hd(o)){_=o.stateNode,h=o.type;var I=o.memoizedProps;switch(_[ns]=o,_[Vc]=I,i=(o.mode&1)!==0,h){case"dialog":tr("cancel",_),tr("close",_);break;case"iframe":case"object":case"embed":tr("load",_);break;case"video":case"audio":for(b=0;b<xc.length;b++)tr(xc[b],_);break;case"source":tr("error",_);break;case"img":case"image":case"link":tr("error",_),tr("load",_);break;case"details":tr("toggle",_);break;case"input":Fy(_,I),tr("invalid",_);break;case"select":_._wrapperState={wasMultiple:!!I.multiple},tr("invalid",_);break;case"textarea":Oy(_,I),tr("invalid",_)}gm(h,I),b=null;for(var S in I)if(I.hasOwnProperty(S)){var d=I[S];S==="children"?typeof d=="string"?_.textContent!==d&&(I.suppressHydrationWarning!==!0&&cd(_.textContent,d,i),b=["children",d]):typeof d=="number"&&_.textContent!==""+d&&(I.suppressHydrationWarning!==!0&&cd(_.textContent,d,i),b=["children",""+d]):zc.hasOwnProperty(S)&&d!=null&&S==="onScroll"&&tr("scroll",_)}switch(h){case"input":rd(_),By(_,I,!0);break;case"textarea":rd(_),Ny(_);break;case"select":case"option":break;default:typeof I.onClick=="function"&&(_.onclick=Bd)}_=b,o.updateQueue=_,_!==null&&(o.flags|=4)}else{S=b.nodeType===9?b:b.ownerDocument,i==="http://www.w3.org/1999/xhtml"&&(i=dx(h)),i==="http://www.w3.org/1999/xhtml"?h==="script"?(i=S.createElement("div"),i.innerHTML="<script><\/script>",i=i.removeChild(i.firstChild)):typeof _.is=="string"?i=S.createElement(h,{is:_.is}):(i=S.createElement(h),h==="select"&&(S=i,_.multiple?S.multiple=!0:_.size&&(S.size=_.size))):i=S.createElementNS(i,h),i[ns]=o,i[Vc]=_,F0(i,o,!1,!1),o.stateNode=i;e:{switch(S=_m(h,_),h){case"dialog":tr("cancel",i),tr("close",i),b=_;break;case"iframe":case"object":case"embed":tr("load",i),b=_;break;case"video":case"audio":for(b=0;b<xc.length;b++)tr(xc[b],i);b=_;break;case"source":tr("error",i),b=_;break;case"img":case"image":case"link":tr("error",i),tr("load",i),b=_;break;case"details":tr("toggle",i),b=_;break;case"input":Fy(i,_),b=hm(i,_),tr("invalid",i);break;case"option":b=_;break;case"select":i._wrapperState={wasMultiple:!!_.multiple},b=dr({},_,{value:void 0}),tr("invalid",i);break;case"textarea":Oy(i,_),b=fm(i,_),tr("invalid",i);break;default:b=_}gm(h,b),d=b;for(I in d)if(d.hasOwnProperty(I)){var H=d[I];I==="style"?mx(i,H):I==="dangerouslySetInnerHTML"?(H=H?H.__html:void 0,H!=null&&px(i,H)):I==="children"?typeof H=="string"?(h!=="textarea"||H!=="")&&Mc(i,H):typeof H=="number"&&Mc(i,""+H):I!=="suppressContentEditableWarning"&&I!=="suppressHydrationWarning"&&I!=="autoFocus"&&(zc.hasOwnProperty(I)?H!=null&&I==="onScroll"&&tr("scroll",i):H!=null&&sg(i,I,H,S))}switch(h){case"input":rd(i),By(i,_,!1);break;case"textarea":rd(i),Ny(i);break;case"option":_.value!=null&&i.setAttribute("value",""+Lo(_.value));break;case"select":i.multiple=!!_.multiple,I=_.value,I!=null?Ol(i,!!_.multiple,I,!1):_.defaultValue!=null&&Ol(i,!!_.multiple,_.defaultValue,!0);break;default:typeof b.onClick=="function"&&(i.onclick=Bd)}switch(h){case"button":case"input":case"select":case"textarea":_=!!_.autoFocus;break e;case"img":_=!0;break e;default:_=!1}}_&&(o.flags|=4)}o.ref!==null&&(o.flags|=512,o.flags|=2097152)}return hi(o),null;case 6:if(i&&o.stateNode!=null)O0(i,o,i.memoizedProps,_);else{if(typeof _!="string"&&o.stateNode===null)throw Error(Ee(166));if(h=wa(Uc.current),wa(os.current),hd(o)){if(_=o.stateNode,h=o.memoizedProps,_[ns]=o,(I=_.nodeValue!==h)&&(i=sn,i!==null))switch(i.tag){case 3:cd(_.nodeValue,h,(i.mode&1)!==0);break;case 5:i.memoizedProps.suppressHydrationWarning!==!0&&cd(_.nodeValue,h,(i.mode&1)!==0)}I&&(o.flags|=4)}else _=(h.nodeType===9?h:h.ownerDocument).createTextNode(_),_[ns]=o,o.stateNode=_}return hi(o),null;case 13:if(rr(cr),_=o.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(ar&&nn!==null&&o.mode&1&&!(o.flags&128))r0(),Gl(),o.flags|=98560,I=!1;else if(I=hd(o),_!==null&&_.dehydrated!==null){if(i===null){if(!I)throw Error(Ee(318));if(I=o.memoizedState,I=I!==null?I.dehydrated:null,!I)throw Error(Ee(317));I[ns]=o}else Gl(),!(o.flags&128)&&(o.memoizedState=null),o.flags|=4;hi(o),I=!1}else On!==null&&(Ym(On),On=null),I=!0;if(!I)return o.flags&65536?o:null}return o.flags&128?(o.lanes=h,o):(_=_!==null,_!==(i!==null&&i.memoizedState!==null)&&_&&(o.child.flags|=8192,o.mode&1&&(i===null||cr.current&1?zr===0&&(zr=3):jg())),o.updateQueue!==null&&(o.flags|=4),hi(o),null);case 4:return Wl(),$m(i,o),i===null&&Oc(o.stateNode.containerInfo),hi(o),null;case 10:return Tg(o.type._context),hi(o),null;case 17:return Oi(o.type)&&Od(),hi(o),null;case 19:if(rr(cr),I=o.memoizedState,I===null)return hi(o),null;if(_=(o.flags&128)!==0,S=I.rendering,S===null)if(_)mc(I,!1);else{if(zr!==0||i!==null&&i.flags&128)for(i=o.child;i!==null;){if(S=qd(i),S!==null){for(o.flags|=128,mc(I,!1),_=S.updateQueue,_!==null&&(o.updateQueue=_,o.flags|=4),o.subtreeFlags=0,_=h,h=o.child;h!==null;)I=h,i=_,I.flags&=14680066,S=I.alternate,S===null?(I.childLanes=0,I.lanes=i,I.child=null,I.subtreeFlags=0,I.memoizedProps=null,I.memoizedState=null,I.updateQueue=null,I.dependencies=null,I.stateNode=null):(I.childLanes=S.childLanes,I.lanes=S.lanes,I.child=S.child,I.subtreeFlags=0,I.deletions=null,I.memoizedProps=S.memoizedProps,I.memoizedState=S.memoizedState,I.updateQueue=S.updateQueue,I.type=S.type,i=S.dependencies,I.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext}),h=h.sibling;return Yt(cr,cr.current&1|2),o.child}i=i.sibling}I.tail!==null&&yr()>Kl&&(o.flags|=128,_=!0,mc(I,!1),o.lanes=4194304)}else{if(!_)if(i=qd(S),i!==null){if(o.flags|=128,_=!0,h=i.updateQueue,h!==null&&(o.updateQueue=h,o.flags|=4),mc(I,!0),I.tail===null&&I.tailMode==="hidden"&&!S.alternate&&!ar)return hi(o),null}else 2*yr()-I.renderingStartTime>Kl&&h!==1073741824&&(o.flags|=128,_=!0,mc(I,!1),o.lanes=4194304);I.isBackwards?(S.sibling=o.child,o.child=S):(h=I.last,h!==null?h.sibling=S:o.child=S,I.last=S)}return I.tail!==null?(o=I.tail,I.rendering=o,I.tail=o.sibling,I.renderingStartTime=yr(),o.sibling=null,h=cr.current,Yt(cr,_?h&1|2:h&1),o):(hi(o),null);case 22:case 23:return Vg(),_=o.memoizedState!==null,i!==null&&i.memoizedState!==null!==_&&(o.flags|=8192),_&&o.mode&1?rn&1073741824&&(hi(o),o.subtreeFlags&6&&(o.flags|=8192)):hi(o),null;case 24:return null;case 25:return null}throw Error(Ee(156,o.tag))}function uS(i,o){switch(xg(o),o.tag){case 1:return Oi(o.type)&&Od(),i=o.flags,i&65536?(o.flags=i&-65537|128,o):null;case 3:return Wl(),rr(Bi),rr(pi),Cg(),i=o.flags,i&65536&&!(i&128)?(o.flags=i&-65537|128,o):null;case 5:return Pg(o),null;case 13:if(rr(cr),i=o.memoizedState,i!==null&&i.dehydrated!==null){if(o.alternate===null)throw Error(Ee(340));Gl()}return i=o.flags,i&65536?(o.flags=i&-65537|128,o):null;case 19:return rr(cr),null;case 4:return Wl(),null;case 10:return Tg(o.type._context),null;case 22:case 23:return Vg(),null;case 24:return null;default:return null}}var fd=!1,di=!1,cS=typeof WeakSet=="function"?WeakSet:Set,et=null;function Fl(i,o){var h=i.ref;if(h!==null)if(typeof h=="function")try{h(null)}catch(_){gr(i,o,_)}else h.current=null}function Zm(i,o,h){try{h()}catch(_){gr(i,o,_)}}var Pv=!1;function hS(i,o){if(Em=Ld,i=$x(),yg(i)){if("selectionStart"in i)var h={start:i.selectionStart,end:i.selectionEnd};else e:{h=(h=i.ownerDocument)&&h.defaultView||window;var _=h.getSelection&&h.getSelection();if(_&&_.rangeCount!==0){h=_.anchorNode;var b=_.anchorOffset,I=_.focusNode;_=_.focusOffset;try{h.nodeType,I.nodeType}catch{h=null;break e}var S=0,d=-1,H=-1,le=0,ye=0,re=i,q=null;t:for(;;){for(var ke;re!==h||b!==0&&re.nodeType!==3||(d=S+b),re!==I||_!==0&&re.nodeType!==3||(H=S+_),re.nodeType===3&&(S+=re.nodeValue.length),(ke=re.firstChild)!==null;)q=re,re=ke;for(;;){if(re===i)break t;if(q===h&&++le===b&&(d=S),q===I&&++ye===_&&(H=S),(ke=re.nextSibling)!==null)break;re=q,q=re.parentNode}re=ke}h=d===-1||H===-1?null:{start:d,end:H}}else h=null}h=h||{start:0,end:0}}else h=null;for(Pm={focusedElem:i,selectionRange:h},Ld=!1,et=o;et!==null;)if(o=et,i=o.child,(o.subtreeFlags&1028)!==0&&i!==null)i.return=o,et=i;else for(;et!==null;){o=et;try{var Pe=o.alternate;if(o.flags&1024)switch(o.tag){case 0:case 11:case 15:break;case 1:if(Pe!==null){var Fe=Pe.memoizedProps,Ct=Pe.memoizedState,ce=o.stateNode,ie=ce.getSnapshotBeforeUpdate(o.elementType===o.type?Fe:Fn(o.type,Fe),Ct);ce.__reactInternalSnapshotBeforeUpdate=ie}break;case 3:var de=o.stateNode.containerInfo;de.nodeType===1?de.textContent="":de.nodeType===9&&de.documentElement&&de.removeChild(de.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Ee(163))}}catch(Te){gr(o,o.return,Te)}if(i=o.sibling,i!==null){i.return=o.return,et=i;break}et=o.return}return Pe=Pv,Pv=!1,Pe}function Ec(i,o,h){var _=o.updateQueue;if(_=_!==null?_.lastEffect:null,_!==null){var b=_=_.next;do{if((b.tag&i)===i){var I=b.destroy;b.destroy=void 0,I!==void 0&&Zm(o,h,I)}b=b.next}while(b!==_)}}function lp(i,o){if(o=o.updateQueue,o=o!==null?o.lastEffect:null,o!==null){var h=o=o.next;do{if((h.tag&i)===i){var _=h.create;h.destroy=_()}h=h.next}while(h!==o)}}function qm(i){var o=i.ref;if(o!==null){var h=i.stateNode;switch(i.tag){case 5:i=h;break;default:i=h}typeof o=="function"?o(i):o.current=i}}function N0(i){var o=i.alternate;o!==null&&(i.alternate=null,N0(o)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(o=i.stateNode,o!==null&&(delete o[ns],delete o[Vc],delete o[Mm],delete o[H2],delete o[W2])),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}function V0(i){return i.tag===5||i.tag===3||i.tag===4}function Cv(i){e:for(;;){for(;i.sibling===null;){if(i.return===null||V0(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.flags&2||i.child===null||i.tag===4)continue e;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function Gm(i,o,h){var _=i.tag;if(_===5||_===6)i=i.stateNode,o?h.nodeType===8?h.parentNode.insertBefore(i,o):h.insertBefore(i,o):(h.nodeType===8?(o=h.parentNode,o.insertBefore(i,h)):(o=h,o.appendChild(i)),h=h._reactRootContainer,h!=null||o.onclick!==null||(o.onclick=Bd));else if(_!==4&&(i=i.child,i!==null))for(Gm(i,o,h),i=i.sibling;i!==null;)Gm(i,o,h),i=i.sibling}function Hm(i,o,h){var _=i.tag;if(_===5||_===6)i=i.stateNode,o?h.insertBefore(i,o):h.appendChild(i);else if(_!==4&&(i=i.child,i!==null))for(Hm(i,o,h),i=i.sibling;i!==null;)Hm(i,o,h),i=i.sibling}var Xr=null,Bn=!1;function vo(i,o,h){for(h=h.child;h!==null;)j0(i,o,h),h=h.sibling}function j0(i,o,h){if(ss&&typeof ss.onCommitFiberUnmount=="function")try{ss.onCommitFiberUnmount(ep,h)}catch{}switch(h.tag){case 5:di||Fl(h,o);case 6:var _=Xr,b=Bn;Xr=null,vo(i,o,h),Xr=_,Bn=b,Xr!==null&&(Bn?(i=Xr,h=h.stateNode,i.nodeType===8?i.parentNode.removeChild(h):i.removeChild(h)):Xr.removeChild(h.stateNode));break;case 18:Xr!==null&&(Bn?(i=Xr,h=h.stateNode,i.nodeType===8?Wf(i.parentNode,h):i.nodeType===1&&Wf(i,h),Rc(i)):Wf(Xr,h.stateNode));break;case 4:_=Xr,b=Bn,Xr=h.stateNode.containerInfo,Bn=!0,vo(i,o,h),Xr=_,Bn=b;break;case 0:case 11:case 14:case 15:if(!di&&(_=h.updateQueue,_!==null&&(_=_.lastEffect,_!==null))){b=_=_.next;do{var I=b,S=I.destroy;I=I.tag,S!==void 0&&(I&2||I&4)&&Zm(h,o,S),b=b.next}while(b!==_)}vo(i,o,h);break;case 1:if(!di&&(Fl(h,o),_=h.stateNode,typeof _.componentWillUnmount=="function"))try{_.props=h.memoizedProps,_.state=h.memoizedState,_.componentWillUnmount()}catch(d){gr(h,o,d)}vo(i,o,h);break;case 21:vo(i,o,h);break;case 22:h.mode&1?(di=(_=di)||h.memoizedState!==null,vo(i,o,h),di=_):vo(i,o,h);break;default:vo(i,o,h)}}function zv(i){var o=i.updateQueue;if(o!==null){i.updateQueue=null;var h=i.stateNode;h===null&&(h=i.stateNode=new cS),o.forEach(function(_){var b=xS.bind(null,i,_);h.has(_)||(h.add(_),_.then(b,b))})}}function Rn(i,o){var h=o.deletions;if(h!==null)for(var _=0;_<h.length;_++){var b=h[_];try{var I=i,S=o,d=S;e:for(;d!==null;){switch(d.tag){case 5:Xr=d.stateNode,Bn=!1;break e;case 3:Xr=d.stateNode.containerInfo,Bn=!0;break e;case 4:Xr=d.stateNode.containerInfo,Bn=!0;break e}d=d.return}if(Xr===null)throw Error(Ee(160));j0(I,S,b),Xr=null,Bn=!1;var H=b.alternate;H!==null&&(H.return=null),b.return=null}catch(le){gr(b,o,le)}}if(o.subtreeFlags&12854)for(o=o.child;o!==null;)U0(o,i),o=o.sibling}function U0(i,o){var h=i.alternate,_=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:if(Rn(o,i),rs(i),_&4){try{Ec(3,i,i.return),lp(3,i)}catch(Fe){gr(i,i.return,Fe)}try{Ec(5,i,i.return)}catch(Fe){gr(i,i.return,Fe)}}break;case 1:Rn(o,i),rs(i),_&512&&h!==null&&Fl(h,h.return);break;case 5:if(Rn(o,i),rs(i),_&512&&h!==null&&Fl(h,h.return),i.flags&32){var b=i.stateNode;try{Mc(b,"")}catch(Fe){gr(i,i.return,Fe)}}if(_&4&&(b=i.stateNode,b!=null)){var I=i.memoizedProps,S=h!==null?h.memoizedProps:I,d=i.type,H=i.updateQueue;if(i.updateQueue=null,H!==null)try{d==="input"&&I.type==="radio"&&I.name!=null&&cx(b,I),_m(d,S);var le=_m(d,I);for(S=0;S<H.length;S+=2){var ye=H[S],re=H[S+1];ye==="style"?mx(b,re):ye==="dangerouslySetInnerHTML"?px(b,re):ye==="children"?Mc(b,re):sg(b,ye,re,le)}switch(d){case"input":dm(b,I);break;case"textarea":hx(b,I);break;case"select":var q=b._wrapperState.wasMultiple;b._wrapperState.wasMultiple=!!I.multiple;var ke=I.value;ke!=null?Ol(b,!!I.multiple,ke,!1):q!==!!I.multiple&&(I.defaultValue!=null?Ol(b,!!I.multiple,I.defaultValue,!0):Ol(b,!!I.multiple,I.multiple?[]:"",!1))}b[Vc]=I}catch(Fe){gr(i,i.return,Fe)}}break;case 6:if(Rn(o,i),rs(i),_&4){if(i.stateNode===null)throw Error(Ee(162));b=i.stateNode,I=i.memoizedProps;try{b.nodeValue=I}catch(Fe){gr(i,i.return,Fe)}}break;case 3:if(Rn(o,i),rs(i),_&4&&h!==null&&h.memoizedState.isDehydrated)try{Rc(o.containerInfo)}catch(Fe){gr(i,i.return,Fe)}break;case 4:Rn(o,i),rs(i);break;case 13:Rn(o,i),rs(i),b=i.child,b.flags&8192&&(I=b.memoizedState!==null,b.stateNode.isHidden=I,!I||b.alternate!==null&&b.alternate.memoizedState!==null||(Og=yr())),_&4&&zv(i);break;case 22:if(ye=h!==null&&h.memoizedState!==null,i.mode&1?(di=(le=di)||ye,Rn(o,i),di=le):Rn(o,i),rs(i),_&8192){if(le=i.memoizedState!==null,(i.stateNode.isHidden=le)&&!ye&&i.mode&1)for(et=i,ye=i.child;ye!==null;){for(re=et=ye;et!==null;){switch(q=et,ke=q.child,q.tag){case 0:case 11:case 14:case 15:Ec(4,q,q.return);break;case 1:Fl(q,q.return);var Pe=q.stateNode;if(typeof Pe.componentWillUnmount=="function"){_=q,h=q.return;try{o=_,Pe.props=o.memoizedProps,Pe.state=o.memoizedState,Pe.componentWillUnmount()}catch(Fe){gr(_,h,Fe)}}break;case 5:Fl(q,q.return);break;case 22:if(q.memoizedState!==null){Av(re);continue}}ke!==null?(ke.return=q,et=ke):Av(re)}ye=ye.sibling}e:for(ye=null,re=i;;){if(re.tag===5){if(ye===null){ye=re;try{b=re.stateNode,le?(I=b.style,typeof I.setProperty=="function"?I.setProperty("display","none","important"):I.display="none"):(d=re.stateNode,H=re.memoizedProps.style,S=H!=null&&H.hasOwnProperty("display")?H.display:null,d.style.display=fx("display",S))}catch(Fe){gr(i,i.return,Fe)}}}else if(re.tag===6){if(ye===null)try{re.stateNode.nodeValue=le?"":re.memoizedProps}catch(Fe){gr(i,i.return,Fe)}}else if((re.tag!==22&&re.tag!==23||re.memoizedState===null||re===i)&&re.child!==null){re.child.return=re,re=re.child;continue}if(re===i)break e;for(;re.sibling===null;){if(re.return===null||re.return===i)break e;ye===re&&(ye=null),re=re.return}ye===re&&(ye=null),re.sibling.return=re.return,re=re.sibling}}break;case 19:Rn(o,i),rs(i),_&4&&zv(i);break;case 21:break;default:Rn(o,i),rs(i)}}function rs(i){var o=i.flags;if(o&2){try{e:{for(var h=i.return;h!==null;){if(V0(h)){var _=h;break e}h=h.return}throw Error(Ee(160))}switch(_.tag){case 5:var b=_.stateNode;_.flags&32&&(Mc(b,""),_.flags&=-33);var I=Cv(i);Hm(i,I,b);break;case 3:case 4:var S=_.stateNode.containerInfo,d=Cv(i);Gm(i,d,S);break;default:throw Error(Ee(161))}}catch(H){gr(i,i.return,H)}i.flags&=-3}o&4096&&(i.flags&=-4097)}function dS(i,o,h){et=i,$0(i)}function $0(i,o,h){for(var _=(i.mode&1)!==0;et!==null;){var b=et,I=b.child;if(b.tag===22&&_){var S=b.memoizedState!==null||fd;if(!S){var d=b.alternate,H=d!==null&&d.memoizedState!==null||di;d=fd;var le=di;if(fd=S,(di=H)&&!le)for(et=b;et!==null;)S=et,H=S.child,S.tag===22&&S.memoizedState!==null?Dv(b):H!==null?(H.return=S,et=H):Dv(b);for(;I!==null;)et=I,$0(I),I=I.sibling;et=b,fd=d,di=le}Mv(i)}else b.subtreeFlags&8772&&I!==null?(I.return=b,et=I):Mv(i)}}function Mv(i){for(;et!==null;){var o=et;if(o.flags&8772){var h=o.alternate;try{if(o.flags&8772)switch(o.tag){case 0:case 11:case 15:di||lp(5,o);break;case 1:var _=o.stateNode;if(o.flags&4&&!di)if(h===null)_.componentDidMount();else{var b=o.elementType===o.type?h.memoizedProps:Fn(o.type,h.memoizedProps);_.componentDidUpdate(b,h.memoizedState,_.__reactInternalSnapshotBeforeUpdate)}var I=o.updateQueue;I!==null&&mv(o,I,_);break;case 3:var S=o.updateQueue;if(S!==null){if(h=null,o.child!==null)switch(o.child.tag){case 5:h=o.child.stateNode;break;case 1:h=o.child.stateNode}mv(o,S,h)}break;case 5:var d=o.stateNode;if(h===null&&o.flags&4){h=d;var H=o.memoizedProps;switch(o.type){case"button":case"input":case"select":case"textarea":H.autoFocus&&h.focus();break;case"img":H.src&&(h.src=H.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(o.memoizedState===null){var le=o.alternate;if(le!==null){var ye=le.memoizedState;if(ye!==null){var re=ye.dehydrated;re!==null&&Rc(re)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Ee(163))}di||o.flags&512&&qm(o)}catch(q){gr(o,o.return,q)}}if(o===i){et=null;break}if(h=o.sibling,h!==null){h.return=o.return,et=h;break}et=o.return}}function Av(i){for(;et!==null;){var o=et;if(o===i){et=null;break}var h=o.sibling;if(h!==null){h.return=o.return,et=h;break}et=o.return}}function Dv(i){for(;et!==null;){var o=et;try{switch(o.tag){case 0:case 11:case 15:var h=o.return;try{lp(4,o)}catch(H){gr(o,h,H)}break;case 1:var _=o.stateNode;if(typeof _.componentDidMount=="function"){var b=o.return;try{_.componentDidMount()}catch(H){gr(o,b,H)}}var I=o.return;try{qm(o)}catch(H){gr(o,I,H)}break;case 5:var S=o.return;try{qm(o)}catch(H){gr(o,S,H)}}}catch(H){gr(o,o.return,H)}if(o===i){et=null;break}var d=o.sibling;if(d!==null){d.return=o.return,et=d;break}et=o.return}}var pS=Math.ceil,Wd=Fs.ReactCurrentDispatcher,Fg=Fs.ReactCurrentOwner,Tn=Fs.ReactCurrentBatchConfig,Lt=0,Ur=null,kr=null,Kr=0,rn=0,Bl=Bo(0),zr=0,Gc=null,Ea=0,up=0,Bg=0,Pc=null,Ri=null,Og=0,Kl=1/0,Es=null,Xd=!1,Wm=null,Mo=null,md=!1,ko=null,Kd=0,Cc=0,Xm=null,Id=-1,Ed=0;function Si(){return Lt&6?yr():Id!==-1?Id:Id=yr()}function Ao(i){return i.mode&1?Lt&2&&Kr!==0?Kr&-Kr:K2.transition!==null?(Ed===0&&(Ed=Ex()),Ed):(i=Zt,i!==0||(i=window.event,i=i===void 0?16:Lx(i.type)),i):1}function jn(i,o,h,_){if(50<Cc)throw Cc=0,Xm=null,Error(Ee(185));Wc(i,h,_),(!(Lt&2)||i!==Ur)&&(i===Ur&&(!(Lt&2)&&(up|=h),zr===4&&So(i,Kr)),Ni(i,_),h===1&&Lt===0&&!(o.mode&1)&&(Kl=yr()+500,sp&&Oo()))}function Ni(i,o){var h=i.callbackNode;Kb(i,o);var _=Dd(i,i===Ur?Kr:0);if(_===0)h!==null&&Uy(h),i.callbackNode=null,i.callbackPriority=0;else if(o=_&-_,i.callbackPriority!==o){if(h!=null&&Uy(h),o===1)i.tag===0?X2(Lv.bind(null,i)):Qx(Lv.bind(null,i)),q2(function(){!(Lt&6)&&Oo()}),h=null;else{switch(Px(_)){case 1:h=cg;break;case 4:h=kx;break;case 16:h=Ad;break;case 536870912:h=Ix;break;default:h=Ad}h=Y0(h,Z0.bind(null,i))}i.callbackPriority=o,i.callbackNode=h}}function Z0(i,o){if(Id=-1,Ed=0,Lt&6)throw Error(Ee(327));var h=i.callbackNode;if($l()&&i.callbackNode!==h)return null;var _=Dd(i,i===Ur?Kr:0);if(_===0)return null;if(_&30||_&i.expiredLanes||o)o=Yd(i,_);else{o=_;var b=Lt;Lt|=2;var I=G0();(Ur!==i||Kr!==o)&&(Es=null,Kl=yr()+500,ba(i,o));do try{gS();break}catch(d){q0(i,d)}while(!0);Sg(),Wd.current=I,Lt=b,kr!==null?o=0:(Ur=null,Kr=0,o=zr)}if(o!==0){if(o===2&&(b=bm(i),b!==0&&(_=b,o=Km(i,b))),o===1)throw h=Gc,ba(i,0),So(i,_),Ni(i,yr()),h;if(o===6)So(i,_);else{if(b=i.current.alternate,!(_&30)&&!fS(b)&&(o=Yd(i,_),o===2&&(I=bm(i),I!==0&&(_=I,o=Km(i,I))),o===1))throw h=Gc,ba(i,0),So(i,_),Ni(i,yr()),h;switch(i.finishedWork=b,i.finishedLanes=_,o){case 0:case 1:throw Error(Ee(345));case 2:ya(i,Ri,Es);break;case 3:if(So(i,_),(_&130023424)===_&&(o=Og+500-yr(),10<o)){if(Dd(i,0)!==0)break;if(b=i.suspendedLanes,(b&_)!==_){Si(),i.pingedLanes|=i.suspendedLanes&b;break}i.timeoutHandle=zm(ya.bind(null,i,Ri,Es),o);break}ya(i,Ri,Es);break;case 4:if(So(i,_),(_&4194240)===_)break;for(o=i.eventTimes,b=-1;0<_;){var S=31-Vn(_);I=1<<S,S=o[S],S>b&&(b=S),_&=~I}if(_=b,_=yr()-_,_=(120>_?120:480>_?480:1080>_?1080:1920>_?1920:3e3>_?3e3:4320>_?4320:1960*pS(_/1960))-_,10<_){i.timeoutHandle=zm(ya.bind(null,i,Ri,Es),_);break}ya(i,Ri,Es);break;case 5:ya(i,Ri,Es);break;default:throw Error(Ee(329))}}}return Ni(i,yr()),i.callbackNode===h?Z0.bind(null,i):null}function Km(i,o){var h=Pc;return i.current.memoizedState.isDehydrated&&(ba(i,o).flags|=256),i=Yd(i,o),i!==2&&(o=Ri,Ri=h,o!==null&&Ym(o)),i}function Ym(i){Ri===null?Ri=i:Ri.push.apply(Ri,i)}function fS(i){for(var o=i;;){if(o.flags&16384){var h=o.updateQueue;if(h!==null&&(h=h.stores,h!==null))for(var _=0;_<h.length;_++){var b=h[_],I=b.getSnapshot;b=b.value;try{if(!Un(I(),b))return!1}catch{return!1}}}if(h=o.child,o.subtreeFlags&16384&&h!==null)h.return=o,o=h;else{if(o===i)break;for(;o.sibling===null;){if(o.return===null||o.return===i)return!0;o=o.return}o.sibling.return=o.return,o=o.sibling}}return!0}function So(i,o){for(o&=~Bg,o&=~up,i.suspendedLanes|=o,i.pingedLanes&=~o,i=i.expirationTimes;0<o;){var h=31-Vn(o),_=1<<h;i[h]=-1,o&=~_}}function Lv(i){if(Lt&6)throw Error(Ee(327));$l();var o=Dd(i,0);if(!(o&1))return Ni(i,yr()),null;var h=Yd(i,o);if(i.tag!==0&&h===2){var _=bm(i);_!==0&&(o=_,h=Km(i,_))}if(h===1)throw h=Gc,ba(i,0),So(i,o),Ni(i,yr()),h;if(h===6)throw Error(Ee(345));return i.finishedWork=i.current.alternate,i.finishedLanes=o,ya(i,Ri,Es),Ni(i,yr()),null}function Ng(i,o){var h=Lt;Lt|=1;try{return i(o)}finally{Lt=h,Lt===0&&(Kl=yr()+500,sp&&Oo())}}function Pa(i){ko!==null&&ko.tag===0&&!(Lt&6)&&$l();var o=Lt;Lt|=1;var h=Tn.transition,_=Zt;try{if(Tn.transition=null,Zt=1,i)return i()}finally{Zt=_,Tn.transition=h,Lt=o,!(Lt&6)&&Oo()}}function Vg(){rn=Bl.current,rr(Bl)}function ba(i,o){i.finishedWork=null,i.finishedLanes=0;var h=i.timeoutHandle;if(h!==-1&&(i.timeoutHandle=-1,Z2(h)),kr!==null)for(h=kr.return;h!==null;){var _=h;switch(xg(_),_.tag){case 1:_=_.type.childContextTypes,_!=null&&Od();break;case 3:Wl(),rr(Bi),rr(pi),Cg();break;case 5:Pg(_);break;case 4:Wl();break;case 13:rr(cr);break;case 19:rr(cr);break;case 10:Tg(_.type._context);break;case 22:case 23:Vg()}h=h.return}if(Ur=i,kr=i=Do(i.current,null),Kr=rn=o,zr=0,Gc=null,Bg=up=Ea=0,Ri=Pc=null,xa!==null){for(o=0;o<xa.length;o++)if(h=xa[o],_=h.interleaved,_!==null){h.interleaved=null;var b=_.next,I=h.pending;if(I!==null){var S=I.next;I.next=b,_.next=S}h.pending=_}xa=null}return i}function q0(i,o){do{var h=kr;try{if(Sg(),Sd.current=Hd,Gd){for(var _=hr.memoizedState;_!==null;){var b=_.queue;b!==null&&(b.pending=null),_=_.next}Gd=!1}if(Ia=0,Vr=Cr=hr=null,Ic=!1,$c=0,Fg.current=null,h===null||h.return===null){zr=1,Gc=o,kr=null;break}e:{var I=i,S=h.return,d=h,H=o;if(o=Kr,d.flags|=32768,H!==null&&typeof H=="object"&&typeof H.then=="function"){var le=H,ye=d,re=ye.tag;if(!(ye.mode&1)&&(re===0||re===11||re===15)){var q=ye.alternate;q?(ye.updateQueue=q.updateQueue,ye.memoizedState=q.memoizedState,ye.lanes=q.lanes):(ye.updateQueue=null,ye.memoizedState=null)}var ke=wv(S);if(ke!==null){ke.flags&=-257,bv(ke,S,d,I,o),ke.mode&1&&xv(I,le,o),o=ke,H=le;var Pe=o.updateQueue;if(Pe===null){var Fe=new Set;Fe.add(H),o.updateQueue=Fe}else Pe.add(H);break e}else{if(!(o&1)){xv(I,le,o),jg();break e}H=Error(Ee(426))}}else if(ar&&d.mode&1){var Ct=wv(S);if(Ct!==null){!(Ct.flags&65536)&&(Ct.flags|=256),bv(Ct,S,d,I,o),wg(Xl(H,d));break e}}I=H=Xl(H,d),zr!==4&&(zr=2),Pc===null?Pc=[I]:Pc.push(I),I=S;do{switch(I.tag){case 3:I.flags|=65536,o&=-o,I.lanes|=o;var ce=P0(I,H,o);fv(I,ce);break e;case 1:d=H;var ie=I.type,de=I.stateNode;if(!(I.flags&128)&&(typeof ie.getDerivedStateFromError=="function"||de!==null&&typeof de.componentDidCatch=="function"&&(Mo===null||!Mo.has(de)))){I.flags|=65536,o&=-o,I.lanes|=o;var Te=C0(I,d,o);fv(I,Te);break e}}I=I.return}while(I!==null)}W0(h)}catch(je){o=je,kr===h&&h!==null&&(kr=h=h.return);continue}break}while(!0)}function G0(){var i=Wd.current;return Wd.current=Hd,i===null?Hd:i}function jg(){(zr===0||zr===3||zr===2)&&(zr=4),Ur===null||!(Ea&268435455)&&!(up&268435455)||So(Ur,Kr)}function Yd(i,o){var h=Lt;Lt|=2;var _=G0();(Ur!==i||Kr!==o)&&(Es=null,ba(i,o));do try{mS();break}catch(b){q0(i,b)}while(!0);if(Sg(),Lt=h,Wd.current=_,kr!==null)throw Error(Ee(261));return Ur=null,Kr=0,zr}function mS(){for(;kr!==null;)H0(kr)}function gS(){for(;kr!==null&&!jb();)H0(kr)}function H0(i){var o=K0(i.alternate,i,rn);i.memoizedProps=i.pendingProps,o===null?W0(i):kr=o,Fg.current=null}function W0(i){var o=i;do{var h=o.alternate;if(i=o.return,o.flags&32768){if(h=uS(h,o),h!==null){h.flags&=32767,kr=h;return}if(i!==null)i.flags|=32768,i.subtreeFlags=0,i.deletions=null;else{zr=6,kr=null;return}}else if(h=lS(h,o,rn),h!==null){kr=h;return}if(o=o.sibling,o!==null){kr=o;return}kr=o=i}while(o!==null);zr===0&&(zr=5)}function ya(i,o,h){var _=Zt,b=Tn.transition;try{Tn.transition=null,Zt=1,_S(i,o,h,_)}finally{Tn.transition=b,Zt=_}return null}function _S(i,o,h,_){do $l();while(ko!==null);if(Lt&6)throw Error(Ee(327));h=i.finishedWork;var b=i.finishedLanes;if(h===null)return null;if(i.finishedWork=null,i.finishedLanes=0,h===i.current)throw Error(Ee(177));i.callbackNode=null,i.callbackPriority=0;var I=h.lanes|h.childLanes;if(Yb(i,I),i===Ur&&(kr=Ur=null,Kr=0),!(h.subtreeFlags&2064)&&!(h.flags&2064)||md||(md=!0,Y0(Ad,function(){return $l(),null})),I=(h.flags&15990)!==0,h.subtreeFlags&15990||I){I=Tn.transition,Tn.transition=null;var S=Zt;Zt=1;var d=Lt;Lt|=4,Fg.current=null,hS(i,h),U0(h,i),B2(Pm),Ld=!!Em,Pm=Em=null,i.current=h,dS(h),Ub(),Lt=d,Zt=S,Tn.transition=I}else i.current=h;if(md&&(md=!1,ko=i,Kd=b),I=i.pendingLanes,I===0&&(Mo=null),qb(h.stateNode),Ni(i,yr()),o!==null)for(_=i.onRecoverableError,h=0;h<o.length;h++)b=o[h],_(b.value,{componentStack:b.stack,digest:b.digest});if(Xd)throw Xd=!1,i=Wm,Wm=null,i;return Kd&1&&i.tag!==0&&$l(),I=i.pendingLanes,I&1?i===Xm?Cc++:(Cc=0,Xm=i):Cc=0,Oo(),null}function $l(){if(ko!==null){var i=Px(Kd),o=Tn.transition,h=Zt;try{if(Tn.transition=null,Zt=16>i?16:i,ko===null)var _=!1;else{if(i=ko,ko=null,Kd=0,Lt&6)throw Error(Ee(331));var b=Lt;for(Lt|=4,et=i.current;et!==null;){var I=et,S=I.child;if(et.flags&16){var d=I.deletions;if(d!==null){for(var H=0;H<d.length;H++){var le=d[H];for(et=le;et!==null;){var ye=et;switch(ye.tag){case 0:case 11:case 15:Ec(8,ye,I)}var re=ye.child;if(re!==null)re.return=ye,et=re;else for(;et!==null;){ye=et;var q=ye.sibling,ke=ye.return;if(N0(ye),ye===le){et=null;break}if(q!==null){q.return=ke,et=q;break}et=ke}}}var Pe=I.alternate;if(Pe!==null){var Fe=Pe.child;if(Fe!==null){Pe.child=null;do{var Ct=Fe.sibling;Fe.sibling=null,Fe=Ct}while(Fe!==null)}}et=I}}if(I.subtreeFlags&2064&&S!==null)S.return=I,et=S;else e:for(;et!==null;){if(I=et,I.flags&2048)switch(I.tag){case 0:case 11:case 15:Ec(9,I,I.return)}var ce=I.sibling;if(ce!==null){ce.return=I.return,et=ce;break e}et=I.return}}var ie=i.current;for(et=ie;et!==null;){S=et;var de=S.child;if(S.subtreeFlags&2064&&de!==null)de.return=S,et=de;else e:for(S=ie;et!==null;){if(d=et,d.flags&2048)try{switch(d.tag){case 0:case 11:case 15:lp(9,d)}}catch(je){gr(d,d.return,je)}if(d===S){et=null;break e}var Te=d.sibling;if(Te!==null){Te.return=d.return,et=Te;break e}et=d.return}}if(Lt=b,Oo(),ss&&typeof ss.onPostCommitFiberRoot=="function")try{ss.onPostCommitFiberRoot(ep,i)}catch{}_=!0}return _}finally{Zt=h,Tn.transition=o}}return!1}function Rv(i,o,h){o=Xl(h,o),o=P0(i,o,1),i=zo(i,o,1),o=Si(),i!==null&&(Wc(i,1,o),Ni(i,o))}function gr(i,o,h){if(i.tag===3)Rv(i,i,h);else for(;o!==null;){if(o.tag===3){Rv(o,i,h);break}else if(o.tag===1){var _=o.stateNode;if(typeof o.type.getDerivedStateFromError=="function"||typeof _.componentDidCatch=="function"&&(Mo===null||!Mo.has(_))){i=Xl(h,i),i=C0(o,i,1),o=zo(o,i,1),i=Si(),o!==null&&(Wc(o,1,i),Ni(o,i));break}}o=o.return}}function yS(i,o,h){var _=i.pingCache;_!==null&&_.delete(o),o=Si(),i.pingedLanes|=i.suspendedLanes&h,Ur===i&&(Kr&h)===h&&(zr===4||zr===3&&(Kr&130023424)===Kr&&500>yr()-Og?ba(i,0):Bg|=h),Ni(i,o)}function X0(i,o){o===0&&(i.mode&1?(o=sd,sd<<=1,!(sd&130023424)&&(sd=4194304)):o=1);var h=Si();i=Ls(i,o),i!==null&&(Wc(i,o,h),Ni(i,h))}function vS(i){var o=i.memoizedState,h=0;o!==null&&(h=o.retryLane),X0(i,h)}function xS(i,o){var h=0;switch(i.tag){case 13:var _=i.stateNode,b=i.memoizedState;b!==null&&(h=b.retryLane);break;case 19:_=i.stateNode;break;default:throw Error(Ee(314))}_!==null&&_.delete(o),X0(i,h)}var K0;K0=function(i,o,h){if(i!==null)if(i.memoizedProps!==o.pendingProps||Bi.current)Fi=!0;else{if(!(i.lanes&h)&&!(o.flags&128))return Fi=!1,aS(i,o,h);Fi=!!(i.flags&131072)}else Fi=!1,ar&&o.flags&1048576&&e0(o,jd,o.index);switch(o.lanes=0,o.tag){case 2:var _=o.type;kd(i,o),i=o.pendingProps;var b=ql(o,pi.current);Ul(o,h),b=Mg(null,o,_,i,b,h);var I=Ag();return o.flags|=1,typeof b=="object"&&b!==null&&typeof b.render=="function"&&b.$$typeof===void 0?(o.tag=1,o.memoizedState=null,o.updateQueue=null,Oi(_)?(I=!0,Nd(o)):I=!1,o.memoizedState=b.state!==null&&b.state!==void 0?b.state:null,Ig(o),b.updater=ap,o.stateNode=b,b._reactInternals=o,Bm(o,_,i,h),o=Vm(null,o,_,!0,I,h)):(o.tag=0,ar&&I&&vg(o),bi(null,o,b,h),o=o.child),o;case 16:_=o.elementType;e:{switch(kd(i,o),i=o.pendingProps,b=_._init,_=b(_._payload),o.type=_,b=o.tag=bS(_),i=Fn(_,i),b){case 0:o=Nm(null,o,_,i,h);break e;case 1:o=kv(null,o,_,i,h);break e;case 11:o=Sv(null,o,_,i,h);break e;case 14:o=Tv(null,o,_,Fn(_.type,i),h);break e}throw Error(Ee(306,_,""))}return o;case 0:return _=o.type,b=o.pendingProps,b=o.elementType===_?b:Fn(_,b),Nm(i,o,_,b,h);case 1:return _=o.type,b=o.pendingProps,b=o.elementType===_?b:Fn(_,b),kv(i,o,_,b,h);case 3:e:{if(D0(o),i===null)throw Error(Ee(387));_=o.pendingProps,I=o.memoizedState,b=I.element,o0(i,o),Zd(o,_,null,h);var S=o.memoizedState;if(_=S.element,I.isDehydrated)if(I={element:_,isDehydrated:!1,cache:S.cache,pendingSuspenseBoundaries:S.pendingSuspenseBoundaries,transitions:S.transitions},o.updateQueue.baseState=I,o.memoizedState=I,o.flags&256){b=Xl(Error(Ee(423)),o),o=Iv(i,o,_,h,b);break e}else if(_!==b){b=Xl(Error(Ee(424)),o),o=Iv(i,o,_,h,b);break e}else for(nn=Co(o.stateNode.containerInfo.firstChild),sn=o,ar=!0,On=null,h=n0(o,null,_,h),o.child=h;h;)h.flags=h.flags&-3|4096,h=h.sibling;else{if(Gl(),_===b){o=Rs(i,o,h);break e}bi(i,o,_,h)}o=o.child}return o;case 5:return a0(o),i===null&&Lm(o),_=o.type,b=o.pendingProps,I=i!==null?i.memoizedProps:null,S=b.children,Cm(_,b)?S=null:I!==null&&Cm(_,I)&&(o.flags|=32),A0(i,o),bi(i,o,S,h),o.child;case 6:return i===null&&Lm(o),null;case 13:return L0(i,o,h);case 4:return Eg(o,o.stateNode.containerInfo),_=o.pendingProps,i===null?o.child=Hl(o,null,_,h):bi(i,o,_,h),o.child;case 11:return _=o.type,b=o.pendingProps,b=o.elementType===_?b:Fn(_,b),Sv(i,o,_,b,h);case 7:return bi(i,o,o.pendingProps,h),o.child;case 8:return bi(i,o,o.pendingProps.children,h),o.child;case 12:return bi(i,o,o.pendingProps.children,h),o.child;case 10:e:{if(_=o.type._context,b=o.pendingProps,I=o.memoizedProps,S=b.value,Yt(Ud,_._currentValue),_._currentValue=S,I!==null)if(Un(I.value,S)){if(I.children===b.children&&!Bi.current){o=Rs(i,o,h);break e}}else for(I=o.child,I!==null&&(I.return=o);I!==null;){var d=I.dependencies;if(d!==null){S=I.child;for(var H=d.firstContext;H!==null;){if(H.context===_){if(I.tag===1){H=Ms(-1,h&-h),H.tag=2;var le=I.updateQueue;if(le!==null){le=le.shared;var ye=le.pending;ye===null?H.next=H:(H.next=ye.next,ye.next=H),le.pending=H}}I.lanes|=h,H=I.alternate,H!==null&&(H.lanes|=h),Rm(I.return,h,o),d.lanes|=h;break}H=H.next}}else if(I.tag===10)S=I.type===o.type?null:I.child;else if(I.tag===18){if(S=I.return,S===null)throw Error(Ee(341));S.lanes|=h,d=S.alternate,d!==null&&(d.lanes|=h),Rm(S,h,o),S=I.sibling}else S=I.child;if(S!==null)S.return=I;else for(S=I;S!==null;){if(S===o){S=null;break}if(I=S.sibling,I!==null){I.return=S.return,S=I;break}S=S.return}I=S}bi(i,o,b.children,h),o=o.child}return o;case 9:return b=o.type,_=o.pendingProps.children,Ul(o,h),b=kn(b),_=_(b),o.flags|=1,bi(i,o,_,h),o.child;case 14:return _=o.type,b=Fn(_,o.pendingProps),b=Fn(_.type,b),Tv(i,o,_,b,h);case 15:return z0(i,o,o.type,o.pendingProps,h);case 17:return _=o.type,b=o.pendingProps,b=o.elementType===_?b:Fn(_,b),kd(i,o),o.tag=1,Oi(_)?(i=!0,Nd(o)):i=!1,Ul(o,h),E0(o,_,b),Bm(o,_,b,h),Vm(null,o,_,!0,i,h);case 19:return R0(i,o,h);case 22:return M0(i,o,h)}throw Error(Ee(156,o.tag))};function Y0(i,o){return Tx(i,o)}function wS(i,o,h,_){this.tag=i,this.key=h,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=o,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=_,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Sn(i,o,h,_){return new wS(i,o,h,_)}function Ug(i){return i=i.prototype,!(!i||!i.isReactComponent)}function bS(i){if(typeof i=="function")return Ug(i)?1:0;if(i!=null){if(i=i.$$typeof,i===ag)return 11;if(i===lg)return 14}return 2}function Do(i,o){var h=i.alternate;return h===null?(h=Sn(i.tag,o,i.key,i.mode),h.elementType=i.elementType,h.type=i.type,h.stateNode=i.stateNode,h.alternate=i,i.alternate=h):(h.pendingProps=o,h.type=i.type,h.flags=0,h.subtreeFlags=0,h.deletions=null),h.flags=i.flags&14680064,h.childLanes=i.childLanes,h.lanes=i.lanes,h.child=i.child,h.memoizedProps=i.memoizedProps,h.memoizedState=i.memoizedState,h.updateQueue=i.updateQueue,o=i.dependencies,h.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext},h.sibling=i.sibling,h.index=i.index,h.ref=i.ref,h}function Pd(i,o,h,_,b,I){var S=2;if(_=i,typeof i=="function")Ug(i)&&(S=1);else if(typeof i=="string")S=5;else e:switch(i){case El:return Sa(h.children,b,I,o);case og:S=8,b|=8;break;case am:return i=Sn(12,h,o,b|2),i.elementType=am,i.lanes=I,i;case lm:return i=Sn(13,h,o,b),i.elementType=lm,i.lanes=I,i;case um:return i=Sn(19,h,o,b),i.elementType=um,i.lanes=I,i;case ax:return cp(h,b,I,o);default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case sx:S=10;break e;case ox:S=9;break e;case ag:S=11;break e;case lg:S=14;break e;case xo:S=16,_=null;break e}throw Error(Ee(130,i==null?i:typeof i,""))}return o=Sn(S,h,o,b),o.elementType=i,o.type=_,o.lanes=I,o}function Sa(i,o,h,_){return i=Sn(7,i,_,o),i.lanes=h,i}function cp(i,o,h,_){return i=Sn(22,i,_,o),i.elementType=ax,i.lanes=h,i.stateNode={isHidden:!1},i}function rm(i,o,h){return i=Sn(6,i,null,o),i.lanes=h,i}function im(i,o,h){return o=Sn(4,i.children!==null?i.children:[],i.key,o),o.lanes=h,o.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},o}function SS(i,o,h,_,b){this.tag=o,this.containerInfo=i,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Bf(0),this.expirationTimes=Bf(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Bf(0),this.identifierPrefix=_,this.onRecoverableError=b,this.mutableSourceEagerHydrationData=null}function $g(i,o,h,_,b,I,S,d,H){return i=new SS(i,o,h,d,H),o===1?(o=1,I===!0&&(o|=8)):o=0,I=Sn(3,null,null,o),i.current=I,I.stateNode=i,I.memoizedState={element:_,isDehydrated:h,cache:null,transitions:null,pendingSuspenseBoundaries:null},Ig(I),i}function TS(i,o,h){var _=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Il,key:_==null?null:""+_,children:i,containerInfo:o,implementation:h}}function J0(i){if(!i)return Ro;i=i._reactInternals;e:{if(za(i)!==i||i.tag!==1)throw Error(Ee(170));var o=i;do{switch(o.tag){case 3:o=o.stateNode.context;break e;case 1:if(Oi(o.type)){o=o.stateNode.__reactInternalMemoizedMergedChildContext;break e}}o=o.return}while(o!==null);throw Error(Ee(171))}if(i.tag===1){var h=i.type;if(Oi(h))return Jx(i,h,o)}return o}function Q0(i,o,h,_,b,I,S,d,H){return i=$g(h,_,!0,i,b,I,S,d,H),i.context=J0(null),h=i.current,_=Si(),b=Ao(h),I=Ms(_,b),I.callback=o??null,zo(h,I,b),i.current.lanes=b,Wc(i,b,_),Ni(i,_),i}function hp(i,o,h,_){var b=o.current,I=Si(),S=Ao(b);return h=J0(h),o.context===null?o.context=h:o.pendingContext=h,o=Ms(I,S),o.payload={element:i},_=_===void 0?null:_,_!==null&&(o.callback=_),i=zo(b,o,S),i!==null&&(jn(i,b,S,I),bd(i,b,S)),S}function Jd(i){if(i=i.current,!i.child)return null;switch(i.child.tag){case 5:return i.child.stateNode;default:return i.child.stateNode}}function Fv(i,o){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var h=i.retryLane;i.retryLane=h!==0&&h<o?h:o}}function Zg(i,o){Fv(i,o),(i=i.alternate)&&Fv(i,o)}function kS(){return null}var e1=typeof reportError=="function"?reportError:function(i){console.error(i)};function qg(i){this._internalRoot=i}dp.prototype.render=qg.prototype.render=function(i){var o=this._internalRoot;if(o===null)throw Error(Ee(409));hp(i,o,null,null)};dp.prototype.unmount=qg.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var o=i.containerInfo;Pa(function(){hp(null,i,null,null)}),o[Ds]=null}};function dp(i){this._internalRoot=i}dp.prototype.unstable_scheduleHydration=function(i){if(i){var o=Mx();i={blockedOn:null,target:i,priority:o};for(var h=0;h<bo.length&&o!==0&&o<bo[h].priority;h++);bo.splice(h,0,i),h===0&&Dx(i)}};function Gg(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}function pp(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11&&(i.nodeType!==8||i.nodeValue!==" react-mount-point-unstable "))}function Bv(){}function IS(i,o,h,_,b){if(b){if(typeof _=="function"){var I=_;_=function(){var le=Jd(S);I.call(le)}}var S=Q0(o,_,i,0,null,!1,!1,"",Bv);return i._reactRootContainer=S,i[Ds]=S.current,Oc(i.nodeType===8?i.parentNode:i),Pa(),S}for(;b=i.lastChild;)i.removeChild(b);if(typeof _=="function"){var d=_;_=function(){var le=Jd(H);d.call(le)}}var H=$g(i,0,!1,null,null,!1,!1,"",Bv);return i._reactRootContainer=H,i[Ds]=H.current,Oc(i.nodeType===8?i.parentNode:i),Pa(function(){hp(o,H,h,_)}),H}function fp(i,o,h,_,b){var I=h._reactRootContainer;if(I){var S=I;if(typeof b=="function"){var d=b;b=function(){var H=Jd(S);d.call(H)}}hp(o,S,i,b)}else S=IS(h,o,i,b,_);return Jd(S)}Cx=function(i){switch(i.tag){case 3:var o=i.stateNode;if(o.current.memoizedState.isDehydrated){var h=vc(o.pendingLanes);h!==0&&(hg(o,h|1),Ni(o,yr()),!(Lt&6)&&(Kl=yr()+500,Oo()))}break;case 13:Pa(function(){var _=Ls(i,1);if(_!==null){var b=Si();jn(_,i,1,b)}}),Zg(i,1)}};dg=function(i){if(i.tag===13){var o=Ls(i,134217728);if(o!==null){var h=Si();jn(o,i,134217728,h)}Zg(i,134217728)}};zx=function(i){if(i.tag===13){var o=Ao(i),h=Ls(i,o);if(h!==null){var _=Si();jn(h,i,o,_)}Zg(i,o)}};Mx=function(){return Zt};Ax=function(i,o){var h=Zt;try{return Zt=i,o()}finally{Zt=h}};vm=function(i,o,h){switch(o){case"input":if(dm(i,h),o=h.name,h.type==="radio"&&o!=null){for(h=i;h.parentNode;)h=h.parentNode;for(h=h.querySelectorAll("input[name="+JSON.stringify(""+o)+'][type="radio"]'),o=0;o<h.length;o++){var _=h[o];if(_!==i&&_.form===i.form){var b=np(_);if(!b)throw Error(Ee(90));ux(_),dm(_,b)}}}break;case"textarea":hx(i,h);break;case"select":o=h.value,o!=null&&Ol(i,!!h.multiple,o,!1)}};yx=Ng;vx=Pa;var ES={usingClientEntryPoint:!1,Events:[Kc,Ml,np,gx,_x,Ng]},gc={findFiberByHostInstance:va,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},PS={bundleType:gc.bundleType,version:gc.version,rendererPackageName:gc.rendererPackageName,rendererConfig:gc.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Fs.ReactCurrentDispatcher,findHostInstanceByFiber:function(i){return i=bx(i),i===null?null:i.stateNode},findFiberByHostInstance:gc.findFiberByHostInstance||kS,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var gd=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!gd.isDisabled&&gd.supportsFiber)try{ep=gd.inject(PS),ss=gd}catch{}}an.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ES;an.createPortal=function(i,o){var h=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Gg(o))throw Error(Ee(200));return TS(i,o,null,h)};an.createRoot=function(i,o){if(!Gg(i))throw Error(Ee(299));var h=!1,_="",b=e1;return o!=null&&(o.unstable_strictMode===!0&&(h=!0),o.identifierPrefix!==void 0&&(_=o.identifierPrefix),o.onRecoverableError!==void 0&&(b=o.onRecoverableError)),o=$g(i,1,!1,null,null,h,!1,_,b),i[Ds]=o.current,Oc(i.nodeType===8?i.parentNode:i),new qg(o)};an.findDOMNode=function(i){if(i==null)return null;if(i.nodeType===1)return i;var o=i._reactInternals;if(o===void 0)throw typeof i.render=="function"?Error(Ee(188)):(i=Object.keys(i).join(","),Error(Ee(268,i)));return i=bx(o),i=i===null?null:i.stateNode,i};an.flushSync=function(i){return Pa(i)};an.hydrate=function(i,o,h){if(!pp(o))throw Error(Ee(200));return fp(null,i,o,!0,h)};an.hydrateRoot=function(i,o,h){if(!Gg(i))throw Error(Ee(405));var _=h!=null&&h.hydratedSources||null,b=!1,I="",S=e1;if(h!=null&&(h.unstable_strictMode===!0&&(b=!0),h.identifierPrefix!==void 0&&(I=h.identifierPrefix),h.onRecoverableError!==void 0&&(S=h.onRecoverableError)),o=Q0(o,null,i,1,h??null,b,!1,I,S),i[Ds]=o.current,Oc(i),_)for(i=0;i<_.length;i++)h=_[i],b=h._getVersion,b=b(h._source),o.mutableSourceEagerHydrationData==null?o.mutableSourceEagerHydrationData=[h,b]:o.mutableSourceEagerHydrationData.push(h,b);return new dp(o)};an.render=function(i,o,h){if(!pp(o))throw Error(Ee(200));return fp(null,i,o,!1,h)};an.unmountComponentAtNode=function(i){if(!pp(i))throw Error(Ee(40));return i._reactRootContainer?(Pa(function(){fp(null,null,i,!1,function(){i._reactRootContainer=null,i[Ds]=null})}),!0):!1};an.unstable_batchedUpdates=Ng;an.unstable_renderSubtreeIntoContainer=function(i,o,h,_){if(!pp(h))throw Error(Ee(200));if(i==null||i._reactInternals===void 0)throw Error(Ee(38));return fp(i,o,h,!1,_)};an.version="18.3.1-next-f1338f8080-20240426";function t1(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t1)}catch(i){console.error(i)}}t1(),tx.exports=an;var CS=tx.exports,Ov=CS;sm.createRoot=Ov.createRoot,sm.hydrateRoot=Ov.hydrateRoot;var r1={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.7.1/LICENSE.txt
 */(function(i,o){(function(h,_){i.exports=_()})(ib,function(){var h={},_={};function b(S,d,H){if(_[S]=H,S==="index"){var le="var sharedModule = {}; ("+_.shared+")(sharedModule); ("+_.worker+")(sharedModule);",ye={};return _.shared(ye),_.index(h,ye),typeof window<"u"&&h.setWorkerUrl(window.URL.createObjectURL(new Blob([le],{type:"text/javascript"}))),h}}b("shared",["exports"],function(S){function d(r,t,n,a){return new(n||(n=Promise))(function(c,m){function g(k){try{x(a.next(k))}catch(E){m(E)}}function y(k){try{x(a.throw(k))}catch(E){m(E)}}function x(k){var E;k.done?c(k.value):(E=k.value,E instanceof n?E:new n(function(C){C(E)})).then(g,y)}x((a=a.apply(r,t||[])).next())})}function H(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}typeof SuppressedError=="function"&&SuppressedError;var le=ye;function ye(r,t){this.x=r,this.y=t}ye.prototype={clone:function(){return new ye(this.x,this.y)},add:function(r){return this.clone()._add(r)},sub:function(r){return this.clone()._sub(r)},multByPoint:function(r){return this.clone()._multByPoint(r)},divByPoint:function(r){return this.clone()._divByPoint(r)},mult:function(r){return this.clone()._mult(r)},div:function(r){return this.clone()._div(r)},rotate:function(r){return this.clone()._rotate(r)},rotateAround:function(r,t){return this.clone()._rotateAround(r,t)},matMult:function(r){return this.clone()._matMult(r)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(r){return this.x===r.x&&this.y===r.y},dist:function(r){return Math.sqrt(this.distSqr(r))},distSqr:function(r){var t=r.x-this.x,n=r.y-this.y;return t*t+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(r){return Math.atan2(this.y-r.y,this.x-r.x)},angleWith:function(r){return this.angleWithSep(r.x,r.y)},angleWithSep:function(r,t){return Math.atan2(this.x*t-this.y*r,this.x*r+this.y*t)},_matMult:function(r){var t=r[2]*this.x+r[3]*this.y;return this.x=r[0]*this.x+r[1]*this.y,this.y=t,this},_add:function(r){return this.x+=r.x,this.y+=r.y,this},_sub:function(r){return this.x-=r.x,this.y-=r.y,this},_mult:function(r){return this.x*=r,this.y*=r,this},_div:function(r){return this.x/=r,this.y/=r,this},_multByPoint:function(r){return this.x*=r.x,this.y*=r.y,this},_divByPoint:function(r){return this.x/=r.x,this.y/=r.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var r=this.y;return this.y=this.x,this.x=-r,this},_rotate:function(r){var t=Math.cos(r),n=Math.sin(r),a=n*this.x+t*this.y;return this.x=t*this.x-n*this.y,this.y=a,this},_rotateAround:function(r,t){var n=Math.cos(r),a=Math.sin(r),c=t.y+a*(this.x-t.x)+n*(this.y-t.y);return this.x=t.x+n*(this.x-t.x)-a*(this.y-t.y),this.y=c,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ye.convert=function(r){return r instanceof ye?r:Array.isArray(r)?new ye(r[0],r[1]):r};var re=H(le),q=ke;function ke(r,t,n,a){this.cx=3*r,this.bx=3*(n-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(a-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=t,this.p2x=n,this.p2y=a}ke.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,t){if(t===void 0&&(t=1e-6),r<0)return 0;if(r>1)return 1;for(var n=r,a=0;a<8;a++){var c=this.sampleCurveX(n)-r;if(Math.abs(c)<t)return n;var m=this.sampleCurveDerivativeX(n);if(Math.abs(m)<1e-6)break;n-=c/m}var g=0,y=1;for(n=r,a=0;a<20&&(c=this.sampleCurveX(n),!(Math.abs(c-r)<t));a++)r>c?g=n:y=n,n=.5*(y-g)+g;return n},solve:function(r,t){return this.sampleCurveY(this.solveCurveX(r,t))}};var Pe=H(q);let Fe,Ct;function ce(){return Fe==null&&(Fe=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Fe}function ie(){if(Ct==null&&(Ct=!1,ce())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let a=0;a<5*5;a++){const c=4*a;t.fillStyle=`rgb(${c},${c+1},${c+2})`,t.fillRect(a%5,Math.floor(a/5),1,1)}const n=t.getImageData(0,0,5,5).data;for(let a=0;a<5*5*4;a++)if(a%4!=3&&n[a]!==a){Ct=!0;break}}}return Ct||!1}function de(r,t,n,a){const c=new Pe(r,t,n,a);return m=>c.solve(m)}const Te=de(.25,.1,.25,1);function je(r,t,n){return Math.min(n,Math.max(t,r))}function Xe(r,t,n){const a=n-t,c=((r-t)%a+a)%a+t;return c===t?n:c}function qe(r,...t){for(const n of t)for(const a in n)r[a]=n[a];return r}let rt=1;function At(r,t,n){const a={};for(const c in r)a[c]=t.call(this,r[c],c,r);return a}function gt(r,t,n){const a={};for(const c in r)t.call(this,r[c],c,r)&&(a[c]=r[c]);return a}function _t(r){return Array.isArray(r)?r.map(_t):typeof r=="object"&&r?At(r,_t):r}const un={};function ir(r){un[r]||(typeof console<"u"&&console.warn(r),un[r]=!0)}function vr(r,t,n){return(n.y-r.y)*(t.x-r.x)>(t.y-r.y)*(n.x-r.x)}function Vi(r){return typeof WorkerGlobalScope<"u"&&r!==void 0&&r instanceof WorkerGlobalScope}let cn=null;function Jr(r){return typeof ImageBitmap<"u"&&r instanceof ImageBitmap}const Ge="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function ut(r,t,n,a,c){return d(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const m=new VideoFrame(r,{timestamp:0});try{const g=m==null?void 0:m.format;if(!g||!g.startsWith("BGR")&&!g.startsWith("RGB"))throw new Error(`Unrecognized format ${g}`);const y=g.startsWith("BGR"),x=new Uint8ClampedArray(a*c*4);if(yield m.copyTo(x,function(k,E,C,A,R){const B=4*Math.max(-E,0),O=(Math.max(0,C)-C)*A*4+B,$=4*A,X=Math.max(0,E),he=Math.max(0,C);return{rect:{x:X,y:he,width:Math.min(k.width,E+A)-X,height:Math.min(k.height,C+R)-he},layout:[{offset:O,stride:$}]}}(r,t,n,a,c)),y)for(let k=0;k<x.length;k+=4){const E=x[k];x[k]=x[k+2],x[k+2]=E}return x}finally{m.close()}})}let ct,St;const Rt="AbortError";function ji(){return new Error(Rt)}const Mr={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Qr(r){return Mr.REGISTERED_PROTOCOLS[r.substring(0,r.indexOf("://"))]}const ei="global-dispatcher";class xr extends Error{constructor(t,n,a,c){super(`AJAXError: ${n} (${t}): ${a}`),this.status=t,this.statusText=n,this.url=a,this.body=c}}const Ui=()=>Vi(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,as=function(r,t){if(/:\/\//.test(r.url)&&!/^https?:|^file:/.test(r.url)){const a=Qr(r.url);if(a)return a(r,t);if(Vi(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:r,targetMapId:ei},t)}if(!(/^file:/.test(n=r.url)||/^file:/.test(Ui())&&!/^\w+:/.test(n))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(a,c){return d(this,void 0,void 0,function*(){const m=new Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,cache:a.cache,referrer:Ui(),signal:c.signal});a.type!=="json"||m.headers.has("Accept")||m.headers.set("Accept","application/json");const g=yield fetch(m);if(!g.ok){const k=yield g.blob();throw new xr(g.status,g.statusText,a.url,k)}let y;y=a.type==="arrayBuffer"||a.type==="image"?g.arrayBuffer():a.type==="json"?g.json():g.text();const x=yield y;if(c.signal.aborted)throw ji();return{data:x,cacheControl:g.headers.get("Cache-Control"),expires:g.headers.get("Expires")}})}(r,t);if(Vi(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:r,mustQueue:!0,targetMapId:ei},t)}var n;return function(a,c){return new Promise((m,g)=>{var y;const x=new XMLHttpRequest;x.open(a.method||"GET",a.url,!0),a.type!=="arrayBuffer"&&a.type!=="image"||(x.responseType="arraybuffer");for(const k in a.headers)x.setRequestHeader(k,a.headers[k]);a.type==="json"&&(x.responseType="text",!((y=a.headers)===null||y===void 0)&&y.Accept||x.setRequestHeader("Accept","application/json")),x.withCredentials=a.credentials==="include",x.onerror=()=>{g(new Error(x.statusText))},x.onload=()=>{if(!c.signal.aborted)if((x.status>=200&&x.status<300||x.status===0)&&x.response!==null){let k=x.response;if(a.type==="json")try{k=JSON.parse(x.response)}catch(E){return void g(E)}m({data:k,cacheControl:x.getResponseHeader("Cache-Control"),expires:x.getResponseHeader("Expires")})}else{const k=new Blob([x.response],{type:x.getResponseHeader("Content-Type")});g(new xr(x.status,x.statusText,a.url,k))}},c.signal.addEventListener("abort",()=>{x.abort(),g(ji())}),x.send(a.body)})}(r,t)};function ls(r){if(!r||r.indexOf("://")<=0||r.indexOf("data:image/")===0||r.indexOf("blob:")===0)return!0;const t=new URL(r),n=window.location;return t.protocol===n.protocol&&t.host===n.host}function No(r,t,n){n[r]&&n[r].indexOf(t)!==-1||(n[r]=n[r]||[],n[r].push(t))}function En(r,t,n){if(n&&n[r]){const a=n[r].indexOf(t);a!==-1&&n[r].splice(a,1)}}class $n{constructor(t,n={}){qe(this,n),this.type=t}}class Zn extends $n{constructor(t,n={}){super("error",qe({error:t},n))}}class Bs{on(t,n){return this._listeners=this._listeners||{},No(t,n,this._listeners),this}off(t,n){return En(t,n,this._listeners),En(t,n,this._oneTimeListeners),this}once(t,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},No(t,n,this._oneTimeListeners),this):new Promise(a=>this.once(t,a))}fire(t,n){typeof t=="string"&&(t=new $n(t,n||{}));const a=t.type;if(this.listens(a)){t.target=this;const c=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(const y of c)y.call(this,t);const m=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(const y of m)En(a,y,this._oneTimeListeners),y.call(this,t);const g=this._eventedParent;g&&(qe(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),g.fire(t))}else t instanceof Zn&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,n){return this._eventedParent=t,this._eventedParentData=n,this}}var me={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"enum",default:"mercator",values:{mercator:{},globe:{}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const us=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Vo(r,t){const n={};for(const a in r)a!=="ref"&&(n[a]=r[a]);return us.forEach(a=>{a in t&&(n[a]=t[a])}),n}function zt(r,t){if(Array.isArray(r)){if(!Array.isArray(t)||r.length!==t.length)return!1;for(let n=0;n<r.length;n++)if(!zt(r[n],t[n]))return!1;return!0}if(typeof r=="object"&&r!==null&&t!==null){if(typeof t!="object"||Object.keys(r).length!==Object.keys(t).length)return!1;for(const n in r)if(!zt(r[n],t[n]))return!1;return!0}return r===t}function Jt(r,t){r.push(t)}function jo(r,t,n){Jt(n,{command:"addSource",args:[r,t[r]]})}function qn(r,t,n){Jt(t,{command:"removeSource",args:[r]}),n[r]=!0}function Pn(r,t,n,a){qn(r,n,a),jo(r,t,n)}function Os(r,t,n){let a;for(a in r[n])if(Object.prototype.hasOwnProperty.call(r[n],a)&&a!=="data"&&!zt(r[n][a],t[n][a]))return!1;for(a in t[n])if(Object.prototype.hasOwnProperty.call(t[n],a)&&a!=="data"&&!zt(r[n][a],t[n][a]))return!1;return!0}function Ii(r,t,n,a,c,m){r=r||{},t=t||{};for(const g in r)Object.prototype.hasOwnProperty.call(r,g)&&(zt(r[g],t[g])||n.push({command:m,args:[a,g,t[g],c]}));for(const g in t)Object.prototype.hasOwnProperty.call(t,g)&&!Object.prototype.hasOwnProperty.call(r,g)&&(zt(r[g],t[g])||n.push({command:m,args:[a,g,t[g],c]}))}function Uo(r){return r.id}function $o(r,t){return r[t.id]=t,r}class Ie{constructor(t,n,a,c){this.message=(t?`${t}: `:"")+a,c&&(this.identifier=c),n!=null&&n.__line__&&(this.line=n.__line__)}}function hn(r,...t){for(const n of t)for(const a in n)r[a]=n[a];return r}class $r extends Error{constructor(t,n){super(n),this.message=n,this.key=t}}class dn{constructor(t,n=[]){this.parent=t,this.bindings={};for(const[a,c]of n)this.bindings[a]=c}concat(t){return new dn(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const Gn={kind:"null"},Ae={kind:"number"},ft={kind:"string"},st={kind:"boolean"},ti={kind:"color"},$i={kind:"object"},ht={kind:"value"},pn={kind:"collator"},Cn={kind:"formatted"},Hn={kind:"padding"},fn={kind:"resolvedImage"},W={kind:"variableAnchorOffsetCollection"};function L(r,t){return{kind:"array",itemType:r,N:t}}function D(r){if(r.kind==="array"){const t=D(r.itemType);return typeof r.N=="number"?`array<${t}, ${r.N}>`:r.itemType.kind==="value"?"array":`array<${t}>`}return r.kind}const N=[Gn,Ae,ft,st,ti,Cn,$i,L(ht),Hn,fn,W];function Z(r,t){if(t.kind==="error")return null;if(r.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!Z(r.itemType,t.itemType))&&(typeof r.N!="number"||r.N===t.N))return null}else{if(r.kind===t.kind)return null;if(r.kind==="value"){for(const n of N)if(!Z(n,t))return null}}return`Expected ${D(r)} but found ${D(t)} instead.`}function te(r,t){return t.some(n=>n.kind===r.kind)}function se(r,t){return t.some(n=>n==="null"?r===null:n==="array"?Array.isArray(r):n==="object"?r&&!Array.isArray(r)&&typeof r=="object":n===typeof r)}function ue(r,t){return r.kind==="array"&&t.kind==="array"?r.itemType.kind===t.itemType.kind&&typeof r.N=="number":r.kind===t.kind}const J=.96422,_e=.82521,we=4/29,fe=6/29,Ce=3*fe*fe,Qe=fe*fe*fe,tt=Math.PI/180,Tt=180/Math.PI;function dt(r){return(r%=360)<0&&(r+=360),r}function kt([r,t,n,a]){let c,m;const g=pr((.2225045*(r=vt(r))+.7168786*(t=vt(t))+.0606169*(n=vt(n)))/1);r===t&&t===n?c=m=g:(c=pr((.4360747*r+.3850649*t+.1430804*n)/J),m=pr((.0139322*r+.0971045*t+.7141733*n)/_e));const y=116*g-16;return[y<0?0:y,500*(c-g),200*(g-m),a]}function vt(r){return r<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function pr(r){return r>Qe?Math.pow(r,1/3):r/Ce+we}function Qt([r,t,n,a]){let c=(r+16)/116,m=isNaN(t)?c:c+t/500,g=isNaN(n)?c:c-n/200;return c=1*Ft(c),m=J*Ft(m),g=_e*Ft(g),[mt(3.1338561*m-1.6168667*c-.4906146*g),mt(-.9787684*m+1.9161415*c+.033454*g),mt(.0719453*m-.2289914*c+1.4052427*g),a]}function mt(r){return(r=r<=.00304?12.92*r:1.055*Math.pow(r,1/2.4)-.055)<0?0:r>1?1:r}function Ft(r){return r>fe?r*r*r:Ce*(r-we)}function Kt(r){return parseInt(r.padEnd(2,r),16)/255}function wr(r,t){return Ir(t?r/100:r,0,1)}function Ir(r,t,n){return Math.min(Math.max(t,r),n)}function Zr(r){return!r.some(Number.isNaN)}const Ns={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Bt{constructor(t,n,a,c=1,m=!0){this.r=t,this.g=n,this.b=a,this.a=c,m||(this.r*=c,this.g*=c,this.b*=c,c||this.overwriteGetter("rgb",[t,n,a,c]))}static parse(t){if(t instanceof Bt)return t;if(typeof t!="string")return;const n=function(a){if((a=a.toLowerCase().trim())==="transparent")return[0,0,0,0];const c=Ns[a];if(c){const[g,y,x]=c;return[g/255,y/255,x/255,1]}if(a.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(a)){const g=a.length<6?1:2;let y=1;return[Kt(a.slice(y,y+=g)),Kt(a.slice(y,y+=g)),Kt(a.slice(y,y+=g)),Kt(a.slice(y,y+g)||"ff")]}if(a.startsWith("rgb")){const g=a.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(g){const[y,x,k,E,C,A,R,B,O,$,X,he]=g,ee=[E||" ",R||" ",$].join("");if(ee==="  "||ee==="  /"||ee===",,"||ee===",,,"){const ae=[k,A,O].join(""),ge=ae==="%%%"?100:ae===""?255:0;if(ge){const be=[Ir(+x/ge,0,1),Ir(+C/ge,0,1),Ir(+B/ge,0,1),X?wr(+X,he):1];if(Zr(be))return be}}return}}const m=a.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(m){const[g,y,x,k,E,C,A,R,B]=m,O=[x||" ",E||" ",A].join("");if(O==="  "||O==="  /"||O===",,"||O===",,,"){const $=[+y,Ir(+k,0,100),Ir(+C,0,100),R?wr(+R,B):1];if(Zr($))return function([X,he,ee,ae]){function ge(be){const Ne=(be+X/30)%12,it=he*Math.min(ee,1-ee);return ee-it*Math.max(-1,Math.min(Ne-3,9-Ne,1))}return X=dt(X),he/=100,ee/=100,[ge(0),ge(8),ge(4),ae]}($)}}}(t);return n?new Bt(...n,!1):void 0}get rgb(){const{r:t,g:n,b:a,a:c}=this,m=c||1/0;return this.overwriteGetter("rgb",[t/m,n/m,a/m,c])}get hcl(){return this.overwriteGetter("hcl",function(t){const[n,a,c,m]=kt(t),g=Math.sqrt(a*a+c*c);return[Math.round(1e4*g)?dt(Math.atan2(c,a)*Tt):NaN,g,n,m]}(this.rgb))}get lab(){return this.overwriteGetter("lab",kt(this.rgb))}overwriteGetter(t,n){return Object.defineProperty(this,t,{value:n}),n}toString(){const[t,n,a,c]=this.rgb;return`rgba(${[t,n,a].map(m=>Math.round(255*m)).join(",")},${c})`}}Bt.black=new Bt(0,0,0,1),Bt.white=new Bt(1,1,1,1),Bt.transparent=new Bt(0,0,0,0),Bt.red=new Bt(1,0,0,1);class tu{constructor(t,n,a){this.sensitivity=t?n?"variant":"case":n?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,n){return this.collator.compare(t,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class ru{constructor(t,n,a,c,m){this.text=t,this.image=n,this.scale=a,this.fontStack=c,this.textColor=m}}class fi{constructor(t){this.sections=t}static fromString(t){return new fi([new ru(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof fi?t:fi.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}}class mi{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof mi)return t;if(typeof t=="number")return new mi([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const n of t)if(typeof n!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new mi(t)}}toString(){return JSON.stringify(this.values)}}const gp=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Ei{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Ei)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let n=0;n<t.length;n+=2){const a=t[n],c=t[n+1];if(typeof a!="string"||!gp.has(a)||!Array.isArray(c)||c.length!==2||typeof c[0]!="number"||typeof c[1]!="number")return}return new Ei(t)}}toString(){return JSON.stringify(this.values)}}class gi{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new gi({name:t,available:!1}):null}}function Vs(r,t,n,a){return typeof r=="number"&&r>=0&&r<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof n=="number"&&n>=0&&n<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[r,t,n,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[r,t,n,a]:[r,t,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function cs(r){if(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number"||r instanceof Bt||r instanceof tu||r instanceof fi||r instanceof mi||r instanceof Ei||r instanceof gi)return!0;if(Array.isArray(r)){for(const t of r)if(!cs(t))return!1;return!0}if(typeof r=="object"){for(const t in r)if(!cs(r[t]))return!1;return!0}return!1}function fr(r){if(r===null)return Gn;if(typeof r=="string")return ft;if(typeof r=="boolean")return st;if(typeof r=="number")return Ae;if(r instanceof Bt)return ti;if(r instanceof tu)return pn;if(r instanceof fi)return Cn;if(r instanceof mi)return Hn;if(r instanceof Ei)return W;if(r instanceof gi)return fn;if(Array.isArray(r)){const t=r.length;let n;for(const a of r){const c=fr(a);if(n){if(n===c)continue;n=ht;break}n=c}return L(n||ht,t)}return $i}function Zo(r){const t=typeof r;return r===null?"":t==="string"||t==="number"||t==="boolean"?String(r):r instanceof Bt||r instanceof fi||r instanceof mi||r instanceof Ei||r instanceof gi?r.toString():JSON.stringify(r)}class Zi{constructor(t,n){this.type=t,this.value=n}static parse(t,n){if(t.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!cs(t[1]))return n.error("invalid value");const a=t[1];let c=fr(a);const m=n.expectedType;return c.kind!=="array"||c.N!==0||!m||m.kind!=="array"||typeof m.N=="number"&&m.N!==0||(c=m),new Zi(c,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class lr{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const Ma={string:ft,number:Ae,boolean:st,object:$i};class qi{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");let a,c=1;const m=t[0];if(m==="array"){let y,x;if(t.length>2){const k=t[1];if(typeof k!="string"||!(k in Ma)||k==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);y=Ma[k],c++}else y=ht;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return n.error('The length argument to "array" must be a positive integer literal',2);x=t[2],c++}a=L(y,x)}else{if(!Ma[m])throw new Error(`Types doesn't contain name = ${m}`);a=Ma[m]}const g=[];for(;c<t.length;c++){const y=n.parse(t[c],c,ht);if(!y)return null;g.push(y)}return new qi(a,g)}evaluate(t){for(let n=0;n<this.args.length;n++){const a=this.args[n].evaluate(t);if(!Z(this.type,fr(a)))return a;if(n===this.args.length-1)throw new lr(`Expected value to be of type ${D(this.type)}, but found ${D(fr(a))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const iu={"to-boolean":st,"to-color":ti,"to-number":Ae,"to-string":ft};class Gi{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const a=t[0];if(!iu[a])throw new Error(`Can't parse ${a} as it is not part of the known types`);if((a==="to-boolean"||a==="to-string")&&t.length!==2)return n.error("Expected one argument.");const c=iu[a],m=[];for(let g=1;g<t.length;g++){const y=n.parse(t[g],g,ht);if(!y)return null;m.push(y)}return new Gi(c,m)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let n,a;for(const c of this.args){if(n=c.evaluate(t),a=null,n instanceof Bt)return n;if(typeof n=="string"){const m=t.parseColor(n);if(m)return m}else if(Array.isArray(n)&&(a=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:Vs(n[0],n[1],n[2],n[3]),!a))return new Bt(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new lr(a||`Could not parse color from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"padding":{let n;for(const a of this.args){n=a.evaluate(t);const c=mi.parse(n);if(c)return c}throw new lr(`Could not parse padding from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"variableAnchorOffsetCollection":{let n;for(const a of this.args){n=a.evaluate(t);const c=Ei.parse(n);if(c)return c}throw new lr(`Could not parse variableAnchorOffsetCollection from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"number":{let n=null;for(const a of this.args){if(n=a.evaluate(t),n===null)return 0;const c=Number(n);if(!isNaN(c))return c}throw new lr(`Could not convert ${JSON.stringify(n)} to number.`)}case"formatted":return fi.fromString(Zo(this.args[0].evaluate(t)));case"resolvedImage":return gi.fromString(Zo(this.args[0].evaluate(t)));default:return Zo(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const _p=["Unknown","Point","LineString","Polygon"];class Aa{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?_p[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let n=this._parseColorCache[t];return n||(n=this._parseColorCache[t]=Bt.parse(t)),n}}class hs{constructor(t,n,a=[],c,m=new dn,g=[]){this.registry=t,this.path=a,this.key=a.map(y=>`[${y}]`).join(""),this.scope=m,this.errors=g,this.expectedType=c,this._isConstant=n}parse(t,n,a,c,m={}){return n?this.concat(n,a,c)._parse(t,m):this._parse(t,m)}_parse(t,n){function a(c,m,g){return g==="assert"?new qi(m,[c]):g==="coerce"?new Gi(m,[c]):c}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const c=t[0];if(typeof c!="string")return this.error(`Expression name must be a string, but found ${typeof c} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const m=this.registry[c];if(m){let g=m.parse(t,this);if(!g)return null;if(this.expectedType){const y=this.expectedType,x=g.type;if(y.kind!=="string"&&y.kind!=="number"&&y.kind!=="boolean"&&y.kind!=="object"&&y.kind!=="array"||x.kind!=="value")if(y.kind!=="color"&&y.kind!=="formatted"&&y.kind!=="resolvedImage"||x.kind!=="value"&&x.kind!=="string")if(y.kind!=="padding"||x.kind!=="value"&&x.kind!=="number"&&x.kind!=="array")if(y.kind!=="variableAnchorOffsetCollection"||x.kind!=="value"&&x.kind!=="array"){if(this.checkSubtype(y,x))return null}else g=a(g,y,n.typeAnnotation||"coerce");else g=a(g,y,n.typeAnnotation||"coerce");else g=a(g,y,n.typeAnnotation||"coerce");else g=a(g,y,n.typeAnnotation||"assert")}if(!(g instanceof Zi)&&g.type.kind!=="resolvedImage"&&this._isConstant(g)){const y=new Aa;try{g=new Zi(g.type,g.evaluate(y))}catch(x){return this.error(x.message),null}}return g}return this.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,n,a){const c=typeof t=="number"?this.path.concat(t):this.path,m=a?this.scope.concat(a):this.scope;return new hs(this.registry,this._isConstant,c,n||null,m,this.errors)}error(t,...n){const a=`${this.key}${n.map(c=>`[${c}]`).join("")}`;this.errors.push(new $r(a,t))}checkSubtype(t,n){const a=Z(t,n);return a&&this.error(a),a}}class Wn{constructor(t,n){this.type=n.type,this.bindings=[].concat(t),this.result=n}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const n of this.bindings)t(n[1]);t(this.result)}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const a=[];for(let m=1;m<t.length-1;m+=2){const g=t[m];if(typeof g!="string")return n.error(`Expected string, but found ${typeof g} instead.`,m);if(/[^a-zA-Z0-9_]/.test(g))return n.error("Variable names must contain only alphanumeric characters or '_'.",m);const y=n.parse(t[m+1],m+1);if(!y)return null;a.push([g,y])}const c=n.parse(t[t.length-1],t.length-1,n.expectedType,a);return c?new Wn(a,c):null}outputDefined(){return this.result.outputDefined()}}class Mt{constructor(t,n){this.type=n.type,this.name=t,this.boundExpression=n}static parse(t,n){if(t.length!==2||typeof t[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const a=t[1];return n.scope.has(a)?new Mt(a,n.scope.get(a)):n.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class nu{constructor(t,n,a){this.type=t,this.index=n,this.input=a}static parse(t,n){if(t.length!==3)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const a=n.parse(t[1],1,Ae),c=n.parse(t[2],2,L(n.expectedType||ht));return a&&c?new nu(c.type.itemType,a,c):null}evaluate(t){const n=this.index.evaluate(t),a=this.input.evaluate(t);if(n<0)throw new lr(`Array index out of bounds: ${n} < 0.`);if(n>=a.length)throw new lr(`Array index out of bounds: ${n} > ${a.length-1}.`);if(n!==Math.floor(n))throw new lr(`Array index must be an integer, but found ${n} instead.`);return a[n]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class su{constructor(t,n){this.type=st,this.needle=t,this.haystack=n}static parse(t,n){if(t.length!==3)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const a=n.parse(t[1],1,ht),c=n.parse(t[2],2,ht);return a&&c?te(a.type,[st,ft,Ae,Gn,ht])?new su(a,c):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${D(a.type)} instead`):null}evaluate(t){const n=this.needle.evaluate(t),a=this.haystack.evaluate(t);if(!a)return!1;if(!se(n,["boolean","string","number","null"]))throw new lr(`Expected first argument to be of type boolean, string, number or null, but found ${D(fr(n))} instead.`);if(!se(a,["string","array"]))throw new lr(`Expected second argument to be of type array or string, but found ${D(fr(a))} instead.`);return a.indexOf(n)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class js{constructor(t,n,a){this.type=Ae,this.needle=t,this.haystack=n,this.fromIndex=a}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const a=n.parse(t[1],1,ht),c=n.parse(t[2],2,ht);if(!a||!c)return null;if(!te(a.type,[st,ft,Ae,Gn,ht]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${D(a.type)} instead`);if(t.length===4){const m=n.parse(t[3],3,Ae);return m?new js(a,c,m):null}return new js(a,c)}evaluate(t){const n=this.needle.evaluate(t),a=this.haystack.evaluate(t);if(!se(n,["boolean","string","number","null"]))throw new lr(`Expected first argument to be of type boolean, string, number or null, but found ${D(fr(n))} instead.`);let c;if(this.fromIndex&&(c=this.fromIndex.evaluate(t)),se(a,["string"])){const m=a.indexOf(n,c);return m===-1?-1:[...a.slice(0,m)].length}if(se(a,["array"]))return a.indexOf(n,c);throw new lr(`Expected second argument to be of type array or string, but found ${D(fr(a))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class ou{constructor(t,n,a,c,m,g){this.inputType=t,this.type=n,this.input=a,this.cases=c,this.outputs=m,this.otherwise=g}static parse(t,n){if(t.length<5)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return n.error("Expected an even number of arguments.");let a,c;n.expectedType&&n.expectedType.kind!=="value"&&(c=n.expectedType);const m={},g=[];for(let k=2;k<t.length-1;k+=2){let E=t[k];const C=t[k+1];Array.isArray(E)||(E=[E]);const A=n.concat(k);if(E.length===0)return A.error("Expected at least one branch label.");for(const B of E){if(typeof B!="number"&&typeof B!="string")return A.error("Branch labels must be numbers or strings.");if(typeof B=="number"&&Math.abs(B)>Number.MAX_SAFE_INTEGER)return A.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof B=="number"&&Math.floor(B)!==B)return A.error("Numeric branch labels must be integer values.");if(a){if(A.checkSubtype(a,fr(B)))return null}else a=fr(B);if(m[String(B)]!==void 0)return A.error("Branch labels must be unique.");m[String(B)]=g.length}const R=n.parse(C,k,c);if(!R)return null;c=c||R.type,g.push(R)}const y=n.parse(t[1],1,ht);if(!y)return null;const x=n.parse(t[t.length-1],t.length-1,c);return x?y.type.kind!=="value"&&n.concat(1).checkSubtype(a,y.type)?null:new ou(a,c,y,m,g,x):null}evaluate(t){const n=this.input.evaluate(t);return(fr(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class Da{constructor(t,n,a){this.type=t,this.branches=n,this.otherwise=a}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return n.error("Expected an odd number of arguments.");let a;n.expectedType&&n.expectedType.kind!=="value"&&(a=n.expectedType);const c=[];for(let g=1;g<t.length-1;g+=2){const y=n.parse(t[g],g,st);if(!y)return null;const x=n.parse(t[g+1],g+1,a);if(!x)return null;c.push([y,x]),a=a||x.type}const m=n.parse(t[t.length-1],t.length-1,a);if(!m)return null;if(!a)throw new Error("Can't infer output type");return new Da(a,c,m)}evaluate(t){for(const[n,a]of this.branches)if(n.evaluate(t))return a.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[n,a]of this.branches)t(n),t(a);t(this.otherwise)}outputDefined(){return this.branches.every(([t,n])=>n.outputDefined())&&this.otherwise.outputDefined()}}class qo{constructor(t,n,a,c){this.type=t,this.input=n,this.beginIndex=a,this.endIndex=c}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const a=n.parse(t[1],1,ht),c=n.parse(t[2],2,Ae);if(!a||!c)return null;if(!te(a.type,[L(ht),ft,ht]))return n.error(`Expected first argument to be of type array or string, but found ${D(a.type)} instead`);if(t.length===4){const m=n.parse(t[3],3,Ae);return m?new qo(a.type,a,c,m):null}return new qo(a.type,a,c)}evaluate(t){const n=this.input.evaluate(t),a=this.beginIndex.evaluate(t);let c;if(this.endIndex&&(c=this.endIndex.evaluate(t)),se(n,["string"]))return[...n].slice(a,c).join("");if(se(n,["array"]))return n.slice(a,c);throw new lr(`Expected first argument to be of type array or string, but found ${D(fr(n))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function La(r,t){const n=r.length-1;let a,c,m=0,g=n,y=0;for(;m<=g;)if(y=Math.floor((m+g)/2),a=r[y],c=r[y+1],a<=t){if(y===n||t<c)return y;m=y+1}else{if(!(a>t))throw new lr("Input is not a number.");g=y-1}return 0}class Us{constructor(t,n,a){this.type=t,this.input=n,this.labels=[],this.outputs=[];for(const[c,m]of a)this.labels.push(c),this.outputs.push(m)}static parse(t,n){if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");const a=n.parse(t[1],1,Ae);if(!a)return null;const c=[];let m=null;n.expectedType&&n.expectedType.kind!=="value"&&(m=n.expectedType);for(let g=1;g<t.length;g+=2){const y=g===1?-1/0:t[g],x=t[g+1],k=g,E=g+1;if(typeof y!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(c.length&&c[c.length-1][0]>=y)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',k);const C=n.parse(x,E,m);if(!C)return null;m=m||C.type,c.push([y,C])}return new Us(m,a,c)}evaluate(t){const n=this.labels,a=this.outputs;if(n.length===1)return a[0].evaluate(t);const c=this.input.evaluate(t);if(c<=n[0])return a[0].evaluate(t);const m=n.length;return c>=n[m-1]?a[m-1].evaluate(t):a[La(n,c)].evaluate(t)}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Jc(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var yp=Qc;function Qc(r,t,n,a){this.cx=3*r,this.bx=3*(n-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(a-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=t,this.p2x=n,this.p2y=a}Qc.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,t){if(t===void 0&&(t=1e-6),r<0)return 0;if(r>1)return 1;for(var n=r,a=0;a<8;a++){var c=this.sampleCurveX(n)-r;if(Math.abs(c)<t)return n;var m=this.sampleCurveDerivativeX(n);if(Math.abs(m)<1e-6)break;n-=c/m}var g=0,y=1;for(n=r,a=0;a<20&&(c=this.sampleCurveX(n),!(Math.abs(c-r)<t));a++)r>c?g=n:y=n,n=.5*(y-g)+g;return n},solve:function(r,t){return this.sampleCurveY(this.solveCurveX(r,t))}};var vp=Jc(yp);function ds(r,t,n){return r+n*(t-r)}function Go(r,t,n){return r.map((a,c)=>ds(a,t[c],n))}const ri={number:ds,color:function(r,t,n,a="rgb"){switch(a){case"rgb":{const[c,m,g,y]=Go(r.rgb,t.rgb,n);return new Bt(c,m,g,y,!1)}case"hcl":{const[c,m,g,y]=r.hcl,[x,k,E,C]=t.hcl;let A,R;if(isNaN(c)||isNaN(x))isNaN(c)?isNaN(x)?A=NaN:(A=x,g!==1&&g!==0||(R=k)):(A=c,E!==1&&E!==0||(R=m));else{let he=x-c;x>c&&he>180?he-=360:x<c&&c-x>180&&(he+=360),A=c+n*he}const[B,O,$,X]=function([he,ee,ae,ge]){return he=isNaN(he)?0:he*tt,Qt([ae,Math.cos(he)*ee,Math.sin(he)*ee,ge])}([A,R??ds(m,k,n),ds(g,E,n),ds(y,C,n)]);return new Bt(B,O,$,X,!1)}case"lab":{const[c,m,g,y]=Qt(Go(r.lab,t.lab,n));return new Bt(c,m,g,y,!1)}}},array:Go,padding:function(r,t,n){return new mi(Go(r.values,t.values,n))},variableAnchorOffsetCollection:function(r,t,n){const a=r.values,c=t.values;if(a.length!==c.length)throw new lr(`Cannot interpolate values of different length. from: ${r.toString()}, to: ${t.toString()}`);const m=[];for(let g=0;g<a.length;g+=2){if(a[g]!==c[g])throw new lr(`Cannot interpolate values containing mismatched anchors. from[${g}]: ${a[g]}, to[${g}]: ${c[g]}`);m.push(a[g]);const[y,x]=a[g+1],[k,E]=c[g+1];m.push([ds(y,k,n),ds(x,E,n)])}return new Ei(m)}};class ii{constructor(t,n,a,c,m){this.type=t,this.operator=n,this.interpolation=a,this.input=c,this.labels=[],this.outputs=[];for(const[g,y]of m)this.labels.push(g),this.outputs.push(y)}static interpolationFactor(t,n,a,c){let m=0;if(t.name==="exponential")m=Ra(n,t.base,a,c);else if(t.name==="linear")m=Ra(n,1,a,c);else if(t.name==="cubic-bezier"){const g=t.controlPoints;m=new vp(g[0],g[1],g[2],g[3]).solve(Ra(n,1,a,c))}return m}static parse(t,n){let[a,c,m,...g]=t;if(!Array.isArray(c)||c.length===0)return n.error("Expected an interpolation type expression.",1);if(c[0]==="linear")c={name:"linear"};else if(c[0]==="exponential"){const k=c[1];if(typeof k!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);c={name:"exponential",base:k}}else{if(c[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(c[0])}`,1,0);{const k=c.slice(1);if(k.length!==4||k.some(E=>typeof E!="number"||E<0||E>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);c={name:"cubic-bezier",controlPoints:k}}}if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(m=n.parse(m,2,Ae),!m)return null;const y=[];let x=null;a==="interpolate-hcl"||a==="interpolate-lab"?x=ti:n.expectedType&&n.expectedType.kind!=="value"&&(x=n.expectedType);for(let k=0;k<g.length;k+=2){const E=g[k],C=g[k+1],A=k+3,R=k+4;if(typeof E!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',A);if(y.length&&y[y.length-1][0]>=E)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',A);const B=n.parse(C,R,x);if(!B)return null;x=x||B.type,y.push([E,B])}return ue(x,Ae)||ue(x,ti)||ue(x,Hn)||ue(x,W)||ue(x,L(Ae))?new ii(x,a,c,m,y):n.error(`Type ${D(x)} is not interpolatable.`)}evaluate(t){const n=this.labels,a=this.outputs;if(n.length===1)return a[0].evaluate(t);const c=this.input.evaluate(t);if(c<=n[0])return a[0].evaluate(t);const m=n.length;if(c>=n[m-1])return a[m-1].evaluate(t);const g=La(n,c),y=ii.interpolationFactor(this.interpolation,c,n[g],n[g+1]),x=a[g].evaluate(t),k=a[g+1].evaluate(t);switch(this.operator){case"interpolate":return ri[this.type.kind](x,k,y);case"interpolate-hcl":return ri.color(x,k,y,"hcl");case"interpolate-lab":return ri.color(x,k,y,"lab")}}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Ra(r,t,n,a){const c=a-n,m=r-n;return c===0?0:t===1?m/c:(Math.pow(t,m)-1)/(Math.pow(t,c)-1)}class Fa{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expectected at least one argument.");let a=null;const c=n.expectedType;c&&c.kind!=="value"&&(a=c);const m=[];for(const y of t.slice(1)){const x=n.parse(y,1+m.length,a,void 0,{typeAnnotation:"omit"});if(!x)return null;a=a||x.type,m.push(x)}if(!a)throw new Error("No output type");const g=c&&m.some(y=>Z(c,y.type));return new Fa(g?ht:a,m)}evaluate(t){let n,a=null,c=0;for(const m of this.args)if(c++,a=m.evaluate(t),a&&a instanceof gi&&!a.available&&(n||(n=a.name),a=null,c===this.args.length&&(a=n)),a!==null)break;return a}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}function Ba(r,t){return r==="=="||r==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function eh(r,t,n,a){return a.compare(t,n)===0}function $s(r,t,n){const a=r!=="=="&&r!=="!=";return class i1{constructor(m,g,y){this.type=st,this.lhs=m,this.rhs=g,this.collator=y,this.hasUntypedArgument=m.type.kind==="value"||g.type.kind==="value"}static parse(m,g){if(m.length!==3&&m.length!==4)return g.error("Expected two or three arguments.");const y=m[0];let x=g.parse(m[1],1,ht);if(!x)return null;if(!Ba(y,x.type))return g.concat(1).error(`"${y}" comparisons are not supported for type '${D(x.type)}'.`);let k=g.parse(m[2],2,ht);if(!k)return null;if(!Ba(y,k.type))return g.concat(2).error(`"${y}" comparisons are not supported for type '${D(k.type)}'.`);if(x.type.kind!==k.type.kind&&x.type.kind!=="value"&&k.type.kind!=="value")return g.error(`Cannot compare types '${D(x.type)}' and '${D(k.type)}'.`);a&&(x.type.kind==="value"&&k.type.kind!=="value"?x=new qi(k.type,[x]):x.type.kind!=="value"&&k.type.kind==="value"&&(k=new qi(x.type,[k])));let E=null;if(m.length===4){if(x.type.kind!=="string"&&k.type.kind!=="string"&&x.type.kind!=="value"&&k.type.kind!=="value")return g.error("Cannot use collator to compare non-string types.");if(E=g.parse(m[3],3,pn),!E)return null}return new i1(x,k,E)}evaluate(m){const g=this.lhs.evaluate(m),y=this.rhs.evaluate(m);if(a&&this.hasUntypedArgument){const x=fr(g),k=fr(y);if(x.kind!==k.kind||x.kind!=="string"&&x.kind!=="number")throw new lr(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${x.kind}, ${k.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){const x=fr(g),k=fr(y);if(x.kind!=="string"||k.kind!=="string")return t(m,g,y)}return this.collator?n(m,g,y,this.collator.evaluate(m)):t(m,g,y)}eachChild(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)}outputDefined(){return!0}}}const xp=$s("==",function(r,t,n){return t===n},eh),th=$s("!=",function(r,t,n){return t!==n},function(r,t,n,a){return!eh(0,t,n,a)}),rh=$s("<",function(r,t,n){return t<n},function(r,t,n,a){return a.compare(t,n)<0}),wp=$s(">",function(r,t,n){return t>n},function(r,t,n,a){return a.compare(t,n)>0}),bp=$s("<=",function(r,t,n){return t<=n},function(r,t,n,a){return a.compare(t,n)<=0}),ih=$s(">=",function(r,t,n){return t>=n},function(r,t,n,a){return a.compare(t,n)>=0});class Ho{constructor(t,n,a){this.type=pn,this.locale=a,this.caseSensitive=t,this.diacriticSensitive=n}static parse(t,n){if(t.length!==2)return n.error("Expected one argument.");const a=t[1];if(typeof a!="object"||Array.isArray(a))return n.error("Collator options argument must be an object.");const c=n.parse(a["case-sensitive"]!==void 0&&a["case-sensitive"],1,st);if(!c)return null;const m=n.parse(a["diacritic-sensitive"]!==void 0&&a["diacritic-sensitive"],1,st);if(!m)return null;let g=null;return a.locale&&(g=n.parse(a.locale,1,ft),!g)?null:new Ho(c,m,g)}evaluate(t){return new tu(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class au{constructor(t,n,a,c,m){this.type=ft,this.number=t,this.locale=n,this.currency=a,this.minFractionDigits=c,this.maxFractionDigits=m}static parse(t,n){if(t.length!==3)return n.error("Expected two arguments.");const a=n.parse(t[1],1,Ae);if(!a)return null;const c=t[2];if(typeof c!="object"||Array.isArray(c))return n.error("NumberFormat options argument must be an object.");let m=null;if(c.locale&&(m=n.parse(c.locale,1,ft),!m))return null;let g=null;if(c.currency&&(g=n.parse(c.currency,1,ft),!g))return null;let y=null;if(c["min-fraction-digits"]&&(y=n.parse(c["min-fraction-digits"],1,Ae),!y))return null;let x=null;return c["max-fraction-digits"]&&(x=n.parse(c["max-fraction-digits"],1,Ae),!x)?null:new au(a,m,g,y,x)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class Oa{constructor(t){this.type=Cn,this.sections=t}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const a=t[1];if(!Array.isArray(a)&&typeof a=="object")return n.error("First argument must be an image or text section.");const c=[];let m=!1;for(let g=1;g<=t.length-1;++g){const y=t[g];if(m&&typeof y=="object"&&!Array.isArray(y)){m=!1;let x=null;if(y["font-scale"]&&(x=n.parse(y["font-scale"],1,Ae),!x))return null;let k=null;if(y["text-font"]&&(k=n.parse(y["text-font"],1,L(ft)),!k))return null;let E=null;if(y["text-color"]&&(E=n.parse(y["text-color"],1,ti),!E))return null;const C=c[c.length-1];C.scale=x,C.font=k,C.textColor=E}else{const x=n.parse(t[g],1,ht);if(!x)return null;const k=x.type.kind;if(k!=="string"&&k!=="value"&&k!=="null"&&k!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,c.push({content:x,scale:null,font:null,textColor:null})}}return new Oa(c)}evaluate(t){return new fi(this.sections.map(n=>{const a=n.content.evaluate(t);return fr(a)===fn?new ru("",a,null,null,null):new ru(Zo(a),null,n.scale?n.scale.evaluate(t):null,n.font?n.font.evaluate(t).join(","):null,n.textColor?n.textColor.evaluate(t):null)}))}eachChild(t){for(const n of this.sections)t(n.content),n.scale&&t(n.scale),n.font&&t(n.font),n.textColor&&t(n.textColor)}outputDefined(){return!1}}class lu{constructor(t){this.type=fn,this.input=t}static parse(t,n){if(t.length!==2)return n.error("Expected two arguments.");const a=n.parse(t[1],1,ft);return a?new lu(a):n.error("No image name provided.")}evaluate(t){const n=this.input.evaluate(t),a=gi.fromString(n);return a&&t.availableImages&&(a.available=t.availableImages.indexOf(n)>-1),a}eachChild(t){t(this.input)}outputDefined(){return!1}}class uu{constructor(t){this.type=Ae,this.input=t}static parse(t,n){if(t.length!==2)return n.error(`Expected 1 argument, but found ${t.length-1} instead.`);const a=n.parse(t[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${D(a.type)} instead.`):new uu(a):null}evaluate(t){const n=this.input.evaluate(t);if(typeof n=="string")return[...n].length;if(Array.isArray(n))return n.length;throw new lr(`Expected value to be of type string or array, but found ${D(fr(n))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const mn=8192;function Sp(r,t){const n=(180+r[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r[1]*Math.PI/360)))/360,c=Math.pow(2,t.z);return[Math.round(n*c*mn),Math.round(a*c*mn)]}function cu(r,t){const n=Math.pow(2,t.z);return[(c=(r[0]/mn+t.x)/n,360*c-180),(a=(r[1]/mn+t.y)/n,360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90)];var a,c}function ps(r,t){r[0]=Math.min(r[0],t[0]),r[1]=Math.min(r[1],t[1]),r[2]=Math.max(r[2],t[0]),r[3]=Math.max(r[3],t[1])}function Xn(r,t){return!(r[0]<=t[0]||r[2]>=t[2]||r[1]<=t[1]||r[3]>=t[3])}function Dt(r,t,n){const a=r[0]-t[0],c=r[1]-t[1],m=r[0]-n[0],g=r[1]-n[1];return a*g-m*c==0&&a*m<=0&&c*g<=0}function Na(r,t,n,a){return(c=[a[0]-n[0],a[1]-n[1]])[0]*(m=[t[0]-r[0],t[1]-r[1]])[1]-c[1]*m[0]!=0&&!(!sh(r,t,n,a)||!sh(n,a,r,t));var c,m}function Tp(r,t,n){for(const a of n)for(let c=0;c<a.length-1;++c)if(Na(r,t,a[c],a[c+1]))return!0;return!1}function Zs(r,t,n=!1){let a=!1;for(const y of t)for(let x=0;x<y.length-1;x++){if(Dt(r,y[x],y[x+1]))return n;(m=y[x])[1]>(c=r)[1]!=(g=y[x+1])[1]>c[1]&&c[0]<(g[0]-m[0])*(c[1]-m[1])/(g[1]-m[1])+m[0]&&(a=!a)}var c,m,g;return a}function kp(r,t){for(const n of t)if(Zs(r,n))return!0;return!1}function nh(r,t){for(const n of r)if(!Zs(n,t))return!1;for(let n=0;n<r.length-1;++n)if(Tp(r[n],r[n+1],t))return!1;return!0}function Ip(r,t){for(const n of t)if(nh(r,n))return!0;return!1}function sh(r,t,n,a){const c=a[0]-n[0],m=a[1]-n[1],g=(r[0]-n[0])*m-c*(r[1]-n[1]),y=(t[0]-n[0])*m-c*(t[1]-n[1]);return g>0&&y<0||g<0&&y>0}function hu(r,t,n){const a=[];for(let c=0;c<r.length;c++){const m=[];for(let g=0;g<r[c].length;g++){const y=Sp(r[c][g],n);ps(t,y),m.push(y)}a.push(m)}return a}function oh(r,t,n){const a=[];for(let c=0;c<r.length;c++){const m=hu(r[c],t,n);a.push(m)}return a}function ah(r,t,n,a){if(r[0]<n[0]||r[0]>n[2]){const c=.5*a;let m=r[0]-n[0]>c?-a:n[0]-r[0]>c?a:0;m===0&&(m=r[0]-n[2]>c?-a:n[2]-r[0]>c?a:0),r[0]+=m}ps(t,r)}function lh(r,t,n,a){const c=Math.pow(2,a.z)*mn,m=[a.x*mn,a.y*mn],g=[];for(const y of r)for(const x of y){const k=[x.x+m[0],x.y+m[1]];ah(k,t,n,c),g.push(k)}return g}function uh(r,t,n,a){const c=Math.pow(2,a.z)*mn,m=[a.x*mn,a.y*mn],g=[];for(const x of r){const k=[];for(const E of x){const C=[E.x+m[0],E.y+m[1]];ps(t,C),k.push(C)}g.push(k)}if(t[2]-t[0]<=c/2){(y=t)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(const x of g)for(const k of x)ah(k,t,n,c)}var y;return g}class fs{constructor(t,n){this.type=st,this.geojson=t,this.geometries=n}static parse(t,n){if(t.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(cs(t[1])){const a=t[1];if(a.type==="FeatureCollection"){const c=[];for(const m of a.features){const{type:g,coordinates:y}=m.geometry;g==="Polygon"&&c.push(y),g==="MultiPolygon"&&c.push(...y)}if(c.length)return new fs(a,{type:"MultiPolygon",coordinates:c})}else if(a.type==="Feature"){const c=a.geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new fs(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new fs(a,a)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(n,a){const c=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],g=n.canonicalID();if(a.type==="Polygon"){const y=hu(a.coordinates,m,g),x=lh(n.geometry(),c,m,g);if(!Xn(c,m))return!1;for(const k of x)if(!Zs(k,y))return!1}if(a.type==="MultiPolygon"){const y=oh(a.coordinates,m,g),x=lh(n.geometry(),c,m,g);if(!Xn(c,m))return!1;for(const k of x)if(!kp(k,y))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(n,a){const c=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],g=n.canonicalID();if(a.type==="Polygon"){const y=hu(a.coordinates,m,g),x=uh(n.geometry(),c,m,g);if(!Xn(c,m))return!1;for(const k of x)if(!nh(k,y))return!1}if(a.type==="MultiPolygon"){const y=oh(a.coordinates,m,g),x=uh(n.geometry(),c,m,g);if(!Xn(c,m))return!1;for(const k of x)if(!Ip(k,y))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let ch=class{constructor(r=[],t=(n,a)=>n<a?-1:n>a?1:0){if(this.data=r,this.length=this.data.length,this.compare=t,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(r){this.data.push(r),this._up(this.length++)}pop(){if(this.length===0)return;const r=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:t,compare:n}=this,a=t[r];for(;r>0;){const c=r-1>>1,m=t[c];if(n(a,m)>=0)break;t[r]=m,r=c}t[r]=a}_down(r){const{data:t,compare:n}=this,a=this.length>>1,c=t[r];for(;r<a;){let m=1+(r<<1);const g=m+1;if(g<this.length&&n(t[g],t[m])<0&&(m=g),n(t[m],c)>=0)break;t[r]=t[m],r=m}t[r]=c}};function Ep(r,t,n,a,c){hh(r,t,n,a||r.length-1,c||Pp)}function hh(r,t,n,a,c){for(;a>n;){if(a-n>600){var m=a-n+1,g=t-n+1,y=Math.log(m),x=.5*Math.exp(2*y/3),k=.5*Math.sqrt(y*x*(m-x)/m)*(g-m/2<0?-1:1);hh(r,t,Math.max(n,Math.floor(t-g*x/m+k)),Math.min(a,Math.floor(t+(m-g)*x/m+k)),c)}var E=r[t],C=n,A=a;for(Wo(r,n,t),c(r[a],E)>0&&Wo(r,n,a);C<A;){for(Wo(r,C,A),C++,A--;c(r[C],E)<0;)C++;for(;c(r[A],E)>0;)A--}c(r[n],E)===0?Wo(r,n,A):Wo(r,++A,a),A<=t&&(n=A+1),t<=A&&(a=A-1)}}function Wo(r,t,n){var a=r[t];r[t]=r[n],r[n]=a}function Pp(r,t){return r<t?-1:r>t?1:0}function Va(r,t){if(r.length<=1)return[r];const n=[];let a,c;for(const m of r){const g=zp(m);g!==0&&(m.area=Math.abs(g),c===void 0&&(c=g<0),c===g<0?(a&&n.push(a),a=[m]):a.push(m))}if(a&&n.push(a),t>1)for(let m=0;m<n.length;m++)n[m].length<=t||(Ep(n[m],t,1,n[m].length-1,Cp),n[m]=n[m].slice(0,t));return n}function Cp(r,t){return t.area-r.area}function zp(r){let t=0;for(let n,a,c=0,m=r.length,g=m-1;c<m;g=c++)n=r[c],a=r[g],t+=(a.x-n.x)*(n.y+a.y);return t}const dh=1/298.257223563,ph=dh*(2-dh),fh=Math.PI/180;class du{constructor(t){const n=6378.137*fh*1e3,a=Math.cos(t*fh),c=1/(1-ph*(1-a*a)),m=Math.sqrt(c);this.kx=n*m*a,this.ky=n*m*c*(1-ph)}distance(t,n){const a=this.wrap(t[0]-n[0])*this.kx,c=(t[1]-n[1])*this.ky;return Math.sqrt(a*a+c*c)}pointOnLine(t,n){let a,c,m,g,y=1/0;for(let x=0;x<t.length-1;x++){let k=t[x][0],E=t[x][1],C=this.wrap(t[x+1][0]-k)*this.kx,A=(t[x+1][1]-E)*this.ky,R=0;C===0&&A===0||(R=(this.wrap(n[0]-k)*this.kx*C+(n[1]-E)*this.ky*A)/(C*C+A*A),R>1?(k=t[x+1][0],E=t[x+1][1]):R>0&&(k+=C/this.kx*R,E+=A/this.ky*R)),C=this.wrap(n[0]-k)*this.kx,A=(n[1]-E)*this.ky;const B=C*C+A*A;B<y&&(y=B,a=k,c=E,m=x,g=R)}return{point:[a,c],index:m,t:Math.max(0,Math.min(1,g))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function mh(r,t){return t[0]-r[0]}function ja(r){return r[1]-r[0]+1}function zn(r,t){return r[1]>=r[0]&&r[1]<t}function pu(r,t){if(r[0]>r[1])return[null,null];const n=ja(r);if(t){if(n===2)return[r,null];const c=Math.floor(n/2);return[[r[0],r[0]+c],[r[0]+c,r[1]]]}if(n===1)return[r,null];const a=Math.floor(n/2)-1;return[[r[0],r[0]+a],[r[0]+a+1,r[1]]]}function fu(r,t){if(!zn(t,r.length))return[1/0,1/0,-1/0,-1/0];const n=[1/0,1/0,-1/0,-1/0];for(let a=t[0];a<=t[1];++a)ps(n,r[a]);return n}function mu(r){const t=[1/0,1/0,-1/0,-1/0];for(const n of r)for(const a of n)ps(t,a);return t}function Ua(r){return r[0]!==-1/0&&r[1]!==-1/0&&r[2]!==1/0&&r[3]!==1/0}function gu(r,t,n){if(!Ua(r)||!Ua(t))return NaN;let a=0,c=0;return r[2]<t[0]&&(a=t[0]-r[2]),r[0]>t[2]&&(a=r[0]-t[2]),r[1]>t[3]&&(c=r[1]-t[3]),r[3]<t[1]&&(c=t[1]-r[3]),n.distance([0,0],[a,c])}function ms(r,t,n){const a=n.pointOnLine(t,r);return n.distance(r,a.point)}function _u(r,t,n,a,c){const m=Math.min(ms(r,[n,a],c),ms(t,[n,a],c)),g=Math.min(ms(n,[r,t],c),ms(a,[r,t],c));return Math.min(m,g)}function Mp(r,t,n,a,c){if(!zn(t,r.length)||!zn(a,n.length))return 1/0;let m=1/0;for(let g=t[0];g<t[1];++g){const y=r[g],x=r[g+1];for(let k=a[0];k<a[1];++k){const E=n[k],C=n[k+1];if(Na(y,x,E,C))return 0;m=Math.min(m,_u(y,x,E,C,c))}}return m}function nr(r,t,n,a,c){if(!zn(t,r.length)||!zn(a,n.length))return NaN;let m=1/0;for(let g=t[0];g<=t[1];++g)for(let y=a[0];y<=a[1];++y)if(m=Math.min(m,c.distance(r[g],n[y])),m===0)return m;return m}function Ap(r,t,n){if(Zs(r,t,!0))return 0;let a=1/0;for(const c of t){const m=c[0],g=c[c.length-1];if(m!==g&&(a=Math.min(a,ms(r,[g,m],n)),a===0))return a;const y=n.pointOnLine(c,r);if(a=Math.min(a,n.distance(r,y.point)),a===0)return a}return a}function yt(r,t,n,a){if(!zn(t,r.length))return NaN;for(let m=t[0];m<=t[1];++m)if(Zs(r[m],n,!0))return 0;let c=1/0;for(let m=t[0];m<t[1];++m){const g=r[m],y=r[m+1];for(const x of n)for(let k=0,E=x.length,C=E-1;k<E;C=k++){const A=x[C],R=x[k];if(Na(g,y,A,R))return 0;c=Math.min(c,_u(g,y,A,R,a))}}return c}function $a(r,t){for(const n of r)for(const a of n)if(Zs(a,t,!0))return!0;return!1}function Ut(r,t,n,a=1/0){const c=mu(r),m=mu(t);if(a!==1/0&&gu(c,m,n)>=a)return a;if(Xn(c,m)){if($a(r,t))return 0}else if($a(t,r))return 0;let g=1/0;for(const y of r)for(let x=0,k=y.length,E=k-1;x<k;E=x++){const C=y[E],A=y[x];for(const R of t)for(let B=0,O=R.length,$=O-1;B<O;$=B++){const X=R[$],he=R[B];if(Na(C,A,X,he))return 0;g=Math.min(g,_u(C,A,X,he,n))}}return g}function Ot(r,t,n,a,c,m){if(!m)return;const g=gu(fu(a,m),c,n);g<t&&r.push([g,m,[0,0]])}function gs(r,t,n,a,c,m,g){if(!m||!g)return;const y=gu(fu(a,m),fu(c,g),n);y<t&&r.push([y,m,g])}function Xo(r,t,n,a,c=1/0){let m=Math.min(a.distance(r[0],n[0][0]),c);if(m===0)return m;const g=new ch([[0,[0,r.length-1],[0,0]]],mh),y=mu(n);for(;g.length>0;){const x=g.pop();if(x[0]>=m)continue;const k=x[1],E=t?50:100;if(ja(k)<=E){if(!zn(k,r.length))return NaN;if(t){const C=yt(r,k,n,a);if(isNaN(C)||C===0)return C;m=Math.min(m,C)}else for(let C=k[0];C<=k[1];++C){const A=Ap(r[C],n,a);if(m=Math.min(m,A),m===0)return 0}}else{const C=pu(k,t);Ot(g,m,a,r,y,C[0]),Ot(g,m,a,r,y,C[1])}}return m}function Ko(r,t,n,a,c,m=1/0){let g=Math.min(m,c.distance(r[0],n[0]));if(g===0)return g;const y=new ch([[0,[0,r.length-1],[0,n.length-1]]],mh);for(;y.length>0;){const x=y.pop();if(x[0]>=g)continue;const k=x[1],E=x[2],C=t?50:100,A=a?50:100;if(ja(k)<=C&&ja(E)<=A){if(!zn(k,r.length)&&zn(E,n.length))return NaN;let R;if(t&&a)R=Mp(r,k,n,E,c),g=Math.min(g,R);else if(t&&!a){const B=r.slice(k[0],k[1]+1);for(let O=E[0];O<=E[1];++O)if(R=ms(n[O],B,c),g=Math.min(g,R),g===0)return g}else if(!t&&a){const B=n.slice(E[0],E[1]+1);for(let O=k[0];O<=k[1];++O)if(R=ms(r[O],B,c),g=Math.min(g,R),g===0)return g}else R=nr(r,k,n,E,c),g=Math.min(g,R)}else{const R=pu(k,t),B=pu(E,a);gs(y,g,c,r,n,R[0],B[0]),gs(y,g,c,r,n,R[0],B[1]),gs(y,g,c,r,n,R[1],B[0]),gs(y,g,c,r,n,R[1],B[1])}}return g}function yu(r){return r.type==="MultiPolygon"?r.coordinates.map(t=>({type:"Polygon",coordinates:t})):r.type==="MultiLineString"?r.coordinates.map(t=>({type:"LineString",coordinates:t})):r.type==="MultiPoint"?r.coordinates.map(t=>({type:"Point",coordinates:t})):[r]}class _s{constructor(t,n){this.type=Ae,this.geojson=t,this.geometries=n}static parse(t,n){if(t.length!==2)return n.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(cs(t[1])){const a=t[1];if(a.type==="FeatureCollection")return new _s(a,a.features.map(c=>yu(c.geometry)).flat());if(a.type==="Feature")return new _s(a,yu(a.geometry));if("type"in a&&"coordinates"in a)return new _s(a,yu(a))}return n.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(n,a){const c=n.geometry(),m=c.flat().map(x=>cu([x.x,x.y],n.canonical));if(c.length===0)return NaN;const g=new du(m[0][1]);let y=1/0;for(const x of a){switch(x.type){case"Point":y=Math.min(y,Ko(m,!1,[x.coordinates],!1,g,y));break;case"LineString":y=Math.min(y,Ko(m,!1,x.coordinates,!0,g,y));break;case"Polygon":y=Math.min(y,Xo(m,!1,x.coordinates,g,y))}if(y===0)return y}return y}(t,this.geometries);if(t.geometryType()==="LineString")return function(n,a){const c=n.geometry(),m=c.flat().map(x=>cu([x.x,x.y],n.canonical));if(c.length===0)return NaN;const g=new du(m[0][1]);let y=1/0;for(const x of a){switch(x.type){case"Point":y=Math.min(y,Ko(m,!0,[x.coordinates],!1,g,y));break;case"LineString":y=Math.min(y,Ko(m,!0,x.coordinates,!0,g,y));break;case"Polygon":y=Math.min(y,Xo(m,!0,x.coordinates,g,y))}if(y===0)return y}return y}(t,this.geometries);if(t.geometryType()==="Polygon")return function(n,a){const c=n.geometry();if(c.length===0||c[0].length===0)return NaN;const m=Va(c,0).map(x=>x.map(k=>k.map(E=>cu([E.x,E.y],n.canonical)))),g=new du(m[0][0][0][1]);let y=1/0;for(const x of a)for(const k of m){switch(x.type){case"Point":y=Math.min(y,Xo([x.coordinates],!1,k,g,y));break;case"LineString":y=Math.min(y,Xo(x.coordinates,!0,k,g,y));break;case"Polygon":y=Math.min(y,Ut(k,x.coordinates,g,y))}if(y===0)return y}return y}(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const qs={"==":xp,"!=":th,">":wp,"<":rh,">=":ih,"<=":bp,array:qi,at:nu,boolean:qi,case:Da,coalesce:Fa,collator:Ho,format:Oa,image:lu,in:su,"index-of":js,interpolate:ii,"interpolate-hcl":ii,"interpolate-lab":ii,length:uu,let:Wn,literal:Zi,match:ou,number:qi,"number-format":au,object:qi,slice:qo,step:Us,string:qi,"to-boolean":Gi,"to-color":Gi,"to-number":Gi,"to-string":Gi,var:Mt,within:fs,distance:_s};class Pi{constructor(t,n,a,c){this.name=t,this.type=n,this._evaluate=a,this.args=c}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,n){const a=t[0],c=Pi.definitions[a];if(!c)return n.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);const m=Array.isArray(c)?c[0]:c.type,g=Array.isArray(c)?[[c[1],c[2]]]:c.overloads,y=g.filter(([k])=>!Array.isArray(k)||k.length===t.length-1);let x=null;for(const[k,E]of y){x=new hs(n.registry,Yo,n.path,null,n.scope);const C=[];let A=!1;for(let R=1;R<t.length;R++){const B=t[R],O=Array.isArray(k)?k[R-1]:k.type,$=x.parse(B,1+C.length,O);if(!$){A=!0;break}C.push($)}if(!A)if(Array.isArray(k)&&k.length!==C.length)x.error(`Expected ${k.length} arguments, but found ${C.length} instead.`);else{for(let R=0;R<C.length;R++){const B=Array.isArray(k)?k[R]:k.type,O=C[R];x.concat(R+1).checkSubtype(B,O.type)}if(x.errors.length===0)return new Pi(a,m,E,C)}}if(y.length===1)n.errors.push(...x.errors);else{const k=(y.length?y:g).map(([C])=>{return A=C,Array.isArray(A)?`(${A.map(D).join(", ")})`:`(${D(A.type)}...)`;var A}).join(" | "),E=[];for(let C=1;C<t.length;C++){const A=n.parse(t[C],1+E.length);if(!A)return null;E.push(D(A.type))}n.error(`Expected arguments of type ${k}, but found (${E.join(", ")}) instead.`)}return null}static register(t,n){Pi.definitions=n;for(const a in n)t[a]=Pi}}function vu(r,[t,n,a,c]){t=t.evaluate(r),n=n.evaluate(r),a=a.evaluate(r);const m=c?c.evaluate(r):1,g=Vs(t,n,a,m);if(g)throw new lr(g);return new Bt(t/255,n/255,a/255,m,!1)}function xu(r,t){return r in t}function wu(r,t){const n=t[r];return n===void 0?null:n}function ys(r){return{type:r}}function Yo(r){if(r instanceof Mt)return Yo(r.boundExpression);if(r instanceof Pi&&r.name==="error"||r instanceof Ho||r instanceof fs||r instanceof _s)return!1;const t=r instanceof Gi||r instanceof qi;let n=!0;return r.eachChild(a=>{n=t?n&&Yo(a):n&&a instanceof Zi}),!!n&&Jo(r)&&Qo(r,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Jo(r){if(r instanceof Pi&&(r.name==="get"&&r.args.length===1||r.name==="feature-state"||r.name==="has"&&r.args.length===1||r.name==="properties"||r.name==="geometry-type"||r.name==="id"||/^filter-/.test(r.name))||r instanceof fs||r instanceof _s)return!1;let t=!0;return r.eachChild(n=>{t&&!Jo(n)&&(t=!1)}),t}function Gs(r){if(r instanceof Pi&&r.name==="feature-state")return!1;let t=!0;return r.eachChild(n=>{t&&!Gs(n)&&(t=!1)}),t}function Qo(r,t){if(r instanceof Pi&&t.indexOf(r.name)>=0)return!1;let n=!0;return r.eachChild(a=>{n&&!Qo(a,t)&&(n=!1)}),n}function Za(r){return{result:"success",value:r}}function Hs(r){return{result:"error",value:r}}function Ws(r){return r["property-type"]==="data-driven"||r["property-type"]==="cross-faded-data-driven"}function gh(r){return!!r.expression&&r.expression.parameters.indexOf("zoom")>-1}function bu(r){return!!r.expression&&r.expression.interpolated}function Et(r){return r instanceof Number?"number":r instanceof String?"string":r instanceof Boolean?"boolean":Array.isArray(r)?"array":r===null?"null":typeof r}function qa(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)}function Dp(r){return r}function _h(r,t){const n=t.type==="color",a=r.stops&&typeof r.stops[0][0]=="object",c=a||!(a||r.property!==void 0),m=r.type||(bu(t)?"exponential":"interval");if(n||t.type==="padding"){const E=n?Bt.parse:mi.parse;(r=hn({},r)).stops&&(r.stops=r.stops.map(C=>[C[0],E(C[1])])),r.default=E(r.default?r.default:t.default)}if(r.colorSpace&&(g=r.colorSpace)!=="rgb"&&g!=="hcl"&&g!=="lab")throw new Error(`Unknown color space: "${r.colorSpace}"`);var g;let y,x,k;if(m==="exponential")y=vh;else if(m==="interval")y=Ga;else if(m==="categorical"){y=yh,x=Object.create(null);for(const E of r.stops)x[E[0]]=E[1];k=typeof r.stops[0][0]}else{if(m!=="identity")throw new Error(`Unknown function type "${m}"`);y=xh}if(a){const E={},C=[];for(let B=0;B<r.stops.length;B++){const O=r.stops[B],$=O[0].zoom;E[$]===void 0&&(E[$]={zoom:$,type:r.type,property:r.property,default:r.default,stops:[]},C.push($)),E[$].stops.push([O[0].value,O[1]])}const A=[];for(const B of C)A.push([E[B].zoom,_h(E[B],t)]);const R={name:"linear"};return{kind:"composite",interpolationType:R,interpolationFactor:ii.interpolationFactor.bind(void 0,R),zoomStops:A.map(B=>B[0]),evaluate:({zoom:B},O)=>vh({stops:A,base:r.base},t,B).evaluate(B,O)}}if(c){const E=m==="exponential"?{name:"exponential",base:r.base!==void 0?r.base:1}:null;return{kind:"camera",interpolationType:E,interpolationFactor:ii.interpolationFactor.bind(void 0,E),zoomStops:r.stops.map(C=>C[0]),evaluate:({zoom:C})=>y(r,t,C,x,k)}}return{kind:"source",evaluate(E,C){const A=C&&C.properties?C.properties[r.property]:void 0;return A===void 0?Xs(r.default,t.default):y(r,t,A,x,k)}}}function Xs(r,t,n){return r!==void 0?r:t!==void 0?t:n!==void 0?n:void 0}function yh(r,t,n,a,c){return Xs(typeof n===c?a[n]:void 0,r.default,t.default)}function Ga(r,t,n){if(Et(n)!=="number")return Xs(r.default,t.default);const a=r.stops.length;if(a===1||n<=r.stops[0][0])return r.stops[0][1];if(n>=r.stops[a-1][0])return r.stops[a-1][1];const c=La(r.stops.map(m=>m[0]),n);return r.stops[c][1]}function vh(r,t,n){const a=r.base!==void 0?r.base:1;if(Et(n)!=="number")return Xs(r.default,t.default);const c=r.stops.length;if(c===1||n<=r.stops[0][0])return r.stops[0][1];if(n>=r.stops[c-1][0])return r.stops[c-1][1];const m=La(r.stops.map(E=>E[0]),n),g=function(E,C,A,R){const B=R-A,O=E-A;return B===0?0:C===1?O/B:(Math.pow(C,O)-1)/(Math.pow(C,B)-1)}(n,a,r.stops[m][0],r.stops[m+1][0]),y=r.stops[m][1],x=r.stops[m+1][1],k=ri[t.type]||Dp;return typeof y.evaluate=="function"?{evaluate(...E){const C=y.evaluate.apply(void 0,E),A=x.evaluate.apply(void 0,E);if(C!==void 0&&A!==void 0)return k(C,A,g,r.colorSpace)}}:k(y,x,g,r.colorSpace)}function xh(r,t,n){switch(t.type){case"color":n=Bt.parse(n);break;case"formatted":n=fi.fromString(n.toString());break;case"resolvedImage":n=gi.fromString(n.toString());break;case"padding":n=mi.parse(n);break;default:Et(n)===t.type||t.type==="enum"&&t.values[n]||(n=void 0)}return Xs(n,r.default,t.default)}Pi.register(qs,{error:[{kind:"error"},[ft],(r,[t])=>{throw new lr(t.evaluate(r))}],typeof:[ft,[ht],(r,[t])=>D(fr(t.evaluate(r)))],"to-rgba":[L(Ae,4),[ti],(r,[t])=>{const[n,a,c,m]=t.evaluate(r).rgb;return[255*n,255*a,255*c,m]}],rgb:[ti,[Ae,Ae,Ae],vu],rgba:[ti,[Ae,Ae,Ae,Ae],vu],has:{type:st,overloads:[[[ft],(r,[t])=>xu(t.evaluate(r),r.properties())],[[ft,$i],(r,[t,n])=>xu(t.evaluate(r),n.evaluate(r))]]},get:{type:ht,overloads:[[[ft],(r,[t])=>wu(t.evaluate(r),r.properties())],[[ft,$i],(r,[t,n])=>wu(t.evaluate(r),n.evaluate(r))]]},"feature-state":[ht,[ft],(r,[t])=>wu(t.evaluate(r),r.featureState||{})],properties:[$i,[],r=>r.properties()],"geometry-type":[ft,[],r=>r.geometryType()],id:[ht,[],r=>r.id()],zoom:[Ae,[],r=>r.globals.zoom],"heatmap-density":[Ae,[],r=>r.globals.heatmapDensity||0],"line-progress":[Ae,[],r=>r.globals.lineProgress||0],accumulated:[ht,[],r=>r.globals.accumulated===void 0?null:r.globals.accumulated],"+":[Ae,ys(Ae),(r,t)=>{let n=0;for(const a of t)n+=a.evaluate(r);return n}],"*":[Ae,ys(Ae),(r,t)=>{let n=1;for(const a of t)n*=a.evaluate(r);return n}],"-":{type:Ae,overloads:[[[Ae,Ae],(r,[t,n])=>t.evaluate(r)-n.evaluate(r)],[[Ae],(r,[t])=>-t.evaluate(r)]]},"/":[Ae,[Ae,Ae],(r,[t,n])=>t.evaluate(r)/n.evaluate(r)],"%":[Ae,[Ae,Ae],(r,[t,n])=>t.evaluate(r)%n.evaluate(r)],ln2:[Ae,[],()=>Math.LN2],pi:[Ae,[],()=>Math.PI],e:[Ae,[],()=>Math.E],"^":[Ae,[Ae,Ae],(r,[t,n])=>Math.pow(t.evaluate(r),n.evaluate(r))],sqrt:[Ae,[Ae],(r,[t])=>Math.sqrt(t.evaluate(r))],log10:[Ae,[Ae],(r,[t])=>Math.log(t.evaluate(r))/Math.LN10],ln:[Ae,[Ae],(r,[t])=>Math.log(t.evaluate(r))],log2:[Ae,[Ae],(r,[t])=>Math.log(t.evaluate(r))/Math.LN2],sin:[Ae,[Ae],(r,[t])=>Math.sin(t.evaluate(r))],cos:[Ae,[Ae],(r,[t])=>Math.cos(t.evaluate(r))],tan:[Ae,[Ae],(r,[t])=>Math.tan(t.evaluate(r))],asin:[Ae,[Ae],(r,[t])=>Math.asin(t.evaluate(r))],acos:[Ae,[Ae],(r,[t])=>Math.acos(t.evaluate(r))],atan:[Ae,[Ae],(r,[t])=>Math.atan(t.evaluate(r))],min:[Ae,ys(Ae),(r,t)=>Math.min(...t.map(n=>n.evaluate(r)))],max:[Ae,ys(Ae),(r,t)=>Math.max(...t.map(n=>n.evaluate(r)))],abs:[Ae,[Ae],(r,[t])=>Math.abs(t.evaluate(r))],round:[Ae,[Ae],(r,[t])=>{const n=t.evaluate(r);return n<0?-Math.round(-n):Math.round(n)}],floor:[Ae,[Ae],(r,[t])=>Math.floor(t.evaluate(r))],ceil:[Ae,[Ae],(r,[t])=>Math.ceil(t.evaluate(r))],"filter-==":[st,[ft,ht],(r,[t,n])=>r.properties()[t.value]===n.value],"filter-id-==":[st,[ht],(r,[t])=>r.id()===t.value],"filter-type-==":[st,[ft],(r,[t])=>r.geometryType()===t.value],"filter-<":[st,[ft,ht],(r,[t,n])=>{const a=r.properties()[t.value],c=n.value;return typeof a==typeof c&&a<c}],"filter-id-<":[st,[ht],(r,[t])=>{const n=r.id(),a=t.value;return typeof n==typeof a&&n<a}],"filter->":[st,[ft,ht],(r,[t,n])=>{const a=r.properties()[t.value],c=n.value;return typeof a==typeof c&&a>c}],"filter-id->":[st,[ht],(r,[t])=>{const n=r.id(),a=t.value;return typeof n==typeof a&&n>a}],"filter-<=":[st,[ft,ht],(r,[t,n])=>{const a=r.properties()[t.value],c=n.value;return typeof a==typeof c&&a<=c}],"filter-id-<=":[st,[ht],(r,[t])=>{const n=r.id(),a=t.value;return typeof n==typeof a&&n<=a}],"filter->=":[st,[ft,ht],(r,[t,n])=>{const a=r.properties()[t.value],c=n.value;return typeof a==typeof c&&a>=c}],"filter-id->=":[st,[ht],(r,[t])=>{const n=r.id(),a=t.value;return typeof n==typeof a&&n>=a}],"filter-has":[st,[ht],(r,[t])=>t.value in r.properties()],"filter-has-id":[st,[],r=>r.id()!==null&&r.id()!==void 0],"filter-type-in":[st,[L(ft)],(r,[t])=>t.value.indexOf(r.geometryType())>=0],"filter-id-in":[st,[L(ht)],(r,[t])=>t.value.indexOf(r.id())>=0],"filter-in-small":[st,[ft,L(ht)],(r,[t,n])=>n.value.indexOf(r.properties()[t.value])>=0],"filter-in-large":[st,[ft,L(ht)],(r,[t,n])=>function(a,c,m,g){for(;m<=g;){const y=m+g>>1;if(c[y]===a)return!0;c[y]>a?g=y-1:m=y+1}return!1}(r.properties()[t.value],n.value,0,n.value.length-1)],all:{type:st,overloads:[[[st,st],(r,[t,n])=>t.evaluate(r)&&n.evaluate(r)],[ys(st),(r,t)=>{for(const n of t)if(!n.evaluate(r))return!1;return!0}]]},any:{type:st,overloads:[[[st,st],(r,[t,n])=>t.evaluate(r)||n.evaluate(r)],[ys(st),(r,t)=>{for(const n of t)if(n.evaluate(r))return!0;return!1}]]},"!":[st,[st],(r,[t])=>!t.evaluate(r)],"is-supported-script":[st,[ft],(r,[t])=>{const n=r.globals&&r.globals.isSupportedScript;return!n||n(t.evaluate(r))}],upcase:[ft,[ft],(r,[t])=>t.evaluate(r).toUpperCase()],downcase:[ft,[ft],(r,[t])=>t.evaluate(r).toLowerCase()],concat:[ft,ys(ht),(r,t)=>t.map(n=>Zo(n.evaluate(r))).join("")],"resolved-locale":[ft,[pn],(r,[t])=>t.evaluate(r).resolvedLocale()]});class Ha{constructor(t,n){var a;this.expression=t,this._warningHistory={},this._evaluator=new Aa,this._defaultValue=n?(a=n).type==="color"&&qa(a.default)?new Bt(0,0,0,0):a.type==="color"?Bt.parse(a.default)||null:a.type==="padding"?mi.parse(a.default)||null:a.type==="variableAnchorOffsetCollection"?Ei.parse(a.default)||null:a.default===void 0?null:a.default:null,this._enumValues=n&&n.type==="enum"?n.values:null}evaluateWithoutErrorHandling(t,n,a,c,m,g){return this._evaluator.globals=t,this._evaluator.feature=n,this._evaluator.featureState=a,this._evaluator.canonical=c,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=g,this.expression.evaluate(this._evaluator)}evaluate(t,n,a,c,m,g){this._evaluator.globals=t,this._evaluator.feature=n||null,this._evaluator.featureState=a||null,this._evaluator.canonical=c,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=g||null;try{const y=this.expression.evaluate(this._evaluator);if(y==null||typeof y=="number"&&y!=y)return this._defaultValue;if(this._enumValues&&!(y in this._enumValues))throw new lr(`Expected value to be one of ${Object.keys(this._enumValues).map(x=>JSON.stringify(x)).join(", ")}, but found ${JSON.stringify(y)} instead.`);return y}catch(y){return this._warningHistory[y.message]||(this._warningHistory[y.message]=!0,typeof console<"u"&&console.warn(y.message)),this._defaultValue}}}function Wa(r){return Array.isArray(r)&&r.length>0&&typeof r[0]=="string"&&r[0]in qs}function Ks(r,t){const n=new hs(qs,Yo,[],t?function(c){const m={color:ti,string:ft,number:Ae,enum:ft,boolean:st,formatted:Cn,padding:Hn,resolvedImage:fn,variableAnchorOffsetCollection:W};return c.type==="array"?L(m[c.value]||ht,c.length):m[c.type]}(t):void 0),a=n.parse(r,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return a?Za(new Ha(a,t)):Hs(n.errors)}class Ys{constructor(t,n){this.kind=t,this._styleExpression=n,this.isStateDependent=t!=="constant"&&!Gs(n.expression)}evaluateWithoutErrorHandling(t,n,a,c,m,g){return this._styleExpression.evaluateWithoutErrorHandling(t,n,a,c,m,g)}evaluate(t,n,a,c,m,g){return this._styleExpression.evaluate(t,n,a,c,m,g)}}class Js{constructor(t,n,a,c){this.kind=t,this.zoomStops=a,this._styleExpression=n,this.isStateDependent=t!=="camera"&&!Gs(n.expression),this.interpolationType=c}evaluateWithoutErrorHandling(t,n,a,c,m,g){return this._styleExpression.evaluateWithoutErrorHandling(t,n,a,c,m,g)}evaluate(t,n,a,c,m,g){return this._styleExpression.evaluate(t,n,a,c,m,g)}interpolationFactor(t,n,a){return this.interpolationType?ii.interpolationFactor(this.interpolationType,t,n,a):0}}function Su(r,t){const n=Ks(r,t);if(n.result==="error")return n;const a=n.value.expression,c=Jo(a);if(!c&&!Ws(t))return Hs([new $r("","data expressions not supported")]);const m=Qo(a,["zoom"]);if(!m&&!gh(t))return Hs([new $r("","zoom expressions not supported")]);const g=ea(a);return g||m?g instanceof $r?Hs([g]):g instanceof ii&&!bu(t)?Hs([new $r("",'"interpolate" expressions cannot be used with this property')]):Za(g?new Js(c?"camera":"composite",n.value,g.labels,g instanceof ii?g.interpolation:void 0):new Ys(c?"constant":"source",n.value)):Hs([new $r("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Qs{constructor(t,n){this._parameters=t,this._specification=n,hn(this,_h(this._parameters,this._specification))}static deserialize(t){return new Qs(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function ea(r){let t=null;if(r instanceof Wn)t=ea(r.result);else if(r instanceof Fa){for(const n of r.args)if(t=ea(n),t)break}else(r instanceof Us||r instanceof ii)&&r.input instanceof Pi&&r.input.name==="zoom"&&(t=r);return t instanceof $r||r.eachChild(n=>{const a=ea(n);a instanceof $r?t=a:!t&&a?t=new $r("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&a&&t!==a&&(t=new $r("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function Xa(r){if(r===!0||r===!1)return!0;if(!Array.isArray(r)||r.length===0)return!1;switch(r[0]){case"has":return r.length>=2&&r[1]!=="$id"&&r[1]!=="$type";case"in":return r.length>=3&&(typeof r[1]!="string"||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return r.length!==3||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(const t of r.slice(1))if(!Xa(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const Ka={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Tu(r){if(r==null)return{filter:()=>!0,needGeometry:!1};Xa(r)||(r=Ya(r));const t=Ks(r,Ka);if(t.result==="error")throw new Error(t.value.map(n=>`${n.key}: ${n.message}`).join(", "));return{filter:(n,a,c)=>t.value.evaluate(n,a,{},c),needGeometry:wh(r)}}function Lp(r,t){return r<t?-1:r>t?1:0}function wh(r){if(!Array.isArray(r))return!1;if(r[0]==="within"||r[0]==="distance")return!0;for(let t=1;t<r.length;t++)if(wh(r[t]))return!0;return!1}function Ya(r){if(!r)return!0;const t=r[0];return r.length<=1?t!=="any":t==="=="?ku(r[1],r[2],"=="):t==="!="?Ar(ku(r[1],r[2],"==")):t==="<"||t===">"||t==="<="||t===">="?ku(r[1],r[2],t):t==="any"?(n=r.slice(1),["any"].concat(n.map(Ya))):t==="all"?["all"].concat(r.slice(1).map(Ya)):t==="none"?["all"].concat(r.slice(1).map(Ya).map(Ar)):t==="in"?ta(r[1],r.slice(2)):t==="!in"?Ar(ta(r[1],r.slice(2))):t==="has"?ra(r[1]):t!=="!has"||Ar(ra(r[1]));var n}function ku(r,t,n){switch(r){case"$type":return[`filter-type-${n}`,t];case"$id":return[`filter-id-${n}`,t];default:return[`filter-${n}`,r,t]}}function ta(r,t){if(t.length===0)return!1;switch(r){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(n=>typeof n!=typeof t[0])?["filter-in-large",r,["literal",t.sort(Lp)]]:["filter-in-small",r,["literal",t]]}}function ra(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function Ar(r){return["!",r]}function vs(r){const t=typeof r;if(t==="number"||t==="boolean"||t==="string"||r==null)return JSON.stringify(r);if(Array.isArray(r)){let c="[";for(const m of r)c+=`${vs(m)},`;return`${c}]`}const n=Object.keys(r).sort();let a="{";for(let c=0;c<n.length;c++)a+=`${JSON.stringify(n[c])}:${vs(r[n[c]])},`;return`${a}}`}function bh(r){let t="";for(const n of us)t+=`/${vs(r[n])}`;return t}function Sh(r){const t=r.value;return t?[new Ie(r.key,t,"constants have been deprecated as of v8")]:[]}function sr(r){return r instanceof Number||r instanceof String||r instanceof Boolean?r.valueOf():r}function Hi(r){if(Array.isArray(r))return r.map(Hi);if(r instanceof Object&&!(r instanceof Number||r instanceof String||r instanceof Boolean)){const t={};for(const n in r)t[n]=Hi(r[n]);return t}return sr(r)}function _i(r){const t=r.key,n=r.value,a=r.valueSpec||{},c=r.objectElementValidators||{},m=r.style,g=r.styleSpec,y=r.validateSpec;let x=[];const k=Et(n);if(k!=="object")return[new Ie(t,n,`object expected, ${k} found`)];for(const E in n){const C=E.split(".")[0],A=a[C]||a["*"];let R;if(c[C])R=c[C];else if(a[C])R=y;else if(c["*"])R=c["*"];else{if(!a["*"]){x.push(new Ie(t,n[E],`unknown property "${E}"`));continue}R=y}x=x.concat(R({key:(t&&`${t}.`)+E,value:n[E],valueSpec:A,style:m,styleSpec:g,object:n,objectKey:E,validateSpec:y},n))}for(const E in a)c[E]||a[E].required&&a[E].default===void 0&&n[E]===void 0&&x.push(new Ie(t,n,`missing required property "${E}"`));return x}function ia(r){const t=r.value,n=r.valueSpec,a=r.style,c=r.styleSpec,m=r.key,g=r.arrayElementValidator||r.validateSpec;if(Et(t)!=="array")return[new Ie(m,t,`array expected, ${Et(t)} found`)];if(n.length&&t.length!==n.length)return[new Ie(m,t,`array length ${n.length} expected, length ${t.length} found`)];if(n["min-length"]&&t.length<n["min-length"])return[new Ie(m,t,`array length at least ${n["min-length"]} expected, length ${t.length} found`)];let y={type:n.value,values:n.values};c.$version<7&&(y.function=n.function),Et(n.value)==="object"&&(y=n.value);let x=[];for(let k=0;k<t.length;k++)x=x.concat(g({array:t,arrayIndex:k,value:t[k],valueSpec:y,validateSpec:r.validateSpec,style:a,styleSpec:c,key:`${m}[${k}]`}));return x}function Iu(r){const t=r.key,n=r.value,a=r.valueSpec;let c=Et(n);return c==="number"&&n!=n&&(c="NaN"),c!=="number"?[new Ie(t,n,`number expected, ${c} found`)]:"minimum"in a&&n<a.minimum?[new Ie(t,n,`${n} is less than the minimum value ${a.minimum}`)]:"maximum"in a&&n>a.maximum?[new Ie(t,n,`${n} is greater than the maximum value ${a.maximum}`)]:[]}function Ja(r){const t=r.valueSpec,n=sr(r.value.type);let a,c,m,g={};const y=n!=="categorical"&&r.value.property===void 0,x=!y,k=Et(r.value.stops)==="array"&&Et(r.value.stops[0])==="array"&&Et(r.value.stops[0][0])==="object",E=_i({key:r.key,value:r.value,valueSpec:r.styleSpec.function,validateSpec:r.validateSpec,style:r.style,styleSpec:r.styleSpec,objectElementValidators:{stops:function(R){if(n==="identity")return[new Ie(R.key,R.value,'identity function may not have a "stops" property')];let B=[];const O=R.value;return B=B.concat(ia({key:R.key,value:O,valueSpec:R.valueSpec,validateSpec:R.validateSpec,style:R.style,styleSpec:R.styleSpec,arrayElementValidator:C})),Et(O)==="array"&&O.length===0&&B.push(new Ie(R.key,O,"array must have at least one stop")),B},default:function(R){return R.validateSpec({key:R.key,value:R.value,valueSpec:t,validateSpec:R.validateSpec,style:R.style,styleSpec:R.styleSpec})}}});return n==="identity"&&y&&E.push(new Ie(r.key,r.value,'missing required property "property"')),n==="identity"||r.value.stops||E.push(new Ie(r.key,r.value,'missing required property "stops"')),n==="exponential"&&r.valueSpec.expression&&!bu(r.valueSpec)&&E.push(new Ie(r.key,r.value,"exponential functions not supported")),r.styleSpec.$version>=8&&(x&&!Ws(r.valueSpec)?E.push(new Ie(r.key,r.value,"property functions not supported")):y&&!gh(r.valueSpec)&&E.push(new Ie(r.key,r.value,"zoom functions not supported"))),n!=="categorical"&&!k||r.value.property!==void 0||E.push(new Ie(r.key,r.value,'"property" property is required')),E;function C(R){let B=[];const O=R.value,$=R.key;if(Et(O)!=="array")return[new Ie($,O,`array expected, ${Et(O)} found`)];if(O.length!==2)return[new Ie($,O,`array length 2 expected, length ${O.length} found`)];if(k){if(Et(O[0])!=="object")return[new Ie($,O,`object expected, ${Et(O[0])} found`)];if(O[0].zoom===void 0)return[new Ie($,O,"object stop key must have zoom")];if(O[0].value===void 0)return[new Ie($,O,"object stop key must have value")];if(m&&m>sr(O[0].zoom))return[new Ie($,O[0].zoom,"stop zoom values must appear in ascending order")];sr(O[0].zoom)!==m&&(m=sr(O[0].zoom),c=void 0,g={}),B=B.concat(_i({key:`${$}[0]`,value:O[0],valueSpec:{zoom:{}},validateSpec:R.validateSpec,style:R.style,styleSpec:R.styleSpec,objectElementValidators:{zoom:Iu,value:A}}))}else B=B.concat(A({key:`${$}[0]`,value:O[0],validateSpec:R.validateSpec,style:R.style,styleSpec:R.styleSpec},O));return Wa(Hi(O[1]))?B.concat([new Ie(`${$}[1]`,O[1],"expressions are not allowed in function stops.")]):B.concat(R.validateSpec({key:`${$}[1]`,value:O[1],valueSpec:t,validateSpec:R.validateSpec,style:R.style,styleSpec:R.styleSpec}))}function A(R,B){const O=Et(R.value),$=sr(R.value),X=R.value!==null?R.value:B;if(a){if(O!==a)return[new Ie(R.key,X,`${O} stop domain type must match previous stop domain type ${a}`)]}else a=O;if(O!=="number"&&O!=="string"&&O!=="boolean")return[new Ie(R.key,X,"stop domain value must be a number, string, or boolean")];if(O!=="number"&&n!=="categorical"){let he=`number expected, ${O} found`;return Ws(t)&&n===void 0&&(he+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ie(R.key,X,he)]}return n!=="categorical"||O!=="number"||isFinite($)&&Math.floor($)===$?n!=="categorical"&&O==="number"&&c!==void 0&&$<c?[new Ie(R.key,X,"stop domain values must appear in ascending order")]:(c=$,n==="categorical"&&$ in g?[new Ie(R.key,X,"stop domain values must be unique")]:(g[$]=!0,[])):[new Ie(R.key,X,`integer expected, found ${$}`)]}}function eo(r){const t=(r.expressionContext==="property"?Su:Ks)(Hi(r.value),r.valueSpec);if(t.result==="error")return t.value.map(a=>new Ie(`${r.key}${a.key}`,r.value,a.message));const n=t.value.expression||t.value._styleExpression.expression;if(r.expressionContext==="property"&&r.propertyKey==="text-font"&&!n.outputDefined())return[new Ie(r.key,r.value,`Invalid data expression for "${r.propertyKey}". Output values must be contained as literals within the expression.`)];if(r.expressionContext==="property"&&r.propertyType==="layout"&&!Gs(n))return[new Ie(r.key,r.value,'"feature-state" data expressions are not supported with layout properties.')];if(r.expressionContext==="filter"&&!Gs(n))return[new Ie(r.key,r.value,'"feature-state" data expressions are not supported with filters.')];if(r.expressionContext&&r.expressionContext.indexOf("cluster")===0){if(!Qo(n,["zoom","feature-state"]))return[new Ie(r.key,r.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(r.expressionContext==="cluster-initial"&&!Jo(n))return[new Ie(r.key,r.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Mn(r){const t=r.key,n=r.value,a=r.valueSpec,c=[];return Array.isArray(a.values)?a.values.indexOf(sr(n))===-1&&c.push(new Ie(t,n,`expected one of [${a.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(a.values).indexOf(sr(n))===-1&&c.push(new Ie(t,n,`expected one of [${Object.keys(a.values).join(", ")}], ${JSON.stringify(n)} found`)),c}function Eu(r){return Xa(Hi(r.value))?eo(hn({},r,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Qa(r)}function Qa(r){const t=r.value,n=r.key;if(Et(t)!=="array")return[new Ie(n,t,`array expected, ${Et(t)} found`)];const a=r.styleSpec;let c,m=[];if(t.length<1)return[new Ie(n,t,"filter array must have at least 1 element")];switch(m=m.concat(Mn({key:`${n}[0]`,value:t[0],valueSpec:a.filter_operator,style:r.style,styleSpec:r.styleSpec})),sr(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&sr(t[1])==="$type"&&m.push(new Ie(n,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&m.push(new Ie(n,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(c=Et(t[1]),c!=="string"&&m.push(new Ie(`${n}[1]`,t[1],`string expected, ${c} found`)));for(let g=2;g<t.length;g++)c=Et(t[g]),sr(t[1])==="$type"?m=m.concat(Mn({key:`${n}[${g}]`,value:t[g],valueSpec:a.geometry_type,style:r.style,styleSpec:r.styleSpec})):c!=="string"&&c!=="number"&&c!=="boolean"&&m.push(new Ie(`${n}[${g}]`,t[g],`string, number, or boolean expected, ${c} found`));break;case"any":case"all":case"none":for(let g=1;g<t.length;g++)m=m.concat(Qa({key:`${n}[${g}]`,value:t[g],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":c=Et(t[1]),t.length!==2?m.push(new Ie(n,t,`filter array for "${t[0]}" operator must have 2 elements`)):c!=="string"&&m.push(new Ie(`${n}[1]`,t[1],`string expected, ${c} found`))}return m}function Pu(r,t){const n=r.key,a=r.validateSpec,c=r.style,m=r.styleSpec,g=r.value,y=r.objectKey,x=m[`${t}_${r.layerType}`];if(!x)return[];const k=y.match(/^(.*)-transition$/);if(t==="paint"&&k&&x[k[1]]&&x[k[1]].transition)return a({key:n,value:g,valueSpec:m.transition,style:c,styleSpec:m});const E=r.valueSpec||x[y];if(!E)return[new Ie(n,g,`unknown property "${y}"`)];let C;if(Et(g)==="string"&&Ws(E)&&!E.tokens&&(C=/^{([^}]+)}$/.exec(g)))return[new Ie(n,g,`"${y}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(C[1])} }\`.`)];const A=[];return r.layerType==="symbol"&&(y==="text-field"&&c&&!c.glyphs&&A.push(new Ie(n,g,'use of "text-field" requires a style "glyphs" property')),y==="text-font"&&qa(Hi(g))&&sr(g.type)==="identity"&&A.push(new Ie(n,g,'"text-font" does not support identity functions'))),A.concat(a({key:r.key,value:g,valueSpec:E,style:c,styleSpec:m,expressionContext:"property",propertyType:t,propertyKey:y}))}function el(r){return Pu(r,"paint")}function Cu(r){return Pu(r,"layout")}function zu(r){let t=[];const n=r.value,a=r.key,c=r.style,m=r.styleSpec;n.type||n.ref||t.push(new Ie(a,n,'either "type" or "ref" is required'));let g=sr(n.type);const y=sr(n.ref);if(n.id){const x=sr(n.id);for(let k=0;k<r.arrayIndex;k++){const E=c.layers[k];sr(E.id)===x&&t.push(new Ie(a,n.id,`duplicate layer id "${n.id}", previously used at line ${E.id.__line__}`))}}if("ref"in n){let x;["type","source","source-layer","filter","layout"].forEach(k=>{k in n&&t.push(new Ie(a,n[k],`"${k}" is prohibited for ref layers`))}),c.layers.forEach(k=>{sr(k.id)===y&&(x=k)}),x?x.ref?t.push(new Ie(a,n.ref,"ref cannot reference another ref layer")):g=sr(x.type):t.push(new Ie(a,n.ref,`ref layer "${y}" not found`))}else if(g!=="background")if(n.source){const x=c.sources&&c.sources[n.source],k=x&&sr(x.type);x?k==="vector"&&g==="raster"?t.push(new Ie(a,n.source,`layer "${n.id}" requires a raster source`)):k!=="raster-dem"&&g==="hillshade"?t.push(new Ie(a,n.source,`layer "${n.id}" requires a raster-dem source`)):k==="raster"&&g!=="raster"?t.push(new Ie(a,n.source,`layer "${n.id}" requires a vector source`)):k!=="vector"||n["source-layer"]?k==="raster-dem"&&g!=="hillshade"?t.push(new Ie(a,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):g!=="line"||!n.paint||!n.paint["line-gradient"]||k==="geojson"&&x.lineMetrics||t.push(new Ie(a,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Ie(a,n,`layer "${n.id}" must specify a "source-layer"`)):t.push(new Ie(a,n.source,`source "${n.source}" not found`))}else t.push(new Ie(a,n,'missing required property "source"'));return t=t.concat(_i({key:a,value:n,valueSpec:m.layer,style:r.style,styleSpec:r.styleSpec,validateSpec:r.validateSpec,objectElementValidators:{"*":()=>[],type:()=>r.validateSpec({key:`${a}.type`,value:n.type,valueSpec:m.layer.type,style:r.style,styleSpec:r.styleSpec,validateSpec:r.validateSpec,object:n,objectKey:"type"}),filter:Eu,layout:x=>_i({layer:n,key:x.key,value:x.value,style:x.style,styleSpec:x.styleSpec,validateSpec:x.validateSpec,objectElementValidators:{"*":k=>Cu(hn({layerType:g},k))}}),paint:x=>_i({layer:n,key:x.key,value:x.value,style:x.style,styleSpec:x.styleSpec,validateSpec:x.validateSpec,objectElementValidators:{"*":k=>el(hn({layerType:g},k))}})}})),t}function xs(r){const t=r.value,n=r.key,a=Et(t);return a!=="string"?[new Ie(n,t,`string expected, ${a} found`)]:[]}const tl={promoteId:function({key:r,value:t}){if(Et(t)==="string")return xs({key:r,value:t});{const n=[];for(const a in t)n.push(...xs({key:`${r}.${a}`,value:t[a]}));return n}}};function na(r){const t=r.value,n=r.key,a=r.styleSpec,c=r.style,m=r.validateSpec;if(!t.type)return[new Ie(n,t,'"type" is required')];const g=sr(t.type);let y;switch(g){case"vector":case"raster":return y=_i({key:n,value:t,valueSpec:a[`source_${g.replace("-","_")}`],style:r.style,styleSpec:a,objectElementValidators:tl,validateSpec:m}),y;case"raster-dem":return y=function(x){var k;const E=(k=x.sourceName)!==null&&k!==void 0?k:"",C=x.value,A=x.styleSpec,R=A.source_raster_dem,B=x.style;let O=[];const $=Et(C);if(C===void 0)return O;if($!=="object")return O.push(new Ie("source_raster_dem",C,`object expected, ${$} found`)),O;const X=sr(C.encoding)==="custom",he=["redFactor","greenFactor","blueFactor","baseShift"],ee=x.value.encoding?`"${x.value.encoding}"`:"Default";for(const ae in C)!X&&he.includes(ae)?O.push(new Ie(ae,C[ae],`In "${E}": "${ae}" is only valid when "encoding" is set to "custom". ${ee} encoding found`)):R[ae]?O=O.concat(x.validateSpec({key:ae,value:C[ae],valueSpec:R[ae],validateSpec:x.validateSpec,style:B,styleSpec:A})):O.push(new Ie(ae,C[ae],`unknown property "${ae}"`));return O}({sourceName:n,value:t,style:r.style,styleSpec:a,validateSpec:m}),y;case"geojson":if(y=_i({key:n,value:t,valueSpec:a.source_geojson,style:c,styleSpec:a,validateSpec:m,objectElementValidators:tl}),t.cluster)for(const x in t.clusterProperties){const[k,E]=t.clusterProperties[x],C=typeof k=="string"?[k,["accumulated"],["get",x]]:k;y.push(...eo({key:`${n}.${x}.map`,value:E,expressionContext:"cluster-map"})),y.push(...eo({key:`${n}.${x}.reduce`,value:C,expressionContext:"cluster-reduce"}))}return y;case"video":return _i({key:n,value:t,valueSpec:a.source_video,style:c,validateSpec:m,styleSpec:a});case"image":return _i({key:n,value:t,valueSpec:a.source_image,style:c,validateSpec:m,styleSpec:a});case"canvas":return[new Ie(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Mn({key:`${n}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Mu(r){const t=r.value,n=r.styleSpec,a=n.light,c=r.style;let m=[];const g=Et(t);if(t===void 0)return m;if(g!=="object")return m=m.concat([new Ie("light",t,`object expected, ${g} found`)]),m;for(const y in t){const x=y.match(/^(.*)-transition$/);m=m.concat(x&&a[x[1]]&&a[x[1]].transition?r.validateSpec({key:y,value:t[y],valueSpec:n.transition,validateSpec:r.validateSpec,style:c,styleSpec:n}):a[y]?r.validateSpec({key:y,value:t[y],valueSpec:a[y],validateSpec:r.validateSpec,style:c,styleSpec:n}):[new Ie(y,t[y],`unknown property "${y}"`)])}return m}function Au(r){const t=r.value,n=r.styleSpec,a=n.sky,c=r.style,m=Et(t);if(t===void 0)return[];if(m!=="object")return[new Ie("sky",t,`object expected, ${m} found`)];let g=[];for(const y in t)g=g.concat(a[y]?r.validateSpec({key:y,value:t[y],valueSpec:a[y],style:c,styleSpec:n}):[new Ie(y,t[y],`unknown property "${y}"`)]);return g}function Du(r){const t=r.value,n=r.styleSpec,a=n.terrain,c=r.style;let m=[];const g=Et(t);if(t===void 0)return m;if(g!=="object")return m=m.concat([new Ie("terrain",t,`object expected, ${g} found`)]),m;for(const y in t)m=m.concat(a[y]?r.validateSpec({key:y,value:t[y],valueSpec:a[y],validateSpec:r.validateSpec,style:c,styleSpec:n}):[new Ie(y,t[y],`unknown property "${y}"`)]);return m}function Lu(r){let t=[];const n=r.value,a=r.key;if(Array.isArray(n)){const c=[],m=[];for(const g in n)n[g].id&&c.includes(n[g].id)&&t.push(new Ie(a,n,`all the sprites' ids must be unique, but ${n[g].id} is duplicated`)),c.push(n[g].id),n[g].url&&m.includes(n[g].url)&&t.push(new Ie(a,n,`all the sprites' URLs must be unique, but ${n[g].url} is duplicated`)),m.push(n[g].url),t=t.concat(_i({key:`${a}[${g}]`,value:n[g],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:r.validateSpec}));return t}return xs({key:a,value:n})}const rl={"*":()=>[],array:ia,boolean:function(r){const t=r.value,n=r.key,a=Et(t);return a!=="boolean"?[new Ie(n,t,`boolean expected, ${a} found`)]:[]},number:Iu,color:function(r){const t=r.key,n=r.value,a=Et(n);return a!=="string"?[new Ie(t,n,`color expected, ${a} found`)]:Bt.parse(String(n))?[]:[new Ie(t,n,`color expected, "${n}" found`)]},constants:Sh,enum:Mn,filter:Eu,function:Ja,layer:zu,object:_i,source:na,light:Mu,sky:Au,terrain:Du,projection:function(r){const t=r.value,n=r.styleSpec,a=n.projection,c=r.style,m=Et(t);if(t===void 0)return[];if(m!=="object")return[new Ie("projection",t,`object expected, ${m} found`)];let g=[];for(const y in t)g=g.concat(a[y]?r.validateSpec({key:y,value:t[y],valueSpec:a[y],style:c,styleSpec:n}):[new Ie(y,t[y],`unknown property "${y}"`)]);return g},string:xs,formatted:function(r){return xs(r).length===0?[]:eo(r)},resolvedImage:function(r){return xs(r).length===0?[]:eo(r)},padding:function(r){const t=r.key,n=r.value;if(Et(n)==="array"){if(n.length<1||n.length>4)return[new Ie(t,n,`padding requires 1 to 4 values; ${n.length} values found`)];const a={type:"number"};let c=[];for(let m=0;m<n.length;m++)c=c.concat(r.validateSpec({key:`${t}[${m}]`,value:n[m],validateSpec:r.validateSpec,valueSpec:a}));return c}return Iu({key:t,value:n,valueSpec:{}})},variableAnchorOffsetCollection:function(r){const t=r.key,n=r.value,a=Et(n),c=r.styleSpec;if(a!=="array"||n.length<1||n.length%2!=0)return[new Ie(t,n,"variableAnchorOffsetCollection requires a non-empty array of even length")];let m=[];for(let g=0;g<n.length;g+=2)m=m.concat(Mn({key:`${t}[${g}]`,value:n[g],valueSpec:c.layout_symbol["text-anchor"]})),m=m.concat(ia({key:`${t}[${g+1}]`,value:n[g+1],valueSpec:{length:2,value:"number"},validateSpec:r.validateSpec,style:r.style,styleSpec:c}));return m},sprite:Lu};function sa(r){const t=r.value,n=r.valueSpec,a=r.styleSpec;return r.validateSpec=sa,n.expression&&qa(sr(t))?Ja(r):n.expression&&Wa(Hi(t))?eo(r):n.type&&rl[n.type]?rl[n.type](r):_i(hn({},r,{valueSpec:n.type?a[n.type]:n}))}function Th(r){const t=r.value,n=r.key,a=xs(r);return a.length||(t.indexOf("{fontstack}")===-1&&a.push(new Ie(n,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&a.push(new Ie(n,t,'"glyphs" url must include a "{range}" token'))),a}function Ci(r,t=me){let n=[];return n=n.concat(sa({key:"",value:r,valueSpec:t.$root,styleSpec:t,style:r,validateSpec:sa,objectElementValidators:{glyphs:Th,"*":()=>[]}})),r.constants&&(n=n.concat(Sh({key:"constants",value:r.constants}))),Ru(n)}function gn(r){return function(t){return r({...t,validateSpec:sa})}}function Ru(r){return[].concat(r).sort((t,n)=>t.line-n.line)}function Wi(r){return function(...t){return Ru(r.apply(this,t))}}Ci.source=Wi(gn(na)),Ci.sprite=Wi(gn(Lu)),Ci.glyphs=Wi(gn(Th)),Ci.light=Wi(gn(Mu)),Ci.sky=Wi(gn(Au)),Ci.terrain=Wi(gn(Du)),Ci.layer=Wi(gn(zu)),Ci.filter=Wi(gn(Eu)),Ci.paintProperty=Wi(gn(el)),Ci.layoutProperty=Wi(gn(Cu));const ws=Ci,Rp=ws.light,Fp=ws.sky,kh=ws.paintProperty,Ih=ws.layoutProperty;function Fu(r,t){let n=!1;if(t&&t.length)for(const a of t)r.fire(new Zn(new Error(a.message))),n=!0;return n}class to{constructor(t,n,a){const c=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const g=new Int32Array(this.arrayBuffer);t=g[0],this.d=(n=g[1])+2*(a=g[2]);for(let x=0;x<this.d*this.d;x++){const k=g[3+x],E=g[3+x+1];c.push(k===E?null:g.subarray(k,E))}const y=g[3+c.length+1];this.keys=g.subarray(g[3+c.length],y),this.bboxes=g.subarray(y),this.insert=this._insertReadonly}else{this.d=n+2*a;for(let g=0;g<this.d*this.d;g++)c.push([]);this.keys=[],this.bboxes=[]}this.n=n,this.extent=t,this.padding=a,this.scale=n/t,this.uid=0;const m=a/n*t;this.min=-m,this.max=t+m}insert(t,n,a,c,m){this._forEachCell(n,a,c,m,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(n),this.bboxes.push(a),this.bboxes.push(c),this.bboxes.push(m)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,n,a,c,m,g){this.cells[m].push(g)}query(t,n,a,c,m){const g=this.min,y=this.max;if(t<=g&&n<=g&&y<=a&&y<=c&&!m)return Array.prototype.slice.call(this.keys);{const x=[];return this._forEachCell(t,n,a,c,this._queryCell,x,{},m),x}}_queryCell(t,n,a,c,m,g,y,x){const k=this.cells[m];if(k!==null){const E=this.keys,C=this.bboxes;for(let A=0;A<k.length;A++){const R=k[A];if(y[R]===void 0){const B=4*R;(x?x(C[B+0],C[B+1],C[B+2],C[B+3]):t<=C[B+2]&&n<=C[B+3]&&a>=C[B+0]&&c>=C[B+1])?(y[R]=!0,g.push(E[R])):y[R]=!1}}}}_forEachCell(t,n,a,c,m,g,y,x){const k=this._convertToCellCoord(t),E=this._convertToCellCoord(n),C=this._convertToCellCoord(a),A=this._convertToCellCoord(c);for(let R=k;R<=C;R++)for(let B=E;B<=A;B++){const O=this.d*B+R;if((!x||x(this._convertFromCellCoord(R),this._convertFromCellCoord(B),this._convertFromCellCoord(R+1),this._convertFromCellCoord(B+1)))&&m.call(this,t,n,a,c,O,g,y,x))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,n=3+this.cells.length+1+1;let a=0;for(let g=0;g<this.cells.length;g++)a+=this.cells[g].length;const c=new Int32Array(n+a+this.keys.length+this.bboxes.length);c[0]=this.extent,c[1]=this.n,c[2]=this.padding;let m=n;for(let g=0;g<t.length;g++){const y=t[g];c[3+g]=m,c.set(y,m),m+=y.length}return c[3+t.length]=m,c.set(this.keys,m),m+=this.keys.length,c[3+t.length+1]=m,c.set(this.bboxes,m),m+=this.bboxes.length,c.buffer}static serialize(t,n){const a=t.toArrayBuffer();return n&&n.push(a),{buffer:a}}static deserialize(t){return new to(t.buffer)}}const zi={};function $e(r,t,n={}){if(zi[r])throw new Error(`${r} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:r,writeable:!1}),zi[r]={klass:t,omit:n.omit||[],shallow:n.shallow||[]}}$e("Object",Object),$e("TransferableGridIndex",to),$e("Color",Bt),$e("Error",Error),$e("AJAXError",xr),$e("ResolvedImage",gi),$e("StylePropertyFunction",Qs),$e("StyleExpression",Ha,{omit:["_evaluator"]}),$e("ZoomDependentExpression",Js),$e("ZoomConstantExpression",Ys),$e("CompoundExpression",Pi,{omit:["_evaluate"]});for(const r in qs)qs[r]._classRegistryKey||$e(`Expression_${r}`,qs[r]);function il(r){return r&&typeof ArrayBuffer<"u"&&(r instanceof ArrayBuffer||r.constructor&&r.constructor.name==="ArrayBuffer")}function Bu(r){return r.$name||r.constructor._classRegistryKey}function Eh(r){return!function(t){if(t===null||typeof t!="object")return!1;const n=Bu(t);return!(!n||n==="Object")}(r)&&(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||r instanceof Blob||r instanceof Error||il(r)||Jr(r)||ArrayBuffer.isView(r)||r instanceof ImageData)}function ro(r,t){if(Eh(r))return(il(r)||Jr(r))&&t&&t.push(r),ArrayBuffer.isView(r)&&t&&t.push(r.buffer),r instanceof ImageData&&t&&t.push(r.data.buffer),r;if(Array.isArray(r)){const m=[];for(const g of r)m.push(ro(g,t));return m}if(typeof r!="object")throw new Error("can't serialize object of type "+typeof r);const n=Bu(r);if(!n)throw new Error(`can't serialize object of unregistered class ${r.constructor.name}`);if(!zi[n])throw new Error(`${n} is not registered.`);const{klass:a}=zi[n],c=a.serialize?a.serialize(r,t):{};if(a.serialize){if(t&&c===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const m in r){if(!r.hasOwnProperty(m)||zi[n].omit.indexOf(m)>=0)continue;const g=r[m];c[m]=zi[n].shallow.indexOf(m)>=0?g:ro(g,t)}r instanceof Error&&(c.message=r.message)}if(c.$name)throw new Error("$name property is reserved for worker serialization logic.");return n!=="Object"&&(c.$name=n),c}function io(r){if(Eh(r))return r;if(Array.isArray(r))return r.map(io);if(typeof r!="object")throw new Error("can't deserialize object of type "+typeof r);const t=Bu(r)||"Object";if(!zi[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:n}=zi[t];if(!n)throw new Error(`can't deserialize unregistered class ${t}`);if(n.deserialize)return n.deserialize(r);const a=Object.create(n.prototype);for(const c of Object.keys(r)){if(c==="$name")continue;const m=r[c];a[c]=zi[t].shallow.indexOf(c)>=0?m:io(m)}return a}class Ou{constructor(){this.first=!0}update(t,n){const a=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=a,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=a,!0):(this.lastFloorZoom>a?(this.lastIntegerZoom=a+1,this.lastIntegerZoomTime=n):this.lastFloorZoom<a&&(this.lastIntegerZoom=a,this.lastIntegerZoomTime=n),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=a,!0))}}const wt={"Latin-1 Supplement":r=>r>=128&&r<=255,"Hangul Jamo":r=>r>=4352&&r<=4607,Khmer:r=>r>=6016&&r<=6143,"General Punctuation":r=>r>=8192&&r<=8303,"Letterlike Symbols":r=>r>=8448&&r<=8527,"Number Forms":r=>r>=8528&&r<=8591,"Miscellaneous Technical":r=>r>=8960&&r<=9215,"Control Pictures":r=>r>=9216&&r<=9279,"Optical Character Recognition":r=>r>=9280&&r<=9311,"Enclosed Alphanumerics":r=>r>=9312&&r<=9471,"Geometric Shapes":r=>r>=9632&&r<=9727,"Miscellaneous Symbols":r=>r>=9728&&r<=9983,"Miscellaneous Symbols and Arrows":r=>r>=11008&&r<=11263,"Ideographic Description Characters":r=>r>=12272&&r<=12287,"CJK Symbols and Punctuation":r=>r>=12288&&r<=12351,Katakana:r=>r>=12448&&r<=12543,Kanbun:r=>r>=12688&&r<=12703,"CJK Strokes":r=>r>=12736&&r<=12783,"Enclosed CJK Letters and Months":r=>r>=12800&&r<=13055,"CJK Compatibility":r=>r>=13056&&r<=13311,"Yijing Hexagram Symbols":r=>r>=19904&&r<=19967,"Private Use Area":r=>r>=57344&&r<=63743,"Vertical Forms":r=>r>=65040&&r<=65055,"CJK Compatibility Forms":r=>r>=65072&&r<=65103,"Small Form Variants":r=>r>=65104&&r<=65135,"Halfwidth and Fullwidth Forms":r=>r>=65280&&r<=65519};function Nu(r){for(const t of r)if(ju(t.charCodeAt(0)))return!0;return!1}function Bp(r){for(const t of r)if(!no(t.charCodeAt(0)))return!1;return!0}function Vu(r){const t=r.map(n=>{try{return new RegExp(`\\p{sc=${n}}`,"u").source}catch{return null}}).filter(n=>n);return new RegExp(t.join("|"),"u")}const Op=Vu(["Arab","Dupl","Mong","Ougr","Syrc"]);function no(r){return!Op.test(String.fromCodePoint(r))}const Ph=Vu(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function ju(r){return!(r!==746&&r!==747&&(r<4352||!(wt["CJK Compatibility Forms"](r)&&!(r>=65097&&r<=65103)||wt["CJK Compatibility"](r)||wt["CJK Strokes"](r)||!(!wt["CJK Symbols and Punctuation"](r)||r>=12296&&r<=12305||r>=12308&&r<=12319||r===12336)||wt["Enclosed CJK Letters and Months"](r)||wt["Ideographic Description Characters"](r)||wt.Kanbun(r)||wt.Katakana(r)&&r!==12540||!(!wt["Halfwidth and Fullwidth Forms"](r)||r===65288||r===65289||r===65293||r>=65306&&r<=65310||r===65339||r===65341||r===65343||r>=65371&&r<=65503||r===65507||r>=65512&&r<=65519)||!(!wt["Small Form Variants"](r)||r>=65112&&r<=65118||r>=65123&&r<=65126)||wt["Vertical Forms"](r)||wt["Yijing Hexagram Symbols"](r)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(r))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(r))||Ph.test(String.fromCodePoint(r)))))}function Ch(r){return!(ju(r)||function(t){return!!(wt["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||wt["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||wt["Letterlike Symbols"](t)||wt["Number Forms"](t)||wt["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||wt["Control Pictures"](t)&&t!==9251||wt["Optical Character Recognition"](t)||wt["Enclosed Alphanumerics"](t)||wt["Geometric Shapes"](t)||wt["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||wt["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||wt["CJK Symbols and Punctuation"](t)||wt.Katakana(t)||wt["Private Use Area"](t)||wt["CJK Compatibility Forms"](t)||wt["Small Form Variants"](t)||wt["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(r))}const Np=Vu(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Uu(r){return Np.test(String.fromCodePoint(r))}function Vp(r,t){return!(!t&&Uu(r)||r>=2304&&r<=3583||r>=3840&&r<=4255||wt.Khmer(r))}function jp(r){for(const t of r)if(Uu(t.charCodeAt(0)))return!0;return!1}const yi=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(r){this.pluginStatus=r.pluginStatus,this.pluginURL=r.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(r){this.applyArabicShaping=r.applyArabicShaping,this.processBidirectionalText=r.processBidirectionalText,this.processStyledBidirectionalText=r.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class qt{constructor(t,n){this.zoom=t,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.zoomHistory=n.zoomHistory,this.transition=n.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Ou,this.transition={})}isSupportedScript(t){return function(n,a){for(const c of n)if(!Vp(c.charCodeAt(0),a))return!1;return!0}(t,yi.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,n=t-Math.floor(t),a=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:n+(1-n)*a}:{fromScale:.5,toScale:1,t:1-(1-a)*n}}}class so{constructor(t,n){this.property=t,this.value=n,this.expression=function(a,c){if(qa(a))return new Qs(a,c);if(Wa(a)){const m=Su(a,c);if(m.result==="error")throw new Error(m.value.map(g=>`${g.key}: ${g.message}`).join(", "));return m.value}{let m=a;return c.type==="color"&&typeof a=="string"?m=Bt.parse(a):c.type!=="padding"||typeof a!="number"&&!Array.isArray(a)?c.type==="variableAnchorOffsetCollection"&&Array.isArray(a)&&(m=Ei.parse(a)):m=mi.parse(a),{kind:"constant",evaluate:()=>m}}}(n===void 0?t.specification.default:n,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,n,a){return this.property.possiblyEvaluate(this,t,n,a)}}class nl{constructor(t){this.property=t,this.value=new so(t,void 0)}transitioned(t,n){return new zh(this.property,this.value,n,qe({},t.transition,this.transition),t.now)}untransitioned(){return new zh(this.property,this.value,null,{},0)}}class sl{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return _t(this._values[t].value.value)}setValue(t,n){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new nl(this._values[t].property)),this._values[t].value=new so(this._values[t].property,n===null?void 0:_t(n))}getTransition(t){return _t(this._values[t].transition)}setTransition(t,n){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new nl(this._values[t].property)),this._values[t].transition=_t(n)||void 0}serialize(){const t={};for(const n of Object.keys(this._values)){const a=this.getValue(n);a!==void 0&&(t[n]=a);const c=this.getTransition(n);c!==void 0&&(t[`${n}-transition`]=c)}return t}transitioned(t,n){const a=new oa(this._properties);for(const c of Object.keys(this._values))a._values[c]=this._values[c].transitioned(t,n._values[c]);return a}untransitioned(){const t=new oa(this._properties);for(const n of Object.keys(this._values))t._values[n]=this._values[n].untransitioned();return t}}class zh{constructor(t,n,a,c,m){this.property=t,this.value=n,this.begin=m+c.delay||0,this.end=this.begin+c.duration||0,t.specification.transition&&(c.delay||c.duration)&&(this.prior=a)}possiblyEvaluate(t,n,a){const c=t.now||0,m=this.value.possiblyEvaluate(t,n,a),g=this.prior;if(g){if(c>this.end)return this.prior=null,m;if(this.value.isDataDriven())return this.prior=null,m;if(c<this.begin)return g.possiblyEvaluate(t,n,a);{const y=(c-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(t,n,a),m,function(x){if(x<=0)return 0;if(x>=1)return 1;const k=x*x,E=k*x;return 4*(x<.5?E:3*(x-k)+E-.75)}(y))}}return m}}class oa{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,n,a){const c=new la(this._properties);for(const m of Object.keys(this._values))c._values[m]=this._values[m].possiblyEvaluate(t,n,a);return c}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class aa{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return _t(this._values[t].value)}setValue(t,n){this._values[t]=new so(this._values[t].property,n===null?void 0:_t(n))}serialize(){const t={};for(const n of Object.keys(this._values)){const a=this.getValue(n);a!==void 0&&(t[n]=a)}return t}possiblyEvaluate(t,n,a){const c=new la(this._properties);for(const m of Object.keys(this._values))c._values[m]=this._values[m].possiblyEvaluate(t,n,a);return c}}class _n{constructor(t,n,a){this.property=t,this.value=n,this.parameters=a}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,n,a,c){return this.property.evaluate(this.value,this.parameters,t,n,a,c)}}class la{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class He{constructor(t){this.specification=t}possiblyEvaluate(t,n){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(n)}interpolate(t,n,a){const c=ri[this.specification.type];return c?c(t,n,a):t}}class nt{constructor(t,n){this.specification=t,this.overrides=n}possiblyEvaluate(t,n,a,c){return new _n(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(n,null,{},a,c)}:t.expression,n)}interpolate(t,n,a){if(t.value.kind!=="constant"||n.value.kind!=="constant")return t;if(t.value.value===void 0||n.value.value===void 0)return new _n(this,{kind:"constant",value:void 0},t.parameters);const c=ri[this.specification.type];if(c){const m=c(t.value.value,n.value.value,a);return new _n(this,{kind:"constant",value:m},t.parameters)}return t}evaluate(t,n,a,c,m,g){return t.kind==="constant"?t.value:t.evaluate(n,a,c,m,g)}}class ol extends nt{possiblyEvaluate(t,n,a,c){if(t.value===void 0)return new _n(this,{kind:"constant",value:void 0},n);if(t.expression.kind==="constant"){const m=t.expression.evaluate(n,null,{},a,c),g=t.property.specification.type==="resolvedImage"&&typeof m!="string"?m.name:m,y=this._calculate(g,g,g,n);return new _n(this,{kind:"constant",value:y},n)}if(t.expression.kind==="camera"){const m=this._calculate(t.expression.evaluate({zoom:n.zoom-1}),t.expression.evaluate({zoom:n.zoom}),t.expression.evaluate({zoom:n.zoom+1}),n);return new _n(this,{kind:"constant",value:m},n)}return new _n(this,t.expression,n)}evaluate(t,n,a,c,m,g){if(t.kind==="source"){const y=t.evaluate(n,a,c,m,g);return this._calculate(y,y,y,n)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(n.zoom)-1},a,c),t.evaluate({zoom:Math.floor(n.zoom)},a,c),t.evaluate({zoom:Math.floor(n.zoom)+1},a,c),n):t.value}_calculate(t,n,a,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:t,to:n}:{from:a,to:n}}interpolate(t){return t}}class al{constructor(t){this.specification=t}possiblyEvaluate(t,n,a,c){if(t.value!==void 0){if(t.expression.kind==="constant"){const m=t.expression.evaluate(n,null,{},a,c);return this._calculate(m,m,m,n)}return this._calculate(t.expression.evaluate(new qt(Math.floor(n.zoom-1),n)),t.expression.evaluate(new qt(Math.floor(n.zoom),n)),t.expression.evaluate(new qt(Math.floor(n.zoom+1),n)),n)}}_calculate(t,n,a,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:t,to:n}:{from:a,to:n}}interpolate(t){return t}}class $u{constructor(t){this.specification=t}possiblyEvaluate(t,n,a,c){return!!t.expression.evaluate(n,null,{},a,c)}interpolate(){return!1}}class f{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const n in t){const a=t[n];a.specification.overridable&&this.overridableProperties.push(n);const c=this.defaultPropertyValues[n]=new so(a,void 0),m=this.defaultTransitionablePropertyValues[n]=new nl(a);this.defaultTransitioningPropertyValues[n]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=c.possiblyEvaluate({})}}}$e("DataDrivenProperty",nt),$e("DataConstantProperty",He),$e("CrossFadedDataDrivenProperty",ol),$e("CrossFadedProperty",al),$e("ColorRampProperty",$u);const e="-transition";class s extends Bs{constructor(t,n){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),n.layout&&(this._unevaluatedLayout=new aa(n.layout)),n.paint)){this._transitionablePaint=new sl(n.paint);for(const a in t.paint)this.setPaintProperty(a,t.paint[a],{validate:!1});for(const a in t.layout)this.setLayoutProperty(a,t.layout[a],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new la(n.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,n,a={}){n!=null&&this._validate(Ih,`layers.${this.id}.layout.${t}`,t,n,a)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,n):this.visibility=n)}getPaintProperty(t){return t.endsWith(e)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,n,a={}){if(n!=null&&this._validate(kh,`layers.${this.id}.paint.${t}`,t,n,a))return!1;if(t.endsWith(e))return this._transitionablePaint.setTransition(t.slice(0,-11),n||void 0),!1;{const c=this._transitionablePaint._values[t],m=c.property.specification["property-type"]==="cross-faded-data-driven",g=c.value.isDataDriven(),y=c.value;this._transitionablePaint.setValue(t,n),this._handleSpecialPaintPropertyUpdate(t);const x=this._transitionablePaint._values[t].value;return x.isDataDriven()||g||m||this._handleOverridablePaintPropertyUpdate(t,y,x)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,n,a){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,n){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,n)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),gt(t,(n,a)=>!(n===void 0||a==="layout"&&!Object.keys(n).length||a==="paint"&&!Object.keys(n).length))}_validate(t,n,a,c,m={}){return(!m||m.validate!==!1)&&Fu(this,t.call(ws,{key:n,layerType:this.type,objectKey:a,value:c,styleSpec:me,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const n=this.paint.get(t);if(n instanceof _n&&Ws(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}}const l={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class u{constructor(t,n){this._structArray=t,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class p{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,n){return t._trim(),n&&(t.isTransferred=!0,n.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const n=Object.create(this.prototype);return n.arrayBuffer=t.arrayBuffer,n.length=t.length,n.capacity=t.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function v(r,t=1){let n=0,a=0;return{members:r.map(c=>{const m=l[c.type].BYTES_PER_ELEMENT,g=n=w(n,Math.max(t,m)),y=c.components||1;return a=Math.max(a,m),n+=m*y,{name:c.name,type:c.type,components:y,offset:g}}),size:w(n,Math.max(a,t)),alignment:t}}function w(r,t){return Math.ceil(r/t)*t}class T extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n){const a=this.length;return this.resize(a+1),this.emplace(a,t,n)}emplace(t,n,a){const c=2*t;return this.int16[c+0]=n,this.int16[c+1]=a,t}}T.prototype.bytesPerElement=4,$e("StructArrayLayout2i4",T);class P extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,a){const c=this.length;return this.resize(c+1),this.emplace(c,t,n,a)}emplace(t,n,a,c){const m=3*t;return this.int16[m+0]=n,this.int16[m+1]=a,this.int16[m+2]=c,t}}P.prototype.bytesPerElement=6,$e("StructArrayLayout3i6",P);class z extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,a,c){const m=this.length;return this.resize(m+1),this.emplace(m,t,n,a,c)}emplace(t,n,a,c,m){const g=4*t;return this.int16[g+0]=n,this.int16[g+1]=a,this.int16[g+2]=c,this.int16[g+3]=m,t}}z.prototype.bytesPerElement=8,$e("StructArrayLayout4i8",z);class M extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,a,c,m,g){const y=this.length;return this.resize(y+1),this.emplace(y,t,n,a,c,m,g)}emplace(t,n,a,c,m,g,y){const x=6*t;return this.int16[x+0]=n,this.int16[x+1]=a,this.int16[x+2]=c,this.int16[x+3]=m,this.int16[x+4]=g,this.int16[x+5]=y,t}}M.prototype.bytesPerElement=12,$e("StructArrayLayout2i4i12",M);class F extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,a,c,m,g){const y=this.length;return this.resize(y+1),this.emplace(y,t,n,a,c,m,g)}emplace(t,n,a,c,m,g,y){const x=4*t,k=8*t;return this.int16[x+0]=n,this.int16[x+1]=a,this.uint8[k+4]=c,this.uint8[k+5]=m,this.uint8[k+6]=g,this.uint8[k+7]=y,t}}F.prototype.bytesPerElement=8,$e("StructArrayLayout2i4ub8",F);class V extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n){const a=this.length;return this.resize(a+1),this.emplace(a,t,n)}emplace(t,n,a){const c=2*t;return this.float32[c+0]=n,this.float32[c+1]=a,t}}V.prototype.bytesPerElement=8,$e("StructArrayLayout2f8",V);class j extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,a,c,m,g,y,x,k,E){const C=this.length;return this.resize(C+1),this.emplace(C,t,n,a,c,m,g,y,x,k,E)}emplace(t,n,a,c,m,g,y,x,k,E,C){const A=10*t;return this.uint16[A+0]=n,this.uint16[A+1]=a,this.uint16[A+2]=c,this.uint16[A+3]=m,this.uint16[A+4]=g,this.uint16[A+5]=y,this.uint16[A+6]=x,this.uint16[A+7]=k,this.uint16[A+8]=E,this.uint16[A+9]=C,t}}j.prototype.bytesPerElement=20,$e("StructArrayLayout10ui20",j);class G extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,a,c,m,g,y,x,k,E,C,A){const R=this.length;return this.resize(R+1),this.emplace(R,t,n,a,c,m,g,y,x,k,E,C,A)}emplace(t,n,a,c,m,g,y,x,k,E,C,A,R){const B=12*t;return this.int16[B+0]=n,this.int16[B+1]=a,this.int16[B+2]=c,this.int16[B+3]=m,this.uint16[B+4]=g,this.uint16[B+5]=y,this.uint16[B+6]=x,this.uint16[B+7]=k,this.int16[B+8]=E,this.int16[B+9]=C,this.int16[B+10]=A,this.int16[B+11]=R,t}}G.prototype.bytesPerElement=24,$e("StructArrayLayout4i4ui4i24",G);class K extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,a){const c=this.length;return this.resize(c+1),this.emplace(c,t,n,a)}emplace(t,n,a,c){const m=3*t;return this.float32[m+0]=n,this.float32[m+1]=a,this.float32[m+2]=c,t}}K.prototype.bytesPerElement=12,$e("StructArrayLayout3f12",K);class Y extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint32[1*t+0]=n,t}}Y.prototype.bytesPerElement=4,$e("StructArrayLayout1ul4",Y);class Q extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,a,c,m,g,y,x,k){const E=this.length;return this.resize(E+1),this.emplace(E,t,n,a,c,m,g,y,x,k)}emplace(t,n,a,c,m,g,y,x,k,E){const C=10*t,A=5*t;return this.int16[C+0]=n,this.int16[C+1]=a,this.int16[C+2]=c,this.int16[C+3]=m,this.int16[C+4]=g,this.int16[C+5]=y,this.uint32[A+3]=x,this.uint16[C+8]=k,this.uint16[C+9]=E,t}}Q.prototype.bytesPerElement=20,$e("StructArrayLayout6i1ul2ui20",Q);class U extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,a,c,m,g){const y=this.length;return this.resize(y+1),this.emplace(y,t,n,a,c,m,g)}emplace(t,n,a,c,m,g,y){const x=6*t;return this.int16[x+0]=n,this.int16[x+1]=a,this.int16[x+2]=c,this.int16[x+3]=m,this.int16[x+4]=g,this.int16[x+5]=y,t}}U.prototype.bytesPerElement=12,$e("StructArrayLayout2i2i2i12",U);class ne extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,a,c,m){const g=this.length;return this.resize(g+1),this.emplace(g,t,n,a,c,m)}emplace(t,n,a,c,m,g){const y=4*t,x=8*t;return this.float32[y+0]=n,this.float32[y+1]=a,this.float32[y+2]=c,this.int16[x+6]=m,this.int16[x+7]=g,t}}ne.prototype.bytesPerElement=16,$e("StructArrayLayout2f1f2i16",ne);class oe extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,a,c,m,g){const y=this.length;return this.resize(y+1),this.emplace(y,t,n,a,c,m,g)}emplace(t,n,a,c,m,g,y){const x=16*t,k=4*t,E=8*t;return this.uint8[x+0]=n,this.uint8[x+1]=a,this.float32[k+1]=c,this.float32[k+2]=m,this.int16[E+6]=g,this.int16[E+7]=y,t}}oe.prototype.bytesPerElement=16,$e("StructArrayLayout2ub2f2i16",oe);class pe extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,a){const c=this.length;return this.resize(c+1),this.emplace(c,t,n,a)}emplace(t,n,a,c){const m=3*t;return this.uint16[m+0]=n,this.uint16[m+1]=a,this.uint16[m+2]=c,t}}pe.prototype.bytesPerElement=6,$e("StructArrayLayout3ui6",pe);class xe extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,a,c,m,g,y,x,k,E,C,A,R,B,O,$,X){const he=this.length;return this.resize(he+1),this.emplace(he,t,n,a,c,m,g,y,x,k,E,C,A,R,B,O,$,X)}emplace(t,n,a,c,m,g,y,x,k,E,C,A,R,B,O,$,X,he){const ee=24*t,ae=12*t,ge=48*t;return this.int16[ee+0]=n,this.int16[ee+1]=a,this.uint16[ee+2]=c,this.uint16[ee+3]=m,this.uint32[ae+2]=g,this.uint32[ae+3]=y,this.uint32[ae+4]=x,this.uint16[ee+10]=k,this.uint16[ee+11]=E,this.uint16[ee+12]=C,this.float32[ae+7]=A,this.float32[ae+8]=R,this.uint8[ge+36]=B,this.uint8[ge+37]=O,this.uint8[ge+38]=$,this.uint32[ae+10]=X,this.int16[ee+22]=he,t}}xe.prototype.bytesPerElement=48,$e("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",xe);class Se extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,a,c,m,g,y,x,k,E,C,A,R,B,O,$,X,he,ee,ae,ge,be,Ne,it,Be,Le,Ye,Ze){const Ue=this.length;return this.resize(Ue+1),this.emplace(Ue,t,n,a,c,m,g,y,x,k,E,C,A,R,B,O,$,X,he,ee,ae,ge,be,Ne,it,Be,Le,Ye,Ze)}emplace(t,n,a,c,m,g,y,x,k,E,C,A,R,B,O,$,X,he,ee,ae,ge,be,Ne,it,Be,Le,Ye,Ze,Ue){const ve=32*t,Je=16*t;return this.int16[ve+0]=n,this.int16[ve+1]=a,this.int16[ve+2]=c,this.int16[ve+3]=m,this.int16[ve+4]=g,this.int16[ve+5]=y,this.int16[ve+6]=x,this.int16[ve+7]=k,this.uint16[ve+8]=E,this.uint16[ve+9]=C,this.uint16[ve+10]=A,this.uint16[ve+11]=R,this.uint16[ve+12]=B,this.uint16[ve+13]=O,this.uint16[ve+14]=$,this.uint16[ve+15]=X,this.uint16[ve+16]=he,this.uint16[ve+17]=ee,this.uint16[ve+18]=ae,this.uint16[ve+19]=ge,this.uint16[ve+20]=be,this.uint16[ve+21]=Ne,this.uint16[ve+22]=it,this.uint32[Je+12]=Be,this.float32[Je+13]=Le,this.float32[Je+14]=Ye,this.uint16[ve+30]=Ze,this.uint16[ve+31]=Ue,t}}Se.prototype.bytesPerElement=64,$e("StructArrayLayout8i15ui1ul2f2ui64",Se);class Re extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.float32[1*t+0]=n,t}}Re.prototype.bytesPerElement=4,$e("StructArrayLayout1f4",Re);class Ve extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,a){const c=this.length;return this.resize(c+1),this.emplace(c,t,n,a)}emplace(t,n,a,c){const m=3*t;return this.uint16[6*t+0]=n,this.float32[m+1]=a,this.float32[m+2]=c,t}}Ve.prototype.bytesPerElement=12,$e("StructArrayLayout1ui2f12",Ve);class Me extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,a){const c=this.length;return this.resize(c+1),this.emplace(c,t,n,a)}emplace(t,n,a,c){const m=4*t;return this.uint32[2*t+0]=n,this.uint16[m+2]=a,this.uint16[m+3]=c,t}}Me.prototype.bytesPerElement=8,$e("StructArrayLayout1ul2ui8",Me);class ze extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n){const a=this.length;return this.resize(a+1),this.emplace(a,t,n)}emplace(t,n,a){const c=2*t;return this.uint16[c+0]=n,this.uint16[c+1]=a,t}}ze.prototype.bytesPerElement=4,$e("StructArrayLayout2ui4",ze);class We extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint16[1*t+0]=n,t}}We.prototype.bytesPerElement=2,$e("StructArrayLayout1ui2",We);class lt extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,a,c){const m=this.length;return this.resize(m+1),this.emplace(m,t,n,a,c)}emplace(t,n,a,c,m){const g=4*t;return this.float32[g+0]=n,this.float32[g+1]=a,this.float32[g+2]=c,this.float32[g+3]=m,t}}lt.prototype.bytesPerElement=16,$e("StructArrayLayout4f16",lt);class De extends u{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new re(this.anchorPointX,this.anchorPointY)}}De.prototype.size=20;class Oe extends Q{get(t){return new De(this,t)}}$e("CollisionBoxArray",Oe);class ot extends u{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}ot.prototype.size=48;class Gt extends xe{get(t){return new ot(this,t)}}$e("PlacedSymbolArray",Gt);class pt extends u{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}pt.prototype.size=64;class xt extends Se{get(t){return new pt(this,t)}}$e("SymbolInstanceArray",xt);class Ht extends Re{getoffsetX(t){return this.float32[1*t+0]}}$e("GlyphOffsetArray",Ht);class Dr extends P{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}$e("SymbolLineVertexArray",Dr);class Xi extends u{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Xi.prototype.size=12;class Wt extends Ve{get(t){return new Xi(this,t)}}$e("TextAnchorOffsetArray",Wt);class ni extends u{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}ni.prototype.size=8;class qr extends Me{get(t){return new ni(this,t)}}$e("FeatureIndexArray",qr);class Lr extends T{}class Gr extends T{}class yn extends T{}class oo extends M{}class ll extends F{}class ao extends V{}class Mi extends j{}class ul extends G{}class Zu extends K{}class Ai extends Y{}class Di extends U{}class Kn extends oe{}class Ki extends pe{}class Er extends ze{}const Rr=v([{name:"a_pos",components:2,type:"Int16"}],4),{members:vi}=Rr;class bt{constructor(t=[]){this.segments=t}prepareSegment(t,n,a,c){let m=this.segments[this.segments.length-1];return t>bt.MAX_VERTEX_ARRAY_LENGTH&&ir(`Max vertices per segment is ${bt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!m||m.vertexLength+t>bt.MAX_VERTEX_ARRAY_LENGTH||m.sortKey!==c)&&(m={vertexOffset:n.length,primitiveOffset:a.length,vertexLength:0,primitiveLength:0},c!==void 0&&(m.sortKey=c),this.segments.push(m)),m}get(){return this.segments}destroy(){for(const t of this.segments)for(const n in t.vaos)t.vaos[n].destroy()}static simpleSegment(t,n,a,c){return new bt([{vertexOffset:t,primitiveOffset:n,vertexLength:a,primitiveLength:c,vaos:{},sortKey:0}])}}function bs(r,t){return 256*(r=je(Math.floor(r),0,255))+je(Math.floor(t),0,255)}bt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,$e("SegmentVector",bt);const lo=v([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var uo={exports:{}},Mh={exports:{}};Mh.exports=function(r,t){var n,a,c,m,g,y,x,k;for(a=r.length-(n=3&r.length),c=t,g=3432918353,y=461845907,k=0;k<a;)x=255&r.charCodeAt(k)|(255&r.charCodeAt(++k))<<8|(255&r.charCodeAt(++k))<<16|(255&r.charCodeAt(++k))<<24,++k,c=27492+(65535&(m=5*(65535&(c=(c^=x=(65535&(x=(x=(65535&x)*g+(((x>>>16)*g&65535)<<16)&4294967295)<<15|x>>>17))*y+(((x>>>16)*y&65535)<<16)&4294967295)<<13|c>>>19))+((5*(c>>>16)&65535)<<16)&4294967295))+((58964+(m>>>16)&65535)<<16);switch(x=0,n){case 3:x^=(255&r.charCodeAt(k+2))<<16;case 2:x^=(255&r.charCodeAt(k+1))<<8;case 1:c^=x=(65535&(x=(x=(65535&(x^=255&r.charCodeAt(k)))*g+(((x>>>16)*g&65535)<<16)&4294967295)<<15|x>>>17))*y+(((x>>>16)*y&65535)<<16)&4294967295}return c^=r.length,c=2246822507*(65535&(c^=c>>>16))+((2246822507*(c>>>16)&65535)<<16)&4294967295,c=3266489909*(65535&(c^=c>>>13))+((3266489909*(c>>>16)&65535)<<16)&4294967295,(c^=c>>>16)>>>0};var Up=Mh.exports,Ah={exports:{}};Ah.exports=function(r,t){for(var n,a=r.length,c=t^a,m=0;a>=4;)n=1540483477*(65535&(n=255&r.charCodeAt(m)|(255&r.charCodeAt(++m))<<8|(255&r.charCodeAt(++m))<<16|(255&r.charCodeAt(++m))<<24))+((1540483477*(n>>>16)&65535)<<16),c=1540483477*(65535&c)+((1540483477*(c>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),a-=4,++m;switch(a){case 3:c^=(255&r.charCodeAt(m+2))<<16;case 2:c^=(255&r.charCodeAt(m+1))<<8;case 1:c=1540483477*(65535&(c^=255&r.charCodeAt(m)))+((1540483477*(c>>>16)&65535)<<16)}return c=1540483477*(65535&(c^=c>>>13))+((1540483477*(c>>>16)&65535)<<16),(c^=c>>>15)>>>0};var Yn=Up,Dh=Ah.exports;uo.exports=Yn,uo.exports.murmur3=Yn,uo.exports.murmur2=Dh;var cl=H(uo.exports);class ua{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,n,a,c){this.ids.push(hl(t)),this.positions.push(n,a,c)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const n=hl(t);let a=0,c=this.ids.length-1;for(;a<c;){const g=a+c>>1;this.ids[g]>=n?c=g:a=g+1}const m=[];for(;this.ids[a]===n;)m.push({index:this.positions[3*a],start:this.positions[3*a+1],end:this.positions[3*a+2]}),a++;return m}static serialize(t,n){const a=new Float64Array(t.ids),c=new Uint32Array(t.positions);return dl(a,c,0,a.length-1),n&&n.push(a.buffer,c.buffer),{ids:a,positions:c}}static deserialize(t){const n=new ua;return n.ids=t.ids,n.positions=t.positions,n.indexed=!0,n}}function hl(r){const t=+r;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:cl(String(r))}function dl(r,t,n,a){for(;n<a;){const c=r[n+a>>1];let m=n-1,g=a+1;for(;;){do m++;while(r[m]<c);do g--;while(r[g]>c);if(m>=g)break;co(r,m,g),co(t,3*m,3*g),co(t,3*m+1,3*g+1),co(t,3*m+2,3*g+2)}g-n<a-g?(dl(r,t,n,g),n=g+1):(dl(r,t,g+1,a),a=g)}}function co(r,t,n){const a=r[t];r[t]=r[n],r[n]=a}$e("FeaturePositionMap",ua);class ca{constructor(t,n){this.gl=t.gl,this.location=n}}class Lh extends ca{constructor(t,n){super(t,n),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class Hg extends ca{constructor(t,n){super(t,n),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class Wg extends ca{constructor(t,n){super(t,n),this.current=Bt.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const h1=new Float32Array(16);function $p(r){return[bs(255*r.r,255*r.g),bs(255*r.b,255*r.a)]}class qu{constructor(t,n,a){this.value=t,this.uniformNames=n.map(c=>`u_${c}`),this.type=a}setUniform(t,n,a){t.set(a.constantOr(this.value))}getBinding(t,n,a){return this.type==="color"?new Wg(t,n):new Lh(t,n)}}class pl{constructor(t,n){this.uniformNames=n.map(a=>`u_${a}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,n){this.pixelRatioFrom=n.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=n.tlbr,this.patternTo=t.tlbr}setUniform(t,n,a,c){const m=c==="u_pattern_to"?this.patternTo:c==="u_pattern_from"?this.patternFrom:c==="u_pixel_ratio_to"?this.pixelRatioTo:c==="u_pixel_ratio_from"?this.pixelRatioFrom:null;m&&t.set(m)}getBinding(t,n,a){return a.substr(0,9)==="u_pattern"?new Hg(t,n):new Lh(t,n)}}class Ss{constructor(t,n,a,c){this.expression=t,this.type=a,this.maxValue=0,this.paintVertexAttributes=n.map(m=>({name:`a_${m}`,type:"Float32",components:a==="color"?2:1,offset:0})),this.paintVertexArray=new c}populatePaintArray(t,n,a,c,m){const g=this.paintVertexArray.length,y=this.expression.evaluate(new qt(0),n,{},c,[],m);this.paintVertexArray.resize(t),this._setPaintValue(g,t,y)}updatePaintArray(t,n,a,c){const m=this.expression.evaluate({zoom:0},a,c);this._setPaintValue(t,n,m)}_setPaintValue(t,n,a){if(this.type==="color"){const c=$p(a);for(let m=t;m<n;m++)this.paintVertexArray.emplace(m,c[0],c[1])}else{for(let c=t;c<n;c++)this.paintVertexArray.emplace(c,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class An{constructor(t,n,a,c,m,g){this.expression=t,this.uniformNames=n.map(y=>`u_${y}_t`),this.type=a,this.useIntegerZoom=c,this.zoom=m,this.maxValue=0,this.paintVertexAttributes=n.map(y=>({name:`a_${y}`,type:"Float32",components:a==="color"?4:2,offset:0})),this.paintVertexArray=new g}populatePaintArray(t,n,a,c,m){const g=this.expression.evaluate(new qt(this.zoom),n,{},c,[],m),y=this.expression.evaluate(new qt(this.zoom+1),n,{},c,[],m),x=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(x,t,g,y)}updatePaintArray(t,n,a,c){const m=this.expression.evaluate({zoom:this.zoom},a,c),g=this.expression.evaluate({zoom:this.zoom+1},a,c);this._setPaintValue(t,n,m,g)}_setPaintValue(t,n,a,c){if(this.type==="color"){const m=$p(a),g=$p(c);for(let y=t;y<n;y++)this.paintVertexArray.emplace(y,m[0],m[1],g[0],g[1])}else{for(let m=t;m<n;m++)this.paintVertexArray.emplace(m,a,c);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(c))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,n){const a=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,c=je(this.expression.interpolationFactor(a,this.zoom,this.zoom+1),0,1);t.set(c)}getBinding(t,n,a){return new Lh(t,n)}}class ho{constructor(t,n,a,c,m,g){this.expression=t,this.type=n,this.useIntegerZoom=a,this.zoom=c,this.layerId=g,this.zoomInPaintVertexArray=new m,this.zoomOutPaintVertexArray=new m}populatePaintArray(t,n,a){const c=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(c,t,n.patterns&&n.patterns[this.layerId],a)}updatePaintArray(t,n,a,c,m){this._setPaintValues(t,n,a.patterns&&a.patterns[this.layerId],m)}_setPaintValues(t,n,a,c){if(!c||!a)return;const{min:m,mid:g,max:y}=a,x=c[m],k=c[g],E=c[y];if(x&&k&&E)for(let C=t;C<n;C++)this.zoomInPaintVertexArray.emplace(C,k.tl[0],k.tl[1],k.br[0],k.br[1],x.tl[0],x.tl[1],x.br[0],x.br[1],k.pixelRatio,x.pixelRatio),this.zoomOutPaintVertexArray.emplace(C,k.tl[0],k.tl[1],k.br[0],k.br[1],E.tl[0],E.tl[1],E.br[0],E.br[1],k.pixelRatio,E.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,lo.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,lo.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Xg{constructor(t,n,a){this.binders={},this._buffers=[];const c=[];for(const m in t.paint._values){if(!a(m))continue;const g=t.paint.get(m);if(!(g instanceof _n&&Ws(g.property.specification)))continue;const y=d1(m,t.type),x=g.value,k=g.property.specification.type,E=g.property.useIntegerZoom,C=g.property.specification["property-type"],A=C==="cross-faded"||C==="cross-faded-data-driven";if(x.kind==="constant")this.binders[m]=A?new pl(x.value,y):new qu(x.value,y,k),c.push(`/u_${m}`);else if(x.kind==="source"||A){const R=Kg(m,k,"source");this.binders[m]=A?new ho(x,k,E,n,R,t.id):new Ss(x,y,k,R),c.push(`/a_${m}`)}else{const R=Kg(m,k,"composite");this.binders[m]=new An(x,y,k,E,n,R),c.push(`/z_${m}`)}}this.cacheKey=c.sort().join("")}getMaxValue(t){const n=this.binders[t];return n instanceof Ss||n instanceof An?n.maxValue:0}populatePaintArrays(t,n,a,c,m){for(const g in this.binders){const y=this.binders[g];(y instanceof Ss||y instanceof An||y instanceof ho)&&y.populatePaintArray(t,n,a,c,m)}}setConstantPatternPositions(t,n){for(const a in this.binders){const c=this.binders[a];c instanceof pl&&c.setConstantPatternPositions(t,n)}}updatePaintArrays(t,n,a,c,m){let g=!1;for(const y in t){const x=n.getPositions(y);for(const k of x){const E=a.feature(k.index);for(const C in this.binders){const A=this.binders[C];if((A instanceof Ss||A instanceof An||A instanceof ho)&&A.expression.isStateDependent===!0){const R=c.paint.get(C);A.expression=R.value,A.updatePaintArray(k.start,k.end,E,t[y],m),g=!0}}}}return g}defines(){const t=[];for(const n in this.binders){const a=this.binders[n];(a instanceof qu||a instanceof pl)&&t.push(...a.uniformNames.map(c=>`#define HAS_UNIFORM_${c}`))}return t}getBinderAttributes(){const t=[];for(const n in this.binders){const a=this.binders[n];if(a instanceof Ss||a instanceof An)for(let c=0;c<a.paintVertexAttributes.length;c++)t.push(a.paintVertexAttributes[c].name);else if(a instanceof ho)for(let c=0;c<lo.members.length;c++)t.push(lo.members[c].name)}return t}getBinderUniforms(){const t=[];for(const n in this.binders){const a=this.binders[n];if(a instanceof qu||a instanceof pl||a instanceof An)for(const c of a.uniformNames)t.push(c)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,n){const a=[];for(const c in this.binders){const m=this.binders[c];if(m instanceof qu||m instanceof pl||m instanceof An){for(const g of m.uniformNames)if(n[g]){const y=m.getBinding(t,n[g],g);a.push({name:g,property:c,binding:y})}}}return a}setUniforms(t,n,a,c){for(const{name:m,property:g,binding:y}of n)this.binders[g].setUniform(y,c,a.get(g),m)}updatePaintBuffers(t){this._buffers=[];for(const n in this.binders){const a=this.binders[n];if(t&&a instanceof ho){const c=t.fromScale===2?a.zoomInPaintVertexBuffer:a.zoomOutPaintVertexBuffer;c&&this._buffers.push(c)}else(a instanceof Ss||a instanceof An)&&a.paintVertexBuffer&&this._buffers.push(a.paintVertexBuffer)}}upload(t){for(const n in this.binders){const a=this.binders[n];(a instanceof Ss||a instanceof An||a instanceof ho)&&a.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const n=this.binders[t];(n instanceof Ss||n instanceof An||n instanceof ho)&&n.destroy()}}}class ha{constructor(t,n,a=()=>!0){this.programConfigurations={};for(const c of t)this.programConfigurations[c.id]=new Xg(c,n,a);this.needsUpload=!1,this._featureMap=new ua,this._bufferOffset=0}populatePaintArrays(t,n,a,c,m,g){for(const y in this.programConfigurations)this.programConfigurations[y].populatePaintArrays(t,n,c,m,g);n.id!==void 0&&this._featureMap.add(n.id,a,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,n,a,c){for(const m of a)this.needsUpload=this.programConfigurations[m.id].updatePaintArrays(t,this._featureMap,n,m,c)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function d1(r,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[r]||[r.replace(`${t}-`,"").replace(/-/g,"_")]}function Kg(r,t,n){const a={color:{source:V,composite:lt},number:{source:Re,composite:V}},c=function(m){return{"line-pattern":{source:Mi,composite:Mi},"fill-pattern":{source:Mi,composite:Mi},"fill-extrusion-pattern":{source:Mi,composite:Mi}}[m]}(r);return c&&c[n]||a[t][n]}$e("ConstantBinder",qu),$e("CrossFadedConstantBinder",pl),$e("SourceExpressionBinder",Ss),$e("CrossFadedCompositeBinder",ho),$e("CompositeExpressionBinder",An),$e("ProgramConfiguration",Xg,{omit:["_buffers"]}),$e("ProgramConfigurationSet",ha);const mr=8192,Zp=Math.pow(2,14)-1,Yg=-Zp-1;function da(r){const t=mr/r.extent,n=r.loadGeometry();for(let a=0;a<n.length;a++){const c=n[a];for(let m=0;m<c.length;m++){const g=c[m],y=Math.round(g.x*t),x=Math.round(g.y*t);g.x=je(y,Yg,Zp),g.y=je(x,Yg,Zp),(y<g.x||y>g.x+1||x<g.y||x>g.y+1)&&ir("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return n}function pa(r,t){return{type:r.type,id:r.id,properties:r.properties,geometry:t?da(r):[]}}function Rh(r,t,n,a,c){r.emplaceBack(2*t+(a+1)/2,2*n+(c+1)/2)}class qp{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Gr,this.indexArray=new Ki,this.segments=new bt,this.programConfigurations=new ha(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,a){const c=this.layers[0],m=[];let g=null,y=!1;c.type==="circle"&&(g=c.layout.get("circle-sort-key"),y=!g.isConstant());for(const{feature:x,id:k,index:E,sourceLayerIndex:C}of t){const A=this.layers[0]._featureFilter.needGeometry,R=pa(x,A);if(!this.layers[0]._featureFilter.filter(new qt(this.zoom),R,a))continue;const B=y?g.evaluate(R,{},a):void 0,O={id:k,properties:x.properties,type:x.type,sourceLayerIndex:C,index:E,geometry:A?R.geometry:da(x),patterns:{},sortKey:B};m.push(O)}y&&m.sort((x,k)=>x.sortKey-k.sortKey);for(const x of m){const{geometry:k,index:E,sourceLayerIndex:C}=x,A=t[E].feature;this.addFeature(x,k,E,a),n.featureIndex.insert(A,k,E,C,this.index)}}update(t,n,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,vi),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,n,a,c){for(const m of n)for(const g of m){const y=g.x,x=g.y;if(y<0||y>=mr||x<0||x>=mr)continue;const k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),E=k.vertexLength;Rh(this.layoutVertexArray,y,x,-1,-1),Rh(this.layoutVertexArray,y,x,1,-1),Rh(this.layoutVertexArray,y,x,1,1),Rh(this.layoutVertexArray,y,x,-1,1),this.indexArray.emplaceBack(E,E+1,E+2),this.indexArray.emplaceBack(E,E+3,E+2),k.vertexLength+=4,k.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,{},c)}}function Jg(r,t){for(let n=0;n<r.length;n++)if(fl(t,r[n]))return!0;for(let n=0;n<t.length;n++)if(fl(r,t[n]))return!0;return!!Gp(r,t)}function p1(r,t,n){return!!fl(r,t)||!!Hp(t,r,n)}function Qg(r,t){if(r.length===1)return t_(t,r[0]);for(let n=0;n<t.length;n++){const a=t[n];for(let c=0;c<a.length;c++)if(fl(r,a[c]))return!0}for(let n=0;n<r.length;n++)if(t_(t,r[n]))return!0;for(let n=0;n<t.length;n++)if(Gp(r,t[n]))return!0;return!1}function f1(r,t,n){if(r.length>1){if(Gp(r,t))return!0;for(let a=0;a<t.length;a++)if(Hp(t[a],r,n))return!0}for(let a=0;a<r.length;a++)if(Hp(r[a],t,n))return!0;return!1}function Gp(r,t){if(r.length===0||t.length===0)return!1;for(let n=0;n<r.length-1;n++){const a=r[n],c=r[n+1];for(let m=0;m<t.length-1;m++)if(m1(a,c,t[m],t[m+1]))return!0}return!1}function m1(r,t,n,a){return vr(r,n,a)!==vr(t,n,a)&&vr(r,t,n)!==vr(r,t,a)}function Hp(r,t,n){const a=n*n;if(t.length===1)return r.distSqr(t[0])<a;for(let c=1;c<t.length;c++)if(e_(r,t[c-1],t[c])<a)return!0;return!1}function e_(r,t,n){const a=t.distSqr(n);if(a===0)return r.distSqr(t);const c=((r.x-t.x)*(n.x-t.x)+(r.y-t.y)*(n.y-t.y))/a;return r.distSqr(c<0?t:c>1?n:n.sub(t)._mult(c)._add(t))}function t_(r,t){let n,a,c,m=!1;for(let g=0;g<r.length;g++){n=r[g];for(let y=0,x=n.length-1;y<n.length;x=y++)a=n[y],c=n[x],a.y>t.y!=c.y>t.y&&t.x<(c.x-a.x)*(t.y-a.y)/(c.y-a.y)+a.x&&(m=!m)}return m}function fl(r,t){let n=!1;for(let a=0,c=r.length-1;a<r.length;c=a++){const m=r[a],g=r[c];m.y>t.y!=g.y>t.y&&t.x<(g.x-m.x)*(t.y-m.y)/(g.y-m.y)+m.x&&(n=!n)}return n}function g1(r,t,n){const a=n[0],c=n[2];if(r.x<a.x&&t.x<a.x||r.x>c.x&&t.x>c.x||r.y<a.y&&t.y<a.y||r.y>c.y&&t.y>c.y)return!1;const m=vr(r,t,n[0]);return m!==vr(r,t,n[1])||m!==vr(r,t,n[2])||m!==vr(r,t,n[3])}function Gu(r,t,n){const a=t.paint.get(r).value;return a.kind==="constant"?a.value:n.programConfigurations.get(t.id).getMaxValue(r)}function Fh(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function Bh(r,t,n,a,c){if(!t[0]&&!t[1])return r;const m=re.convert(t)._mult(c);n==="viewport"&&m._rotate(-a);const g=[];for(let y=0;y<r.length;y++)g.push(r[y].sub(m));return g}let r_,i_;$e("CircleBucket",qp,{omit:["layers"]});var _1={get paint(){return i_=i_||new f({"circle-radius":new nt(me.paint_circle["circle-radius"]),"circle-color":new nt(me.paint_circle["circle-color"]),"circle-blur":new nt(me.paint_circle["circle-blur"]),"circle-opacity":new nt(me.paint_circle["circle-opacity"]),"circle-translate":new He(me.paint_circle["circle-translate"]),"circle-translate-anchor":new He(me.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new He(me.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new He(me.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new nt(me.paint_circle["circle-stroke-width"]),"circle-stroke-color":new nt(me.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new nt(me.paint_circle["circle-stroke-opacity"])})},get layout(){return r_=r_||new f({"circle-sort-key":new nt(me.layout_circle["circle-sort-key"])})}},si=1e-6,ml=typeof Float32Array<"u"?Float32Array:Array;function Wp(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function n_(r,t,n){var a=t[0],c=t[1],m=t[2],g=t[3],y=t[4],x=t[5],k=t[6],E=t[7],C=t[8],A=t[9],R=t[10],B=t[11],O=t[12],$=t[13],X=t[14],he=t[15],ee=n[0],ae=n[1],ge=n[2],be=n[3];return r[0]=ee*a+ae*y+ge*C+be*O,r[1]=ee*c+ae*x+ge*A+be*$,r[2]=ee*m+ae*k+ge*R+be*X,r[3]=ee*g+ae*E+ge*B+be*he,r[4]=(ee=n[4])*a+(ae=n[5])*y+(ge=n[6])*C+(be=n[7])*O,r[5]=ee*c+ae*x+ge*A+be*$,r[6]=ee*m+ae*k+ge*R+be*X,r[7]=ee*g+ae*E+ge*B+be*he,r[8]=(ee=n[8])*a+(ae=n[9])*y+(ge=n[10])*C+(be=n[11])*O,r[9]=ee*c+ae*x+ge*A+be*$,r[10]=ee*m+ae*k+ge*R+be*X,r[11]=ee*g+ae*E+ge*B+be*he,r[12]=(ee=n[12])*a+(ae=n[13])*y+(ge=n[14])*C+(be=n[15])*O,r[13]=ee*c+ae*x+ge*A+be*$,r[14]=ee*m+ae*k+ge*R+be*X,r[15]=ee*g+ae*E+ge*B+be*he,r}Math.hypot||(Math.hypot=function(){for(var r=0,t=arguments.length;t--;)r+=arguments[t]*arguments[t];return Math.sqrt(r)});var Hu,y1=n_;function Oh(r,t,n){var a=t[0],c=t[1],m=t[2],g=t[3];return r[0]=n[0]*a+n[4]*c+n[8]*m+n[12]*g,r[1]=n[1]*a+n[5]*c+n[9]*m+n[13]*g,r[2]=n[2]*a+n[6]*c+n[10]*m+n[14]*g,r[3]=n[3]*a+n[7]*c+n[11]*m+n[15]*g,r}Hu=new ml(4),ml!=Float32Array&&(Hu[0]=0,Hu[1]=0,Hu[2]=0,Hu[3]=0);class v1 extends s{constructor(t){super(t,_1)}createBucket(t){return new qp(t)}queryRadius(t){const n=t;return Gu("circle-radius",this,n)+Gu("circle-stroke-width",this,n)+Fh(this.paint.get("circle-translate"))}queryIntersectsFeature(t,n,a,c,m,g,y,x){const k=Bh(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),g.angle,y),E=this.paint.get("circle-radius").evaluate(n,a)+this.paint.get("circle-stroke-width").evaluate(n,a),C=this.paint.get("circle-pitch-alignment")==="map",A=C?k:function(B,O){return B.map($=>s_($,O))}(k,x),R=C?E*y:E;for(const B of c)for(const O of B){const $=C?O:s_(O,x);let X=R;const he=Oh([],[O.x,O.y,0,1],x);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?X*=he[3]/g.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(X*=g.cameraToCenterDistance/he[3]),p1(A,$,X))return!0}return!1}}function s_(r,t){const n=Oh([],[r.x,r.y,0,1],t);return new re(n[0]/n[3],n[1]/n[3])}class o_ extends qp{}let a_;$e("HeatmapBucket",o_,{omit:["layers"]});var x1={get paint(){return a_=a_||new f({"heatmap-radius":new nt(me.paint_heatmap["heatmap-radius"]),"heatmap-weight":new nt(me.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new He(me.paint_heatmap["heatmap-intensity"]),"heatmap-color":new $u(me.paint_heatmap["heatmap-color"]),"heatmap-opacity":new He(me.paint_heatmap["heatmap-opacity"])})}};function Xp(r,{width:t,height:n},a,c){if(c){if(c instanceof Uint8ClampedArray)c=new Uint8Array(c.buffer);else if(c.length!==t*n*a)throw new RangeError(`mismatched image size. expected: ${c.length} but got: ${t*n*a}`)}else c=new Uint8Array(t*n*a);return r.width=t,r.height=n,r.data=c,r}function l_(r,{width:t,height:n},a){if(t===r.width&&n===r.height)return;const c=Xp({},{width:t,height:n},a);Kp(r,c,{x:0,y:0},{x:0,y:0},{width:Math.min(r.width,t),height:Math.min(r.height,n)},a),r.width=t,r.height=n,r.data=c.data}function Kp(r,t,n,a,c,m){if(c.width===0||c.height===0)return t;if(c.width>r.width||c.height>r.height||n.x>r.width-c.width||n.y>r.height-c.height)throw new RangeError("out of range source coordinates for image copy");if(c.width>t.width||c.height>t.height||a.x>t.width-c.width||a.y>t.height-c.height)throw new RangeError("out of range destination coordinates for image copy");const g=r.data,y=t.data;if(g===y)throw new Error("srcData equals dstData, so image is already copied");for(let x=0;x<c.height;x++){const k=((n.y+x)*r.width+n.x)*m,E=((a.y+x)*t.width+a.x)*m;for(let C=0;C<c.width*m;C++)y[E+C]=g[k+C]}return t}class Wu{constructor(t,n){Xp(this,t,1,n)}resize(t){l_(this,t,1)}clone(){return new Wu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,a,c,m){Kp(t,n,a,c,m,1)}}class Yi{constructor(t,n){Xp(this,t,4,n)}resize(t){l_(this,t,4)}replace(t,n){n?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Yi({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,a,c,m){Kp(t,n,a,c,m,4)}}function u_(r){const t={},n=r.resolution||256,a=r.clips?r.clips.length:1,c=r.image||new Yi({width:n,height:a});if(Math.log(n)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${n}`);const m=(g,y,x)=>{t[r.evaluationKey]=x;const k=r.expression.evaluate(t);c.data[g+y+0]=Math.floor(255*k.r/k.a),c.data[g+y+1]=Math.floor(255*k.g/k.a),c.data[g+y+2]=Math.floor(255*k.b/k.a),c.data[g+y+3]=Math.floor(255*k.a)};if(r.clips)for(let g=0,y=0;g<a;++g,y+=4*n)for(let x=0,k=0;x<n;x++,k+=4){const E=x/(n-1),{start:C,end:A}=r.clips[g];m(y,k,C*(1-E)+A*E)}else for(let g=0,y=0;g<n;g++,y+=4)m(0,y,g/(n-1));return c}$e("AlphaImage",Wu),$e("RGBAImage",Yi);const Yp="big-fb";class w1 extends s{createBucket(t){return new o_(t)}constructor(t){super(t,x1),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=u_({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(Yp)&&this.heatmapFbos.delete(Yp)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let c_;var b1={get paint(){return c_=c_||new f({"hillshade-illumination-direction":new He(me.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new He(me.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new He(me.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new He(me.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new He(me.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new He(me.paint_hillshade["hillshade-accent-color"])})}};class S1 extends s{constructor(t){super(t,b1)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const T1=v([{name:"a_pos",components:2,type:"Int16"}],4),{members:k1}=T1;function h_(r,t,n=2){const a=t&&t.length,c=a?t[0]*n:r.length;let m=d_(r,0,c,n,!0);const g=[];if(!m||m.next===m.prev)return g;let y,x,k;if(a&&(m=function(E,C,A,R){const B=[];for(let O=0,$=C.length;O<$;O++){const X=d_(E,C[O]*R,O<$-1?C[O+1]*R:E.length,R,!1);X===X.next&&(X.steiner=!0),B.push(D1(X))}B.sort(z1);for(let O=0;O<B.length;O++)A=M1(B[O],A);return A}(r,t,m,n)),r.length>80*n){y=1/0,x=1/0;let E=-1/0,C=-1/0;for(let A=n;A<c;A+=n){const R=r[A],B=r[A+1];R<y&&(y=R),B<x&&(x=B),R>E&&(E=R),B>C&&(C=B)}k=Math.max(E-y,C-x),k=k!==0?32767/k:0}return Xu(m,g,n,y,x,k,0),g}function d_(r,t,n,a,c){let m;if(c===function(g,y,x,k){let E=0;for(let C=y,A=x-k;C<x;C+=k)E+=(g[A]-g[C])*(g[C+1]+g[A+1]),A=C;return E}(r,t,n,a)>0)for(let g=t;g<n;g+=a)m=m_(g/a|0,r[g],r[g+1],m);else for(let g=n-a;g>=t;g-=a)m=m_(g/a|0,r[g],r[g+1],m);return m&&Nh(m,m.next)&&(Yu(m),m=m.next),m}function fa(r,t){if(!r)return r;t||(t=r);let n,a=r;do if(n=!1,a.steiner||!Nh(a,a.next)&&ur(a.prev,a,a.next)!==0)a=a.next;else{if(Yu(a),a=t=a.prev,a===a.next)break;n=!0}while(n||a!==t);return t}function Xu(r,t,n,a,c,m,g){if(!r)return;!g&&m&&function(x,k,E,C){let A=x;do A.z===0&&(A.z=Jp(A.x,A.y,k,E,C)),A.prevZ=A.prev,A.nextZ=A.next,A=A.next;while(A!==x);A.prevZ.nextZ=null,A.prevZ=null,function(R){let B,O=1;do{let $,X=R;R=null;let he=null;for(B=0;X;){B++;let ee=X,ae=0;for(let be=0;be<O&&(ae++,ee=ee.nextZ,ee);be++);let ge=O;for(;ae>0||ge>0&&ee;)ae!==0&&(ge===0||!ee||X.z<=ee.z)?($=X,X=X.nextZ,ae--):($=ee,ee=ee.nextZ,ge--),he?he.nextZ=$:R=$,$.prevZ=he,he=$;X=ee}he.nextZ=null,O*=2}while(B>1)}(A)}(r,a,c,m);let y=r;for(;r.prev!==r.next;){const x=r.prev,k=r.next;if(m?E1(r,a,c,m):I1(r))t.push(x.i,r.i,k.i),Yu(r),r=k.next,y=k.next;else if((r=k)===y){g?g===1?Xu(r=P1(fa(r),t),t,n,a,c,m,2):g===2&&C1(r,t,n,a,c,m):Xu(fa(r),t,n,a,c,m,1);break}}}function I1(r){const t=r.prev,n=r,a=r.next;if(ur(t,n,a)>=0)return!1;const c=t.x,m=n.x,g=a.x,y=t.y,x=n.y,k=a.y,E=c<m?c<g?c:g:m<g?m:g,C=y<x?y<k?y:k:x<k?x:k,A=c>m?c>g?c:g:m>g?m:g,R=y>x?y>k?y:k:x>k?x:k;let B=a.next;for(;B!==t;){if(B.x>=E&&B.x<=A&&B.y>=C&&B.y<=R&&gl(c,y,m,x,g,k,B.x,B.y)&&ur(B.prev,B,B.next)>=0)return!1;B=B.next}return!0}function E1(r,t,n,a){const c=r.prev,m=r,g=r.next;if(ur(c,m,g)>=0)return!1;const y=c.x,x=m.x,k=g.x,E=c.y,C=m.y,A=g.y,R=y<x?y<k?y:k:x<k?x:k,B=E<C?E<A?E:A:C<A?C:A,O=y>x?y>k?y:k:x>k?x:k,$=E>C?E>A?E:A:C>A?C:A,X=Jp(R,B,t,n,a),he=Jp(O,$,t,n,a);let ee=r.prevZ,ae=r.nextZ;for(;ee&&ee.z>=X&&ae&&ae.z<=he;){if(ee.x>=R&&ee.x<=O&&ee.y>=B&&ee.y<=$&&ee!==c&&ee!==g&&gl(y,E,x,C,k,A,ee.x,ee.y)&&ur(ee.prev,ee,ee.next)>=0||(ee=ee.prevZ,ae.x>=R&&ae.x<=O&&ae.y>=B&&ae.y<=$&&ae!==c&&ae!==g&&gl(y,E,x,C,k,A,ae.x,ae.y)&&ur(ae.prev,ae,ae.next)>=0))return!1;ae=ae.nextZ}for(;ee&&ee.z>=X;){if(ee.x>=R&&ee.x<=O&&ee.y>=B&&ee.y<=$&&ee!==c&&ee!==g&&gl(y,E,x,C,k,A,ee.x,ee.y)&&ur(ee.prev,ee,ee.next)>=0)return!1;ee=ee.prevZ}for(;ae&&ae.z<=he;){if(ae.x>=R&&ae.x<=O&&ae.y>=B&&ae.y<=$&&ae!==c&&ae!==g&&gl(y,E,x,C,k,A,ae.x,ae.y)&&ur(ae.prev,ae,ae.next)>=0)return!1;ae=ae.nextZ}return!0}function P1(r,t){let n=r;do{const a=n.prev,c=n.next.next;!Nh(a,c)&&p_(a,n,n.next,c)&&Ku(a,c)&&Ku(c,a)&&(t.push(a.i,n.i,c.i),Yu(n),Yu(n.next),n=r=c),n=n.next}while(n!==r);return fa(n)}function C1(r,t,n,a,c,m){let g=r;do{let y=g.next.next;for(;y!==g.prev;){if(g.i!==y.i&&L1(g,y)){let x=f_(g,y);return g=fa(g,g.next),x=fa(x,x.next),Xu(g,t,n,a,c,m,0),void Xu(x,t,n,a,c,m,0)}y=y.next}g=g.next}while(g!==r)}function z1(r,t){return r.x-t.x}function M1(r,t){const n=function(c,m){let g=m;const y=c.x,x=c.y;let k,E=-1/0;do{if(x<=g.y&&x>=g.next.y&&g.next.y!==g.y){const O=g.x+(x-g.y)*(g.next.x-g.x)/(g.next.y-g.y);if(O<=y&&O>E&&(E=O,k=g.x<g.next.x?g:g.next,O===y))return k}g=g.next}while(g!==m);if(!k)return null;const C=k,A=k.x,R=k.y;let B=1/0;g=k;do{if(y>=g.x&&g.x>=A&&y!==g.x&&gl(x<R?y:E,x,A,R,x<R?E:y,x,g.x,g.y)){const O=Math.abs(x-g.y)/(y-g.x);Ku(g,c)&&(O<B||O===B&&(g.x>k.x||g.x===k.x&&A1(k,g)))&&(k=g,B=O)}g=g.next}while(g!==C);return k}(r,t);if(!n)return t;const a=f_(n,r);return fa(a,a.next),fa(n,n.next)}function A1(r,t){return ur(r.prev,r,t.prev)<0&&ur(t.next,r,r.next)<0}function Jp(r,t,n,a,c){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-n)*c|0)|r<<8))|r<<4))|r<<2))|r<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-a)*c|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function D1(r){let t=r,n=r;do(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next;while(t!==r);return n}function gl(r,t,n,a,c,m,g,y){return(c-g)*(t-y)>=(r-g)*(m-y)&&(r-g)*(a-y)>=(n-g)*(t-y)&&(n-g)*(m-y)>=(c-g)*(a-y)}function L1(r,t){return r.next.i!==t.i&&r.prev.i!==t.i&&!function(n,a){let c=n;do{if(c.i!==n.i&&c.next.i!==n.i&&c.i!==a.i&&c.next.i!==a.i&&p_(c,c.next,n,a))return!0;c=c.next}while(c!==n);return!1}(r,t)&&(Ku(r,t)&&Ku(t,r)&&function(n,a){let c=n,m=!1;const g=(n.x+a.x)/2,y=(n.y+a.y)/2;do c.y>y!=c.next.y>y&&c.next.y!==c.y&&g<(c.next.x-c.x)*(y-c.y)/(c.next.y-c.y)+c.x&&(m=!m),c=c.next;while(c!==n);return m}(r,t)&&(ur(r.prev,r,t.prev)||ur(r,t.prev,t))||Nh(r,t)&&ur(r.prev,r,r.next)>0&&ur(t.prev,t,t.next)>0)}function ur(r,t,n){return(t.y-r.y)*(n.x-t.x)-(t.x-r.x)*(n.y-t.y)}function Nh(r,t){return r.x===t.x&&r.y===t.y}function p_(r,t,n,a){const c=jh(ur(r,t,n)),m=jh(ur(r,t,a)),g=jh(ur(n,a,r)),y=jh(ur(n,a,t));return c!==m&&g!==y||!(c!==0||!Vh(r,n,t))||!(m!==0||!Vh(r,a,t))||!(g!==0||!Vh(n,r,a))||!(y!==0||!Vh(n,t,a))}function Vh(r,t,n){return t.x<=Math.max(r.x,n.x)&&t.x>=Math.min(r.x,n.x)&&t.y<=Math.max(r.y,n.y)&&t.y>=Math.min(r.y,n.y)}function jh(r){return r>0?1:r<0?-1:0}function Ku(r,t){return ur(r.prev,r,r.next)<0?ur(r,t,r.next)>=0&&ur(r,r.prev,t)>=0:ur(r,t,r.prev)<0||ur(r,r.next,t)<0}function f_(r,t){const n=Qp(r.i,r.x,r.y),a=Qp(t.i,t.x,t.y),c=r.next,m=t.prev;return r.next=t,t.prev=r,n.next=c,c.prev=n,a.next=n,n.prev=a,m.next=a,a.prev=m,a}function m_(r,t,n,a){const c=Qp(r,t,n);return a?(c.next=a.next,c.prev=a,a.next.prev=c,a.next=c):(c.prev=c,c.next=c),c}function Yu(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function Qp(r,t,n){return{i:r,x:t,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function ef(r,t,n){const a=n.patternDependencies;let c=!1;for(const m of t){const g=m.paint.get(`${r}-pattern`);g.isConstant()||(c=!0);const y=g.constantOr(null);y&&(c=!0,a[y.to]=!0,a[y.from]=!0)}return c}function tf(r,t,n,a,c){const m=c.patternDependencies;for(const g of t){const y=g.paint.get(`${r}-pattern`).value;if(y.kind!=="constant"){let x=y.evaluate({zoom:a-1},n,{},c.availableImages),k=y.evaluate({zoom:a},n,{},c.availableImages),E=y.evaluate({zoom:a+1},n,{},c.availableImages);x=x&&x.name?x.name:x,k=k&&k.name?k.name:k,E=E&&E.name?E.name:E,m[x]=!0,m[k]=!0,m[E]=!0,n.patterns[g.id]={min:x,mid:k,max:E}}}return n}class rf{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new yn,this.indexArray=new Ki,this.indexArray2=new Er,this.programConfigurations=new ha(t.layers,t.zoom),this.segments=new bt,this.segments2=new bt,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,a){this.hasPattern=ef("fill",this.layers,n);const c=this.layers[0].layout.get("fill-sort-key"),m=!c.isConstant(),g=[];for(const{feature:y,id:x,index:k,sourceLayerIndex:E}of t){const C=this.layers[0]._featureFilter.needGeometry,A=pa(y,C);if(!this.layers[0]._featureFilter.filter(new qt(this.zoom),A,a))continue;const R=m?c.evaluate(A,{},a,n.availableImages):void 0,B={id:x,properties:y.properties,type:y.type,sourceLayerIndex:E,index:k,geometry:C?A.geometry:da(y),patterns:{},sortKey:R};g.push(B)}m&&g.sort((y,x)=>y.sortKey-x.sortKey);for(const y of g){const{geometry:x,index:k,sourceLayerIndex:E}=y;if(this.hasPattern){const C=tf("fill",this.layers,y,this.zoom,n);this.patternFeatures.push(C)}else this.addFeature(y,x,k,a,{});n.featureIndex.insert(t[k].feature,x,k,E,this.index)}}update(t,n,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,a)}addFeatures(t,n,a){for(const c of this.patternFeatures)this.addFeature(c,c.geometry,c.index,n,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,k1),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,n,a,c,m){for(const g of Va(n,500)){let y=0;for(const R of g)y+=R.length;const x=this.segments.prepareSegment(y,this.layoutVertexArray,this.indexArray),k=x.vertexLength,E=[],C=[];for(const R of g){if(R.length===0)continue;R!==g[0]&&C.push(E.length/2);const B=this.segments2.prepareSegment(R.length,this.layoutVertexArray,this.indexArray2),O=B.vertexLength;this.layoutVertexArray.emplaceBack(R[0].x,R[0].y),this.indexArray2.emplaceBack(O+R.length-1,O),E.push(R[0].x),E.push(R[0].y);for(let $=1;$<R.length;$++)this.layoutVertexArray.emplaceBack(R[$].x,R[$].y),this.indexArray2.emplaceBack(O+$-1,O+$),E.push(R[$].x),E.push(R[$].y);B.vertexLength+=R.length,B.primitiveLength+=R.length}const A=h_(E,C);for(let R=0;R<A.length;R+=3)this.indexArray.emplaceBack(k+A[R],k+A[R+1],k+A[R+2]);x.vertexLength+=y,x.primitiveLength+=A.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,m,c)}}let g_,__;$e("FillBucket",rf,{omit:["layers","patternFeatures"]});var R1={get paint(){return __=__||new f({"fill-antialias":new He(me.paint_fill["fill-antialias"]),"fill-opacity":new nt(me.paint_fill["fill-opacity"]),"fill-color":new nt(me.paint_fill["fill-color"]),"fill-outline-color":new nt(me.paint_fill["fill-outline-color"]),"fill-translate":new He(me.paint_fill["fill-translate"]),"fill-translate-anchor":new He(me.paint_fill["fill-translate-anchor"]),"fill-pattern":new ol(me.paint_fill["fill-pattern"])})},get layout(){return g_=g_||new f({"fill-sort-key":new nt(me.layout_fill["fill-sort-key"])})}};class F1 extends s{constructor(t){super(t,R1)}recalculate(t,n){super.recalculate(t,n);const a=this.paint._values["fill-outline-color"];a.value.kind==="constant"&&a.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new rf(t)}queryRadius(){return Fh(this.paint.get("fill-translate"))}queryIntersectsFeature(t,n,a,c,m,g,y){return Qg(Bh(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),g.angle,y),c)}isTileClipped(){return!0}}const B1=v([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),O1=v([{name:"a_centroid",components:2,type:"Int16"}],4),{members:N1}=B1;var po={},V1=le,y_=_l;function _l(r,t,n,a,c){this.properties={},this.extent=n,this.type=0,this._pbf=r,this._geometry=-1,this._keys=a,this._values=c,r.readFields(j1,this,t)}function j1(r,t,n){r==1?t.id=n.readVarint():r==2?function(a,c){for(var m=a.readVarint()+a.pos;a.pos<m;){var g=c._keys[a.readVarint()],y=c._values[a.readVarint()];c.properties[g]=y}}(n,t):r==3?t.type=n.readVarint():r==4&&(t._geometry=n.pos)}function U1(r){for(var t,n,a=0,c=0,m=r.length,g=m-1;c<m;g=c++)a+=((n=r[g]).x-(t=r[c]).x)*(t.y+n.y);return a}_l.types=["Unknown","Point","LineString","Polygon"],_l.prototype.loadGeometry=function(){var r=this._pbf;r.pos=this._geometry;for(var t,n=r.readVarint()+r.pos,a=1,c=0,m=0,g=0,y=[];r.pos<n;){if(c<=0){var x=r.readVarint();a=7&x,c=x>>3}if(c--,a===1||a===2)m+=r.readSVarint(),g+=r.readSVarint(),a===1&&(t&&y.push(t),t=[]),t.push(new V1(m,g));else{if(a!==7)throw new Error("unknown command "+a);t&&t.push(t[0].clone())}}return t&&y.push(t),y},_l.prototype.bbox=function(){var r=this._pbf;r.pos=this._geometry;for(var t=r.readVarint()+r.pos,n=1,a=0,c=0,m=0,g=1/0,y=-1/0,x=1/0,k=-1/0;r.pos<t;){if(a<=0){var E=r.readVarint();n=7&E,a=E>>3}if(a--,n===1||n===2)(c+=r.readSVarint())<g&&(g=c),c>y&&(y=c),(m+=r.readSVarint())<x&&(x=m),m>k&&(k=m);else if(n!==7)throw new Error("unknown command "+n)}return[g,x,y,k]},_l.prototype.toGeoJSON=function(r,t,n){var a,c,m=this.extent*Math.pow(2,n),g=this.extent*r,y=this.extent*t,x=this.loadGeometry(),k=_l.types[this.type];function E(R){for(var B=0;B<R.length;B++){var O=R[B];R[B]=[360*(O.x+g)/m-180,360/Math.PI*Math.atan(Math.exp((180-360*(O.y+y)/m)*Math.PI/180))-90]}}switch(this.type){case 1:var C=[];for(a=0;a<x.length;a++)C[a]=x[a][0];E(x=C);break;case 2:for(a=0;a<x.length;a++)E(x[a]);break;case 3:for(x=function(R){var B=R.length;if(B<=1)return[R];for(var O,$,X=[],he=0;he<B;he++){var ee=U1(R[he]);ee!==0&&($===void 0&&($=ee<0),$===ee<0?(O&&X.push(O),O=[R[he]]):O.push(R[he]))}return O&&X.push(O),X}(x),a=0;a<x.length;a++)for(c=0;c<x[a].length;c++)E(x[a][c])}x.length===1?x=x[0]:k="Multi"+k;var A={type:"Feature",geometry:{type:k,coordinates:x},properties:this.properties};return"id"in this&&(A.id=this.id),A};var $1=y_,v_=x_;function x_(r,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=r,this._keys=[],this._values=[],this._features=[],r.readFields(Z1,this,t),this.length=this._features.length}function Z1(r,t,n){r===15?t.version=n.readVarint():r===1?t.name=n.readString():r===5?t.extent=n.readVarint():r===2?t._features.push(n.pos):r===3?t._keys.push(n.readString()):r===4&&t._values.push(function(a){for(var c=null,m=a.readVarint()+a.pos;a.pos<m;){var g=a.readVarint()>>3;c=g===1?a.readString():g===2?a.readFloat():g===3?a.readDouble():g===4?a.readVarint64():g===5?a.readVarint():g===6?a.readSVarint():g===7?a.readBoolean():null}return c}(n))}x_.prototype.feature=function(r){if(r<0||r>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[r];var t=this._pbf.readVarint()+this._pbf.pos;return new $1(this._pbf,t,this.extent,this._keys,this._values)};var q1=v_;function G1(r,t,n){if(r===3){var a=new q1(n,n.readVarint()+n.pos);a.length&&(t[a.name]=a)}}po.VectorTile=function(r,t){this.layers=r.readFields(G1,{},t)},po.VectorTileFeature=y_,po.VectorTileLayer=v_;const H1=po.VectorTileFeature.types,nf=Math.pow(2,13);function Ju(r,t,n,a,c,m,g,y){r.emplaceBack(t,n,2*Math.floor(a*nf)+g,c*nf*2,m*nf*2,Math.round(y))}class sf{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new oo,this.centroidVertexArray=new Lr,this.indexArray=new Ki,this.programConfigurations=new ha(t.layers,t.zoom),this.segments=new bt,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,a){this.features=[],this.hasPattern=ef("fill-extrusion",this.layers,n);for(const{feature:c,id:m,index:g,sourceLayerIndex:y}of t){const x=this.layers[0]._featureFilter.needGeometry,k=pa(c,x);if(!this.layers[0]._featureFilter.filter(new qt(this.zoom),k,a))continue;const E={id:m,sourceLayerIndex:y,index:g,geometry:x?k.geometry:da(c),properties:c.properties,type:c.type,patterns:{}};this.hasPattern?this.features.push(tf("fill-extrusion",this.layers,E,this.zoom,n)):this.addFeature(E,E.geometry,g,a,{}),n.featureIndex.insert(c,E.geometry,g,y,this.index,!0)}}addFeatures(t,n,a){for(const c of this.features){const{geometry:m}=c;this.addFeature(c,m,c.index,n,a)}}update(t,n,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,a)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,N1),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,O1.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,n,a,c,m){for(const g of Va(n,500)){const y={x:0,y:0,vertexCount:0};let x=0;for(const B of g)x+=B.length;let k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const B of g){if(B.length===0||X1(B))continue;let O=0;for(let $=0;$<B.length;$++){const X=B[$];if($>=1){const he=B[$-1];if(!W1(X,he)){k.vertexLength+4>bt.MAX_VERTEX_ARRAY_LENGTH&&(k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const ee=X.sub(he)._perp()._unit(),ae=he.dist(X);O+ae>32768&&(O=0),Ju(this.layoutVertexArray,X.x,X.y,ee.x,ee.y,0,0,O),Ju(this.layoutVertexArray,X.x,X.y,ee.x,ee.y,0,1,O),y.x+=2*X.x,y.y+=2*X.y,y.vertexCount+=2,O+=ae,Ju(this.layoutVertexArray,he.x,he.y,ee.x,ee.y,0,0,O),Ju(this.layoutVertexArray,he.x,he.y,ee.x,ee.y,0,1,O),y.x+=2*he.x,y.y+=2*he.y,y.vertexCount+=2;const ge=k.vertexLength;this.indexArray.emplaceBack(ge,ge+2,ge+1),this.indexArray.emplaceBack(ge+1,ge+2,ge+3),k.vertexLength+=4,k.primitiveLength+=2}}}}if(k.vertexLength+x>bt.MAX_VERTEX_ARRAY_LENGTH&&(k=this.segments.prepareSegment(x,this.layoutVertexArray,this.indexArray)),H1[t.type]!=="Polygon")continue;const E=[],C=[],A=k.vertexLength;for(const B of g)if(B.length!==0){B!==g[0]&&C.push(E.length/2);for(let O=0;O<B.length;O++){const $=B[O];Ju(this.layoutVertexArray,$.x,$.y,0,0,1,1,0),y.x+=$.x,y.y+=$.y,y.vertexCount+=1,E.push($.x),E.push($.y)}}const R=h_(E,C);for(let B=0;B<R.length;B+=3)this.indexArray.emplaceBack(A+R[B],A+R[B+2],A+R[B+1]);k.primitiveLength+=R.length/3,k.vertexLength+=x;for(let B=0;B<y.vertexCount;B++){const O=Math.floor(y.x/y.vertexCount),$=Math.floor(y.y/y.vertexCount);this.centroidVertexArray.emplaceBack(O,$)}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,m,c)}}function W1(r,t){return r.x===t.x&&(r.x<0||r.x>mr)||r.y===t.y&&(r.y<0||r.y>mr)}function X1(r){return r.every(t=>t.x<0)||r.every(t=>t.x>mr)||r.every(t=>t.y<0)||r.every(t=>t.y>mr)}let w_;$e("FillExtrusionBucket",sf,{omit:["layers","features"]});var K1={get paint(){return w_=w_||new f({"fill-extrusion-opacity":new He(me["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new nt(me["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new He(me["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new He(me["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ol(me["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new nt(me["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new nt(me["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new He(me["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Y1 extends s{constructor(t){super(t,K1)}createBucket(t){return new sf(t)}queryRadius(){return Fh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(t,n,a,c,m,g,y,x){const k=Bh(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),g.angle,y),E=this.paint.get("fill-extrusion-height").evaluate(n,a),C=this.paint.get("fill-extrusion-base").evaluate(n,a),A=function(B,O,$,X){const he=[];for(const ee of B){const ae=[ee.x,ee.y,0,1];Oh(ae,ae,O),he.push(new re(ae[0]/ae[3],ae[1]/ae[3]))}return he}(k,x),R=function(B,O,$,X){const he=[],ee=[],ae=X[8]*O,ge=X[9]*O,be=X[10]*O,Ne=X[11]*O,it=X[8]*$,Be=X[9]*$,Le=X[10]*$,Ye=X[11]*$;for(const Ze of B){const Ue=[],ve=[];for(const Je of Ze){const Ke=Je.x,at=Je.y,jt=X[0]*Ke+X[4]*at+X[12],Vt=X[1]*Ke+X[5]*at+X[13],br=X[2]*Ke+X[6]*at+X[14],vn=X[3]*Ke+X[7]*at+X[15],Br=br+be,Sr=vn+Ne,oi=jt+it,ai=Vt+Be,li=br+Le,or=vn+Ye,Tr=new re((jt+ae)/Sr,(Vt+ge)/Sr);Tr.z=Br/Sr,Ue.push(Tr);const Hr=new re(oi/or,ai/or);Hr.z=li/or,ve.push(Hr)}he.push(Ue),ee.push(ve)}return[he,ee]}(c,C,E,x);return function(B,O,$){let X=1/0;Qg($,O)&&(X=b_($,O[0]));for(let he=0;he<O.length;he++){const ee=O[he],ae=B[he];for(let ge=0;ge<ee.length-1;ge++){const be=ee[ge],Ne=[be,ee[ge+1],ae[ge+1],ae[ge],be];Jg($,Ne)&&(X=Math.min(X,b_($,Ne)))}}return X!==1/0&&X}(R[0],R[1],A)}}function Qu(r,t){return r.x*t.x+r.y*t.y}function b_(r,t){if(r.length===1){let n=0;const a=t[n++];let c;for(;!c||a.equals(c);)if(c=t[n++],!c)return 1/0;for(;n<t.length;n++){const m=t[n],g=r[0],y=c.sub(a),x=m.sub(a),k=g.sub(a),E=Qu(y,y),C=Qu(y,x),A=Qu(x,x),R=Qu(k,y),B=Qu(k,x),O=E*A-C*C,$=(A*R-C*B)/O,X=(E*B-C*R)/O,he=a.z*(1-$-X)+c.z*$+m.z*X;if(isFinite(he))return he}return 1/0}{let n=1/0;for(const a of t)n=Math.min(n,a.z);return n}}const J1=v([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Q1}=J1,ew=v([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:tw}=ew,rw=po.VectorTileFeature.types,iw=Math.cos(Math.PI/180*37.5),S_=Math.pow(2,14)/.5;class of{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new ll,this.layoutVertexArray2=new ao,this.indexArray=new Ki,this.programConfigurations=new ha(t.layers,t.zoom),this.segments=new bt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,a){this.hasPattern=ef("line",this.layers,n);const c=this.layers[0].layout.get("line-sort-key"),m=!c.isConstant(),g=[];for(const{feature:y,id:x,index:k,sourceLayerIndex:E}of t){const C=this.layers[0]._featureFilter.needGeometry,A=pa(y,C);if(!this.layers[0]._featureFilter.filter(new qt(this.zoom),A,a))continue;const R=m?c.evaluate(A,{},a):void 0,B={id:x,properties:y.properties,type:y.type,sourceLayerIndex:E,index:k,geometry:C?A.geometry:da(y),patterns:{},sortKey:R};g.push(B)}m&&g.sort((y,x)=>y.sortKey-x.sortKey);for(const y of g){const{geometry:x,index:k,sourceLayerIndex:E}=y;if(this.hasPattern){const C=tf("line",this.layers,y,this.zoom,n);this.patternFeatures.push(C)}else this.addFeature(y,x,k,a,{});n.featureIndex.insert(t[k].feature,x,k,E,this.index)}}update(t,n,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,a)}addFeatures(t,n,a){for(const c of this.patternFeatures)this.addFeature(c,c.geometry,c.index,n,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,tw)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Q1),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,n,a,c,m){const g=this.layers[0].layout,y=g.get("line-join").evaluate(t,{}),x=g.get("line-cap"),k=g.get("line-miter-limit"),E=g.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const C of n)this.addLine(C,t,y,x,k,E);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,m,c)}addLine(t,n,a,c,m,g){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let X=0;X<t.length-1;X++)this.totalDistance+=t[X].dist(t[X+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const y=rw[n.type]==="Polygon";let x=t.length;for(;x>=2&&t[x-1].equals(t[x-2]);)x--;let k=0;for(;k<x-1&&t[k].equals(t[k+1]);)k++;if(x<(y?3:2))return;a==="bevel"&&(m=1.05);const E=this.overscaling<=16?15*mr/(512*this.overscaling):0,C=this.segments.prepareSegment(10*x,this.layoutVertexArray,this.indexArray);let A,R,B,O,$;this.e1=this.e2=-1,y&&(A=t[x-2],$=t[k].sub(A)._unit()._perp());for(let X=k;X<x;X++){if(B=X===x-1?y?t[k+1]:void 0:t[X+1],B&&t[X].equals(B))continue;$&&(O=$),A&&(R=A),A=t[X],$=B?B.sub(A)._unit()._perp():O,O=O||$;let he=O.add($);he.x===0&&he.y===0||he._unit();const ee=O.x*$.x+O.y*$.y,ae=he.x*$.x+he.y*$.y,ge=ae!==0?1/ae:1/0,be=2*Math.sqrt(2-2*ae),Ne=ae<iw&&R&&B,it=O.x*$.y-O.y*$.x>0;if(Ne&&X>k){const Ye=A.dist(R);if(Ye>2*E){const Ze=A.sub(A.sub(R)._mult(E/Ye)._round());this.updateDistance(R,Ze),this.addCurrentVertex(Ze,O,0,0,C),R=Ze}}const Be=R&&B;let Le=Be?a:y?"butt":c;if(Be&&Le==="round"&&(ge<g?Le="miter":ge<=2&&(Le="fakeround")),Le==="miter"&&ge>m&&(Le="bevel"),Le==="bevel"&&(ge>2&&(Le="flipbevel"),ge<m&&(Le="miter")),R&&this.updateDistance(R,A),Le==="miter")he._mult(ge),this.addCurrentVertex(A,he,0,0,C);else if(Le==="flipbevel"){if(ge>100)he=$.mult(-1);else{const Ye=ge*O.add($).mag()/O.sub($).mag();he._perp()._mult(Ye*(it?-1:1))}this.addCurrentVertex(A,he,0,0,C),this.addCurrentVertex(A,he.mult(-1),0,0,C)}else if(Le==="bevel"||Le==="fakeround"){const Ye=-Math.sqrt(ge*ge-1),Ze=it?Ye:0,Ue=it?0:Ye;if(R&&this.addCurrentVertex(A,O,Ze,Ue,C),Le==="fakeround"){const ve=Math.round(180*be/Math.PI/20);for(let Je=1;Je<ve;Je++){let Ke=Je/ve;if(Ke!==.5){const jt=Ke-.5;Ke+=Ke*jt*(Ke-1)*((1.0904+ee*(ee*(3.55645-1.43519*ee)-3.2452))*jt*jt+(.848013+ee*(.215638*ee-1.06021)))}const at=$.sub(O)._mult(Ke)._add(O)._unit()._mult(it?-1:1);this.addHalfVertex(A,at.x,at.y,!1,it,0,C)}}B&&this.addCurrentVertex(A,$,-Ze,-Ue,C)}else if(Le==="butt")this.addCurrentVertex(A,he,0,0,C);else if(Le==="square"){const Ye=R?1:-1;this.addCurrentVertex(A,he,Ye,Ye,C)}else Le==="round"&&(R&&(this.addCurrentVertex(A,O,0,0,C),this.addCurrentVertex(A,O,1,1,C,!0)),B&&(this.addCurrentVertex(A,$,-1,-1,C,!0),this.addCurrentVertex(A,$,0,0,C)));if(Ne&&X<x-1){const Ye=A.dist(B);if(Ye>2*E){const Ze=A.add(B.sub(A)._mult(E/Ye)._round());this.updateDistance(A,Ze),this.addCurrentVertex(Ze,$,0,0,C),A=Ze}}}}addCurrentVertex(t,n,a,c,m,g=!1){const y=n.y*c-n.x,x=-n.y-n.x*c;this.addHalfVertex(t,n.x+n.y*a,n.y-n.x*a,g,!1,a,m),this.addHalfVertex(t,y,x,g,!0,-c,m),this.distance>S_/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,n,a,c,m,g))}addHalfVertex({x:t,y:n},a,c,m,g,y,x){const k=.5*(this.lineClips?this.scaledDistance*(S_-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(m?1:0),(n<<1)+(g?1:0),Math.round(63*a)+128,Math.round(63*c)+128,1+(y===0?0:y<0?-1:1)|(63&k)<<2,k>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const E=x.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,E),x.primitiveLength++),g?this.e2=E:this.e1=E}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,n){this.distance+=t.dist(n),this.updateScaledDistance()}}let T_,k_;$e("LineBucket",of,{omit:["layers","patternFeatures"]});var I_={get paint(){return k_=k_||new f({"line-opacity":new nt(me.paint_line["line-opacity"]),"line-color":new nt(me.paint_line["line-color"]),"line-translate":new He(me.paint_line["line-translate"]),"line-translate-anchor":new He(me.paint_line["line-translate-anchor"]),"line-width":new nt(me.paint_line["line-width"]),"line-gap-width":new nt(me.paint_line["line-gap-width"]),"line-offset":new nt(me.paint_line["line-offset"]),"line-blur":new nt(me.paint_line["line-blur"]),"line-dasharray":new al(me.paint_line["line-dasharray"]),"line-pattern":new ol(me.paint_line["line-pattern"]),"line-gradient":new $u(me.paint_line["line-gradient"])})},get layout(){return T_=T_||new f({"line-cap":new He(me.layout_line["line-cap"]),"line-join":new nt(me.layout_line["line-join"]),"line-miter-limit":new He(me.layout_line["line-miter-limit"]),"line-round-limit":new He(me.layout_line["line-round-limit"]),"line-sort-key":new nt(me.layout_line["line-sort-key"])})}};class nw extends nt{possiblyEvaluate(t,n){return n=new qt(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,zoomHistory:n.zoomHistory,transition:n.transition}),super.possiblyEvaluate(t,n)}evaluate(t,n,a,c){return n=qe({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(t,n,a,c)}}let Uh;class sw extends s{constructor(t){super(t,I_),this.gradientVersion=0,Uh||(Uh=new nw(I_.paint.properties["line-width"].specification),Uh.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const n=this.gradientExpression();this.stepInterpolant=!!function(a){return a._styleExpression!==void 0}(n)&&n._styleExpression.expression instanceof Us,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,n){super.recalculate(t,n),this.paint._values["line-floorwidth"]=Uh.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new of(t)}queryRadius(t){const n=t,a=E_(Gu("line-width",this,n),Gu("line-gap-width",this,n)),c=Gu("line-offset",this,n);return a/2+Math.abs(c)+Fh(this.paint.get("line-translate"))}queryIntersectsFeature(t,n,a,c,m,g,y){const x=Bh(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),g.angle,y),k=y/2*E_(this.paint.get("line-width").evaluate(n,a),this.paint.get("line-gap-width").evaluate(n,a)),E=this.paint.get("line-offset").evaluate(n,a);return E&&(c=function(C,A){const R=[];for(let B=0;B<C.length;B++){const O=C[B],$=[];for(let X=0;X<O.length;X++){const he=O[X-1],ee=O[X],ae=O[X+1],ge=X===0?new re(0,0):ee.sub(he)._unit()._perp(),be=X===O.length-1?new re(0,0):ae.sub(ee)._unit()._perp(),Ne=ge._add(be)._unit(),it=Ne.x*be.x+Ne.y*be.y;it!==0&&Ne._mult(1/it),$.push(Ne._mult(A)._add(ee))}R.push($)}return R}(c,E*y)),function(C,A,R){for(let B=0;B<A.length;B++){const O=A[B];if(C.length>=3){for(let $=0;$<O.length;$++)if(fl(C,O[$]))return!0}if(f1(C,O,R))return!0}return!1}(x,c,k)}isTileClipped(){return!0}}function E_(r,t){return t>0?t+2*r:r}const ow=v([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),aw=v([{name:"a_projected_pos",components:3,type:"Float32"}],4);v([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const lw=v([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);v([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const P_=v([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),uw=v([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function cw(r,t,n){return r.sections.forEach(a=>{a.text=function(c,m,g){const y=m.layout.get("text-transform").evaluate(g,{});return y==="uppercase"?c=c.toLocaleUpperCase():y==="lowercase"&&(c=c.toLocaleLowerCase()),yi.applyArabicShaping&&(c=yi.applyArabicShaping(c)),c}(a.text,t,n)}),r}v([{name:"triangle",components:3,type:"Uint16"}]),v([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),v([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),v([{type:"Float32",name:"offsetX"}]),v([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),v([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const ec={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var _r=24,C_=Nt,z_=function(r,t,n,a,c){var m,g,y=8*c-a-1,x=(1<<y)-1,k=x>>1,E=-7,C=c-1,A=-1,R=r[t+C];for(C+=A,m=R&(1<<-E)-1,R>>=-E,E+=y;E>0;m=256*m+r[t+C],C+=A,E-=8);for(g=m&(1<<-E)-1,m>>=-E,E+=a;E>0;g=256*g+r[t+C],C+=A,E-=8);if(m===0)m=1-k;else{if(m===x)return g?NaN:1/0*(R?-1:1);g+=Math.pow(2,a),m-=k}return(R?-1:1)*g*Math.pow(2,m-a)},M_=function(r,t,n,a,c,m){var g,y,x,k=8*m-c-1,E=(1<<k)-1,C=E>>1,A=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,R=0,B=1,O=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(y=isNaN(t)?1:0,g=E):(g=Math.floor(Math.log(t)/Math.LN2),t*(x=Math.pow(2,-g))<1&&(g--,x*=2),(t+=g+C>=1?A/x:A*Math.pow(2,1-C))*x>=2&&(g++,x/=2),g+C>=E?(y=0,g=E):g+C>=1?(y=(t*x-1)*Math.pow(2,c),g+=C):(y=t*Math.pow(2,C-1)*Math.pow(2,c),g=0));c>=8;r[n+R]=255&y,R+=B,y/=256,c-=8);for(g=g<<c|y,k+=c;k>0;r[n+R]=255&g,R+=B,g/=256,k-=8);r[n+R-B]|=128*O};function Nt(r){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(r)?r:new Uint8Array(r||0),this.pos=0,this.type=0,this.length=this.buf.length}Nt.Varint=0,Nt.Fixed64=1,Nt.Bytes=2,Nt.Fixed32=5;var af=4294967296,A_=1/af,D_=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function Ts(r){return r.type===Nt.Bytes?r.readVarint()+r.pos:r.pos+1}function yl(r,t,n){return n?4294967296*t+(r>>>0):4294967296*(t>>>0)+(r>>>0)}function L_(r,t,n){var a=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));n.realloc(a);for(var c=n.pos-1;c>=r;c--)n.buf[c+a]=n.buf[c]}function hw(r,t){for(var n=0;n<r.length;n++)t.writeVarint(r[n])}function dw(r,t){for(var n=0;n<r.length;n++)t.writeSVarint(r[n])}function pw(r,t){for(var n=0;n<r.length;n++)t.writeFloat(r[n])}function fw(r,t){for(var n=0;n<r.length;n++)t.writeDouble(r[n])}function mw(r,t){for(var n=0;n<r.length;n++)t.writeBoolean(r[n])}function gw(r,t){for(var n=0;n<r.length;n++)t.writeFixed32(r[n])}function _w(r,t){for(var n=0;n<r.length;n++)t.writeSFixed32(r[n])}function yw(r,t){for(var n=0;n<r.length;n++)t.writeFixed64(r[n])}function vw(r,t){for(var n=0;n<r.length;n++)t.writeSFixed64(r[n])}function $h(r,t){return(r[t]|r[t+1]<<8|r[t+2]<<16)+16777216*r[t+3]}function vl(r,t,n){r[n]=t,r[n+1]=t>>>8,r[n+2]=t>>>16,r[n+3]=t>>>24}function R_(r,t){return(r[t]|r[t+1]<<8|r[t+2]<<16)+(r[t+3]<<24)}Nt.prototype={destroy:function(){this.buf=null},readFields:function(r,t,n){for(n=n||this.length;this.pos<n;){var a=this.readVarint(),c=a>>3,m=this.pos;this.type=7&a,r(c,t,this),this.pos===m&&this.skip(a)}return t},readMessage:function(r,t){return this.readFields(r,t,this.readVarint()+this.pos)},readFixed32:function(){var r=$h(this.buf,this.pos);return this.pos+=4,r},readSFixed32:function(){var r=R_(this.buf,this.pos);return this.pos+=4,r},readFixed64:function(){var r=$h(this.buf,this.pos)+$h(this.buf,this.pos+4)*af;return this.pos+=8,r},readSFixed64:function(){var r=$h(this.buf,this.pos)+R_(this.buf,this.pos+4)*af;return this.pos+=8,r},readFloat:function(){var r=z_(this.buf,this.pos,!0,23,4);return this.pos+=4,r},readDouble:function(){var r=z_(this.buf,this.pos,!0,52,8);return this.pos+=8,r},readVarint:function(r){var t,n,a=this.buf;return t=127&(n=a[this.pos++]),n<128?t:(t|=(127&(n=a[this.pos++]))<<7,n<128?t:(t|=(127&(n=a[this.pos++]))<<14,n<128?t:(t|=(127&(n=a[this.pos++]))<<21,n<128?t:function(c,m,g){var y,x,k=g.buf;if(y=(112&(x=k[g.pos++]))>>4,x<128||(y|=(127&(x=k[g.pos++]))<<3,x<128)||(y|=(127&(x=k[g.pos++]))<<10,x<128)||(y|=(127&(x=k[g.pos++]))<<17,x<128)||(y|=(127&(x=k[g.pos++]))<<24,x<128)||(y|=(1&(x=k[g.pos++]))<<31,x<128))return yl(c,y,m);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(n=a[this.pos]))<<28,r,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var r=this.readVarint();return r%2==1?(r+1)/-2:r/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var r=this.readVarint()+this.pos,t=this.pos;return this.pos=r,r-t>=12&&D_?function(n,a,c){return D_.decode(n.subarray(a,c))}(this.buf,t,r):function(n,a,c){for(var m="",g=a;g<c;){var y,x,k,E=n[g],C=null,A=E>239?4:E>223?3:E>191?2:1;if(g+A>c)break;A===1?E<128&&(C=E):A===2?(192&(y=n[g+1]))==128&&(C=(31&E)<<6|63&y)<=127&&(C=null):A===3?(x=n[g+2],(192&(y=n[g+1]))==128&&(192&x)==128&&((C=(15&E)<<12|(63&y)<<6|63&x)<=2047||C>=55296&&C<=57343)&&(C=null)):A===4&&(x=n[g+2],k=n[g+3],(192&(y=n[g+1]))==128&&(192&x)==128&&(192&k)==128&&((C=(15&E)<<18|(63&y)<<12|(63&x)<<6|63&k)<=65535||C>=1114112)&&(C=null)),C===null?(C=65533,A=1):C>65535&&(C-=65536,m+=String.fromCharCode(C>>>10&1023|55296),C=56320|1023&C),m+=String.fromCharCode(C),g+=A}return m}(this.buf,t,r)},readBytes:function(){var r=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,r);return this.pos=r,t},readPackedVarint:function(r,t){if(this.type!==Nt.Bytes)return r.push(this.readVarint(t));var n=Ts(this);for(r=r||[];this.pos<n;)r.push(this.readVarint(t));return r},readPackedSVarint:function(r){if(this.type!==Nt.Bytes)return r.push(this.readSVarint());var t=Ts(this);for(r=r||[];this.pos<t;)r.push(this.readSVarint());return r},readPackedBoolean:function(r){if(this.type!==Nt.Bytes)return r.push(this.readBoolean());var t=Ts(this);for(r=r||[];this.pos<t;)r.push(this.readBoolean());return r},readPackedFloat:function(r){if(this.type!==Nt.Bytes)return r.push(this.readFloat());var t=Ts(this);for(r=r||[];this.pos<t;)r.push(this.readFloat());return r},readPackedDouble:function(r){if(this.type!==Nt.Bytes)return r.push(this.readDouble());var t=Ts(this);for(r=r||[];this.pos<t;)r.push(this.readDouble());return r},readPackedFixed32:function(r){if(this.type!==Nt.Bytes)return r.push(this.readFixed32());var t=Ts(this);for(r=r||[];this.pos<t;)r.push(this.readFixed32());return r},readPackedSFixed32:function(r){if(this.type!==Nt.Bytes)return r.push(this.readSFixed32());var t=Ts(this);for(r=r||[];this.pos<t;)r.push(this.readSFixed32());return r},readPackedFixed64:function(r){if(this.type!==Nt.Bytes)return r.push(this.readFixed64());var t=Ts(this);for(r=r||[];this.pos<t;)r.push(this.readFixed64());return r},readPackedSFixed64:function(r){if(this.type!==Nt.Bytes)return r.push(this.readSFixed64());var t=Ts(this);for(r=r||[];this.pos<t;)r.push(this.readSFixed64());return r},skip:function(r){var t=7&r;if(t===Nt.Varint)for(;this.buf[this.pos++]>127;);else if(t===Nt.Bytes)this.pos=this.readVarint()+this.pos;else if(t===Nt.Fixed32)this.pos+=4;else{if(t!==Nt.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(r,t){this.writeVarint(r<<3|t)},realloc:function(r){for(var t=this.length||16;t<this.pos+r;)t*=2;if(t!==this.length){var n=new Uint8Array(t);n.set(this.buf),this.buf=n,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(r){this.realloc(4),vl(this.buf,r,this.pos),this.pos+=4},writeSFixed32:function(r){this.realloc(4),vl(this.buf,r,this.pos),this.pos+=4},writeFixed64:function(r){this.realloc(8),vl(this.buf,-1&r,this.pos),vl(this.buf,Math.floor(r*A_),this.pos+4),this.pos+=8},writeSFixed64:function(r){this.realloc(8),vl(this.buf,-1&r,this.pos),vl(this.buf,Math.floor(r*A_),this.pos+4),this.pos+=8},writeVarint:function(r){(r=+r||0)>268435455||r<0?function(t,n){var a,c;if(t>=0?(a=t%4294967296|0,c=t/4294967296|0):(c=~(-t/4294967296),4294967295^(a=~(-t%4294967296))?a=a+1|0:(a=0,c=c+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),function(m,g,y){y.buf[y.pos++]=127&m|128,m>>>=7,y.buf[y.pos++]=127&m|128,m>>>=7,y.buf[y.pos++]=127&m|128,m>>>=7,y.buf[y.pos++]=127&m|128,y.buf[y.pos]=127&(m>>>=7)}(a,0,n),function(m,g){var y=(7&m)<<4;g.buf[g.pos++]|=y|((m>>>=3)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m)))))}(c,n)}(r,this):(this.realloc(4),this.buf[this.pos++]=127&r|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=r>>>7&127))))},writeSVarint:function(r){this.writeVarint(r<0?2*-r-1:2*r)},writeBoolean:function(r){this.writeVarint(!!r)},writeString:function(r){r=String(r),this.realloc(4*r.length),this.pos++;var t=this.pos;this.pos=function(a,c,m){for(var g,y,x=0;x<c.length;x++){if((g=c.charCodeAt(x))>55295&&g<57344){if(!y){g>56319||x+1===c.length?(a[m++]=239,a[m++]=191,a[m++]=189):y=g;continue}if(g<56320){a[m++]=239,a[m++]=191,a[m++]=189,y=g;continue}g=y-55296<<10|g-56320|65536,y=null}else y&&(a[m++]=239,a[m++]=191,a[m++]=189,y=null);g<128?a[m++]=g:(g<2048?a[m++]=g>>6|192:(g<65536?a[m++]=g>>12|224:(a[m++]=g>>18|240,a[m++]=g>>12&63|128),a[m++]=g>>6&63|128),a[m++]=63&g|128)}return m}(this.buf,r,this.pos);var n=this.pos-t;n>=128&&L_(t,n,this),this.pos=t-1,this.writeVarint(n),this.pos+=n},writeFloat:function(r){this.realloc(4),M_(this.buf,r,this.pos,!0,23,4),this.pos+=4},writeDouble:function(r){this.realloc(8),M_(this.buf,r,this.pos,!0,52,8),this.pos+=8},writeBytes:function(r){var t=r.length;this.writeVarint(t),this.realloc(t);for(var n=0;n<t;n++)this.buf[this.pos++]=r[n]},writeRawMessage:function(r,t){this.pos++;var n=this.pos;r(t,this);var a=this.pos-n;a>=128&&L_(n,a,this),this.pos=n-1,this.writeVarint(a),this.pos+=a},writeMessage:function(r,t,n){this.writeTag(r,Nt.Bytes),this.writeRawMessage(t,n)},writePackedVarint:function(r,t){t.length&&this.writeMessage(r,hw,t)},writePackedSVarint:function(r,t){t.length&&this.writeMessage(r,dw,t)},writePackedBoolean:function(r,t){t.length&&this.writeMessage(r,mw,t)},writePackedFloat:function(r,t){t.length&&this.writeMessage(r,pw,t)},writePackedDouble:function(r,t){t.length&&this.writeMessage(r,fw,t)},writePackedFixed32:function(r,t){t.length&&this.writeMessage(r,gw,t)},writePackedSFixed32:function(r,t){t.length&&this.writeMessage(r,_w,t)},writePackedFixed64:function(r,t){t.length&&this.writeMessage(r,yw,t)},writePackedSFixed64:function(r,t){t.length&&this.writeMessage(r,vw,t)},writeBytesField:function(r,t){this.writeTag(r,Nt.Bytes),this.writeBytes(t)},writeFixed32Field:function(r,t){this.writeTag(r,Nt.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(r,t){this.writeTag(r,Nt.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(r,t){this.writeTag(r,Nt.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(r,t){this.writeTag(r,Nt.Fixed64),this.writeSFixed64(t)},writeVarintField:function(r,t){this.writeTag(r,Nt.Varint),this.writeVarint(t)},writeSVarintField:function(r,t){this.writeTag(r,Nt.Varint),this.writeSVarint(t)},writeStringField:function(r,t){this.writeTag(r,Nt.Bytes),this.writeString(t)},writeFloatField:function(r,t){this.writeTag(r,Nt.Fixed32),this.writeFloat(t)},writeDoubleField:function(r,t){this.writeTag(r,Nt.Fixed64),this.writeDouble(t)},writeBooleanField:function(r,t){this.writeVarintField(r,!!t)}};var lf=H(C_);const uf=3;function xw(r,t,n){r===1&&n.readMessage(ww,t)}function ww(r,t,n){if(r===3){const{id:a,bitmap:c,width:m,height:g,left:y,top:x,advance:k}=n.readMessage(bw,{});t.push({id:a,bitmap:new Wu({width:m+2*uf,height:g+2*uf},c),metrics:{width:m,height:g,left:y,top:x,advance:k}})}}function bw(r,t,n){r===1?t.id=n.readVarint():r===2?t.bitmap=n.readBytes():r===3?t.width=n.readVarint():r===4?t.height=n.readVarint():r===5?t.left=n.readSVarint():r===6?t.top=n.readSVarint():r===7&&(t.advance=n.readVarint())}const F_=uf;function B_(r){let t=0,n=0;for(const g of r)t+=g.w*g.h,n=Math.max(n,g.w);r.sort((g,y)=>y.h-g.h);const a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),n),h:1/0}];let c=0,m=0;for(const g of r)for(let y=a.length-1;y>=0;y--){const x=a[y];if(!(g.w>x.w||g.h>x.h)){if(g.x=x.x,g.y=x.y,m=Math.max(m,g.y+g.h),c=Math.max(c,g.x+g.w),g.w===x.w&&g.h===x.h){const k=a.pop();y<a.length&&(a[y]=k)}else g.h===x.h?(x.x+=g.w,x.w-=g.w):g.w===x.w?(x.y+=g.h,x.h-=g.h):(a.push({x:x.x+g.w,y:x.y,w:x.w-g.w,h:g.h}),x.y+=g.h,x.h-=g.h);break}}return{w:c,h:m,fill:t/(c*m)||0}}const xi=1;class cf{constructor(t,{pixelRatio:n,version:a,stretchX:c,stretchY:m,content:g,textFitWidth:y,textFitHeight:x}){this.paddedRect=t,this.pixelRatio=n,this.stretchX=c,this.stretchY=m,this.content=g,this.version=a,this.textFitWidth=y,this.textFitHeight=x}get tl(){return[this.paddedRect.x+xi,this.paddedRect.y+xi]}get br(){return[this.paddedRect.x+this.paddedRect.w-xi,this.paddedRect.y+this.paddedRect.h-xi]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*xi)/this.pixelRatio,(this.paddedRect.h-2*xi)/this.pixelRatio]}}class O_{constructor(t,n){const a={},c={};this.haveRenderCallbacks=[];const m=[];this.addImages(t,a,m),this.addImages(n,c,m);const{w:g,h:y}=B_(m),x=new Yi({width:g||1,height:y||1});for(const k in t){const E=t[k],C=a[k].paddedRect;Yi.copy(E.data,x,{x:0,y:0},{x:C.x+xi,y:C.y+xi},E.data)}for(const k in n){const E=n[k],C=c[k].paddedRect,A=C.x+xi,R=C.y+xi,B=E.data.width,O=E.data.height;Yi.copy(E.data,x,{x:0,y:0},{x:A,y:R},E.data),Yi.copy(E.data,x,{x:0,y:O-1},{x:A,y:R-1},{width:B,height:1}),Yi.copy(E.data,x,{x:0,y:0},{x:A,y:R+O},{width:B,height:1}),Yi.copy(E.data,x,{x:B-1,y:0},{x:A-1,y:R},{width:1,height:O}),Yi.copy(E.data,x,{x:0,y:0},{x:A+B,y:R},{width:1,height:O})}this.image=x,this.iconPositions=a,this.patternPositions=c}addImages(t,n,a){for(const c in t){const m=t[c],g={x:0,y:0,w:m.data.width+2*xi,h:m.data.height+2*xi};a.push(g),n[c]=new cf(g,m),m.hasRenderCallback&&this.haveRenderCallbacks.push(c)}}patchUpdatedImages(t,n){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const a in t.updatedImages)this.patchUpdatedImage(this.iconPositions[a],t.getImage(a),n),this.patchUpdatedImage(this.patternPositions[a],t.getImage(a),n)}patchUpdatedImage(t,n,a){if(!t||!n||t.version===n.version)return;t.version=n.version;const[c,m]=t.tl;a.update(n.data,void 0,{x:c,y:m})}}var fo;$e("ImagePosition",cf),$e("ImageAtlas",O_),S.ah=void 0,(fo=S.ah||(S.ah={}))[fo.none=0]="none",fo[fo.horizontal=1]="horizontal",fo[fo.vertical=2]="vertical",fo[fo.horizontalOnly=3]="horizontalOnly";const tc=-17;class rc{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,n){const a=new rc;return a.scale=t||1,a.fontStack=n,a}static forImage(t){const n=new rc;return n.imageName=t,n}}class xl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,n){const a=new xl;for(let c=0;c<t.sections.length;c++){const m=t.sections[c];m.image?a.addImageSection(m):a.addTextSection(m,n)}return a}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let n="";for(let a=0;a<t.length;a++){const c=t.charCodeAt(a+1)||null,m=t.charCodeAt(a-1)||null;n+=c&&Ch(c)&&!ec[t[a+1]]||m&&Ch(m)&&!ec[t[a-1]]||!ec[t[a]]?t[a]:ec[t[a]]}return n}(this.text)}trim(){let t=0;for(let a=0;a<this.text.length&&qh[this.text.charCodeAt(a)];a++)t++;let n=this.text.length;for(let a=this.text.length-1;a>=0&&a>=t&&qh[this.text.charCodeAt(a)];a--)n--;this.text=this.text.substring(t,n),this.sectionIndex=this.sectionIndex.slice(t,n)}substring(t,n){const a=new xl;return a.text=this.text.substring(t,n),a.sectionIndex=this.sectionIndex.slice(t,n),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,n)=>Math.max(t,this.sections[n].scale),0)}addTextSection(t,n){this.text+=t.text,this.sections.push(rc.forText(t.scale,t.fontStack||n));const a=this.sections.length-1;for(let c=0;c<t.text.length;++c)this.sectionIndex.push(a)}addImageSection(t){const n=t.image?t.image.name:"";if(n.length===0)return void ir("Can't add FormattedSection with an empty image.");const a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCharCode(a),this.sections.push(rc.forImage(n)),this.sectionIndex.push(this.sections.length-1)):ir("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Zh(r,t,n,a,c,m,g,y,x,k,E,C,A,R,B){const O=xl.fromFeature(r,c);let $;C===S.ah.vertical&&O.verticalizePunctuation();const{processBidirectionalText:X,processStyledBidirectionalText:he}=yi;if(X&&O.sections.length===1){$=[];const ge=X(O.toString(),hf(O,k,m,t,a,R));for(const be of ge){const Ne=new xl;Ne.text=be,Ne.sections=O.sections;for(let it=0;it<be.length;it++)Ne.sectionIndex.push(0);$.push(Ne)}}else if(he){$=[];const ge=he(O.text,O.sectionIndex,hf(O,k,m,t,a,R));for(const be of ge){const Ne=new xl;Ne.text=be[0],Ne.sectionIndex=be[1],Ne.sections=O.sections,$.push(Ne)}}else $=function(ge,be){const Ne=[],it=ge.text;let Be=0;for(const Le of be)Ne.push(ge.substring(Be,Le)),Be=Le;return Be<it.length&&Ne.push(ge.substring(Be,it.length)),Ne}(O,hf(O,k,m,t,a,R));const ee=[],ae={positionedLines:ee,text:O.toString(),top:E[1],bottom:E[1],left:E[0],right:E[0],writingMode:C,iconsInText:!1,verticalizable:!1};return function(ge,be,Ne,it,Be,Le,Ye,Ze,Ue,ve,Je,Ke){let at=0,jt=tc,Vt=0,br=0;const vn=Ze==="right"?1:Ze==="left"?0:.5;let Br=0;for(const or of Be){or.trim();const Tr=or.getMaxScale(),Hr=(Tr-1)*_r,Or={positionedGlyphs:[],lineOffset:0};ge.positionedLines[Br]=Or;const ui=Or.positionedGlyphs;let Nr=0;if(!or.length()){jt+=Le,++Br;continue}for(let wi=0;wi<or.length();wi++){const Pt=or.getSection(wi),$t=or.getSectionIndex(wi),Xt=or.getCharCode(wi);let Li=0,er=null,Tl=null,Qn=null,es=_r;const xn=!(Ue===S.ah.horizontal||!Je&&!ju(Xt)||Je&&(qh[Xt]||(Sr=Xt,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(Sr)))));if(Pt.imageName){const en=it[Pt.imageName];if(!en)continue;Qn=Pt.imageName,ge.iconsInText=ge.iconsInText||!0,Tl=en.paddedRect;const Pr=en.displaySize;Pt.scale=Pt.scale*_r/Ke,er={width:Pr[0],height:Pr[1],left:xi,top:-F_,advance:xn?Pr[1]:Pr[0]},Li=Hr+(_r-Pr[1]*Pt.scale),es=er.advance;const ks=xn?Pr[0]*Pt.scale-_r*Tr:Pr[1]*Pt.scale-_r*Tr;ks>0&&ks>Nr&&(Nr=ks)}else{const en=Ne[Pt.fontStack],Pr=en&&en[Xt];if(Pr&&Pr.rect)Tl=Pr.rect,er=Pr.metrics;else{const ks=be[Pt.fontStack],lc=ks&&ks[Xt];if(!lc)continue;er=lc.metrics}Li=(Tr-Pt.scale)*_r}xn?(ge.verticalizable=!0,ui.push({glyph:Xt,imageName:Qn,x:at,y:jt+Li,vertical:xn,scale:Pt.scale,fontStack:Pt.fontStack,sectionIndex:$t,metrics:er,rect:Tl}),at+=es*Pt.scale+ve):(ui.push({glyph:Xt,imageName:Qn,x:at,y:jt+Li,vertical:xn,scale:Pt.scale,fontStack:Pt.fontStack,sectionIndex:$t,metrics:er,rect:Tl}),at+=er.advance*Pt.scale+ve)}ui.length!==0&&(Vt=Math.max(at-ve,Vt),Iw(ui,0,ui.length-1,vn,Nr)),at=0;const Qi=Le*Tr+Nr;Or.lineOffset=Math.max(Nr,Hr),jt+=Qi,br=Math.max(Qi,br),++Br}var Sr;const oi=jt-tc,{horizontalAlign:ai,verticalAlign:li}=df(Ye);(function(or,Tr,Hr,Or,ui,Nr,Qi,wi,Pt){const $t=(Tr-Hr)*ui;let Xt=0;Xt=Nr!==Qi?-wi*Or-tc:(-Or*Pt+.5)*Qi;for(const Li of or)for(const er of Li.positionedGlyphs)er.x+=$t,er.y+=Xt})(ge.positionedLines,vn,ai,li,Vt,br,Le,oi,Be.length),ge.top+=-li*oi,ge.bottom=ge.top+oi,ge.left+=-ai*Vt,ge.right=ge.left+Vt}(ae,t,n,a,$,g,y,x,C,k,A,B),!function(ge){for(const be of ge)if(be.positionedGlyphs.length!==0)return!1;return!0}(ee)&&ae}const qh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Sw={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},Tw={40:!0};function N_(r,t,n,a,c,m){if(t.imageName){const g=a[t.imageName];return g?g.displaySize[0]*t.scale*_r/m+c:0}{const g=n[t.fontStack],y=g&&g[r];return y?y.metrics.advance*t.scale+c:0}}function V_(r,t,n,a){const c=Math.pow(r-t,2);return a?r<t?c/2:2*c:c+Math.abs(n)*n}function kw(r,t,n){let a=0;return r===10&&(a-=1e4),n&&(a+=150),r!==40&&r!==65288||(a+=50),t!==41&&t!==65289||(a+=50),a}function j_(r,t,n,a,c,m){let g=null,y=V_(t,n,c,m);for(const x of a){const k=V_(t-x.x,n,c,m)+x.badness;k<=y&&(g=x,y=k)}return{index:r,x:t,priorBreak:g,badness:y}}function U_(r){return r?U_(r.priorBreak).concat(r.index):[]}function hf(r,t,n,a,c,m){if(!r)return[];const g=[],y=function(C,A,R,B,O,$){let X=0;for(let he=0;he<C.length();he++){const ee=C.getSection(he);X+=N_(C.getCharCode(he),ee,B,O,A,$)}return X/Math.max(1,Math.ceil(X/R))}(r,t,n,a,c,m),x=r.text.indexOf("")>=0;let k=0;for(let C=0;C<r.length();C++){const A=r.getSection(C),R=r.getCharCode(C);if(qh[R]||(k+=N_(R,A,a,c,t,m)),C<r.length()-1){const B=!((E=R)<11904)&&(!!wt["CJK Compatibility Forms"](E)||!!wt["CJK Compatibility"](E)||!!wt["CJK Strokes"](E)||!!wt["CJK Symbols and Punctuation"](E)||!!wt["Enclosed CJK Letters and Months"](E)||!!wt["Halfwidth and Fullwidth Forms"](E)||!!wt["Ideographic Description Characters"](E)||!!wt["Vertical Forms"](E)||Ph.test(String.fromCodePoint(E)));(Sw[R]||B||A.imageName||C!==r.length()-2&&Tw[r.getCharCode(C+1)])&&g.push(j_(C+1,k,y,g,kw(R,r.getCharCode(C+1),B&&x),!1))}}var E;return U_(j_(r.length(),k,y,g,0,!0))}function df(r){let t=.5,n=.5;switch(r){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(r){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:t,verticalAlign:n}}function Iw(r,t,n,a,c){if(!a&&!c)return;const m=r[n],g=(r[n].x+m.metrics.advance*m.scale)*a;for(let y=t;y<=n;y++)r[y].x-=g,r[y].y+=c}function Ew(r,t,n){const{horizontalAlign:a,verticalAlign:c}=df(n),m=t[0]-r.displaySize[0]*a,g=t[1]-r.displaySize[1]*c;return{image:r,top:g,bottom:g+r.displaySize[1],left:m,right:m+r.displaySize[0]}}function $_(r){var t,n;let a=r.left,c=r.top,m=r.right-a,g=r.bottom-c;const y=(t=r.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",x=(n=r.image.textFitHeight)!==null&&n!==void 0?n:"stretchOrShrink",k=(r.image.content[2]-r.image.content[0])/(r.image.content[3]-r.image.content[1]);if(x==="proportional"){if(y==="stretchOnly"&&m/g<k||y==="proportional"){const E=Math.ceil(g*k);a*=E/m,m=E}}else if(y==="proportional"&&x==="stretchOnly"&&k!==0&&m/g>k){const E=Math.ceil(m/k);c*=E/g,g=E}return{x1:a,y1:c,x2:a+m,y2:c+g}}function Z_(r,t,n,a,c,m){const g=r.image;let y;if(g.content){const $=g.content,X=g.pixelRatio||1;y=[$[0]/X,$[1]/X,g.displaySize[0]-$[2]/X,g.displaySize[1]-$[3]/X]}const x=t.left*m,k=t.right*m;let E,C,A,R;n==="width"||n==="both"?(R=c[0]+x-a[3],C=c[0]+k+a[1]):(R=c[0]+(x+k-g.displaySize[0])/2,C=R+g.displaySize[0]);const B=t.top*m,O=t.bottom*m;return n==="height"||n==="both"?(E=c[1]+B-a[0],A=c[1]+O+a[2]):(E=c[1]+(B+O-g.displaySize[1])/2,A=E+g.displaySize[1]),{image:g,top:E,right:C,bottom:A,left:R,collisionPadding:y}}const ic=255,Jn=128,mo=ic*Jn;function q_(r,t){const{expression:n}=t;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new qt(r+1))};if(n.kind==="source")return{kind:"source"};{const{zoomStops:a,interpolationType:c}=n;let m=0;for(;m<a.length&&a[m]<=r;)m++;m=Math.max(0,m-1);let g=m;for(;g<a.length&&a[g]<r+1;)g++;g=Math.min(a.length-1,g);const y=a[m],x=a[g];return n.kind==="composite"?{kind:"composite",minZoom:y,maxZoom:x,interpolationType:c}:{kind:"camera",minZoom:y,maxZoom:x,minSize:n.evaluate(new qt(y)),maxSize:n.evaluate(new qt(x)),interpolationType:c}}}function pf(r,t,n){let a="never";const c=r.get(t);return c?a=c:r.get(n)&&(a="always"),a}const Pw=po.VectorTileFeature.types,Cw=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Gh(r,t,n,a,c,m,g,y,x,k,E,C,A){const R=y?Math.min(mo,Math.round(y[0])):0,B=y?Math.min(mo,Math.round(y[1])):0;r.emplaceBack(t,n,Math.round(32*a),Math.round(32*c),m,g,(R<<1)+(x?1:0),B,16*k,16*E,256*C,256*A)}function ff(r,t,n){r.emplaceBack(t.x,t.y,n),r.emplaceBack(t.x,t.y,n),r.emplaceBack(t.x,t.y,n),r.emplaceBack(t.x,t.y,n)}function zw(r){for(const t of r.sections)if(jp(t.text))return!0;return!1}class mf{constructor(t){this.layoutVertexArray=new ul,this.indexArray=new Ki,this.programConfigurations=t,this.segments=new bt,this.dynamicLayoutVertexArray=new Zu,this.opacityVertexArray=new Ai,this.hasVisibleVertices=!1,this.placedSymbolArray=new Gt}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,n,a,c){this.isEmpty()||(a&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ow.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,aw.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Cw,!0),this.opacityVertexBuffer.itemSize=1),(a||c)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}$e("SymbolBuffers",mf);class gf{constructor(t,n,a){this.layoutVertexArray=new t,this.layoutAttributes=n,this.indexArray=new a,this.segments=new bt,this.collisionVertexArray=new Kn}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,lw.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}$e("CollisionBuffers",gf);class wl{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(g=>g.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Wp([]),this.placementViewportMatrix=Wp([]);const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=q_(this.zoom,n["text-size"]),this.iconSizeData=q_(this.zoom,n["icon-size"]);const a=this.layers[0].layout,c=a.get("symbol-sort-key"),m=a.get("symbol-z-order");this.canOverlap=pf(a,"text-overlap","text-allow-overlap")!=="never"||pf(a,"icon-overlap","icon-allow-overlap")!=="never"||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=m!=="viewport-y"&&!c.isConstant(),this.sortFeaturesByY=(m==="viewport-y"||m==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,a.get("symbol-placement")==="point"&&(this.writingModes=a.get("text-writing-mode").map(g=>S.ah[g])),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.sourceID=t.sourceID}createArrays(){this.text=new mf(new ha(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new mf(new ha(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new Ht,this.lineVertexArray=new Dr,this.symbolInstances=new xt,this.textAnchorOffsets=new Wt}calculateGlyphDependencies(t,n,a,c,m){for(let g=0;g<t.length;g++)if(n[t.charCodeAt(g)]=!0,(a||c)&&m){const y=ec[t.charAt(g)];y&&(n[y.charCodeAt(0)]=!0)}}populate(t,n,a){const c=this.layers[0],m=c.layout,g=m.get("text-font"),y=m.get("text-field"),x=m.get("icon-image"),k=(y.value.kind!=="constant"||y.value.value instanceof fi&&!y.value.value.isEmpty()||y.value.value.toString().length>0)&&(g.value.kind!=="constant"||g.value.value.length>0),E=x.value.kind!=="constant"||!!x.value.value||Object.keys(x.parameters).length>0,C=m.get("symbol-sort-key");if(this.features=[],!k&&!E)return;const A=n.iconDependencies,R=n.glyphDependencies,B=n.availableImages,O=new qt(this.zoom);for(const{feature:$,id:X,index:he,sourceLayerIndex:ee}of t){const ae=c._featureFilter.needGeometry,ge=pa($,ae);if(!c._featureFilter.filter(O,ge,a))continue;let be,Ne;if(ae||(ge.geometry=da($)),k){const Be=c.getValueAndResolveTokens("text-field",ge,a,B),Le=fi.factory(Be),Ye=this.hasRTLText=this.hasRTLText||zw(Le);(!Ye||yi.getRTLTextPluginStatus()==="unavailable"||Ye&&yi.isParsed())&&(be=cw(Le,c,ge))}if(E){const Be=c.getValueAndResolveTokens("icon-image",ge,a,B);Ne=Be instanceof gi?Be:gi.fromString(Be)}if(!be&&!Ne)continue;const it=this.sortFeaturesByKey?C.evaluate(ge,{},a):void 0;if(this.features.push({id:X,text:be,icon:Ne,index:he,sourceLayerIndex:ee,geometry:ge.geometry,properties:$.properties,type:Pw[$.type],sortKey:it}),Ne&&(A[Ne.name]=!0),be){const Be=g.evaluate(ge,{},a).join(","),Le=m.get("text-rotation-alignment")!=="viewport"&&m.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(S.ah.vertical)>=0;for(const Ye of be.sections)if(Ye.image)A[Ye.image.name]=!0;else{const Ze=Nu(be.toString()),Ue=Ye.fontStack||Be,ve=R[Ue]=R[Ue]||{};this.calculateGlyphDependencies(Ye.text,ve,Le,this.allowVerticalPlacement,Ze)}}}m.get("symbol-placement")==="line"&&(this.features=function($){const X={},he={},ee=[];let ae=0;function ge(Be){ee.push($[Be]),ae++}function be(Be,Le,Ye){const Ze=he[Be];return delete he[Be],he[Le]=Ze,ee[Ze].geometry[0].pop(),ee[Ze].geometry[0]=ee[Ze].geometry[0].concat(Ye[0]),Ze}function Ne(Be,Le,Ye){const Ze=X[Le];return delete X[Le],X[Be]=Ze,ee[Ze].geometry[0].shift(),ee[Ze].geometry[0]=Ye[0].concat(ee[Ze].geometry[0]),Ze}function it(Be,Le,Ye){const Ze=Ye?Le[0][Le[0].length-1]:Le[0][0];return`${Be}:${Ze.x}:${Ze.y}`}for(let Be=0;Be<$.length;Be++){const Le=$[Be],Ye=Le.geometry,Ze=Le.text?Le.text.toString():null;if(!Ze){ge(Be);continue}const Ue=it(Ze,Ye),ve=it(Ze,Ye,!0);if(Ue in he&&ve in X&&he[Ue]!==X[ve]){const Je=Ne(Ue,ve,Ye),Ke=be(Ue,ve,ee[Je].geometry);delete X[Ue],delete he[ve],he[it(Ze,ee[Ke].geometry,!0)]=Ke,ee[Je].geometry=null}else Ue in he?be(Ue,ve,Ye):ve in X?Ne(Ue,ve,Ye):(ge(Be),X[Ue]=ae-1,he[ve]=ae-1)}return ee.filter(Be=>Be.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort(($,X)=>$.sortKey-X.sortKey)}update(t,n,a){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,n,this.layers,a),this.icon.programConfigurations.updatePaintArrays(t,n,this.layers,a))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,n){const a=this.lineVertexArray.length;if(t.segment!==void 0){let c=t.dist(n[t.segment+1]),m=t.dist(n[t.segment]);const g={};for(let y=t.segment+1;y<n.length;y++)g[y]={x:n[y].x,y:n[y].y,tileUnitDistanceFromAnchor:c},y<n.length-1&&(c+=n[y+1].dist(n[y]));for(let y=t.segment||0;y>=0;y--)g[y]={x:n[y].x,y:n[y].y,tileUnitDistanceFromAnchor:m},y>0&&(m+=n[y-1].dist(n[y]));for(let y=0;y<n.length;y++){const x=g[y];this.lineVertexArray.emplaceBack(x.x,x.y,x.tileUnitDistanceFromAnchor)}}return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(t,n,a,c,m,g,y,x,k,E,C,A){const R=t.indexArray,B=t.layoutVertexArray,O=t.segments.prepareSegment(4*n.length,B,R,this.canOverlap?g.sortKey:void 0),$=this.glyphOffsetArray.length,X=O.vertexLength,he=this.allowVerticalPlacement&&y===S.ah.vertical?Math.PI/2:0,ee=g.text&&g.text.sections;for(let ae=0;ae<n.length;ae++){const{tl:ge,tr:be,bl:Ne,br:it,tex:Be,pixelOffsetTL:Le,pixelOffsetBR:Ye,minFontScaleX:Ze,minFontScaleY:Ue,glyphOffset:ve,isSDF:Je,sectionIndex:Ke}=n[ae],at=O.vertexLength,jt=ve[1];Gh(B,x.x,x.y,ge.x,jt+ge.y,Be.x,Be.y,a,Je,Le.x,Le.y,Ze,Ue),Gh(B,x.x,x.y,be.x,jt+be.y,Be.x+Be.w,Be.y,a,Je,Ye.x,Le.y,Ze,Ue),Gh(B,x.x,x.y,Ne.x,jt+Ne.y,Be.x,Be.y+Be.h,a,Je,Le.x,Ye.y,Ze,Ue),Gh(B,x.x,x.y,it.x,jt+it.y,Be.x+Be.w,Be.y+Be.h,a,Je,Ye.x,Ye.y,Ze,Ue),ff(t.dynamicLayoutVertexArray,x,he),R.emplaceBack(at,at+1,at+2),R.emplaceBack(at+1,at+2,at+3),O.vertexLength+=4,O.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ve[0]),ae!==n.length-1&&Ke===n[ae+1].sectionIndex||t.programConfigurations.populatePaintArrays(B.length,g,g.index,{},A,ee&&ee[Ke])}t.placedSymbolArray.emplaceBack(x.x,x.y,$,this.glyphOffsetArray.length-$,X,k,E,x.segment,a?a[0]:0,a?a[1]:0,c[0],c[1],y,0,!1,0,C)}_addCollisionDebugVertex(t,n,a,c,m,g){return n.emplaceBack(0,0),t.emplaceBack(a.x,a.y,c,m,Math.round(g.x),Math.round(g.y))}addCollisionDebugVertices(t,n,a,c,m,g,y){const x=m.segments.prepareSegment(4,m.layoutVertexArray,m.indexArray),k=x.vertexLength,E=m.layoutVertexArray,C=m.collisionVertexArray,A=y.anchorX,R=y.anchorY;this._addCollisionDebugVertex(E,C,g,A,R,new re(t,n)),this._addCollisionDebugVertex(E,C,g,A,R,new re(a,n)),this._addCollisionDebugVertex(E,C,g,A,R,new re(a,c)),this._addCollisionDebugVertex(E,C,g,A,R,new re(t,c)),x.vertexLength+=4;const B=m.indexArray;B.emplaceBack(k,k+1),B.emplaceBack(k+1,k+2),B.emplaceBack(k+2,k+3),B.emplaceBack(k+3,k),x.primitiveLength+=4}addDebugCollisionBoxes(t,n,a,c){for(let m=t;m<n;m++){const g=this.collisionBoxArray.get(m);this.addCollisionDebugVertices(g.x1,g.y1,g.x2,g.y2,c?this.textCollisionBox:this.iconCollisionBox,g.anchorPoint,a)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new gf(Di,P_.members,Er),this.iconCollisionBox=new gf(Di,P_.members,Er);for(let t=0;t<this.symbolInstances.length;t++){const n=this.symbolInstances.get(t);this.addDebugCollisionBoxes(n.textBoxStartIndex,n.textBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.iconBoxStartIndex,n.iconBoxEndIndex,n,!1),this.addDebugCollisionBoxes(n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex,n,!1)}}_deserializeCollisionBoxesForSymbol(t,n,a,c,m,g,y,x,k){const E={};for(let C=n;C<a;C++){const A=t.get(C);E.textBox={x1:A.x1,y1:A.y1,x2:A.x2,y2:A.y2,anchorPointX:A.anchorPointX,anchorPointY:A.anchorPointY},E.textFeatureIndex=A.featureIndex;break}for(let C=c;C<m;C++){const A=t.get(C);E.verticalTextBox={x1:A.x1,y1:A.y1,x2:A.x2,y2:A.y2,anchorPointX:A.anchorPointX,anchorPointY:A.anchorPointY},E.verticalTextFeatureIndex=A.featureIndex;break}for(let C=g;C<y;C++){const A=t.get(C);E.iconBox={x1:A.x1,y1:A.y1,x2:A.x2,y2:A.y2,anchorPointX:A.anchorPointX,anchorPointY:A.anchorPointY},E.iconFeatureIndex=A.featureIndex;break}for(let C=x;C<k;C++){const A=t.get(C);E.verticalIconBox={x1:A.x1,y1:A.y1,x2:A.x2,y2:A.y2,anchorPointX:A.anchorPointX,anchorPointY:A.anchorPointY},E.verticalIconFeatureIndex=A.featureIndex;break}return E}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const a=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,n){const a=t.placedSymbolArray.get(n),c=a.vertexStartIndex+4*a.numGlyphs;for(let m=a.vertexStartIndex;m<c;m+=4)t.indexArray.emplaceBack(m,m+1,m+2),t.indexArray.emplaceBack(m+1,m+2,m+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const n=Math.sin(t),a=Math.cos(t),c=[],m=[],g=[];for(let y=0;y<this.symbolInstances.length;++y){g.push(y);const x=this.symbolInstances.get(y);c.push(0|Math.round(n*x.anchorX+a*x.anchorY)),m.push(x.featureIndex)}return g.sort((y,x)=>c[y]-c[x]||m[x]-m[y]),g}addToSortKeyRanges(t,n){const a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===n?a.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const a=this.symbolInstances.get(n);this.featureSortOrder.push(a.featureIndex),[a.rightJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.leftJustifiedTextSymbolIndex].forEach((c,m,g)=>{c>=0&&g.indexOf(c)===m&&this.addIndicesForPlacedSymbol(this.text,c)}),a.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,a.verticalPlacedTextSymbolIndex),a.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.placedIconSymbolIndex),a.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let G_,H_;$e("SymbolBucket",wl,{omit:["layers","collisionBoxArray","features","compareText"]}),wl.MAX_GLYPHS=65535,wl.addDynamicAttributes=ff;var _f={get paint(){return H_=H_||new f({"icon-opacity":new nt(me.paint_symbol["icon-opacity"]),"icon-color":new nt(me.paint_symbol["icon-color"]),"icon-halo-color":new nt(me.paint_symbol["icon-halo-color"]),"icon-halo-width":new nt(me.paint_symbol["icon-halo-width"]),"icon-halo-blur":new nt(me.paint_symbol["icon-halo-blur"]),"icon-translate":new He(me.paint_symbol["icon-translate"]),"icon-translate-anchor":new He(me.paint_symbol["icon-translate-anchor"]),"text-opacity":new nt(me.paint_symbol["text-opacity"]),"text-color":new nt(me.paint_symbol["text-color"],{runtimeType:ti,getOverride:r=>r.textColor,hasOverride:r=>!!r.textColor}),"text-halo-color":new nt(me.paint_symbol["text-halo-color"]),"text-halo-width":new nt(me.paint_symbol["text-halo-width"]),"text-halo-blur":new nt(me.paint_symbol["text-halo-blur"]),"text-translate":new He(me.paint_symbol["text-translate"]),"text-translate-anchor":new He(me.paint_symbol["text-translate-anchor"])})},get layout(){return G_=G_||new f({"symbol-placement":new He(me.layout_symbol["symbol-placement"]),"symbol-spacing":new He(me.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new He(me.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new nt(me.layout_symbol["symbol-sort-key"]),"symbol-z-order":new He(me.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new He(me.layout_symbol["icon-allow-overlap"]),"icon-overlap":new He(me.layout_symbol["icon-overlap"]),"icon-ignore-placement":new He(me.layout_symbol["icon-ignore-placement"]),"icon-optional":new He(me.layout_symbol["icon-optional"]),"icon-rotation-alignment":new He(me.layout_symbol["icon-rotation-alignment"]),"icon-size":new nt(me.layout_symbol["icon-size"]),"icon-text-fit":new He(me.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new He(me.layout_symbol["icon-text-fit-padding"]),"icon-image":new nt(me.layout_symbol["icon-image"]),"icon-rotate":new nt(me.layout_symbol["icon-rotate"]),"icon-padding":new nt(me.layout_symbol["icon-padding"]),"icon-keep-upright":new He(me.layout_symbol["icon-keep-upright"]),"icon-offset":new nt(me.layout_symbol["icon-offset"]),"icon-anchor":new nt(me.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new He(me.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new He(me.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new He(me.layout_symbol["text-rotation-alignment"]),"text-field":new nt(me.layout_symbol["text-field"]),"text-font":new nt(me.layout_symbol["text-font"]),"text-size":new nt(me.layout_symbol["text-size"]),"text-max-width":new nt(me.layout_symbol["text-max-width"]),"text-line-height":new He(me.layout_symbol["text-line-height"]),"text-letter-spacing":new nt(me.layout_symbol["text-letter-spacing"]),"text-justify":new nt(me.layout_symbol["text-justify"]),"text-radial-offset":new nt(me.layout_symbol["text-radial-offset"]),"text-variable-anchor":new He(me.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new nt(me.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new nt(me.layout_symbol["text-anchor"]),"text-max-angle":new He(me.layout_symbol["text-max-angle"]),"text-writing-mode":new He(me.layout_symbol["text-writing-mode"]),"text-rotate":new nt(me.layout_symbol["text-rotate"]),"text-padding":new He(me.layout_symbol["text-padding"]),"text-keep-upright":new He(me.layout_symbol["text-keep-upright"]),"text-transform":new nt(me.layout_symbol["text-transform"]),"text-offset":new nt(me.layout_symbol["text-offset"]),"text-allow-overlap":new He(me.layout_symbol["text-allow-overlap"]),"text-overlap":new He(me.layout_symbol["text-overlap"]),"text-ignore-placement":new He(me.layout_symbol["text-ignore-placement"]),"text-optional":new He(me.layout_symbol["text-optional"])})}};class W_{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:Gn,this.defaultValue=t}evaluate(t){if(t.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(t.formattedSection))return n.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}$e("FormatSectionOverride",W_,{omit:["defaultValue"]});class Hh extends s{constructor(t){super(t,_f)}recalculate(t,n){if(super.recalculate(t,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const a=this.layout.get("text-writing-mode");if(a){const c=[];for(const m of a)c.indexOf(m)<0&&c.push(m);this.layout._values["text-writing-mode"]=c}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,n,a,c){const m=this.layout.get(t).evaluate(n,{},a,c),g=this._unevaluatedLayout._values[t];return g.isDataDriven()||Wa(g.value)||!m?m:function(y,x){return x.replace(/{([^{}]+)}/g,(k,E)=>y&&E in y?String(y[E]):"")}(n.properties,m)}createBucket(t){return new wl(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of _f.paint.overridableProperties){if(!Hh.hasPaintOverride(this.layout,t))continue;const n=this.paint.get(t),a=new W_(n),c=new Ha(a,n.property.specification);let m=null;m=n.value.kind==="constant"||n.value.kind==="source"?new Ys("source",c):new Js("composite",c,n.value.zoomStops),this.paint._values[t]=new _n(n.property,m,n.parameters)}}_handleOverridablePaintPropertyUpdate(t,n,a){return!(!this.layout||n.isDataDriven()||a.isDataDriven())&&Hh.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,n){const a=t.get("text-field"),c=_f.paint.properties[n];let m=!1;const g=y=>{for(const x of y)if(c.overrides&&c.overrides.hasOverride(x))return void(m=!0)};if(a.value.kind==="constant"&&a.value.value instanceof fi)g(a.value.value.sections);else if(a.value.kind==="source"){const y=k=>{m||(k instanceof Zi&&fr(k.value)===Cn?g(k.value.sections):k instanceof Oa?g(k.sections):k.eachChild(y))},x=a.value;x._styleExpression&&y(x._styleExpression.expression)}return m}}let X_;var Mw={get paint(){return X_=X_||new f({"background-color":new He(me.paint_background["background-color"]),"background-pattern":new al(me.paint_background["background-pattern"]),"background-opacity":new He(me.paint_background["background-opacity"])})}};class Aw extends s{constructor(t){super(t,Mw)}}let K_;var Dw={get paint(){return K_=K_||new f({"raster-opacity":new He(me.paint_raster["raster-opacity"]),"raster-hue-rotate":new He(me.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new He(me.paint_raster["raster-brightness-min"]),"raster-brightness-max":new He(me.paint_raster["raster-brightness-max"]),"raster-saturation":new He(me.paint_raster["raster-saturation"]),"raster-contrast":new He(me.paint_raster["raster-contrast"]),"raster-resampling":new He(me.paint_raster["raster-resampling"]),"raster-fade-duration":new He(me.paint_raster["raster-fade-duration"])})}};class Lw extends s{constructor(t){super(t,Dw)}}class Rw extends s{constructor(t){super(t,{}),this.onAdd=n=>{this.implementation.onAdd&&this.implementation.onAdd(n,n.painter.context.gl)},this.onRemove=n=>{this.implementation.onRemove&&this.implementation.onRemove(n,n.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Fw{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const yf=63710088e-1;class go{constructor(t,n){if(isNaN(t)||isNaN(n))throw new Error(`Invalid LngLat object: (${t}, ${n})`);if(this.lng=+t,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new go(Xe(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const n=Math.PI/180,a=this.lat*n,c=t.lat*n,m=Math.sin(a)*Math.sin(c)+Math.cos(a)*Math.cos(c)*Math.cos((t.lng-this.lng)*n);return yf*Math.acos(Math.min(m,1))}static convert(t){if(t instanceof go)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new go(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new go(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Y_=2*Math.PI*yf;function J_(r){return Y_*Math.cos(r*Math.PI/180)}function Q_(r){return(180+r)/360}function ey(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function ty(r,t){return r/J_(t)}function vf(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}class nc{constructor(t,n,a=0){this.x=+t,this.y=+n,this.z=+a}static fromLngLat(t,n=0){const a=go.convert(t);return new nc(Q_(a.lng),ey(a.lat),ty(n,a.lat))}toLngLat(){return new go(360*this.x-180,vf(this.y))}toAltitude(){return this.z*J_(vf(this.y))}meterInMercatorCoordinateUnits(){return 1/Y_*(t=vf(this.y),1/Math.cos(t*Math.PI/180));var t}}function ry(r,t,n){var a=2*Math.PI*6378137/256/Math.pow(2,n);return[r*a-2*Math.PI*6378137/2,t*a-2*Math.PI*6378137/2]}class xf{constructor(t,n,a){if(!function(c,m,g){return!(c<0||c>25||g<0||g>=Math.pow(2,c)||m<0||m>=Math.pow(2,c))}(t,n,a))throw new Error(`x=${n}, y=${a}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=n,this.y=a,this.key=sc(0,t,t,n,a)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,n,a){const c=(g=this.y,y=this.z,x=ry(256*(m=this.x),256*(g=Math.pow(2,y)-g-1),y),k=ry(256*(m+1),256*(g+1),y),x[0]+","+x[1]+","+k[0]+","+k[1]);var m,g,y,x,k;const E=function(C,A,R){let B,O="";for(let $=C;$>0;$--)B=1<<$-1,O+=(A&B?1:0)+(R&B?2:0);return O}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(a==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,n>1?"@2x":"").replace(/{quadkey}/g,E).replace(/{bbox-epsg-3857}/g,c)}isChildOf(t){const n=this.z-t.z;return n>0&&t.x===this.x>>n&&t.y===this.y>>n}getTilePoint(t){const n=Math.pow(2,this.z);return new re((t.x*n-this.x)*mr,(t.y*n-this.y)*mr)}toString(){return`${this.z}/${this.x}/${this.y}`}}class iy{constructor(t,n){this.wrap=t,this.canonical=n,this.key=sc(t,n.z,n.z,n.x,n.y)}}class Ji{constructor(t,n,a,c,m){if(t<a)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${a}`);this.overscaledZ=t,this.wrap=n,this.canonical=new xf(a,+c,+m),this.key=sc(n,t,a,c,m)}clone(){return new Ji(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const n=this.canonical.z-t;return t>this.canonical.z?new Ji(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Ji(t,this.wrap,t,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(t,n){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const a=this.canonical.z-t;return t>this.canonical.z?sc(this.wrap*+n,t,this.canonical.z,this.canonical.x,this.canonical.y):sc(this.wrap*+n,t,t,this.canonical.x>>a,this.canonical.y>>a)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const n=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>n&&t.canonical.y===this.canonical.y>>n}children(t){if(this.overscaledZ>=t)return[new Ji(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,a=2*this.canonical.x,c=2*this.canonical.y;return[new Ji(n,this.wrap,n,a,c),new Ji(n,this.wrap,n,a+1,c),new Ji(n,this.wrap,n,a,c+1),new Ji(n,this.wrap,n,a+1,c+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Ji(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Ji(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new iy(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new nc(t.x-this.wrap,t.y))}}function sc(r,t,n,a,c){(r*=2)<0&&(r=-1*r-1);const m=1<<n;return(m*m*r+m*c+a).toString(36)+n.toString(36)+t.toString(36)}$e("CanonicalTileID",xf),$e("OverscaledTileID",Ji,{omit:["posMatrix"]});class ny{constructor(t,n,a,c=1,m=1,g=1,y=0){if(this.uid=t,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(a&&!["mapbox","terrarium","custom"].includes(a))return void ir(`"${a}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=n.height;const x=this.dim=n.height-2;switch(this.data=new Uint32Array(n.data.buffer),a){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=c,this.greenFactor=m,this.blueFactor=g,this.baseShift=y;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let k=0;k<x;k++)this.data[this._idx(-1,k)]=this.data[this._idx(0,k)],this.data[this._idx(x,k)]=this.data[this._idx(x-1,k)],this.data[this._idx(k,-1)]=this.data[this._idx(k,0)],this.data[this._idx(k,x)]=this.data[this._idx(k,x-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(x,-1)]=this.data[this._idx(x-1,0)],this.data[this._idx(-1,x)]=this.data[this._idx(0,x-1)],this.data[this._idx(x,x)]=this.data[this._idx(x-1,x-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let k=0;k<x;k++)for(let E=0;E<x;E++){const C=this.get(k,E);C>this.max&&(this.max=C),C<this.min&&(this.min=C)}}get(t,n){const a=new Uint8Array(this.data.buffer),c=4*this._idx(t,n);return this.unpack(a[c],a[c+1],a[c+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,n){if(t<-1||t>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(t+1)}unpack(t,n,a){return t*this.redFactor+n*this.greenFactor+a*this.blueFactor-this.baseShift}getPixels(){return new Yi({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,n,a){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let c=n*this.dim,m=n*this.dim+this.dim,g=a*this.dim,y=a*this.dim+this.dim;switch(n){case-1:c=m-1;break;case 1:m=c+1}switch(a){case-1:g=y-1;break;case 1:y=g+1}const x=-n*this.dim,k=-a*this.dim;for(let E=g;E<y;E++)for(let C=c;C<m;C++)this.data[this._idx(C,E)]=t.data[this._idx(C+x,E+k)]}}$e("DEMData",ny);class sy{constructor(t){this._stringToNumber={},this._numberToString=[];for(let n=0;n<t.length;n++){const a=t[n];this._stringToNumber[a]=n,this._numberToString[n]=a}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class oy{constructor(t,n,a,c,m){this.type="Feature",this._vectorTileFeature=t,t._z=n,t._x=a,t._y=c,this.properties=t.properties,this.id=m}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const n in this)n!=="_geometry"&&n!=="_vectorTileFeature"&&(t[n]=this[n]);return t}}class ay{constructor(t,n){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new to(mr,16,0),this.grid3D=new to(mr,16,0),this.featureIndexArray=new qr,this.promoteId=n}insert(t,n,a,c,m,g){const y=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,c,m);const x=g?this.grid3D:this.grid;for(let k=0;k<n.length;k++){const E=n[k],C=[1/0,1/0,-1/0,-1/0];for(let A=0;A<E.length;A++){const R=E[A];C[0]=Math.min(C[0],R.x),C[1]=Math.min(C[1],R.y),C[2]=Math.max(C[2],R.x),C[3]=Math.max(C[3],R.y)}C[0]<mr&&C[1]<mr&&C[2]>=0&&C[3]>=0&&x.insert(y,C[0],C[1],C[2],C[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new po.VectorTile(new lf(this.rawTileData)).layers,this.sourceLayerCoder=new sy(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,n,a,c){this.loadVTLayers();const m=t.params||{},g=mr/t.tileSize/t.scale,y=Tu(m.filter),x=t.queryGeometry,k=t.queryPadding*g,E=uy(x),C=this.grid.query(E.minX-k,E.minY-k,E.maxX+k,E.maxY+k),A=uy(t.cameraQueryGeometry),R=this.grid3D.query(A.minX-k,A.minY-k,A.maxX+k,A.maxY+k,($,X,he,ee)=>function(ae,ge,be,Ne,it){for(const Le of ae)if(ge<=Le.x&&be<=Le.y&&Ne>=Le.x&&it>=Le.y)return!0;const Be=[new re(ge,be),new re(ge,it),new re(Ne,it),new re(Ne,be)];if(ae.length>2){for(const Le of Be)if(fl(ae,Le))return!0}for(let Le=0;Le<ae.length-1;Le++)if(g1(ae[Le],ae[Le+1],Be))return!0;return!1}(t.cameraQueryGeometry,$-k,X-k,he+k,ee+k));for(const $ of R)C.push($);C.sort(Bw);const B={};let O;for(let $=0;$<C.length;$++){const X=C[$];if(X===O)continue;O=X;const he=this.featureIndexArray.get(X);let ee=null;this.loadMatchingFeature(B,he.bucketIndex,he.sourceLayerIndex,he.featureIndex,y,m.layers,m.availableImages,n,a,c,(ae,ge,be)=>(ee||(ee=da(ae)),ge.queryIntersectsFeature(x,ae,be,ee,this.z,t.transform,g,t.pixelPosMatrix)))}return B}loadMatchingFeature(t,n,a,c,m,g,y,x,k,E,C){const A=this.bucketLayerIDs[n];if(g&&!function($,X){for(let he=0;he<$.length;he++)if(X.indexOf($[he])>=0)return!0;return!1}(g,A))return;const R=this.sourceLayerCoder.decode(a),B=this.vtLayers[R].feature(c);if(m.needGeometry){const $=pa(B,!0);if(!m.filter(new qt(this.tileID.overscaledZ),$,this.tileID.canonical))return}else if(!m.filter(new qt(this.tileID.overscaledZ),B))return;const O=this.getId(B,R);for(let $=0;$<A.length;$++){const X=A[$];if(g&&g.indexOf(X)<0)continue;const he=x[X];if(!he)continue;let ee={};O&&E&&(ee=E.getState(he.sourceLayer||"_geojsonTileLayer",O));const ae=qe({},k[X]);ae.paint=ly(ae.paint,he.paint,B,ee,y),ae.layout=ly(ae.layout,he.layout,B,ee,y);const ge=!C||C(B,he,ee);if(!ge)continue;const be=new oy(B,this.z,this.x,this.y,O);be.layer=ae;let Ne=t[X];Ne===void 0&&(Ne=t[X]=[]),Ne.push({featureIndex:c,feature:be,intersectionZ:ge})}}lookupSymbolFeatures(t,n,a,c,m,g,y,x){const k={};this.loadVTLayers();const E=Tu(m);for(const C of t)this.loadMatchingFeature(k,a,c,C,E,g,y,x,n);return k}hasLayer(t){for(const n of this.bucketLayerIDs)for(const a of n)if(t===a)return!0;return!1}getId(t,n){let a=t.id;return this.promoteId&&(a=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[n]],typeof a=="boolean"&&(a=Number(a))),a}}function ly(r,t,n,a,c){return At(r,(m,g)=>{const y=t instanceof la?t.get(g):null;return y&&y.evaluate?y.evaluate(n,a,c):y})}function uy(r){let t=1/0,n=1/0,a=-1/0,c=-1/0;for(const m of r)t=Math.min(t,m.x),n=Math.min(n,m.y),a=Math.max(a,m.x),c=Math.max(c,m.y);return{minX:t,minY:n,maxX:a,maxY:c}}function Bw(r,t){return t-r}function cy(r,t,n,a,c){const m=[];for(let g=0;g<r.length;g++){const y=r[g];let x;for(let k=0;k<y.length-1;k++){let E=y[k],C=y[k+1];E.x<t&&C.x<t||(E.x<t?E=new re(t,E.y+(t-E.x)/(C.x-E.x)*(C.y-E.y))._round():C.x<t&&(C=new re(t,E.y+(t-E.x)/(C.x-E.x)*(C.y-E.y))._round()),E.y<n&&C.y<n||(E.y<n?E=new re(E.x+(n-E.y)/(C.y-E.y)*(C.x-E.x),n)._round():C.y<n&&(C=new re(E.x+(n-E.y)/(C.y-E.y)*(C.x-E.x),n)._round()),E.x>=a&&C.x>=a||(E.x>=a?E=new re(a,E.y+(a-E.x)/(C.x-E.x)*(C.y-E.y))._round():C.x>=a&&(C=new re(a,E.y+(a-E.x)/(C.x-E.x)*(C.y-E.y))._round()),E.y>=c&&C.y>=c||(E.y>=c?E=new re(E.x+(c-E.y)/(C.y-E.y)*(C.x-E.x),c)._round():C.y>=c&&(C=new re(E.x+(c-E.y)/(C.y-E.y)*(C.x-E.x),c)._round()),x&&E.equals(x[x.length-1])||(x=[E],m.push(x)),x.push(C)))))}}return m}$e("FeatureIndex",ay,{omit:["rawTileData","sourceLayerCoder"]});class _o extends re{constructor(t,n,a,c){super(t,n),this.angle=a,c!==void 0&&(this.segment=c)}clone(){return new _o(this.x,this.y,this.angle,this.segment)}}function hy(r,t,n,a,c){if(t.segment===void 0||n===0)return!0;let m=t,g=t.segment+1,y=0;for(;y>-n/2;){if(g--,g<0)return!1;y-=r[g].dist(m),m=r[g]}y+=r[g].dist(r[g+1]),g++;const x=[];let k=0;for(;y<n/2;){const E=r[g],C=r[g+1];if(!C)return!1;let A=r[g-1].angleTo(E)-E.angleTo(C);for(A=Math.abs((A+3*Math.PI)%(2*Math.PI)-Math.PI),x.push({distance:y,angleDelta:A}),k+=A;y-x[0].distance>a;)k-=x.shift().angleDelta;if(k>c)return!1;g++,y+=E.dist(C)}return!0}function dy(r){let t=0;for(let n=0;n<r.length-1;n++)t+=r[n].dist(r[n+1]);return t}function py(r,t,n){return r?.6*t*n:0}function fy(r,t){return Math.max(r?r.right-r.left:0,t?t.right-t.left:0)}function Ow(r,t,n,a,c,m){const g=py(n,c,m),y=fy(n,a)*m;let x=0;const k=dy(r)/2;for(let E=0;E<r.length-1;E++){const C=r[E],A=r[E+1],R=C.dist(A);if(x+R>k){const B=(k-x)/R,O=ri.number(C.x,A.x,B),$=ri.number(C.y,A.y,B),X=new _o(O,$,A.angleTo(C),E);return X._round(),!g||hy(r,X,y,g,t)?X:void 0}x+=R}}function Nw(r,t,n,a,c,m,g,y,x){const k=py(a,m,g),E=fy(a,c),C=E*g,A=r[0].x===0||r[0].x===x||r[0].y===0||r[0].y===x;return t-C<t/4&&(t=C+t/4),my(r,A?t/2*y%t:(E/2+2*m)*g*y%t,t,k,n,C,A,!1,x)}function my(r,t,n,a,c,m,g,y,x){const k=m/2,E=dy(r);let C=0,A=t-n,R=[];for(let B=0;B<r.length-1;B++){const O=r[B],$=r[B+1],X=O.dist($),he=$.angleTo(O);for(;A+n<C+X;){A+=n;const ee=(A-C)/X,ae=ri.number(O.x,$.x,ee),ge=ri.number(O.y,$.y,ee);if(ae>=0&&ae<x&&ge>=0&&ge<x&&A-k>=0&&A+k<=E){const be=new _o(ae,ge,he,B);be._round(),a&&!hy(r,be,m,a,c)||R.push(be)}}C+=X}return y||R.length||g||(R=my(r,C/2,n,a,c,m,g,!0,x)),R}$e("Anchor",_o);const bl=xi;function gy(r,t,n,a){const c=[],m=r.image,g=m.pixelRatio,y=m.paddedRect.w-2*bl,x=m.paddedRect.h-2*bl;let k={x1:r.left,y1:r.top,x2:r.right,y2:r.bottom};const E=m.stretchX||[[0,y]],C=m.stretchY||[[0,x]],A=(ve,Je)=>ve+Je[1]-Je[0],R=E.reduce(A,0),B=C.reduce(A,0),O=y-R,$=x-B;let X=0,he=R,ee=0,ae=B,ge=0,be=O,Ne=0,it=$;if(m.content&&a){const ve=m.content,Je=ve[2]-ve[0],Ke=ve[3]-ve[1];(m.textFitWidth||m.textFitHeight)&&(k=$_(r)),X=Wh(E,0,ve[0]),ee=Wh(C,0,ve[1]),he=Wh(E,ve[0],ve[2]),ae=Wh(C,ve[1],ve[3]),ge=ve[0]-X,Ne=ve[1]-ee,be=Je-he,it=Ke-ae}const Be=k.x1,Le=k.y1,Ye=k.x2-Be,Ze=k.y2-Le,Ue=(ve,Je,Ke,at)=>{const jt=Xh(ve.stretch-X,he,Ye,Be),Vt=Kh(ve.fixed-ge,be,ve.stretch,R),br=Xh(Je.stretch-ee,ae,Ze,Le),vn=Kh(Je.fixed-Ne,it,Je.stretch,B),Br=Xh(Ke.stretch-X,he,Ye,Be),Sr=Kh(Ke.fixed-ge,be,Ke.stretch,R),oi=Xh(at.stretch-ee,ae,Ze,Le),ai=Kh(at.fixed-Ne,it,at.stretch,B),li=new re(jt,br),or=new re(Br,br),Tr=new re(Br,oi),Hr=new re(jt,oi),Or=new re(Vt/g,vn/g),ui=new re(Sr/g,ai/g),Nr=t*Math.PI/180;if(Nr){const Pt=Math.sin(Nr),$t=Math.cos(Nr),Xt=[$t,-Pt,Pt,$t];li._matMult(Xt),or._matMult(Xt),Hr._matMult(Xt),Tr._matMult(Xt)}const Qi=ve.stretch+ve.fixed,wi=Je.stretch+Je.fixed;return{tl:li,tr:or,bl:Hr,br:Tr,tex:{x:m.paddedRect.x+bl+Qi,y:m.paddedRect.y+bl+wi,w:Ke.stretch+Ke.fixed-Qi,h:at.stretch+at.fixed-wi},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Or,pixelOffsetBR:ui,minFontScaleX:be/g/Ye,minFontScaleY:it/g/Ze,isSDF:n}};if(a&&(m.stretchX||m.stretchY)){const ve=_y(E,O,R),Je=_y(C,$,B);for(let Ke=0;Ke<ve.length-1;Ke++){const at=ve[Ke],jt=ve[Ke+1];for(let Vt=0;Vt<Je.length-1;Vt++)c.push(Ue(at,Je[Vt],jt,Je[Vt+1]))}}else c.push(Ue({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:y+1},{fixed:0,stretch:x+1}));return c}function Wh(r,t,n){let a=0;for(const c of r)a+=Math.max(t,Math.min(n,c[1]))-Math.max(t,Math.min(n,c[0]));return a}function _y(r,t,n){const a=[{fixed:-bl,stretch:0}];for(const[c,m]of r){const g=a[a.length-1];a.push({fixed:c-g.stretch,stretch:g.stretch}),a.push({fixed:c-g.stretch,stretch:g.stretch+(m-c)})}return a.push({fixed:t+bl,stretch:n}),a}function Xh(r,t,n,a){return r/t*n+a}function Kh(r,t,n,a){return r-t*n/a}class Yh{constructor(t,n,a,c,m,g,y,x,k,E){var C;if(this.boxStartIndex=t.length,k){let A=g.top,R=g.bottom;const B=g.collisionPadding;B&&(A-=B[1],R+=B[3]);let O=R-A;O>0&&(O=Math.max(10,O),this.circleDiameter=O)}else{const A=!((C=g.image)===null||C===void 0)&&C.content&&(g.image.textFitWidth||g.image.textFitHeight)?$_(g):{x1:g.left,y1:g.top,x2:g.right,y2:g.bottom};A.y1=A.y1*y-x[0],A.y2=A.y2*y+x[2],A.x1=A.x1*y-x[3],A.x2=A.x2*y+x[1];const R=g.collisionPadding;if(R&&(A.x1-=R[0]*y,A.y1-=R[1]*y,A.x2+=R[2]*y,A.y2+=R[3]*y),E){const B=new re(A.x1,A.y1),O=new re(A.x2,A.y1),$=new re(A.x1,A.y2),X=new re(A.x2,A.y2),he=E*Math.PI/180;B._rotate(he),O._rotate(he),$._rotate(he),X._rotate(he),A.x1=Math.min(B.x,O.x,$.x,X.x),A.x2=Math.max(B.x,O.x,$.x,X.x),A.y1=Math.min(B.y,O.y,$.y,X.y),A.y2=Math.max(B.y,O.y,$.y,X.y)}t.emplaceBack(n.x,n.y,A.x1,A.y1,A.x2,A.y2,a,c,m)}this.boxEndIndex=t.length}}class Vw{constructor(t=[],n=(a,c)=>a<c?-1:a>c?1:0){if(this.data=t,this.length=this.data.length,this.compare=n,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],n=this.data.pop();return--this.length>0&&(this.data[0]=n,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:n,compare:a}=this,c=n[t];for(;t>0;){const m=t-1>>1,g=n[m];if(a(c,g)>=0)break;n[t]=g,t=m}n[t]=c}_down(t){const{data:n,compare:a}=this,c=this.length>>1,m=n[t];for(;t<c;){let g=1+(t<<1);const y=g+1;if(y<this.length&&a(n[y],n[g])<0&&(g=y),a(n[g],m)>=0)break;n[t]=n[g],t=g}n[t]=m}}function jw(r,t=1,n=!1){let a=1/0,c=1/0,m=-1/0,g=-1/0;const y=r[0];for(let R=0;R<y.length;R++){const B=y[R];(!R||B.x<a)&&(a=B.x),(!R||B.y<c)&&(c=B.y),(!R||B.x>m)&&(m=B.x),(!R||B.y>g)&&(g=B.y)}const x=Math.min(m-a,g-c);let k=x/2;const E=new Vw([],Uw);if(x===0)return new re(a,c);for(let R=a;R<m;R+=x)for(let B=c;B<g;B+=x)E.push(new Sl(R+k,B+k,k,r));let C=function(R){let B=0,O=0,$=0;const X=R[0];for(let he=0,ee=X.length,ae=ee-1;he<ee;ae=he++){const ge=X[he],be=X[ae],Ne=ge.x*be.y-be.x*ge.y;O+=(ge.x+be.x)*Ne,$+=(ge.y+be.y)*Ne,B+=3*Ne}return new Sl(O/B,$/B,0,R)}(r),A=E.length;for(;E.length;){const R=E.pop();(R.d>C.d||!C.d)&&(C=R,n&&console.log("found best %d after %d probes",Math.round(1e4*R.d)/1e4,A)),R.max-C.d<=t||(k=R.h/2,E.push(new Sl(R.p.x-k,R.p.y-k,k,r)),E.push(new Sl(R.p.x+k,R.p.y-k,k,r)),E.push(new Sl(R.p.x-k,R.p.y+k,k,r)),E.push(new Sl(R.p.x+k,R.p.y+k,k,r)),A+=4)}return n&&(console.log(`num probes: ${A}`),console.log(`best distance: ${C.d}`)),C.p}function Uw(r,t){return t.max-r.max}function Sl(r,t,n,a){this.p=new re(r,t),this.h=n,this.d=function(c,m){let g=!1,y=1/0;for(let x=0;x<m.length;x++){const k=m[x];for(let E=0,C=k.length,A=C-1;E<C;A=E++){const R=k[E],B=k[A];R.y>c.y!=B.y>c.y&&c.x<(B.x-R.x)*(c.y-R.y)/(B.y-R.y)+R.x&&(g=!g),y=Math.min(y,e_(c,R,B))}}return(g?1:-1)*Math.sqrt(y)}(this.p,a),this.max=this.d+this.h*Math.SQRT2}var Fr;S.aq=void 0,(Fr=S.aq||(S.aq={}))[Fr.center=1]="center",Fr[Fr.left=2]="left",Fr[Fr.right=3]="right",Fr[Fr.top=4]="top",Fr[Fr.bottom=5]="bottom",Fr[Fr["top-left"]=6]="top-left",Fr[Fr["top-right"]=7]="top-right",Fr[Fr["bottom-left"]=8]="bottom-left",Fr[Fr["bottom-right"]=9]="bottom-right";const yo=7,wf=Number.POSITIVE_INFINITY;function yy(r,t){return t[1]!==wf?function(n,a,c){let m=0,g=0;switch(a=Math.abs(a),c=Math.abs(c),n){case"top-right":case"top-left":case"top":g=c-yo;break;case"bottom-right":case"bottom-left":case"bottom":g=-c+yo}switch(n){case"top-right":case"bottom-right":case"right":m=-a;break;case"top-left":case"bottom-left":case"left":m=a}return[m,g]}(r,t[0],t[1]):function(n,a){let c=0,m=0;a<0&&(a=0);const g=a/Math.SQRT2;switch(n){case"top-right":case"top-left":m=g-yo;break;case"bottom-right":case"bottom-left":m=-g+yo;break;case"bottom":m=-a+yo;break;case"top":m=a-yo}switch(n){case"top-right":case"bottom-right":c=-g;break;case"top-left":case"bottom-left":c=g;break;case"left":c=a;break;case"right":c=-a}return[c,m]}(r,t[0])}function vy(r,t,n){var a;const c=r.layout,m=(a=c.get("text-variable-anchor-offset"))===null||a===void 0?void 0:a.evaluate(t,{},n);if(m){const y=m.values,x=[];for(let k=0;k<y.length;k+=2){const E=x[k]=y[k],C=y[k+1].map(A=>A*_r);E.startsWith("top")?C[1]-=yo:E.startsWith("bottom")&&(C[1]+=yo),x[k+1]=C}return new Ei(x)}const g=c.get("text-variable-anchor");if(g){let y;y=r._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[c.get("text-radial-offset").evaluate(t,{},n)*_r,wf]:c.get("text-offset").evaluate(t,{},n).map(k=>k*_r);const x=[];for(const k of g)x.push(k,yy(k,y));return new Ei(x)}return null}function bf(r){switch(r){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function $w(r,t,n,a,c,m,g,y,x,k,E){let C=m.textMaxSize.evaluate(t,{});C===void 0&&(C=g);const A=r.layers[0].layout,R=A.get("icon-offset").evaluate(t,{},E),B=wy(n.horizontal),O=g/24,$=r.tilePixelRatio*O,X=r.tilePixelRatio*C/24,he=r.tilePixelRatio*y,ee=r.tilePixelRatio*A.get("symbol-spacing"),ae=A.get("text-padding")*r.tilePixelRatio,ge=function(ve,Je,Ke,at=1){const jt=ve.get("icon-padding").evaluate(Je,{},Ke),Vt=jt&&jt.values;return[Vt[0]*at,Vt[1]*at,Vt[2]*at,Vt[3]*at]}(A,t,E,r.tilePixelRatio),be=A.get("text-max-angle")/180*Math.PI,Ne=A.get("text-rotation-alignment")!=="viewport"&&A.get("symbol-placement")!=="point",it=A.get("icon-rotation-alignment")==="map"&&A.get("symbol-placement")!=="point",Be=A.get("symbol-placement"),Le=ee/2,Ye=A.get("icon-text-fit");let Ze;a&&Ye!=="none"&&(r.allowVerticalPlacement&&n.vertical&&(Ze=Z_(a,n.vertical,Ye,A.get("icon-text-fit-padding"),R,O)),B&&(a=Z_(a,B,Ye,A.get("icon-text-fit-padding"),R,O)));const Ue=(ve,Je)=>{Je.x<0||Je.x>=mr||Je.y<0||Je.y>=mr||function(Ke,at,jt,Vt,br,vn,Br,Sr,oi,ai,li,or,Tr,Hr,Or,ui,Nr,Qi,wi,Pt,$t,Xt,Li,er,Tl){const Qn=Ke.addToLineVertexArray(at,jt);let es,xn,en,Pr,ks=0,lc=0,ky=0,Iy=0,zf=-1,Mf=-1;const Is={};let Ey=cl("");if(Ke.allowVerticalPlacement&&Vt.vertical){const Wr=Sr.layout.get("text-rotate").evaluate($t,{},er)+90;en=new Yh(oi,at,ai,li,or,Vt.vertical,Tr,Hr,Or,Wr),Br&&(Pr=new Yh(oi,at,ai,li,or,Br,Nr,Qi,Or,Wr))}if(br){const Wr=Sr.layout.get("icon-rotate").evaluate($t,{}),tn=Sr.layout.get("icon-text-fit")!=="none",ma=gy(br,Wr,Li,tn),Ln=Br?gy(Br,Wr,Li,tn):void 0;xn=new Yh(oi,at,ai,li,or,br,Nr,Qi,!1,Wr),ks=4*ma.length;const ga=Ke.iconSizeData;let ts=null;ga.kind==="source"?(ts=[Jn*Sr.layout.get("icon-size").evaluate($t,{})],ts[0]>mo&&ir(`${Ke.layerIds[0]}: Value for "icon-size" is >= ${ic}. Reduce your "icon-size".`)):ga.kind==="composite"&&(ts=[Jn*Xt.compositeIconSizes[0].evaluate($t,{},er),Jn*Xt.compositeIconSizes[1].evaluate($t,{},er)],(ts[0]>mo||ts[1]>mo)&&ir(`${Ke.layerIds[0]}: Value for "icon-size" is >= ${ic}. Reduce your "icon-size".`)),Ke.addSymbols(Ke.icon,ma,ts,Pt,wi,$t,S.ah.none,at,Qn.lineStartIndex,Qn.lineLength,-1,er),zf=Ke.icon.placedSymbolArray.length-1,Ln&&(lc=4*Ln.length,Ke.addSymbols(Ke.icon,Ln,ts,Pt,wi,$t,S.ah.vertical,at,Qn.lineStartIndex,Qn.lineLength,-1,er),Mf=Ke.icon.placedSymbolArray.length-1)}const Py=Object.keys(Vt.horizontal);for(const Wr of Py){const tn=Vt.horizontal[Wr];if(!es){Ey=cl(tn.text);const Ln=Sr.layout.get("text-rotate").evaluate($t,{},er);es=new Yh(oi,at,ai,li,or,tn,Tr,Hr,Or,Ln)}const ma=tn.positionedLines.length===1;if(ky+=xy(Ke,at,tn,vn,Sr,Or,$t,ui,Qn,Vt.vertical?S.ah.horizontal:S.ah.horizontalOnly,ma?Py:[Wr],Is,zf,Xt,er),ma)break}Vt.vertical&&(Iy+=xy(Ke,at,Vt.vertical,vn,Sr,Or,$t,ui,Qn,S.ah.vertical,["vertical"],Is,Mf,Xt,er));const Gw=es?es.boxStartIndex:Ke.collisionBoxArray.length,Hw=es?es.boxEndIndex:Ke.collisionBoxArray.length,Ww=en?en.boxStartIndex:Ke.collisionBoxArray.length,Xw=en?en.boxEndIndex:Ke.collisionBoxArray.length,Kw=xn?xn.boxStartIndex:Ke.collisionBoxArray.length,Yw=xn?xn.boxEndIndex:Ke.collisionBoxArray.length,Jw=Pr?Pr.boxStartIndex:Ke.collisionBoxArray.length,Qw=Pr?Pr.boxEndIndex:Ke.collisionBoxArray.length;let Dn=-1;const Qh=(Wr,tn)=>Wr&&Wr.circleDiameter?Math.max(Wr.circleDiameter,tn):tn;Dn=Qh(es,Dn),Dn=Qh(en,Dn),Dn=Qh(xn,Dn),Dn=Qh(Pr,Dn);const Cy=Dn>-1?1:0;Cy&&(Dn*=Tl/_r),Ke.glyphOffsetArray.length>=wl.MAX_GLYPHS&&ir("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),$t.sortKey!==void 0&&Ke.addToSortKeyRanges(Ke.symbolInstances.length,$t.sortKey);const eb=vy(Sr,$t,er),[tb,rb]=function(Wr,tn){const ma=Wr.length,Ln=tn==null?void 0:tn.values;if((Ln==null?void 0:Ln.length)>0)for(let ga=0;ga<Ln.length;ga+=2){const ts=Ln[ga+1];Wr.emplaceBack(S.aq[Ln[ga]],ts[0],ts[1])}return[ma,Wr.length]}(Ke.textAnchorOffsets,eb);Ke.symbolInstances.emplaceBack(at.x,at.y,Is.right>=0?Is.right:-1,Is.center>=0?Is.center:-1,Is.left>=0?Is.left:-1,Is.vertical||-1,zf,Mf,Ey,Gw,Hw,Ww,Xw,Kw,Yw,Jw,Qw,ai,ky,Iy,ks,lc,Cy,0,Tr,Dn,tb,rb)}(r,Je,ve,n,a,c,Ze,r.layers[0],r.collisionBoxArray,t.index,t.sourceLayerIndex,r.index,$,[ae,ae,ae,ae],Ne,x,he,ge,it,R,t,m,k,E,g)};if(Be==="line")for(const ve of cy(t.geometry,0,0,mr,mr)){const Je=Nw(ve,ee,be,n.vertical||B,a,24,X,r.overscaling,mr);for(const Ke of Je)B&&Zw(r,B.text,Le,Ke)||Ue(ve,Ke)}else if(Be==="line-center"){for(const ve of t.geometry)if(ve.length>1){const Je=Ow(ve,be,n.vertical||B,a,24,X);Je&&Ue(ve,Je)}}else if(t.type==="Polygon")for(const ve of Va(t.geometry,0)){const Je=jw(ve,16);Ue(ve[0],new _o(Je.x,Je.y,0))}else if(t.type==="LineString")for(const ve of t.geometry)Ue(ve,new _o(ve[0].x,ve[0].y,0));else if(t.type==="Point")for(const ve of t.geometry)for(const Je of ve)Ue([Je],new _o(Je.x,Je.y,0))}function xy(r,t,n,a,c,m,g,y,x,k,E,C,A,R,B){const O=function(he,ee,ae,ge,be,Ne,it,Be){const Le=ge.layout.get("text-rotate").evaluate(Ne,{})*Math.PI/180,Ye=[];for(const Ze of ee.positionedLines)for(const Ue of Ze.positionedGlyphs){if(!Ue.rect)continue;const ve=Ue.rect||{};let Je=F_+1,Ke=!0,at=1,jt=0;const Vt=(be||Be)&&Ue.vertical,br=Ue.metrics.advance*Ue.scale/2;if(Be&&ee.verticalizable&&(jt=Ze.lineOffset/2-(Ue.imageName?-(_r-Ue.metrics.width*Ue.scale)/2:(Ue.scale-1)*_r)),Ue.imageName){const Pt=it[Ue.imageName];Ke=Pt.sdf,at=Pt.pixelRatio,Je=xi/at}const vn=be?[Ue.x+br,Ue.y]:[0,0];let Br=be?[0,0]:[Ue.x+br+ae[0],Ue.y+ae[1]-jt],Sr=[0,0];Vt&&(Sr=Br,Br=[0,0]);const oi=Ue.metrics.isDoubleResolution?2:1,ai=(Ue.metrics.left-Je)*Ue.scale-br+Br[0],li=(-Ue.metrics.top-Je)*Ue.scale+Br[1],or=ai+ve.w/oi*Ue.scale/at,Tr=li+ve.h/oi*Ue.scale/at,Hr=new re(ai,li),Or=new re(or,li),ui=new re(ai,Tr),Nr=new re(or,Tr);if(Vt){const Pt=new re(-br,br-tc),$t=-Math.PI/2,Xt=_r/2-br,Li=new re(5-tc-Xt,-(Ue.imageName?Xt:0)),er=new re(...Sr);Hr._rotateAround($t,Pt)._add(Li)._add(er),Or._rotateAround($t,Pt)._add(Li)._add(er),ui._rotateAround($t,Pt)._add(Li)._add(er),Nr._rotateAround($t,Pt)._add(Li)._add(er)}if(Le){const Pt=Math.sin(Le),$t=Math.cos(Le),Xt=[$t,-Pt,Pt,$t];Hr._matMult(Xt),Or._matMult(Xt),ui._matMult(Xt),Nr._matMult(Xt)}const Qi=new re(0,0),wi=new re(0,0);Ye.push({tl:Hr,tr:Or,bl:ui,br:Nr,tex:ve,writingMode:ee.writingMode,glyphOffset:vn,sectionIndex:Ue.sectionIndex,isSDF:Ke,pixelOffsetTL:Qi,pixelOffsetBR:wi,minFontScaleX:0,minFontScaleY:0})}return Ye}(0,n,y,c,m,g,a,r.allowVerticalPlacement),$=r.textSizeData;let X=null;$.kind==="source"?(X=[Jn*c.layout.get("text-size").evaluate(g,{})],X[0]>mo&&ir(`${r.layerIds[0]}: Value for "text-size" is >= ${ic}. Reduce your "text-size".`)):$.kind==="composite"&&(X=[Jn*R.compositeTextSizes[0].evaluate(g,{},B),Jn*R.compositeTextSizes[1].evaluate(g,{},B)],(X[0]>mo||X[1]>mo)&&ir(`${r.layerIds[0]}: Value for "text-size" is >= ${ic}. Reduce your "text-size".`)),r.addSymbols(r.text,O,X,y,m,g,k,t,x.lineStartIndex,x.lineLength,A,B);for(const he of E)C[he]=r.text.placedSymbolArray.length-1;return 4*O.length}function wy(r){for(const t in r)return r[t];return null}function Zw(r,t,n,a){const c=r.compareText;if(t in c){const m=c[t];for(let g=m.length-1;g>=0;g--)if(a.dist(m[g])<n)return!0}else c[t]=[];return c[t].push(a),!1}const by=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Sf{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[n,a]=new Uint8Array(t,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");const c=a>>4;if(c!==1)throw new Error(`Got v${c} data when expected v1.`);const m=by[15&a];if(!m)throw new Error("Unrecognized array type.");const[g]=new Uint16Array(t,2,1),[y]=new Uint32Array(t,4,1);return new Sf(y,g,m,t)}constructor(t,n=64,a=Float64Array,c){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=a,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const m=by.indexOf(this.ArrayType),g=2*t*this.ArrayType.BYTES_PER_ELEMENT,y=t*this.IndexArrayType.BYTES_PER_ELEMENT,x=(8-y%8)%8;if(m<0)throw new Error(`Unexpected typed array class: ${a}.`);c&&c instanceof ArrayBuffer?(this.data=c,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+y+x,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+g+y+x),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+y+x,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+m]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=t)}add(t,n){const a=this._pos>>1;return this.ids[a]=a,this.coords[this._pos++]=t,this.coords[this._pos++]=n,a}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return Tf(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,n,a,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:m,coords:g,nodeSize:y}=this,x=[0,m.length-1,0],k=[];for(;x.length;){const E=x.pop()||0,C=x.pop()||0,A=x.pop()||0;if(C-A<=y){for(let $=A;$<=C;$++){const X=g[2*$],he=g[2*$+1];X>=t&&X<=a&&he>=n&&he<=c&&k.push(m[$])}continue}const R=A+C>>1,B=g[2*R],O=g[2*R+1];B>=t&&B<=a&&O>=n&&O<=c&&k.push(m[R]),(E===0?t<=B:n<=O)&&(x.push(A),x.push(R-1),x.push(1-E)),(E===0?a>=B:c>=O)&&(x.push(R+1),x.push(C),x.push(1-E))}return k}within(t,n,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:c,coords:m,nodeSize:g}=this,y=[0,c.length-1,0],x=[],k=a*a;for(;y.length;){const E=y.pop()||0,C=y.pop()||0,A=y.pop()||0;if(C-A<=g){for(let $=A;$<=C;$++)Ty(m[2*$],m[2*$+1],t,n)<=k&&x.push(c[$]);continue}const R=A+C>>1,B=m[2*R],O=m[2*R+1];Ty(B,O,t,n)<=k&&x.push(c[R]),(E===0?t-a<=B:n-a<=O)&&(y.push(A),y.push(R-1),y.push(1-E)),(E===0?t+a>=B:n+a>=O)&&(y.push(R+1),y.push(C),y.push(1-E))}return x}}function Tf(r,t,n,a,c,m){if(c-a<=n)return;const g=a+c>>1;Sy(r,t,g,a,c,m),Tf(r,t,n,a,g-1,1-m),Tf(r,t,n,g+1,c,1-m)}function Sy(r,t,n,a,c,m){for(;c>a;){if(c-a>600){const k=c-a+1,E=n-a+1,C=Math.log(k),A=.5*Math.exp(2*C/3),R=.5*Math.sqrt(C*A*(k-A)/k)*(E-k/2<0?-1:1);Sy(r,t,n,Math.max(a,Math.floor(n-E*A/k+R)),Math.min(c,Math.floor(n+(k-E)*A/k+R)),m)}const g=t[2*n+m];let y=a,x=c;for(oc(r,t,a,n),t[2*c+m]>g&&oc(r,t,a,c);y<x;){for(oc(r,t,y,x),y++,x--;t[2*y+m]<g;)y++;for(;t[2*x+m]>g;)x--}t[2*a+m]===g?oc(r,t,a,x):(x++,oc(r,t,x,c)),x<=n&&(a=x+1),n<=x&&(c=x-1)}}function oc(r,t,n,a){kf(r,n,a),kf(t,2*n,2*a),kf(t,2*n+1,2*a+1)}function kf(r,t,n){const a=r[t];r[t]=r[n],r[n]=a}function Ty(r,t,n,a){const c=r-n,m=t-a;return c*c+m*m}var If;S.bg=void 0,(If=S.bg||(S.bg={})).create="create",If.load="load",If.fullLoad="fullLoad";let Jh=null,ac=[];const Ef=1e3/60,Pf="loadTime",Cf="fullLoadTime",qw={mark(r){performance.mark(r)},frame(r){const t=r;Jh!=null&&ac.push(t-Jh),Jh=t},clearMetrics(){Jh=null,ac=[],performance.clearMeasures(Pf),performance.clearMeasures(Cf);for(const r in S.bg)performance.clearMarks(S.bg[r])},getPerformanceMetrics(){performance.measure(Pf,S.bg.create,S.bg.load),performance.measure(Cf,S.bg.create,S.bg.fullLoad);const r=performance.getEntriesByName(Pf)[0].duration,t=performance.getEntriesByName(Cf)[0].duration,n=ac.length,a=1/(ac.reduce((m,g)=>m+g,0)/n/1e3),c=ac.filter(m=>m>Ef).reduce((m,g)=>m+(g-Ef)/Ef,0);return{loadTime:r,fullLoadTime:t,fps:a,percentDroppedFrames:c/(n+c)*100,totalFrames:n}}};S.$=class extends z{},S.A=ml,S.B=Fp,S.C=function(r){if(cn==null){const t=r.navigator?r.navigator.userAgent:null;cn=!!r.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return cn},S.D=He,S.E=Bs,S.F=class{constructor(r,t){this.target=r,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Fw(()=>this.process()),this.subscription=function(n,a,c,m){return n.addEventListener(a,c,!1),{unsubscribe:()=>{n.removeEventListener(a,c,!1)}}}(this.target,"message",n=>this.receive(n)),this.globalScope=Vi(self)?r:window}registerMessageHandler(r,t){this.messageHandlers[r]=t}sendAsync(r,t){return new Promise((n,a)=>{const c=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[c]={resolve:n,reject:a},t&&t.signal.addEventListener("abort",()=>{delete this.resolveRejects[c];const y={id:c,type:"<cancel>",origin:location.origin,targetMapId:r.targetMapId,sourceMapId:this.mapId};this.target.postMessage(y)},{once:!0});const m=[],g=Object.assign(Object.assign({},r),{id:c,sourceMapId:this.mapId,origin:location.origin,data:ro(r.data,m)});this.target.postMessage(g,{transfer:m})})}receive(r){const t=r.data,n=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[n];const a=this.abortControllers[n];return delete this.abortControllers[n],void(a&&a.abort())}if(Vi(self)||t.mustQueue)return this.tasks[n]=t,this.taskQueue.push(n),void this.invoker.trigger();this.processTask(n,t)}}process(){if(this.taskQueue.length===0)return;const r=this.taskQueue.shift(),t=this.tasks[r];delete this.tasks[r],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(r,t)}processTask(r,t){return d(this,void 0,void 0,function*(){if(t.type==="<response>"){const c=this.resolveRejects[r];return delete this.resolveRejects[r],c?void(t.error?c.reject(io(t.error)):c.resolve(io(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(r,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const n=io(t.data),a=new AbortController;this.abortControllers[r]=a;try{const c=yield this.messageHandlers[t.type](t.sourceMapId,n,a);this.completeTask(r,null,c)}catch(c){this.completeTask(r,c)}})}completeTask(r,t,n){const a=[];delete this.abortControllers[r];const c={id:r,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?ro(t):null,data:ro(n,a)};this.target.postMessage(c,{transfer:a})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},S.G=ei,S.H=function(){var r=new ml(16);return ml!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r},S.I=cf,S.J=function(r,t,n){var a,c,m,g,y,x,k,E,C,A,R,B,O=n[0],$=n[1],X=n[2];return t===r?(r[12]=t[0]*O+t[4]*$+t[8]*X+t[12],r[13]=t[1]*O+t[5]*$+t[9]*X+t[13],r[14]=t[2]*O+t[6]*$+t[10]*X+t[14],r[15]=t[3]*O+t[7]*$+t[11]*X+t[15]):(c=t[1],m=t[2],g=t[3],y=t[4],x=t[5],k=t[6],E=t[7],C=t[8],A=t[9],R=t[10],B=t[11],r[0]=a=t[0],r[1]=c,r[2]=m,r[3]=g,r[4]=y,r[5]=x,r[6]=k,r[7]=E,r[8]=C,r[9]=A,r[10]=R,r[11]=B,r[12]=a*O+y*$+C*X+t[12],r[13]=c*O+x*$+A*X+t[13],r[14]=m*O+k*$+R*X+t[14],r[15]=g*O+E*$+B*X+t[15]),r},S.K=function(r,t,n){var a=n[0],c=n[1],m=n[2];return r[0]=t[0]*a,r[1]=t[1]*a,r[2]=t[2]*a,r[3]=t[3]*a,r[4]=t[4]*c,r[5]=t[5]*c,r[6]=t[6]*c,r[7]=t[7]*c,r[8]=t[8]*m,r[9]=t[9]*m,r[10]=t[10]*m,r[11]=t[11]*m,r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r},S.L=n_,S.M=function(r,t){const n={};for(let a=0;a<t.length;a++){const c=t[a];c in r&&(n[c]=r[c])}return n},S.N=go,S.O=Q_,S.P=re,S.Q=ey,S.R=Yi,S.S=Ji,S.T=sl,S.U=ce,S.V=ie,S.W=ut,S.X=mr,S.Y=v,S.Z=nc,S._=d,S.a=Mr,S.a$=function(r,t){var n=r[0],a=r[1],c=r[2],m=r[3],g=r[4],y=r[5],x=r[6],k=r[7],E=r[8],C=r[9],A=r[10],R=r[11],B=r[12],O=r[13],$=r[14],X=r[15],he=t[0],ee=t[1],ae=t[2],ge=t[3],be=t[4],Ne=t[5],it=t[6],Be=t[7],Le=t[8],Ye=t[9],Ze=t[10],Ue=t[11],ve=t[12],Je=t[13],Ke=t[14],at=t[15];return Math.abs(n-he)<=si*Math.max(1,Math.abs(n),Math.abs(he))&&Math.abs(a-ee)<=si*Math.max(1,Math.abs(a),Math.abs(ee))&&Math.abs(c-ae)<=si*Math.max(1,Math.abs(c),Math.abs(ae))&&Math.abs(m-ge)<=si*Math.max(1,Math.abs(m),Math.abs(ge))&&Math.abs(g-be)<=si*Math.max(1,Math.abs(g),Math.abs(be))&&Math.abs(y-Ne)<=si*Math.max(1,Math.abs(y),Math.abs(Ne))&&Math.abs(x-it)<=si*Math.max(1,Math.abs(x),Math.abs(it))&&Math.abs(k-Be)<=si*Math.max(1,Math.abs(k),Math.abs(Be))&&Math.abs(E-Le)<=si*Math.max(1,Math.abs(E),Math.abs(Le))&&Math.abs(C-Ye)<=si*Math.max(1,Math.abs(C),Math.abs(Ye))&&Math.abs(A-Ze)<=si*Math.max(1,Math.abs(A),Math.abs(Ze))&&Math.abs(R-Ue)<=si*Math.max(1,Math.abs(R),Math.abs(Ue))&&Math.abs(B-ve)<=si*Math.max(1,Math.abs(B),Math.abs(ve))&&Math.abs(O-Je)<=si*Math.max(1,Math.abs(O),Math.abs(Je))&&Math.abs($-Ke)<=si*Math.max(1,Math.abs($),Math.abs(Ke))&&Math.abs(X-at)<=si*Math.max(1,Math.abs(X),Math.abs(at))},S.a0=bt,S.a1=xf,S.a2=Ie,S.a3=r=>{const t=window.document.createElement("video");return t.muted=!0,new Promise(n=>{t.onloadstart=()=>{n(t)};for(const a of r){const c=window.document.createElement("source");ls(a)||(t.crossOrigin="Anonymous"),c.src=a,t.appendChild(c)}})},S.a4=function(){return rt++},S.a5=Oe,S.a6=wl,S.a7=Tu,S.a8=pa,S.a9=oy,S.aA=function(r){if(r.type==="custom")return new Rw(r);switch(r.type){case"background":return new Aw(r);case"circle":return new v1(r);case"fill":return new F1(r);case"fill-extrusion":return new Y1(r);case"heatmap":return new w1(r);case"hillshade":return new S1(r);case"line":return new sw(r);case"raster":return new Lw(r);case"symbol":return new Hh(r)}},S.aB=_t,S.aC=function(r,t){if(!r)return[{command:"setStyle",args:[t]}];let n=[];try{if(!zt(r.version,t.version))return[{command:"setStyle",args:[t]}];zt(r.center,t.center)||n.push({command:"setCenter",args:[t.center]}),zt(r.zoom,t.zoom)||n.push({command:"setZoom",args:[t.zoom]}),zt(r.bearing,t.bearing)||n.push({command:"setBearing",args:[t.bearing]}),zt(r.pitch,t.pitch)||n.push({command:"setPitch",args:[t.pitch]}),zt(r.sprite,t.sprite)||n.push({command:"setSprite",args:[t.sprite]}),zt(r.glyphs,t.glyphs)||n.push({command:"setGlyphs",args:[t.glyphs]}),zt(r.transition,t.transition)||n.push({command:"setTransition",args:[t.transition]}),zt(r.light,t.light)||n.push({command:"setLight",args:[t.light]}),zt(r.terrain,t.terrain)||n.push({command:"setTerrain",args:[t.terrain]}),zt(r.sky,t.sky)||n.push({command:"setSky",args:[t.sky]}),zt(r.projection,t.projection)||n.push({command:"setProjection",args:[t.projection]});const a={},c=[];(function(g,y,x,k){let E;for(E in y=y||{},g=g||{})Object.prototype.hasOwnProperty.call(g,E)&&(Object.prototype.hasOwnProperty.call(y,E)||qn(E,x,k));for(E in y)Object.prototype.hasOwnProperty.call(y,E)&&(Object.prototype.hasOwnProperty.call(g,E)?zt(g[E],y[E])||(g[E].type==="geojson"&&y[E].type==="geojson"&&Os(g,y,E)?Jt(x,{command:"setGeoJSONSourceData",args:[E,y[E].data]}):Pn(E,y,x,k)):jo(E,y,x))})(r.sources,t.sources,c,a);const m=[];r.layers&&r.layers.forEach(g=>{"source"in g&&a[g.source]?n.push({command:"removeLayer",args:[g.id]}):m.push(g)}),n=n.concat(c),function(g,y,x){y=y||[];const k=(g=g||[]).map(Uo),E=y.map(Uo),C=g.reduce($o,{}),A=y.reduce($o,{}),R=k.slice(),B=Object.create(null);let O,$,X,he,ee;for(let ae=0,ge=0;ae<k.length;ae++)O=k[ae],Object.prototype.hasOwnProperty.call(A,O)?ge++:(Jt(x,{command:"removeLayer",args:[O]}),R.splice(R.indexOf(O,ge),1));for(let ae=0,ge=0;ae<E.length;ae++)O=E[E.length-1-ae],R[R.length-1-ae]!==O&&(Object.prototype.hasOwnProperty.call(C,O)?(Jt(x,{command:"removeLayer",args:[O]}),R.splice(R.lastIndexOf(O,R.length-ge),1)):ge++,he=R[R.length-ae],Jt(x,{command:"addLayer",args:[A[O],he]}),R.splice(R.length-ae,0,O),B[O]=!0);for(let ae=0;ae<E.length;ae++)if(O=E[ae],$=C[O],X=A[O],!B[O]&&!zt($,X))if(zt($.source,X.source)&&zt($["source-layer"],X["source-layer"])&&zt($.type,X.type)){for(ee in Ii($.layout,X.layout,x,O,null,"setLayoutProperty"),Ii($.paint,X.paint,x,O,null,"setPaintProperty"),zt($.filter,X.filter)||Jt(x,{command:"setFilter",args:[O,X.filter]}),zt($.minzoom,X.minzoom)&&zt($.maxzoom,X.maxzoom)||Jt(x,{command:"setLayerZoomRange",args:[O,X.minzoom,X.maxzoom]}),$)Object.prototype.hasOwnProperty.call($,ee)&&ee!=="layout"&&ee!=="paint"&&ee!=="filter"&&ee!=="metadata"&&ee!=="minzoom"&&ee!=="maxzoom"&&(ee.indexOf("paint.")===0?Ii($[ee],X[ee],x,O,ee.slice(6),"setPaintProperty"):zt($[ee],X[ee])||Jt(x,{command:"setLayerProperty",args:[O,ee,X[ee]]}));for(ee in X)Object.prototype.hasOwnProperty.call(X,ee)&&!Object.prototype.hasOwnProperty.call($,ee)&&ee!=="layout"&&ee!=="paint"&&ee!=="filter"&&ee!=="metadata"&&ee!=="minzoom"&&ee!=="maxzoom"&&(ee.indexOf("paint.")===0?Ii($[ee],X[ee],x,O,ee.slice(6),"setPaintProperty"):zt($[ee],X[ee])||Jt(x,{command:"setLayerProperty",args:[O,ee,X[ee]]}))}else Jt(x,{command:"removeLayer",args:[O]}),he=R[R.lastIndexOf(O)+1],Jt(x,{command:"addLayer",args:[X,he]})}(m,t.layers,n)}catch(a){console.warn("Unable to compute style diff:",a),n=[{command:"setStyle",args:[t]}]}return n},S.aD=function(r){const t=[],n=r.id;return n===void 0&&t.push({message:`layers.${n}: missing required property "id"`}),r.render===void 0&&t.push({message:`layers.${n}: missing required method "render"`}),r.renderingMode&&r.renderingMode!=="2d"&&r.renderingMode!=="3d"&&t.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),t},S.aE=function r(t,n){if(Array.isArray(t)){if(!Array.isArray(n)||t.length!==n.length)return!1;for(let a=0;a<t.length;a++)if(!r(t[a],n[a]))return!1;return!0}if(typeof t=="object"&&t!==null&&n!==null){if(typeof n!="object"||Object.keys(t).length!==Object.keys(n).length)return!1;for(const a in t)if(!r(t[a],n[a]))return!1;return!0}return t===n},S.aF=At,S.aG=gt,S.aH=class extends ca{constructor(r,t){super(r,t),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))}},S.aI=Lh,S.aJ=class extends ca{constructor(r,t){super(r,t),this.current=h1}set(r){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(let t=1;t<16;t++)if(r[t]!==this.current[t]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}}},S.aK=Hg,S.aL=Wg,S.aM=Bt,S.aN=class extends ca{constructor(r,t){super(r,t),this.current=[0,0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2]))}},S.aO=class extends ca{constructor(r,t){super(r,t),this.current=[0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1]))}},S.aP=function(r,t,n,a,c,m,g){var y=1/(t-n),x=1/(a-c),k=1/(m-g);return r[0]=-2*y,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*x,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*k,r[11]=0,r[12]=(t+n)*y,r[13]=(c+a)*x,r[14]=(g+m)*k,r[15]=1,r},S.aQ=y1,S.aR=class extends ne{},S.aS=uw,S.aT=class extends pe{},S.aU=Yp,S.aV=function(r){return r<=1?1:Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))},S.aW=u_,S.aX=Lr,S.aY=Ki,S.aZ=class extends We{},S.a_=function(r,t){return r[0]===t[0]&&r[1]===t[1]&&r[2]===t[2]&&r[3]===t[3]&&r[4]===t[4]&&r[5]===t[5]&&r[6]===t[6]&&r[7]===t[7]&&r[8]===t[8]&&r[9]===t[9]&&r[10]===t[10]&&r[11]===t[11]&&r[12]===t[12]&&r[13]===t[13]&&r[14]===t[14]&&r[15]===t[15]},S.aa=function(r){const t={};if(r.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,a,c,m)=>{const g=c||m;return t[a]=!g||g.toLowerCase(),""}),t["max-age"]){const n=parseInt(t["max-age"],10);isNaN(n)?delete t["max-age"]:t["max-age"]=n}return t},S.ab=function(r,t){const n=[];for(const a in r)a in t||n.push(a);return n},S.ac=je,S.ad=function(r,t,n){var a=Math.sin(n),c=Math.cos(n),m=t[0],g=t[1],y=t[2],x=t[3],k=t[4],E=t[5],C=t[6],A=t[7];return t!==r&&(r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[0]=m*c+k*a,r[1]=g*c+E*a,r[2]=y*c+C*a,r[3]=x*c+A*a,r[4]=k*c-m*a,r[5]=E*c-g*a,r[6]=C*c-y*a,r[7]=A*c-x*a,r},S.ae=function(r){var t=new ml(16);return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],t},S.af=Oh,S.ag=function(r,t){let n=0,a=0;if(r.kind==="constant")a=r.layoutSize;else if(r.kind!=="source"){const{interpolationType:c,minZoom:m,maxZoom:g}=r,y=c?je(ii.interpolationFactor(c,t,m,g),0,1):0;r.kind==="camera"?a=ri.number(r.minSize,r.maxSize,y):n=y}return{uSizeT:n,uSize:a}},S.ai=function(r,{uSize:t,uSizeT:n},{lowerSize:a,upperSize:c}){return r.kind==="source"?a/Jn:r.kind==="composite"?ri.number(a/Jn,c/Jn,n):t},S.aj=ff,S.ak=function(r,t,n,a){const c=t.y-r.y,m=t.x-r.x,g=a.y-n.y,y=a.x-n.x,x=g*m-y*c;if(x===0)return null;const k=(y*(r.y-n.y)-g*(r.x-n.x))/x;return new re(r.x+k*m,r.y+k*c)},S.al=cy,S.am=Jg,S.an=Wp,S.ao=function(r){let t=1/0,n=1/0,a=-1/0,c=-1/0;for(const m of r)t=Math.min(t,m.x),n=Math.min(n,m.y),a=Math.max(a,m.x),c=Math.max(c,m.y);return[t,n,a,c]},S.ap=_r,S.ar=pf,S.as=function(r,t){var n=t[0],a=t[1],c=t[2],m=t[3],g=t[4],y=t[5],x=t[6],k=t[7],E=t[8],C=t[9],A=t[10],R=t[11],B=t[12],O=t[13],$=t[14],X=t[15],he=n*y-a*g,ee=n*x-c*g,ae=n*k-m*g,ge=a*x-c*y,be=a*k-m*y,Ne=c*k-m*x,it=E*O-C*B,Be=E*$-A*B,Le=E*X-R*B,Ye=C*$-A*O,Ze=C*X-R*O,Ue=A*X-R*$,ve=he*Ue-ee*Ze+ae*Ye+ge*Le-be*Be+Ne*it;return ve?(r[0]=(y*Ue-x*Ze+k*Ye)*(ve=1/ve),r[1]=(c*Ze-a*Ue-m*Ye)*ve,r[2]=(O*Ne-$*be+X*ge)*ve,r[3]=(A*be-C*Ne-R*ge)*ve,r[4]=(x*Le-g*Ue-k*Be)*ve,r[5]=(n*Ue-c*Le+m*Be)*ve,r[6]=($*ae-B*Ne-X*ee)*ve,r[7]=(E*Ne-A*ae+R*ee)*ve,r[8]=(g*Ze-y*Le+k*it)*ve,r[9]=(a*Le-n*Ze-m*it)*ve,r[10]=(B*be-O*ae+X*he)*ve,r[11]=(C*ae-E*be-R*he)*ve,r[12]=(y*Be-g*Ye-x*it)*ve,r[13]=(n*Ye-a*Be+c*it)*ve,r[14]=(O*ee-B*ge-$*he)*ve,r[15]=(E*ge-C*ee+A*he)*ve,r):null},S.at=bf,S.au=df,S.av=Sf,S.aw=function(){const r={},t=me.$version;for(const n in me.$root){const a=me.$root[n];if(a.required){let c=null;c=n==="version"?t:a.type==="array"?[]:{},c!=null&&(r[n]=c)}}return r},S.ax=Ou,S.ay=Ui,S.az=function(r){r=r.slice();const t=Object.create(null);for(let n=0;n<r.length;n++)t[r[n].id]=r[n];for(let n=0;n<r.length;n++)"ref"in r[n]&&(r[n]=Vo(r[n],t[r[n].ref]));return r},S.b=Jr,S.b0=function(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r},S.b1=function(r,t,n){return r[0]=t[0]*n[0],r[1]=t[1]*n[1],r[2]=t[2]*n[2],r[3]=t[3]*n[3],r},S.b2=function(r,t){return r[0]*t[0]+r[1]*t[1]+r[2]*t[2]+r[3]*t[3]},S.b3=Xe,S.b4=iy,S.b5=ty,S.b6=function(r,t,n,a,c){var m,g=1/Math.tan(t/2);return r[0]=g/n,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=g,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,c!=null&&c!==1/0?(r[10]=(c+a)*(m=1/(a-c)),r[14]=2*c*a*m):(r[10]=-1,r[14]=-2*a),r},S.b7=function(r,t,n){var a=Math.sin(n),c=Math.cos(n),m=t[4],g=t[5],y=t[6],x=t[7],k=t[8],E=t[9],C=t[10],A=t[11];return t!==r&&(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[4]=m*c+k*a,r[5]=g*c+E*a,r[6]=y*c+C*a,r[7]=x*c+A*a,r[8]=k*c-m*a,r[9]=E*c-g*a,r[10]=C*c-y*a,r[11]=A*c-x*a,r},S.b8=de,S.b9=Te,S.bA=C_,S.bB=function(r){return r.message===Rt},S.bC=Ks,S.bD=yi,S.ba=function(r){return r*Math.PI/180},S.bb=function(r,t){const{x:n,y:a}=nc.fromLngLat(t);return!(r<0||r>25||a<0||a>=1||n<0||n>=1)},S.bc=function(r,t){return r[0]=t[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=t[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=t[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},S.bd=class extends P{},S.be=yf,S.bf=qw,S.bh=xr,S.bi=function(r,t){Mr.REGISTERED_PROTOCOLS[r]=t},S.bj=function(r){delete Mr.REGISTERED_PROTOCOLS[r]},S.bk=function(r,t){const n={};for(let c=0;c<r.length;c++){const m=t&&t[r[c].id]||bh(r[c]);t&&(t[r[c].id]=m);let g=n[m];g||(g=n[m]=[]),g.push(r[c])}const a=[];for(const c in n)a.push(n[c]);return a},S.bl=$e,S.bm=sy,S.bn=ay,S.bo=O_,S.bp=function(r){r.bucket.createArrays(),r.bucket.tilePixelRatio=mr/(512*r.bucket.overscaling),r.bucket.compareText={},r.bucket.iconsNeedLinear=!1;const t=r.bucket.layers[0],n=t.layout,a=t._unevaluatedLayout._values,c={layoutIconSize:a["icon-size"].possiblyEvaluate(new qt(r.bucket.zoom+1),r.canonical),layoutTextSize:a["text-size"].possiblyEvaluate(new qt(r.bucket.zoom+1),r.canonical),textMaxSize:a["text-size"].possiblyEvaluate(new qt(18))};if(r.bucket.textSizeData.kind==="composite"){const{minZoom:k,maxZoom:E}=r.bucket.textSizeData;c.compositeTextSizes=[a["text-size"].possiblyEvaluate(new qt(k),r.canonical),a["text-size"].possiblyEvaluate(new qt(E),r.canonical)]}if(r.bucket.iconSizeData.kind==="composite"){const{minZoom:k,maxZoom:E}=r.bucket.iconSizeData;c.compositeIconSizes=[a["icon-size"].possiblyEvaluate(new qt(k),r.canonical),a["icon-size"].possiblyEvaluate(new qt(E),r.canonical)]}const m=n.get("text-line-height")*_r,g=n.get("text-rotation-alignment")!=="viewport"&&n.get("symbol-placement")!=="point",y=n.get("text-keep-upright"),x=n.get("text-size");for(const k of r.bucket.features){const E=n.get("text-font").evaluate(k,{},r.canonical).join(","),C=x.evaluate(k,{},r.canonical),A=c.layoutTextSize.evaluate(k,{},r.canonical),R=c.layoutIconSize.evaluate(k,{},r.canonical),B={horizontal:{},vertical:void 0},O=k.text;let $,X=[0,0];if(O){const ae=O.toString(),ge=n.get("text-letter-spacing").evaluate(k,{},r.canonical)*_r,be=Bp(ae)?ge:0,Ne=n.get("text-anchor").evaluate(k,{},r.canonical),it=vy(t,k,r.canonical);if(!it){const Ze=n.get("text-radial-offset").evaluate(k,{},r.canonical);X=Ze?yy(Ne,[Ze*_r,wf]):n.get("text-offset").evaluate(k,{},r.canonical).map(Ue=>Ue*_r)}let Be=g?"center":n.get("text-justify").evaluate(k,{},r.canonical);const Le=n.get("symbol-placement")==="point"?n.get("text-max-width").evaluate(k,{},r.canonical)*_r:1/0,Ye=()=>{r.bucket.allowVerticalPlacement&&Nu(ae)&&(B.vertical=Zh(O,r.glyphMap,r.glyphPositions,r.imagePositions,E,Le,m,Ne,"left",be,X,S.ah.vertical,!0,A,C))};if(!g&&it){const Ze=new Set;if(Be==="auto")for(let ve=0;ve<it.values.length;ve+=2)Ze.add(bf(it.values[ve]));else Ze.add(Be);let Ue=!1;for(const ve of Ze)if(!B.horizontal[ve])if(Ue)B.horizontal[ve]=B.horizontal[0];else{const Je=Zh(O,r.glyphMap,r.glyphPositions,r.imagePositions,E,Le,m,"center",ve,be,X,S.ah.horizontal,!1,A,C);Je&&(B.horizontal[ve]=Je,Ue=Je.positionedLines.length===1)}Ye()}else{Be==="auto"&&(Be=bf(Ne));const Ze=Zh(O,r.glyphMap,r.glyphPositions,r.imagePositions,E,Le,m,Ne,Be,be,X,S.ah.horizontal,!1,A,C);Ze&&(B.horizontal[Be]=Ze),Ye(),Nu(ae)&&g&&y&&(B.vertical=Zh(O,r.glyphMap,r.glyphPositions,r.imagePositions,E,Le,m,Ne,Be,be,X,S.ah.vertical,!1,A,C))}}let he=!1;if(k.icon&&k.icon.name){const ae=r.imageMap[k.icon.name];ae&&($=Ew(r.imagePositions[k.icon.name],n.get("icon-offset").evaluate(k,{},r.canonical),n.get("icon-anchor").evaluate(k,{},r.canonical)),he=!!ae.sdf,r.bucket.sdfIcons===void 0?r.bucket.sdfIcons=he:r.bucket.sdfIcons!==he&&ir("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ae.pixelRatio!==r.bucket.pixelRatio||n.get("icon-rotate").constantOr(1)!==0)&&(r.bucket.iconsNeedLinear=!0))}const ee=wy(B.horizontal)||B.vertical;r.bucket.iconsInText=!!ee&&ee.iconsInText,(ee||$)&&$w(r.bucket,k,B,$,r.imageMap,c,A,R,X,he,r.canonical)}r.showCollisionBoxes&&r.bucket.generateCollisionDebugBuffers()},S.bq=of,S.br=rf,S.bs=sf,S.bt=po,S.bu=lf,S.bv=class{constructor(r){this._marks={start:[r.url,"start"].join("#"),end:[r.url,"end"].join("#"),measure:r.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let r=performance.getEntriesByName(this._marks.measure);return r.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),r=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),r}},S.bw=function(r,t,n,a,c){return d(this,void 0,void 0,function*(){if(ie())try{return yield ut(r,t,n,a,c)}catch{}return function(m,g,y,x,k){const E=m.width,C=m.height;ct&&St||(ct=new OffscreenCanvas(E,C),St=ct.getContext("2d",{willReadFrequently:!0})),ct.width=E,ct.height=C,St.drawImage(m,0,0,E,C);const A=St.getImageData(g,y,x,k);return St.clearRect(0,0,E,C),A.data}(r,t,n,a,c)})},S.bx=ny,S.by=H,S.bz=le,S.c=ji,S.d=r=>d(void 0,void 0,void 0,function*(){if(r.byteLength===0)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(r)],{type:"image/png"});try{return createImageBitmap(t)}catch(n){throw new Error(`Could not load image because of ${n.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),S.e=qe,S.f=r=>new Promise((t,n)=>{const a=new Image;a.onload=()=>{t(a),URL.revokeObjectURL(a.src),a.onload=null,window.requestAnimationFrame(()=>{a.src=Ge})},a.onerror=()=>n(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const c=new Blob([new Uint8Array(r)],{type:"image/png"});a.src=r.byteLength?URL.createObjectURL(c):Ge}),S.g=Qr,S.h=(r,t)=>as(qe(r,{type:"json"}),t),S.i=Vi,S.j=Zn,S.k=$n,S.l=(r,t)=>as(qe(r,{type:"arrayBuffer"}),t),S.m=as,S.n=function(r){return new lf(r).readFields(xw,[])},S.o=Wu,S.p=B_,S.q=f,S.r=Rp,S.s=ls,S.t=Fu,S.u=ws,S.v=me,S.w=ir,S.x=function([r,t,n]){return t+=90,t*=Math.PI/180,n*=Math.PI/180,{x:r*Math.cos(t)*Math.sin(n),y:r*Math.sin(t)*Math.sin(n),z:r*Math.cos(n)}},S.y=ri,S.z=qt}),b("worker",["./shared"],function(S){class d{constructor(L){this.keyCache={},L&&this.replace(L)}replace(L){this._layerConfigs={},this._layers={},this.update(L,[])}update(L,D){for(const Z of L){this._layerConfigs[Z.id]=Z;const te=this._layers[Z.id]=S.aA(Z);te._featureFilter=S.a7(te.filter),this.keyCache[Z.id]&&delete this.keyCache[Z.id]}for(const Z of D)delete this.keyCache[Z],delete this._layerConfigs[Z],delete this._layers[Z];this.familiesBySource={};const N=S.bk(Object.values(this._layerConfigs),this.keyCache);for(const Z of N){const te=Z.map(fe=>this._layers[fe.id]),se=te[0];if(se.visibility==="none")continue;const ue=se.source||"";let J=this.familiesBySource[ue];J||(J=this.familiesBySource[ue]={});const _e=se.sourceLayer||"_geojsonTileLayer";let we=J[_e];we||(we=J[_e]=[]),we.push(te)}}}class H{constructor(L){const D={},N=[];for(const ue in L){const J=L[ue],_e=D[ue]={};for(const we in J){const fe=J[+we];if(!fe||fe.bitmap.width===0||fe.bitmap.height===0)continue;const Ce={x:0,y:0,w:fe.bitmap.width+2,h:fe.bitmap.height+2};N.push(Ce),_e[we]={rect:Ce,metrics:fe.metrics}}}const{w:Z,h:te}=S.p(N),se=new S.o({width:Z||1,height:te||1});for(const ue in L){const J=L[ue];for(const _e in J){const we=J[+_e];if(!we||we.bitmap.width===0||we.bitmap.height===0)continue;const fe=D[ue][_e].rect;S.o.copy(we.bitmap,se,{x:0,y:0},{x:fe.x+1,y:fe.y+1},we.bitmap)}}this.image=se,this.positions=D}}S.bl("GlyphAtlas",H);class le{constructor(L){this.tileID=new S.S(L.tileID.overscaledZ,L.tileID.wrap,L.tileID.canonical.z,L.tileID.canonical.x,L.tileID.canonical.y),this.uid=L.uid,this.zoom=L.zoom,this.pixelRatio=L.pixelRatio,this.tileSize=L.tileSize,this.source=L.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=L.showCollisionBoxes,this.collectResourceTiming=!!L.collectResourceTiming,this.returnDependencies=!!L.returnDependencies,this.promoteId=L.promoteId,this.inFlightDependencies=[]}parse(L,D,N,Z){return S._(this,void 0,void 0,function*(){this.status="parsing",this.data=L,this.collisionBoxArray=new S.a5;const te=new S.bm(Object.keys(L.layers).sort()),se=new S.bn(this.tileID,this.promoteId);se.bucketLayerIDs=[];const ue={},J={featureIndex:se,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:N},_e=D.familiesBySource[this.source];for(const mt in _e){const Ft=L.layers[mt];if(!Ft)continue;Ft.version===1&&S.w(`Vector tile source "${this.source}" layer "${mt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Kt=te.encode(mt),wr=[];for(let Ir=0;Ir<Ft.length;Ir++){const Zr=Ft.feature(Ir),Ns=se.getId(Zr,mt);wr.push({feature:Zr,id:Ns,index:Ir,sourceLayerIndex:Kt})}for(const Ir of _e[mt]){const Zr=Ir[0];Zr.source!==this.source&&S.w(`layer.source = ${Zr.source} does not equal this.source = ${this.source}`),Zr.minzoom&&this.zoom<Math.floor(Zr.minzoom)||Zr.maxzoom&&this.zoom>=Zr.maxzoom||Zr.visibility!=="none"&&(ye(Ir,this.zoom,N),(ue[Zr.id]=Zr.createBucket({index:se.bucketLayerIDs.length,layers:Ir,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Kt,sourceID:this.source})).populate(wr,J,this.tileID.canonical),se.bucketLayerIDs.push(Ir.map(Ns=>Ns.id)))}}const we=S.aF(J.glyphDependencies,mt=>Object.keys(mt).map(Number));this.inFlightDependencies.forEach(mt=>mt==null?void 0:mt.abort()),this.inFlightDependencies=[];let fe=Promise.resolve({});if(Object.keys(we).length){const mt=new AbortController;this.inFlightDependencies.push(mt),fe=Z.sendAsync({type:"GG",data:{stacks:we,source:this.source,tileID:this.tileID,type:"glyphs"}},mt)}const Ce=Object.keys(J.iconDependencies);let Qe=Promise.resolve({});if(Ce.length){const mt=new AbortController;this.inFlightDependencies.push(mt),Qe=Z.sendAsync({type:"GI",data:{icons:Ce,source:this.source,tileID:this.tileID,type:"icons"}},mt)}const tt=Object.keys(J.patternDependencies);let Tt=Promise.resolve({});if(tt.length){const mt=new AbortController;this.inFlightDependencies.push(mt),Tt=Z.sendAsync({type:"GI",data:{icons:tt,source:this.source,tileID:this.tileID,type:"patterns"}},mt)}const[dt,kt,vt]=yield Promise.all([fe,Qe,Tt]),pr=new H(dt),Qt=new S.bo(kt,vt);for(const mt in ue){const Ft=ue[mt];Ft instanceof S.a6?(ye(Ft.layers,this.zoom,N),S.bp({bucket:Ft,glyphMap:dt,glyphPositions:pr.positions,imageMap:kt,imagePositions:Qt.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Ft.hasPattern&&(Ft instanceof S.bq||Ft instanceof S.br||Ft instanceof S.bs)&&(ye(Ft.layers,this.zoom,N),Ft.addFeatures(J,this.tileID.canonical,Qt.patternPositions))}return this.status="done",{buckets:Object.values(ue).filter(mt=>!mt.isEmpty()),featureIndex:se,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:pr.image,imageAtlas:Qt,glyphMap:this.returnDependencies?dt:null,iconMap:this.returnDependencies?kt:null,glyphPositions:this.returnDependencies?pr.positions:null}})}}function ye(W,L,D){const N=new S.z(L);for(const Z of W)Z.recalculate(N,D)}class re{constructor(L,D,N){this.actor=L,this.layerIndex=D,this.availableImages=N,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(L,D){return S._(this,void 0,void 0,function*(){const N=yield S.l(L.request,D);try{return{vectorTile:new S.bt.VectorTile(new S.bu(N.data)),rawData:N.data,cacheControl:N.cacheControl,expires:N.expires}}catch(Z){const te=new Uint8Array(N.data);let se=`Unable to parse the tile at ${L.request.url}, `;throw se+=te[0]===31&&te[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${Z.message}`,new Error(se)}})}loadTile(L){return S._(this,void 0,void 0,function*(){const D=L.uid,N=!!(L&&L.request&&L.request.collectResourceTiming)&&new S.bv(L.request),Z=new le(L);this.loading[D]=Z;const te=new AbortController;Z.abort=te;try{const se=yield this.loadVectorTile(L,te);if(delete this.loading[D],!se)return null;const ue=se.rawData,J={};se.expires&&(J.expires=se.expires),se.cacheControl&&(J.cacheControl=se.cacheControl);const _e={};if(N){const fe=N.finish();fe&&(_e.resourceTiming=JSON.parse(JSON.stringify(fe)))}Z.vectorTile=se.vectorTile;const we=Z.parse(se.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[D]=Z,this.fetching[D]={rawTileData:ue,cacheControl:J,resourceTiming:_e};try{const fe=yield we;return S.e({rawTileData:ue.slice(0)},fe,J,_e)}finally{delete this.fetching[D]}}catch(se){throw delete this.loading[D],Z.status="done",this.loaded[D]=Z,se}})}reloadTile(L){return S._(this,void 0,void 0,function*(){const D=L.uid;if(!this.loaded||!this.loaded[D])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const N=this.loaded[D];if(N.showCollisionBoxes=L.showCollisionBoxes,N.status==="parsing"){const Z=yield N.parse(N.vectorTile,this.layerIndex,this.availableImages,this.actor);let te;if(this.fetching[D]){const{rawTileData:se,cacheControl:ue,resourceTiming:J}=this.fetching[D];delete this.fetching[D],te=S.e({rawTileData:se.slice(0)},Z,ue,J)}else te=Z;return te}if(N.status==="done"&&N.vectorTile)return N.parse(N.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(L){return S._(this,void 0,void 0,function*(){const D=this.loading,N=L.uid;D&&D[N]&&D[N].abort&&(D[N].abort.abort(),delete D[N])})}removeTile(L){return S._(this,void 0,void 0,function*(){this.loaded&&this.loaded[L.uid]&&delete this.loaded[L.uid]})}}class q{constructor(){this.loaded={}}loadTile(L){return S._(this,void 0,void 0,function*(){const{uid:D,encoding:N,rawImageData:Z,redFactor:te,greenFactor:se,blueFactor:ue,baseShift:J}=L,_e=Z.width+2,we=Z.height+2,fe=S.b(Z)?new S.R({width:_e,height:we},yield S.bw(Z,-1,-1,_e,we)):Z,Ce=new S.bx(D,fe,N,te,se,ue,J);return this.loaded=this.loaded||{},this.loaded[D]=Ce,Ce})}removeTile(L){const D=this.loaded,N=L.uid;D&&D[N]&&delete D[N]}}function ke(W,L){if(W.length!==0){Pe(W[0],L);for(var D=1;D<W.length;D++)Pe(W[D],!L)}}function Pe(W,L){for(var D=0,N=0,Z=0,te=W.length,se=te-1;Z<te;se=Z++){var ue=(W[Z][0]-W[se][0])*(W[se][1]+W[Z][1]),J=D+ue;N+=Math.abs(D)>=Math.abs(ue)?D-J+ue:ue-J+D,D=J}D+N>=0!=!!L&&W.reverse()}var Fe=S.by(function W(L,D){var N,Z=L&&L.type;if(Z==="FeatureCollection")for(N=0;N<L.features.length;N++)W(L.features[N],D);else if(Z==="GeometryCollection")for(N=0;N<L.geometries.length;N++)W(L.geometries[N],D);else if(Z==="Feature")W(L.geometry,D);else if(Z==="Polygon")ke(L.coordinates,D);else if(Z==="MultiPolygon")for(N=0;N<L.coordinates.length;N++)ke(L.coordinates[N],D);return L});const Ct=S.bt.VectorTileFeature.prototype.toGeoJSON;var ce={exports:{}},ie=S.bz,de=S.bt.VectorTileFeature,Te=je;function je(W,L){this.options=L||{},this.features=W,this.length=W.length}function Xe(W,L){this.id=typeof W.id=="number"?W.id:void 0,this.type=W.type,this.rawGeometry=W.type===1?[W.geometry]:W.geometry,this.properties=W.tags,this.extent=L||4096}je.prototype.feature=function(W){return new Xe(this.features[W],this.options.extent)},Xe.prototype.loadGeometry=function(){var W=this.rawGeometry;this.geometry=[];for(var L=0;L<W.length;L++){for(var D=W[L],N=[],Z=0;Z<D.length;Z++)N.push(new ie(D[Z][0],D[Z][1]));this.geometry.push(N)}return this.geometry},Xe.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var W=this.geometry,L=1/0,D=-1/0,N=1/0,Z=-1/0,te=0;te<W.length;te++)for(var se=W[te],ue=0;ue<se.length;ue++){var J=se[ue];L=Math.min(L,J.x),D=Math.max(D,J.x),N=Math.min(N,J.y),Z=Math.max(Z,J.y)}return[L,N,D,Z]},Xe.prototype.toGeoJSON=de.prototype.toGeoJSON;var qe=S.bA,rt=Te;function At(W){var L=new qe;return function(D,N){for(var Z in D.layers)N.writeMessage(3,gt,D.layers[Z])}(W,L),L.finish()}function gt(W,L){var D;L.writeVarintField(15,W.version||1),L.writeStringField(1,W.name||""),L.writeVarintField(5,W.extent||4096);var N={keys:[],values:[],keycache:{},valuecache:{}};for(D=0;D<W.length;D++)N.feature=W.feature(D),L.writeMessage(2,_t,N);var Z=N.keys;for(D=0;D<Z.length;D++)L.writeStringField(3,Z[D]);var te=N.values;for(D=0;D<te.length;D++)L.writeMessage(4,cn,te[D])}function _t(W,L){var D=W.feature;D.id!==void 0&&L.writeVarintField(1,D.id),L.writeMessage(2,un,W),L.writeVarintField(3,D.type),L.writeMessage(4,Vi,D)}function un(W,L){var D=W.feature,N=W.keys,Z=W.values,te=W.keycache,se=W.valuecache;for(var ue in D.properties){var J=D.properties[ue],_e=te[ue];if(J!==null){_e===void 0&&(N.push(ue),te[ue]=_e=N.length-1),L.writeVarint(_e);var we=typeof J;we!=="string"&&we!=="boolean"&&we!=="number"&&(J=JSON.stringify(J));var fe=we+":"+J,Ce=se[fe];Ce===void 0&&(Z.push(J),se[fe]=Ce=Z.length-1),L.writeVarint(Ce)}}}function ir(W,L){return(L<<3)+(7&W)}function vr(W){return W<<1^W>>31}function Vi(W,L){for(var D=W.loadGeometry(),N=W.type,Z=0,te=0,se=D.length,ue=0;ue<se;ue++){var J=D[ue],_e=1;N===1&&(_e=J.length),L.writeVarint(ir(1,_e));for(var we=N===3?J.length-1:J.length,fe=0;fe<we;fe++){fe===1&&N!==1&&L.writeVarint(ir(2,we-1));var Ce=J[fe].x-Z,Qe=J[fe].y-te;L.writeVarint(vr(Ce)),L.writeVarint(vr(Qe)),Z+=Ce,te+=Qe}N===3&&L.writeVarint(ir(7,1))}}function cn(W,L){var D=typeof W;D==="string"?L.writeStringField(1,W):D==="boolean"?L.writeBooleanField(7,W):D==="number"&&(W%1!=0?L.writeDoubleField(3,W):W<0?L.writeSVarintField(6,W):L.writeVarintField(5,W))}ce.exports=At,ce.exports.fromVectorTileJs=At,ce.exports.fromGeojsonVt=function(W,L){L=L||{};var D={};for(var N in W)D[N]=new rt(W[N].features,L),D[N].name=N,D[N].version=L.version,D[N].extent=L.extent;return At({layers:D})},ce.exports.GeoJSONWrapper=rt;var Jr=S.by(ce.exports);const Ge={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:W=>W},ut=Math.fround||(ct=new Float32Array(1),W=>(ct[0]=+W,ct[0]));var ct;const St=3,Rt=5,ji=6;class Mr{constructor(L){this.options=Object.assign(Object.create(Ge),L),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(L){const{log:D,minZoom:N,maxZoom:Z}=this.options;D&&console.time("total time");const te=`prepare ${L.length} points`;D&&console.time(te),this.points=L;const se=[];for(let J=0;J<L.length;J++){const _e=L[J];if(!_e.geometry)continue;const[we,fe]=_e.geometry.coordinates,Ce=ut(xr(we)),Qe=ut(Ui(fe));se.push(Ce,Qe,1/0,J,-1,1),this.options.reduce&&se.push(0)}let ue=this.trees[Z+1]=this._createTree(se);D&&console.timeEnd(te);for(let J=Z;J>=N;J--){const _e=+Date.now();ue=this.trees[J]=this._createTree(this._cluster(ue,J)),D&&console.log("z%d: %d clusters in %dms",J,ue.numItems,+Date.now()-_e)}return D&&console.timeEnd("total time"),this}getClusters(L,D){let N=((L[0]+180)%360+360)%360-180;const Z=Math.max(-90,Math.min(90,L[1]));let te=L[2]===180?180:((L[2]+180)%360+360)%360-180;const se=Math.max(-90,Math.min(90,L[3]));if(L[2]-L[0]>=360)N=-180,te=180;else if(N>te){const fe=this.getClusters([N,Z,180,se],D),Ce=this.getClusters([-180,Z,te,se],D);return fe.concat(Ce)}const ue=this.trees[this._limitZoom(D)],J=ue.range(xr(N),Ui(se),xr(te),Ui(Z)),_e=ue.data,we=[];for(const fe of J){const Ce=this.stride*fe;we.push(_e[Ce+Rt]>1?Qr(_e,Ce,this.clusterProps):this.points[_e[Ce+St]])}return we}getChildren(L){const D=this._getOriginId(L),N=this._getOriginZoom(L),Z="No cluster with the specified id.",te=this.trees[N];if(!te)throw new Error(Z);const se=te.data;if(D*this.stride>=se.length)throw new Error(Z);const ue=this.options.radius/(this.options.extent*Math.pow(2,N-1)),J=te.within(se[D*this.stride],se[D*this.stride+1],ue),_e=[];for(const we of J){const fe=we*this.stride;se[fe+4]===L&&_e.push(se[fe+Rt]>1?Qr(se,fe,this.clusterProps):this.points[se[fe+St]])}if(_e.length===0)throw new Error(Z);return _e}getLeaves(L,D,N){const Z=[];return this._appendLeaves(Z,L,D=D||10,N=N||0,0),Z}getTile(L,D,N){const Z=this.trees[this._limitZoom(L)],te=Math.pow(2,L),{extent:se,radius:ue}=this.options,J=ue/se,_e=(N-J)/te,we=(N+1+J)/te,fe={features:[]};return this._addTileFeatures(Z.range((D-J)/te,_e,(D+1+J)/te,we),Z.data,D,N,te,fe),D===0&&this._addTileFeatures(Z.range(1-J/te,_e,1,we),Z.data,te,N,te,fe),D===te-1&&this._addTileFeatures(Z.range(0,_e,J/te,we),Z.data,-1,N,te,fe),fe.features.length?fe:null}getClusterExpansionZoom(L){let D=this._getOriginZoom(L)-1;for(;D<=this.options.maxZoom;){const N=this.getChildren(L);if(D++,N.length!==1)break;L=N[0].properties.cluster_id}return D}_appendLeaves(L,D,N,Z,te){const se=this.getChildren(D);for(const ue of se){const J=ue.properties;if(J&&J.cluster?te+J.point_count<=Z?te+=J.point_count:te=this._appendLeaves(L,J.cluster_id,N,Z,te):te<Z?te++:L.push(ue),L.length===N)break}return te}_createTree(L){const D=new S.av(L.length/this.stride|0,this.options.nodeSize,Float32Array);for(let N=0;N<L.length;N+=this.stride)D.add(L[N],L[N+1]);return D.finish(),D.data=L,D}_addTileFeatures(L,D,N,Z,te,se){for(const ue of L){const J=ue*this.stride,_e=D[J+Rt]>1;let we,fe,Ce;if(_e)we=ei(D,J,this.clusterProps),fe=D[J],Ce=D[J+1];else{const Tt=this.points[D[J+St]];we=Tt.properties;const[dt,kt]=Tt.geometry.coordinates;fe=xr(dt),Ce=Ui(kt)}const Qe={type:1,geometry:[[Math.round(this.options.extent*(fe*te-N)),Math.round(this.options.extent*(Ce*te-Z))]],tags:we};let tt;tt=_e||this.options.generateId?D[J+St]:this.points[D[J+St]].id,tt!==void 0&&(Qe.id=tt),se.features.push(Qe)}}_limitZoom(L){return Math.max(this.options.minZoom,Math.min(Math.floor(+L),this.options.maxZoom+1))}_cluster(L,D){const{radius:N,extent:Z,reduce:te,minPoints:se}=this.options,ue=N/(Z*Math.pow(2,D)),J=L.data,_e=[],we=this.stride;for(let fe=0;fe<J.length;fe+=we){if(J[fe+2]<=D)continue;J[fe+2]=D;const Ce=J[fe],Qe=J[fe+1],tt=L.within(J[fe],J[fe+1],ue),Tt=J[fe+Rt];let dt=Tt;for(const kt of tt){const vt=kt*we;J[vt+2]>D&&(dt+=J[vt+Rt])}if(dt>Tt&&dt>=se){let kt,vt=Ce*Tt,pr=Qe*Tt,Qt=-1;const mt=((fe/we|0)<<5)+(D+1)+this.points.length;for(const Ft of tt){const Kt=Ft*we;if(J[Kt+2]<=D)continue;J[Kt+2]=D;const wr=J[Kt+Rt];vt+=J[Kt]*wr,pr+=J[Kt+1]*wr,J[Kt+4]=mt,te&&(kt||(kt=this._map(J,fe,!0),Qt=this.clusterProps.length,this.clusterProps.push(kt)),te(kt,this._map(J,Kt)))}J[fe+4]=mt,_e.push(vt/dt,pr/dt,1/0,mt,-1,dt),te&&_e.push(Qt)}else{for(let kt=0;kt<we;kt++)_e.push(J[fe+kt]);if(dt>1)for(const kt of tt){const vt=kt*we;if(!(J[vt+2]<=D)){J[vt+2]=D;for(let pr=0;pr<we;pr++)_e.push(J[vt+pr])}}}}return _e}_getOriginId(L){return L-this.points.length>>5}_getOriginZoom(L){return(L-this.points.length)%32}_map(L,D,N){if(L[D+Rt]>1){const se=this.clusterProps[L[D+ji]];return N?Object.assign({},se):se}const Z=this.points[L[D+St]].properties,te=this.options.map(Z);return N&&te===Z?Object.assign({},te):te}}function Qr(W,L,D){return{type:"Feature",id:W[L+St],properties:ei(W,L,D),geometry:{type:"Point",coordinates:[(N=W[L],360*(N-.5)),as(W[L+1])]}};var N}function ei(W,L,D){const N=W[L+Rt],Z=N>=1e4?`${Math.round(N/1e3)}k`:N>=1e3?Math.round(N/100)/10+"k":N,te=W[L+ji],se=te===-1?{}:Object.assign({},D[te]);return Object.assign(se,{cluster:!0,cluster_id:W[L+St],point_count:N,point_count_abbreviated:Z})}function xr(W){return W/360+.5}function Ui(W){const L=Math.sin(W*Math.PI/180),D=.5-.25*Math.log((1+L)/(1-L))/Math.PI;return D<0?0:D>1?1:D}function as(W){const L=(180-360*W)*Math.PI/180;return 360*Math.atan(Math.exp(L))/Math.PI-90}function ls(W,L,D,N){let Z=N;const te=L+(D-L>>1);let se,ue=D-L;const J=W[L],_e=W[L+1],we=W[D],fe=W[D+1];for(let Ce=L+3;Ce<D;Ce+=3){const Qe=No(W[Ce],W[Ce+1],J,_e,we,fe);if(Qe>Z)se=Ce,Z=Qe;else if(Qe===Z){const tt=Math.abs(Ce-te);tt<ue&&(se=Ce,ue=tt)}}Z>N&&(se-L>3&&ls(W,L,se,N),W[se+2]=Z,D-se>3&&ls(W,se,D,N))}function No(W,L,D,N,Z,te){let se=Z-D,ue=te-N;if(se!==0||ue!==0){const J=((W-D)*se+(L-N)*ue)/(se*se+ue*ue);J>1?(D=Z,N=te):J>0&&(D+=se*J,N+=ue*J)}return se=W-D,ue=L-N,se*se+ue*ue}function En(W,L,D,N){const Z={id:W??null,type:L,geometry:D,tags:N,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(L==="Point"||L==="MultiPoint"||L==="LineString")$n(Z,D);else if(L==="Polygon")$n(Z,D[0]);else if(L==="MultiLineString")for(const te of D)$n(Z,te);else if(L==="MultiPolygon")for(const te of D)$n(Z,te[0]);return Z}function $n(W,L){for(let D=0;D<L.length;D+=3)W.minX=Math.min(W.minX,L[D]),W.minY=Math.min(W.minY,L[D+1]),W.maxX=Math.max(W.maxX,L[D]),W.maxY=Math.max(W.maxY,L[D+1])}function Zn(W,L,D,N){if(!L.geometry)return;const Z=L.geometry.coordinates;if(Z&&Z.length===0)return;const te=L.geometry.type,se=Math.pow(D.tolerance/((1<<D.maxZoom)*D.extent),2);let ue=[],J=L.id;if(D.promoteId?J=L.properties[D.promoteId]:D.generateId&&(J=N||0),te==="Point")Bs(Z,ue);else if(te==="MultiPoint")for(const _e of Z)Bs(_e,ue);else if(te==="LineString")me(Z,ue,se,!1);else if(te==="MultiLineString"){if(D.lineMetrics){for(const _e of Z)ue=[],me(_e,ue,se,!1),W.push(En(J,"LineString",ue,L.properties));return}us(Z,ue,se,!1)}else if(te==="Polygon")us(Z,ue,se,!0);else{if(te!=="MultiPolygon"){if(te==="GeometryCollection"){for(const _e of L.geometry.geometries)Zn(W,{id:J,geometry:_e,properties:L.properties},D,N);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const _e of Z){const we=[];us(_e,we,se,!0),ue.push(we)}}W.push(En(J,te,ue,L.properties))}function Bs(W,L){L.push(Vo(W[0]),zt(W[1]),0)}function me(W,L,D,N){let Z,te,se=0;for(let J=0;J<W.length;J++){const _e=Vo(W[J][0]),we=zt(W[J][1]);L.push(_e,we,0),J>0&&(se+=N?(Z*we-_e*te)/2:Math.sqrt(Math.pow(_e-Z,2)+Math.pow(we-te,2))),Z=_e,te=we}const ue=L.length-3;L[2]=1,ls(L,0,ue,D),L[ue+2]=1,L.size=Math.abs(se),L.start=0,L.end=L.size}function us(W,L,D,N){for(let Z=0;Z<W.length;Z++){const te=[];me(W[Z],te,D,N),L.push(te)}}function Vo(W){return W/360+.5}function zt(W){const L=Math.sin(W*Math.PI/180),D=.5-.25*Math.log((1+L)/(1-L))/Math.PI;return D<0?0:D>1?1:D}function Jt(W,L,D,N,Z,te,se,ue){if(N/=L,te>=(D/=L)&&se<N)return W;if(se<D||te>=N)return null;const J=[];for(const _e of W){const we=_e.geometry;let fe=_e.type;const Ce=Z===0?_e.minX:_e.minY,Qe=Z===0?_e.maxX:_e.maxY;if(Ce>=D&&Qe<N){J.push(_e);continue}if(Qe<D||Ce>=N)continue;let tt=[];if(fe==="Point"||fe==="MultiPoint")jo(we,tt,D,N,Z);else if(fe==="LineString")qn(we,tt,D,N,Z,!1,ue.lineMetrics);else if(fe==="MultiLineString")Os(we,tt,D,N,Z,!1);else if(fe==="Polygon")Os(we,tt,D,N,Z,!0);else if(fe==="MultiPolygon")for(const Tt of we){const dt=[];Os(Tt,dt,D,N,Z,!0),dt.length&&tt.push(dt)}if(tt.length){if(ue.lineMetrics&&fe==="LineString"){for(const Tt of tt)J.push(En(_e.id,fe,Tt,_e.tags));continue}fe!=="LineString"&&fe!=="MultiLineString"||(tt.length===1?(fe="LineString",tt=tt[0]):fe="MultiLineString"),fe!=="Point"&&fe!=="MultiPoint"||(fe=tt.length===3?"Point":"MultiPoint"),J.push(En(_e.id,fe,tt,_e.tags))}}return J.length?J:null}function jo(W,L,D,N,Z){for(let te=0;te<W.length;te+=3){const se=W[te+Z];se>=D&&se<=N&&Ii(L,W[te],W[te+1],W[te+2])}}function qn(W,L,D,N,Z,te,se){let ue=Pn(W);const J=Z===0?Uo:$o;let _e,we,fe=W.start;for(let dt=0;dt<W.length-3;dt+=3){const kt=W[dt],vt=W[dt+1],pr=W[dt+2],Qt=W[dt+3],mt=W[dt+4],Ft=Z===0?kt:vt,Kt=Z===0?Qt:mt;let wr=!1;se&&(_e=Math.sqrt(Math.pow(kt-Qt,2)+Math.pow(vt-mt,2))),Ft<D?Kt>D&&(we=J(ue,kt,vt,Qt,mt,D),se&&(ue.start=fe+_e*we)):Ft>N?Kt<N&&(we=J(ue,kt,vt,Qt,mt,N),se&&(ue.start=fe+_e*we)):Ii(ue,kt,vt,pr),Kt<D&&Ft>=D&&(we=J(ue,kt,vt,Qt,mt,D),wr=!0),Kt>N&&Ft<=N&&(we=J(ue,kt,vt,Qt,mt,N),wr=!0),!te&&wr&&(se&&(ue.end=fe+_e*we),L.push(ue),ue=Pn(W)),se&&(fe+=_e)}let Ce=W.length-3;const Qe=W[Ce],tt=W[Ce+1],Tt=Z===0?Qe:tt;Tt>=D&&Tt<=N&&Ii(ue,Qe,tt,W[Ce+2]),Ce=ue.length-3,te&&Ce>=3&&(ue[Ce]!==ue[0]||ue[Ce+1]!==ue[1])&&Ii(ue,ue[0],ue[1],ue[2]),ue.length&&L.push(ue)}function Pn(W){const L=[];return L.size=W.size,L.start=W.start,L.end=W.end,L}function Os(W,L,D,N,Z,te){for(const se of W)qn(se,L,D,N,Z,te,!1)}function Ii(W,L,D,N){W.push(L,D,N)}function Uo(W,L,D,N,Z,te){const se=(te-L)/(N-L);return Ii(W,te,D+(Z-D)*se,1),se}function $o(W,L,D,N,Z,te){const se=(te-D)/(Z-D);return Ii(W,L+(N-L)*se,te,1),se}function Ie(W,L){const D=[];for(let N=0;N<W.length;N++){const Z=W[N],te=Z.type;let se;if(te==="Point"||te==="MultiPoint"||te==="LineString")se=hn(Z.geometry,L);else if(te==="MultiLineString"||te==="Polygon"){se=[];for(const ue of Z.geometry)se.push(hn(ue,L))}else if(te==="MultiPolygon"){se=[];for(const ue of Z.geometry){const J=[];for(const _e of ue)J.push(hn(_e,L));se.push(J)}}D.push(En(Z.id,te,se,Z.tags))}return D}function hn(W,L){const D=[];D.size=W.size,W.start!==void 0&&(D.start=W.start,D.end=W.end);for(let N=0;N<W.length;N+=3)D.push(W[N]+L,W[N+1],W[N+2]);return D}function $r(W,L){if(W.transformed)return W;const D=1<<W.z,N=W.x,Z=W.y;for(const te of W.features){const se=te.geometry,ue=te.type;if(te.geometry=[],ue===1)for(let J=0;J<se.length;J+=2)te.geometry.push(dn(se[J],se[J+1],L,D,N,Z));else for(let J=0;J<se.length;J++){const _e=[];for(let we=0;we<se[J].length;we+=2)_e.push(dn(se[J][we],se[J][we+1],L,D,N,Z));te.geometry.push(_e)}}return W.transformed=!0,W}function dn(W,L,D,N,Z,te){return[Math.round(D*(W*N-Z)),Math.round(D*(L*N-te))]}function Gn(W,L,D,N,Z){const te=L===Z.maxZoom?0:Z.tolerance/((1<<L)*Z.extent),se={features:[],numPoints:0,numSimplified:0,numFeatures:W.length,source:null,x:D,y:N,z:L,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const ue of W)Ae(se,ue,te,Z);return se}function Ae(W,L,D,N){const Z=L.geometry,te=L.type,se=[];if(W.minX=Math.min(W.minX,L.minX),W.minY=Math.min(W.minY,L.minY),W.maxX=Math.max(W.maxX,L.maxX),W.maxY=Math.max(W.maxY,L.maxY),te==="Point"||te==="MultiPoint")for(let ue=0;ue<Z.length;ue+=3)se.push(Z[ue],Z[ue+1]),W.numPoints++,W.numSimplified++;else if(te==="LineString")ft(se,Z,W,D,!1,!1);else if(te==="MultiLineString"||te==="Polygon")for(let ue=0;ue<Z.length;ue++)ft(se,Z[ue],W,D,te==="Polygon",ue===0);else if(te==="MultiPolygon")for(let ue=0;ue<Z.length;ue++){const J=Z[ue];for(let _e=0;_e<J.length;_e++)ft(se,J[_e],W,D,!0,_e===0)}if(se.length){let ue=L.tags||null;if(te==="LineString"&&N.lineMetrics){ue={};for(const _e in L.tags)ue[_e]=L.tags[_e];ue.mapbox_clip_start=Z.start/Z.size,ue.mapbox_clip_end=Z.end/Z.size}const J={geometry:se,type:te==="Polygon"||te==="MultiPolygon"?3:te==="LineString"||te==="MultiLineString"?2:1,tags:ue};L.id!==null&&(J.id=L.id),W.features.push(J)}}function ft(W,L,D,N,Z,te){const se=N*N;if(N>0&&L.size<(Z?se:N))return void(D.numPoints+=L.length/3);const ue=[];for(let J=0;J<L.length;J+=3)(N===0||L[J+2]>se)&&(D.numSimplified++,ue.push(L[J],L[J+1])),D.numPoints++;Z&&function(J,_e){let we=0;for(let fe=0,Ce=J.length,Qe=Ce-2;fe<Ce;Qe=fe,fe+=2)we+=(J[fe]-J[Qe])*(J[fe+1]+J[Qe+1]);if(we>0===_e)for(let fe=0,Ce=J.length;fe<Ce/2;fe+=2){const Qe=J[fe],tt=J[fe+1];J[fe]=J[Ce-2-fe],J[fe+1]=J[Ce-1-fe],J[Ce-2-fe]=Qe,J[Ce-1-fe]=tt}}(ue,te),W.push(ue)}const st={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class ti{constructor(L,D){const N=(D=this.options=function(te,se){for(const ue in se)te[ue]=se[ue];return te}(Object.create(st),D)).debug;if(N&&console.time("preprocess data"),D.maxZoom<0||D.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(D.promoteId&&D.generateId)throw new Error("promoteId and generateId cannot be used together.");let Z=function(te,se){const ue=[];if(te.type==="FeatureCollection")for(let J=0;J<te.features.length;J++)Zn(ue,te.features[J],se,J);else Zn(ue,te.type==="Feature"?te:{geometry:te},se);return ue}(L,D);this.tiles={},this.tileCoords=[],N&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",D.indexMaxZoom,D.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Z=function(te,se){const ue=se.buffer/se.extent;let J=te;const _e=Jt(te,1,-1-ue,ue,0,-1,2,se),we=Jt(te,1,1-ue,2+ue,0,-1,2,se);return(_e||we)&&(J=Jt(te,1,-ue,1+ue,0,-1,2,se)||[],_e&&(J=Ie(_e,1).concat(J)),we&&(J=J.concat(Ie(we,-1)))),J}(Z,D),Z.length&&this.splitTile(Z,0,0,0),N&&(Z.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(L,D,N,Z,te,se,ue){const J=[L,D,N,Z],_e=this.options,we=_e.debug;for(;J.length;){Z=J.pop(),N=J.pop(),D=J.pop(),L=J.pop();const fe=1<<D,Ce=$i(D,N,Z);let Qe=this.tiles[Ce];if(!Qe&&(we>1&&console.time("creation"),Qe=this.tiles[Ce]=Gn(L,D,N,Z,_e),this.tileCoords.push({z:D,x:N,y:Z}),we)){we>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",D,N,Z,Qe.numFeatures,Qe.numPoints,Qe.numSimplified),console.timeEnd("creation"));const wr=`z${D}`;this.stats[wr]=(this.stats[wr]||0)+1,this.total++}if(Qe.source=L,te==null){if(D===_e.indexMaxZoom||Qe.numPoints<=_e.indexMaxPoints)continue}else{if(D===_e.maxZoom||D===te)continue;if(te!=null){const wr=te-D;if(N!==se>>wr||Z!==ue>>wr)continue}}if(Qe.source=null,L.length===0)continue;we>1&&console.time("clipping");const tt=.5*_e.buffer/_e.extent,Tt=.5-tt,dt=.5+tt,kt=1+tt;let vt=null,pr=null,Qt=null,mt=null,Ft=Jt(L,fe,N-tt,N+dt,0,Qe.minX,Qe.maxX,_e),Kt=Jt(L,fe,N+Tt,N+kt,0,Qe.minX,Qe.maxX,_e);L=null,Ft&&(vt=Jt(Ft,fe,Z-tt,Z+dt,1,Qe.minY,Qe.maxY,_e),pr=Jt(Ft,fe,Z+Tt,Z+kt,1,Qe.minY,Qe.maxY,_e),Ft=null),Kt&&(Qt=Jt(Kt,fe,Z-tt,Z+dt,1,Qe.minY,Qe.maxY,_e),mt=Jt(Kt,fe,Z+Tt,Z+kt,1,Qe.minY,Qe.maxY,_e),Kt=null),we>1&&console.timeEnd("clipping"),J.push(vt||[],D+1,2*N,2*Z),J.push(pr||[],D+1,2*N,2*Z+1),J.push(Qt||[],D+1,2*N+1,2*Z),J.push(mt||[],D+1,2*N+1,2*Z+1)}}getTile(L,D,N){L=+L,D=+D,N=+N;const Z=this.options,{extent:te,debug:se}=Z;if(L<0||L>24)return null;const ue=1<<L,J=$i(L,D=D+ue&ue-1,N);if(this.tiles[J])return $r(this.tiles[J],te);se>1&&console.log("drilling down to z%d-%d-%d",L,D,N);let _e,we=L,fe=D,Ce=N;for(;!_e&&we>0;)we--,fe>>=1,Ce>>=1,_e=this.tiles[$i(we,fe,Ce)];return _e&&_e.source?(se>1&&(console.log("found parent tile z%d-%d-%d",we,fe,Ce),console.time("drilling down")),this.splitTile(_e.source,we,fe,Ce,L,D,N),se>1&&console.timeEnd("drilling down"),this.tiles[J]?$r(this.tiles[J],te):null):null}}function $i(W,L,D){return 32*((1<<W)*D+L)+W}function ht(W,L){return L?W.properties[L]:W.id}function pn(W,L){if(W==null)return!0;if(W.type==="Feature")return ht(W,L)!=null;if(W.type==="FeatureCollection"){const D=new Set;for(const N of W.features){const Z=ht(N,L);if(Z==null||D.has(Z))return!1;D.add(Z)}return!0}return!1}function Cn(W,L){const D=new Map;if(W!=null)if(W.type==="Feature")D.set(ht(W,L),W);else for(const N of W.features)D.set(ht(N,L),N);return D}class Hn extends re{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(L,D){return S._(this,void 0,void 0,function*(){const N=L.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const Z=this._geoJSONIndex.getTile(N.z,N.x,N.y);if(!Z)return null;const te=new class{constructor(ue){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=S.X,this.length=ue.length,this._features=ue}feature(ue){return new class{constructor(J){this._feature=J,this.extent=S.X,this.type=J.type,this.properties=J.tags,"id"in J&&!isNaN(J.id)&&(this.id=parseInt(J.id,10))}loadGeometry(){if(this._feature.type===1){const J=[];for(const _e of this._feature.geometry)J.push([new S.P(_e[0],_e[1])]);return J}{const J=[];for(const _e of this._feature.geometry){const we=[];for(const fe of _e)we.push(new S.P(fe[0],fe[1]));J.push(we)}return J}}toGeoJSON(J,_e,we){return Ct.call(this,J,_e,we)}}(this._features[ue])}}(Z.features);let se=Jr(te);return se.byteOffset===0&&se.byteLength===se.buffer.byteLength||(se=new Uint8Array(se)),{vectorTile:te,rawData:se.buffer}})}loadData(L){return S._(this,void 0,void 0,function*(){var D;(D=this._pendingRequest)===null||D===void 0||D.abort();const N=!!(L&&L.request&&L.request.collectResourceTiming)&&new S.bv(L.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(L,this._pendingRequest),this._geoJSONIndex=L.cluster?new Mr(function({superclusterOptions:se,clusterProperties:ue}){if(!ue||!se)return se;const J={},_e={},we={accumulated:null,zoom:0},fe={properties:null},Ce=Object.keys(ue);for(const Qe of Ce){const[tt,Tt]=ue[Qe],dt=S.bC(Tt),kt=S.bC(typeof tt=="string"?[tt,["accumulated"],["get",Qe]]:tt);J[Qe]=dt.value,_e[Qe]=kt.value}return se.map=Qe=>{fe.properties=Qe;const tt={};for(const Tt of Ce)tt[Tt]=J[Tt].evaluate(we,fe);return tt},se.reduce=(Qe,tt)=>{fe.properties=tt;for(const Tt of Ce)we.accumulated=Qe[Tt],Qe[Tt]=_e[Tt].evaluate(we,fe)},se}(L)).load((yield this._pendingData).features):(Z=yield this._pendingData,new ti(Z,L.geojsonVtOptions)),this.loaded={};const te={};if(N){const se=N.finish();se&&(te.resourceTiming={},te.resourceTiming[L.source]=JSON.parse(JSON.stringify(se)))}return te}catch(te){if(delete this._pendingRequest,S.bB(te))return{abandoned:!0};throw te}var Z})}getData(){return S._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(L){const D=this.loaded;return D&&D[L.uid]?super.reloadTile(L):this.loadTile(L)}loadAndProcessGeoJSON(L,D){return S._(this,void 0,void 0,function*(){let N=yield this.loadGeoJSON(L,D);if(delete this._pendingRequest,typeof N!="object")throw new Error(`Input data given to '${L.source}' is not a valid GeoJSON object.`);if(Fe(N,!0),L.filter){const Z=S.bC(L.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Z.result==="error")throw new Error(Z.value.map(se=>`${se.key}: ${se.message}`).join(", "));N={type:"FeatureCollection",features:N.features.filter(se=>Z.value.evaluate({zoom:0},se))}}return N})}loadGeoJSON(L,D){return S._(this,void 0,void 0,function*(){const{promoteId:N}=L;if(L.request){const Z=yield S.h(L.request,D);return this._dataUpdateable=pn(Z.data,N)?Cn(Z.data,N):void 0,Z.data}if(typeof L.data=="string")try{const Z=JSON.parse(L.data);return this._dataUpdateable=pn(Z,N)?Cn(Z,N):void 0,Z}catch{throw new Error(`Input data given to '${L.source}' is not a valid GeoJSON object.`)}if(!L.dataDiff)throw new Error(`Input data given to '${L.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${L.source}`);return function(Z,te,se){var ue,J,_e,we;if(te.removeAll&&Z.clear(),te.remove)for(const fe of te.remove)Z.delete(fe);if(te.add)for(const fe of te.add){const Ce=ht(fe,se);Ce!=null&&Z.set(Ce,fe)}if(te.update)for(const fe of te.update){let Ce=Z.get(fe.id);if(Ce==null)continue;const Qe=!fe.removeAllProperties&&(((ue=fe.removeProperties)===null||ue===void 0?void 0:ue.length)>0||((J=fe.addOrUpdateProperties)===null||J===void 0?void 0:J.length)>0);if((fe.newGeometry||fe.removeAllProperties||Qe)&&(Ce=Object.assign({},Ce),Z.set(fe.id,Ce),Qe&&(Ce.properties=Object.assign({},Ce.properties))),fe.newGeometry&&(Ce.geometry=fe.newGeometry),fe.removeAllProperties)Ce.properties={};else if(((_e=fe.removeProperties)===null||_e===void 0?void 0:_e.length)>0)for(const tt of fe.removeProperties)Object.prototype.hasOwnProperty.call(Ce.properties,tt)&&delete Ce.properties[tt];if(((we=fe.addOrUpdateProperties)===null||we===void 0?void 0:we.length)>0)for(const{key:tt,value:Tt}of fe.addOrUpdateProperties)Ce.properties[tt]=Tt}}(this._dataUpdateable,L.dataDiff,N),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(L){return S._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(L){return this._geoJSONIndex.getClusterExpansionZoom(L.clusterId)}getClusterChildren(L){return this._geoJSONIndex.getChildren(L.clusterId)}getClusterLeaves(L){return this._geoJSONIndex.getLeaves(L.clusterId,L.limit,L.offset)}}class fn{constructor(L){this.self=L,this.actor=new S.F(L),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(D,N)=>{if(this.externalWorkerSourceTypes[D])throw new Error(`Worker source with name "${D}" already registered.`);this.externalWorkerSourceTypes[D]=N},this.self.addProtocol=S.bi,this.self.removeProtocol=S.bj,this.self.registerRTLTextPlugin=D=>{if(S.bD.isParsed())throw new Error("RTL text plugin already registered.");S.bD.setMethods(D)},this.actor.registerMessageHandler("LDT",(D,N)=>this._getDEMWorkerSource(D,N.source).loadTile(N)),this.actor.registerMessageHandler("RDT",(D,N)=>S._(this,void 0,void 0,function*(){this._getDEMWorkerSource(D,N.source).removeTile(N)})),this.actor.registerMessageHandler("GCEZ",(D,N)=>S._(this,void 0,void 0,function*(){return this._getWorkerSource(D,N.type,N.source).getClusterExpansionZoom(N)})),this.actor.registerMessageHandler("GCC",(D,N)=>S._(this,void 0,void 0,function*(){return this._getWorkerSource(D,N.type,N.source).getClusterChildren(N)})),this.actor.registerMessageHandler("GCL",(D,N)=>S._(this,void 0,void 0,function*(){return this._getWorkerSource(D,N.type,N.source).getClusterLeaves(N)})),this.actor.registerMessageHandler("LD",(D,N)=>this._getWorkerSource(D,N.type,N.source).loadData(N)),this.actor.registerMessageHandler("GD",(D,N)=>this._getWorkerSource(D,N.type,N.source).getData()),this.actor.registerMessageHandler("LT",(D,N)=>this._getWorkerSource(D,N.type,N.source).loadTile(N)),this.actor.registerMessageHandler("RT",(D,N)=>this._getWorkerSource(D,N.type,N.source).reloadTile(N)),this.actor.registerMessageHandler("AT",(D,N)=>this._getWorkerSource(D,N.type,N.source).abortTile(N)),this.actor.registerMessageHandler("RMT",(D,N)=>this._getWorkerSource(D,N.type,N.source).removeTile(N)),this.actor.registerMessageHandler("RS",(D,N)=>S._(this,void 0,void 0,function*(){if(!this.workerSources[D]||!this.workerSources[D][N.type]||!this.workerSources[D][N.type][N.source])return;const Z=this.workerSources[D][N.type][N.source];delete this.workerSources[D][N.type][N.source],Z.removeSource!==void 0&&Z.removeSource(N)})),this.actor.registerMessageHandler("RM",D=>S._(this,void 0,void 0,function*(){delete this.layerIndexes[D],delete this.availableImages[D],delete this.workerSources[D],delete this.demWorkerSources[D]})),this.actor.registerMessageHandler("SR",(D,N)=>S._(this,void 0,void 0,function*(){this.referrer=N})),this.actor.registerMessageHandler("SRPS",(D,N)=>this._syncRTLPluginState(D,N)),this.actor.registerMessageHandler("IS",(D,N)=>S._(this,void 0,void 0,function*(){this.self.importScripts(N)})),this.actor.registerMessageHandler("SI",(D,N)=>this._setImages(D,N)),this.actor.registerMessageHandler("UL",(D,N)=>S._(this,void 0,void 0,function*(){this._getLayerIndex(D).update(N.layers,N.removedIds)})),this.actor.registerMessageHandler("SL",(D,N)=>S._(this,void 0,void 0,function*(){this._getLayerIndex(D).replace(N)}))}_setImages(L,D){return S._(this,void 0,void 0,function*(){this.availableImages[L]=D;for(const N in this.workerSources[L]){const Z=this.workerSources[L][N];for(const te in Z)Z[te].availableImages=D}})}_syncRTLPluginState(L,D){return S._(this,void 0,void 0,function*(){if(S.bD.isParsed())return S.bD.getState();if(D.pluginStatus!=="loading")return S.bD.setState(D),D;const N=D.pluginURL;if(this.self.importScripts(N),S.bD.isParsed()){const Z={pluginStatus:"loaded",pluginURL:N};return S.bD.setState(Z),Z}throw S.bD.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${N}`)})}_getAvailableImages(L){let D=this.availableImages[L];return D||(D=[]),D}_getLayerIndex(L){let D=this.layerIndexes[L];return D||(D=this.layerIndexes[L]=new d),D}_getWorkerSource(L,D,N){if(this.workerSources[L]||(this.workerSources[L]={}),this.workerSources[L][D]||(this.workerSources[L][D]={}),!this.workerSources[L][D][N]){const Z={sendAsync:(te,se)=>(te.targetMapId=L,this.actor.sendAsync(te,se))};switch(D){case"vector":this.workerSources[L][D][N]=new re(Z,this._getLayerIndex(L),this._getAvailableImages(L));break;case"geojson":this.workerSources[L][D][N]=new Hn(Z,this._getLayerIndex(L),this._getAvailableImages(L));break;default:this.workerSources[L][D][N]=new this.externalWorkerSourceTypes[D](Z,this._getLayerIndex(L),this._getAvailableImages(L))}}return this.workerSources[L][D][N]}_getDEMWorkerSource(L,D){return this.demWorkerSources[L]||(this.demWorkerSources[L]={}),this.demWorkerSources[L][D]||(this.demWorkerSources[L][D]=new q),this.demWorkerSources[L][D]}}return S.i(self)&&(self.worker=new fn(self)),fn}),b("index",["exports","./shared"],function(S,d){var H="4.7.1";let le,ye;const re={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:f=>new Promise((e,s)=>{const l=requestAnimationFrame(e);f.signal.addEventListener("abort",()=>{cancelAnimationFrame(l),s(d.c())})}),getImageData(f,e=0){return this.getImageCanvasContext(f).getImageData(-e,-e,f.width+2*e,f.height+2*e)},getImageCanvasContext(f){const e=window.document.createElement("canvas"),s=e.getContext("2d",{willReadFrequently:!0});if(!s)throw new Error("failed to create canvas 2d context");return e.width=f.width,e.height=f.height,s.drawImage(f,0,0,f.width,f.height),s},resolveURL:f=>(le||(le=document.createElement("a")),le.href=f,le.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(ye==null&&(ye=matchMedia("(prefers-reduced-motion: reduce)")),ye.matches)}};class q{static testProp(e){if(!q.docStyle)return e[0];for(let s=0;s<e.length;s++)if(e[s]in q.docStyle)return e[s];return e[0]}static create(e,s,l){const u=window.document.createElement(e);return s!==void 0&&(u.className=s),l&&l.appendChild(u),u}static createNS(e,s){return window.document.createElementNS(e,s)}static disableDrag(){q.docStyle&&q.selectProp&&(q.userSelect=q.docStyle[q.selectProp],q.docStyle[q.selectProp]="none")}static enableDrag(){q.docStyle&&q.selectProp&&(q.docStyle[q.selectProp]=q.userSelect)}static setTransform(e,s){e.style[q.transformProp]=s}static addEventListener(e,s,l,u={}){e.addEventListener(s,l,"passive"in u?u:u.capture)}static removeEventListener(e,s,l,u={}){e.removeEventListener(s,l,"passive"in u?u:u.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",q.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",q.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",q.suppressClickInternal,!0)},0)}static getScale(e){const s=e.getBoundingClientRect();return{x:s.width/e.offsetWidth||1,y:s.height/e.offsetHeight||1,boundingClientRect:s}}static getPoint(e,s,l){const u=s.boundingClientRect;return new d.P((l.clientX-u.left)/s.x-e.clientLeft,(l.clientY-u.top)/s.y-e.clientTop)}static mousePos(e,s){const l=q.getScale(e);return q.getPoint(e,l,s)}static touchPos(e,s){const l=[],u=q.getScale(e);for(let p=0;p<s.length;p++)l.push(q.getPoint(e,u,s[p]));return l}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}}q.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,q.selectProp=q.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),q.transformProp=q.testProp(["transform","WebkitTransform"]);const ke={supported:!1,testSupport:function(f){!Ct&&Fe&&(ce?ie(f):Pe=f)}};let Pe,Fe,Ct=!1,ce=!1;function ie(f){const e=f.createTexture();f.bindTexture(f.TEXTURE_2D,e);try{if(f.texImage2D(f.TEXTURE_2D,0,f.RGBA,f.RGBA,f.UNSIGNED_BYTE,Fe),f.isContextLost())return;ke.supported=!0}catch{}f.deleteTexture(e),Ct=!0}var de;typeof document<"u"&&(Fe=document.createElement("img"),Fe.onload=()=>{Pe&&ie(Pe),Pe=null,ce=!0},Fe.onerror=()=>{Ct=!0,Pe=null},Fe.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(f){let e,s,l,u;f.resetRequestQueue=()=>{e=[],s=0,l=0,u={}},f.addThrottleControl=T=>{const P=l++;return u[P]=T,P},f.removeThrottleControl=T=>{delete u[T],v()},f.getImage=(T,P,z=!0)=>new Promise((M,F)=>{ke.supported&&(T.headers||(T.headers={}),T.headers.accept="image/webp,*/*"),d.e(T,{type:"image"}),e.push({abortController:P,requestParameters:T,supportImageRefresh:z,state:"queued",onError:V=>{F(V)},onSuccess:V=>{M(V)}}),v()});const p=T=>d._(this,void 0,void 0,function*(){T.state="running";const{requestParameters:P,supportImageRefresh:z,onError:M,onSuccess:F,abortController:V}=T,j=z===!1&&!d.i(self)&&!d.g(P.url)&&(!P.headers||Object.keys(P.headers).reduce((Y,Q)=>Y&&Q==="accept",!0));s++;const G=j?w(P,V):d.m(P,V);try{const Y=yield G;delete T.abortController,T.state="completed",Y.data instanceof HTMLImageElement||d.b(Y.data)?F(Y):Y.data&&F({data:yield(K=Y.data,typeof createImageBitmap=="function"?d.d(K):d.f(K)),cacheControl:Y.cacheControl,expires:Y.expires})}catch(Y){delete T.abortController,M(Y)}finally{s--,v()}var K}),v=()=>{const T=(()=>{for(const P of Object.keys(u))if(u[P]())return!0;return!1})()?d.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:d.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let P=s;P<T&&e.length>0;P++){const z=e.shift();z.abortController.signal.aborted?P--:p(z)}},w=(T,P)=>new Promise((z,M)=>{const F=new Image,V=T.url,j=T.credentials;j&&j==="include"?F.crossOrigin="use-credentials":(j&&j==="same-origin"||!d.s(V))&&(F.crossOrigin="anonymous"),P.signal.addEventListener("abort",()=>{F.src="",M(d.c())}),F.fetchPriority="high",F.onload=()=>{F.onerror=F.onload=null,z({data:F})},F.onerror=()=>{F.onerror=F.onload=null,P.signal.aborted||M(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},F.src=V})}(de||(de={})),de.resetRequestQueue();class Te{constructor(e){this._transformRequestFn=e}transformRequest(e,s){return this._transformRequestFn&&this._transformRequestFn(e,s)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function je(f){var e=new d.A(3);return e[0]=f[0],e[1]=f[1],e[2]=f[2],e}var Xe,qe=function(f,e,s){return f[0]=e[0]-s[0],f[1]=e[1]-s[1],f[2]=e[2]-s[2],f};Xe=new d.A(3),d.A!=Float32Array&&(Xe[0]=0,Xe[1]=0,Xe[2]=0);var rt=function(f){var e=f[0],s=f[1];return e*e+s*s};function At(f){const e=[];if(typeof f=="string")e.push({id:"default",url:f});else if(f&&f.length>0){const s=[];for(const{id:l,url:u}of f){const p=`${l}${u}`;s.indexOf(p)===-1&&(s.push(p),e.push({id:l,url:u}))}}return e}function gt(f,e,s){const l=f.split("?");return l[0]+=`${e}${s}`,l.join("?")}(function(){var f=new d.A(2);d.A!=Float32Array&&(f[0]=0,f[1]=0)})();class _t{constructor(e,s,l,u){this.context=e,this.format=l,this.texture=e.gl.createTexture(),this.update(s,u)}update(e,s,l){const{width:u,height:p}=e,v=!(this.size&&this.size[0]===u&&this.size[1]===p||l),{context:w}=this,{gl:T}=w;if(this.useMipmap=!!(s&&s.useMipmap),T.bindTexture(T.TEXTURE_2D,this.texture),w.pixelStoreUnpackFlipY.set(!1),w.pixelStoreUnpack.set(1),w.pixelStoreUnpackPremultiplyAlpha.set(this.format===T.RGBA&&(!s||s.premultiply!==!1)),v)this.size=[u,p],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||d.b(e)?T.texImage2D(T.TEXTURE_2D,0,this.format,this.format,T.UNSIGNED_BYTE,e):T.texImage2D(T.TEXTURE_2D,0,this.format,u,p,0,this.format,T.UNSIGNED_BYTE,e.data);else{const{x:P,y:z}=l||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||d.b(e)?T.texSubImage2D(T.TEXTURE_2D,0,P,z,T.RGBA,T.UNSIGNED_BYTE,e):T.texSubImage2D(T.TEXTURE_2D,0,P,z,u,p,T.RGBA,T.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&T.generateMipmap(T.TEXTURE_2D)}bind(e,s,l){const{context:u}=this,{gl:p}=u;p.bindTexture(p.TEXTURE_2D,this.texture),l!==p.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(l=p.LINEAR),e!==this.filter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,e),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,l||e),this.filter=e),s!==this.wrap&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,s),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,s),this.wrap=s)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}function un(f){const{userImage:e}=f;return!!(e&&e.render&&e.render())&&(f.data.replace(new Uint8Array(e.data.buffer)),!0)}class ir extends d.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new d.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:s,promiseResolve:l}of this.requestors)l(this._getImagesForIds(s));this.requestors=[]}}getImage(e){const s=this.images[e];if(s&&!s.data&&s.spriteData){const l=s.spriteData;s.data=new d.R({width:l.width,height:l.height},l.context.getImageData(l.x,l.y,l.width,l.height).data),s.spriteData=null}return s}addImage(e,s){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,s)&&(this.images[e]=s)}_validate(e,s){let l=!0;const u=s.data||s.spriteData;return this._validateStretch(s.stretchX,u&&u.width)||(this.fire(new d.j(new Error(`Image "${e}" has invalid "stretchX" value`))),l=!1),this._validateStretch(s.stretchY,u&&u.height)||(this.fire(new d.j(new Error(`Image "${e}" has invalid "stretchY" value`))),l=!1),this._validateContent(s.content,s)||(this.fire(new d.j(new Error(`Image "${e}" has invalid "content" value`))),l=!1),l}_validateStretch(e,s){if(!e)return!0;let l=0;for(const u of e){if(u[0]<l||u[1]<u[0]||s<u[1])return!1;l=u[1]}return!0}_validateContent(e,s){if(!e)return!0;if(e.length!==4)return!1;const l=s.spriteData,u=l&&l.width||s.data.width,p=l&&l.height||s.data.height;return!(e[0]<0||u<e[0]||e[1]<0||p<e[1]||e[2]<0||u<e[2]||e[3]<0||p<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,s,l=!0){const u=this.getImage(e);if(l&&(u.data.width!==s.data.width||u.data.height!==s.data.height))throw new Error(`size mismatch between old image (${u.data.width}x${u.data.height}) and new image (${s.data.width}x${s.data.height}).`);s.version=u.version+1,this.images[e]=s,this.updatedImages[e]=!0}removeImage(e){const s=this.images[e];delete this.images[e],delete this.patterns[e],s.userImage&&s.userImage.onRemove&&s.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise((s,l)=>{let u=!0;if(!this.isLoaded())for(const p of e)this.images[p]||(u=!1);this.isLoaded()||u?s(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:s})})}_getImagesForIds(e){const s={};for(const l of e){let u=this.getImage(l);u||(this.fire(new d.k("styleimagemissing",{id:l})),u=this.getImage(l)),u?s[l]={data:u.data.clone(),pixelRatio:u.pixelRatio,sdf:u.sdf,version:u.version,stretchX:u.stretchX,stretchY:u.stretchY,content:u.content,textFitWidth:u.textFitWidth,textFitHeight:u.textFitHeight,hasRenderCallback:!!(u.userImage&&u.userImage.render)}:d.w(`Image "${l}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return s}getPixelSize(){const{width:e,height:s}=this.atlasImage;return{width:e,height:s}}getPattern(e){const s=this.patterns[e],l=this.getImage(e);if(!l)return null;if(s&&s.position.version===l.version)return s.position;if(s)s.position.version=l.version;else{const u={w:l.data.width+2,h:l.data.height+2,x:0,y:0},p=new d.I(u,l);this.patterns[e]={bin:u,position:p}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const s=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new _t(e,this.atlasImage,s.RGBA),this.atlasTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const p in this.patterns)e.push(this.patterns[p].bin);const{w:s,h:l}=d.p(e),u=this.atlasImage;u.resize({width:s||1,height:l||1});for(const p in this.patterns){const{bin:v}=this.patterns[p],w=v.x+1,T=v.y+1,P=this.getImage(p).data,z=P.width,M=P.height;d.R.copy(P,u,{x:0,y:0},{x:w,y:T},{width:z,height:M}),d.R.copy(P,u,{x:0,y:M-1},{x:w,y:T-1},{width:z,height:1}),d.R.copy(P,u,{x:0,y:0},{x:w,y:T+M},{width:z,height:1}),d.R.copy(P,u,{x:z-1,y:0},{x:w-1,y:T},{width:1,height:M}),d.R.copy(P,u,{x:0,y:0},{x:w+z,y:T},{width:1,height:M})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const s of e){if(this.callbackDispatchedThisFrame[s])continue;this.callbackDispatchedThisFrame[s]=!0;const l=this.getImage(s);l||d.w(`Image with ID: "${s}" was not found`),un(l)&&this.updateImage(s,l)}}}const vr=1e20;function Vi(f,e,s,l,u,p,v,w,T){for(let P=e;P<e+l;P++)cn(f,s*p+P,p,u,v,w,T);for(let P=s;P<s+u;P++)cn(f,P*p+e,1,l,v,w,T)}function cn(f,e,s,l,u,p,v){p[0]=0,v[0]=-vr,v[1]=vr,u[0]=f[e];for(let w=1,T=0,P=0;w<l;w++){u[w]=f[e+w*s];const z=w*w;do{const M=p[T];P=(u[w]-u[M]+z-M*M)/(w-M)/2}while(P<=v[T]&&--T>-1);T++,p[T]=w,v[T]=P,v[T+1]=vr}for(let w=0,T=0;w<l;w++){for(;v[T+1]<w;)T++;const P=p[T],z=w-P;f[e+w*s]=u[P]+z*z}}class Jr{constructor(e,s){this.requestManager=e,this.localIdeographFontFamily=s,this.entries={}}setURL(e){this.url=e}getGlyphs(e){return d._(this,void 0,void 0,function*(){const s=[];for(const p in e)for(const v of e[p])s.push(this._getAndCacheGlyphsPromise(p,v));const l=yield Promise.all(s),u={};for(const{stack:p,id:v,glyph:w}of l)u[p]||(u[p]={}),u[p][v]=w&&{id:w.id,bitmap:w.bitmap.clone(),metrics:w.metrics};return u})}_getAndCacheGlyphsPromise(e,s){return d._(this,void 0,void 0,function*(){let l=this.entries[e];l||(l=this.entries[e]={glyphs:{},requests:{},ranges:{}});let u=l.glyphs[s];if(u!==void 0)return{stack:e,id:s,glyph:u};if(u=this._tinySDF(l,e,s),u)return l.glyphs[s]=u,{stack:e,id:s,glyph:u};const p=Math.floor(s/256);if(256*p>65535)throw new Error("glyphs > 65535 not supported");if(l.ranges[p])return{stack:e,id:s,glyph:u};if(!this.url)throw new Error("glyphsUrl is not set");if(!l.requests[p]){const w=Jr.loadGlyphRange(e,p,this.url,this.requestManager);l.requests[p]=w}const v=yield l.requests[p];for(const w in v)this._doesCharSupportLocalGlyph(+w)||(l.glyphs[+w]=v[+w]);return l.ranges[p]=!0,{stack:e,id:s,glyph:v[s]||null}})}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(e))}_tinySDF(e,s,l){const u=this.localIdeographFontFamily;if(!u||!this._doesCharSupportLocalGlyph(l))return;let p=e.tinySDF;if(!p){let w="400";/bold/i.test(s)?w="900":/medium/i.test(s)?w="500":/light/i.test(s)&&(w="200"),p=e.tinySDF=new Jr.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:u,fontWeight:w})}const v=p.draw(String.fromCharCode(l));return{id:l,bitmap:new d.o({width:v.width||60,height:v.height||60},v.data),metrics:{width:v.glyphWidth/2||24,height:v.glyphHeight/2||24,left:v.glyphLeft/2+.5||0,top:v.glyphTop/2-27.5||-8,advance:v.glyphAdvance/2||24,isDoubleResolution:!0}}}}Jr.loadGlyphRange=function(f,e,s,l){return d._(this,void 0,void 0,function*(){const u=256*e,p=u+255,v=l.transformRequest(s.replace("{fontstack}",f).replace("{range}",`${u}-${p}`),"Glyphs"),w=yield d.l(v,new AbortController);if(!w||!w.data)throw new Error(`Could not load glyph range. range: ${e}, ${u}-${p}`);const T={};for(const P of d.n(w.data))T[P.id]=P;return T})},Jr.TinySDF=class{constructor({fontSize:f=24,buffer:e=3,radius:s=8,cutoff:l=.25,fontFamily:u="sans-serif",fontWeight:p="normal",fontStyle:v="normal"}={}){this.buffer=e,this.cutoff=l,this.radius=s;const w=this.size=f+4*e,T=this._createCanvas(w),P=this.ctx=T.getContext("2d",{willReadFrequently:!0});P.font=`${v} ${p} ${f}px ${u}`,P.textBaseline="alphabetic",P.textAlign="left",P.fillStyle="black",this.gridOuter=new Float64Array(w*w),this.gridInner=new Float64Array(w*w),this.f=new Float64Array(w),this.z=new Float64Array(w+1),this.v=new Uint16Array(w)}_createCanvas(f){const e=document.createElement("canvas");return e.width=e.height=f,e}draw(f){const{width:e,actualBoundingBoxAscent:s,actualBoundingBoxDescent:l,actualBoundingBoxLeft:u,actualBoundingBoxRight:p}=this.ctx.measureText(f),v=Math.ceil(s),w=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(p-u))),T=Math.min(this.size-this.buffer,v+Math.ceil(l)),P=w+2*this.buffer,z=T+2*this.buffer,M=Math.max(P*z,0),F=new Uint8ClampedArray(M),V={data:F,width:P,height:z,glyphWidth:w,glyphHeight:T,glyphTop:v,glyphLeft:0,glyphAdvance:e};if(w===0||T===0)return V;const{ctx:j,buffer:G,gridInner:K,gridOuter:Y}=this;j.clearRect(G,G,w,T),j.fillText(f,G,G+v);const Q=j.getImageData(G,G,w,T);Y.fill(vr,0,M),K.fill(0,0,M);for(let U=0;U<T;U++)for(let ne=0;ne<w;ne++){const oe=Q.data[4*(U*w+ne)+3]/255;if(oe===0)continue;const pe=(U+G)*P+ne+G;if(oe===1)Y[pe]=0,K[pe]=vr;else{const xe=.5-oe;Y[pe]=xe>0?xe*xe:0,K[pe]=xe<0?xe*xe:0}}Vi(Y,0,0,P,z,P,this.f,this.v,this.z),Vi(K,G,G,w,T,P,this.f,this.v,this.z);for(let U=0;U<M;U++){const ne=Math.sqrt(Y[U])-Math.sqrt(K[U]);F[U]=Math.round(255-255*(ne/this.radius+this.cutoff))}return V}};class Ge{constructor(){this.specification=d.v.light.position}possiblyEvaluate(e,s){return d.x(e.expression.evaluate(s))}interpolate(e,s,l){return{x:d.y.number(e.x,s.x,l),y:d.y.number(e.y,s.y,l),z:d.y.number(e.z,s.z,l)}}}let ut;class ct extends d.E{constructor(e){super(),ut=ut||new d.q({anchor:new d.D(d.v.light.anchor),position:new Ge,color:new d.D(d.v.light.color),intensity:new d.D(d.v.light.intensity)}),this._transitionable=new d.T(ut),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,s={}){if(!this._validate(d.r,e,s))for(const l in e){const u=e[l];l.endsWith("-transition")?this._transitionable.setTransition(l.slice(0,-11),u):this._transitionable.setValue(l,u)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,s,l){return(!l||l.validate!==!1)&&d.t(this,e.call(d.u,{value:s,style:{glyphs:!0,sprite:!0},styleSpec:d.v}))}}const St=new d.q({"sky-color":new d.D(d.v.sky["sky-color"]),"horizon-color":new d.D(d.v.sky["horizon-color"]),"fog-color":new d.D(d.v.sky["fog-color"]),"fog-ground-blend":new d.D(d.v.sky["fog-ground-blend"]),"horizon-fog-blend":new d.D(d.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new d.D(d.v.sky["sky-horizon-blend"]),"atmosphere-blend":new d.D(d.v.sky["atmosphere-blend"])});class Rt extends d.E{constructor(e){super(),this._transitionable=new d.T(St),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new d.z(0))}setSky(e,s={}){if(!this._validate(d.B,e,s)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const l in e){const u=e[l];l.endsWith("-transition")?this._transitionable.setTransition(l.slice(0,-11),u):this._transitionable.setValue(l,u)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,s,l={}){return(l==null?void 0:l.validate)!==!1&&d.t(this,e.call(d.u,d.e({value:s,style:{glyphs:!0,sprite:!0},styleSpec:d.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class ji{constructor(e,s){this.width=e,this.height=s,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,s){const l=e.join(",")+String(s);return this.dashEntry[l]||(this.dashEntry[l]=this.addDash(e,s)),this.dashEntry[l]}getDashRanges(e,s,l){const u=[];let p=e.length%2==1?-e[e.length-1]*l:0,v=e[0]*l,w=!0;u.push({left:p,right:v,isDash:w,zeroLength:e[0]===0});let T=e[0];for(let P=1;P<e.length;P++){w=!w;const z=e[P];p=T*l,T+=z,v=T*l,u.push({left:p,right:v,isDash:w,zeroLength:z===0})}return u}addRoundDash(e,s,l){const u=s/2;for(let p=-l;p<=l;p++){const v=this.width*(this.nextRow+l+p);let w=0,T=e[w];for(let P=0;P<this.width;P++){P/T.right>1&&(T=e[++w]);const z=Math.abs(P-T.left),M=Math.abs(P-T.right),F=Math.min(z,M);let V;const j=p/l*(u+1);if(T.isDash){const G=u-Math.abs(j);V=Math.sqrt(F*F+G*G)}else V=u-Math.sqrt(F*F+j*j);this.data[v+P]=Math.max(0,Math.min(255,V+128))}}}addRegularDash(e){for(let w=e.length-1;w>=0;--w){const T=e[w],P=e[w+1];T.zeroLength?e.splice(w,1):P&&P.isDash===T.isDash&&(P.left=T.left,e.splice(w,1))}const s=e[0],l=e[e.length-1];s.isDash===l.isDash&&(s.left=l.left-this.width,l.right=s.right+this.width);const u=this.width*this.nextRow;let p=0,v=e[p];for(let w=0;w<this.width;w++){w/v.right>1&&(v=e[++p]);const T=Math.abs(w-v.left),P=Math.abs(w-v.right),z=Math.min(T,P);this.data[u+w]=Math.max(0,Math.min(255,(v.isDash?z:-z)+128))}}addDash(e,s){const l=s?7:0,u=2*l+1;if(this.nextRow+u>this.height)return d.w("LineAtlas out of space"),null;let p=0;for(let w=0;w<e.length;w++)p+=e[w];if(p!==0){const w=this.width/p,T=this.getDashRanges(e,this.width,w);s?this.addRoundDash(T,w,l):this.addRegularDash(T)}const v={y:(this.nextRow+l+.5)/this.height,height:2*l/this.height,width:p};return this.nextRow+=u,this.dirty=!0,v}bind(e){const s=e.gl;this.texture?(s.bindTexture(s.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,s.texSubImage2D(s.TEXTURE_2D,0,0,0,this.width,this.height,s.ALPHA,s.UNSIGNED_BYTE,this.data))):(this.texture=s.createTexture(),s.bindTexture(s.TEXTURE_2D,this.texture),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texImage2D(s.TEXTURE_2D,0,s.ALPHA,this.width,this.height,0,s.ALPHA,s.UNSIGNED_BYTE,this.data))}}const Mr="maplibre_preloaded_worker_pool";class Qr{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Qr.workerCount;)this.workers.push(new Worker(d.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach(s=>{s.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Mr]}numActive(){return Object.keys(this.active).length}}const ei=Math.floor(re.hardwareConcurrency/2);let xr,Ui;function as(){return xr||(xr=new Qr),xr}Qr.workerCount=d.C(globalThis)?Math.max(Math.min(ei,3),1):1;class ls{constructor(e,s){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=s;const l=this.workerPool.acquire(s);for(let u=0;u<l.length;u++){const p=new d.F(l[u],s);p.name=`Worker ${u}`,this.actors.push(p)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,s){const l=[];for(const u of this.actors)l.push(u.sendAsync({type:e,data:s}));return Promise.all(l)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach(s=>{s.remove()}),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,s){for(const l of this.actors)l.registerMessageHandler(e,s)}}function No(){return Ui||(Ui=new ls(as(),d.G),Ui.registerMessageHandler("GR",(f,e,s)=>d.m(e,s))),Ui}function En(f,e){const s=d.H();return d.J(s,s,[1,1,0]),d.K(s,s,[.5*f.width,.5*f.height,1]),d.L(s,s,f.calculatePosMatrix(e.toUnwrapped()))}function $n(f,e,s,l,u,p){const v=function(M,F,V){if(M)for(const j of M){const G=F[j];if(G&&G.source===V&&G.type==="fill-extrusion")return!0}else for(const j in F){const G=F[j];if(G.source===V&&G.type==="fill-extrusion")return!0}return!1}(u&&u.layers,e,f.id),w=p.maxPitchScaleFactor(),T=f.tilesIn(l,w,v);T.sort(Zn);const P=[];for(const M of T)P.push({wrappedTileID:M.tileID.wrapped().key,queryResults:M.tile.queryRenderedFeatures(e,s,f._state,M.queryGeometry,M.cameraQueryGeometry,M.scale,u,p,w,En(f.transform,M.tileID))});const z=function(M){const F={},V={};for(const j of M){const G=j.queryResults,K=j.wrappedTileID,Y=V[K]=V[K]||{};for(const Q in G){const U=G[Q],ne=Y[Q]=Y[Q]||{},oe=F[Q]=F[Q]||[];for(const pe of U)ne[pe.featureIndex]||(ne[pe.featureIndex]=!0,oe.push(pe))}}return F}(P);for(const M in z)z[M].forEach(F=>{const V=F.feature,j=f.getFeatureState(V.layer["source-layer"],V.id);V.source=V.layer.source,V.layer["source-layer"]&&(V.sourceLayer=V.layer["source-layer"]),V.state=j});return z}function Zn(f,e){const s=f.tileID,l=e.tileID;return s.overscaledZ-l.overscaledZ||s.canonical.y-l.canonical.y||s.wrap-l.wrap||s.canonical.x-l.canonical.x}function Bs(f,e,s){return d._(this,void 0,void 0,function*(){let l=f;if(f.url?l=(yield d.h(e.transformRequest(f.url,"Source"),s)).data:yield re.frameAsync(s),!l)return null;const u=d.M(d.e(l,f),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in l&&l.vector_layers&&(u.vectorLayerIds=l.vector_layers.map(p=>p.id)),u})}class me{constructor(e,s){e&&(s?this.setSouthWest(e).setNorthEast(s):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof d.N?new d.N(e.lng,e.lat):d.N.convert(e),this}setSouthWest(e){return this._sw=e instanceof d.N?new d.N(e.lng,e.lat):d.N.convert(e),this}extend(e){const s=this._sw,l=this._ne;let u,p;if(e instanceof d.N)u=e,p=e;else{if(!(e instanceof me))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(me.convert(e)):this.extend(d.N.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(d.N.convert(e)):this;if(u=e._sw,p=e._ne,!u||!p)return this}return s||l?(s.lng=Math.min(u.lng,s.lng),s.lat=Math.min(u.lat,s.lat),l.lng=Math.max(p.lng,l.lng),l.lat=Math.max(p.lat,l.lat)):(this._sw=new d.N(u.lng,u.lat),this._ne=new d.N(p.lng,p.lat)),this}getCenter(){return new d.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new d.N(this.getWest(),this.getNorth())}getSouthEast(){return new d.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:s,lat:l}=d.N.convert(e);let u=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&u}static convert(e){return e instanceof me?e:e&&new me(e)}static fromLngLat(e,s=0){const l=360*s/40075017,u=l/Math.cos(Math.PI/180*e.lat);return new me(new d.N(e.lng-u,e.lat-l),new d.N(e.lng+u,e.lat+l))}adjustAntiMeridian(){const e=new d.N(this._sw.lng,this._sw.lat),s=new d.N(this._ne.lng,this._ne.lat);return new me(e,e.lng>s.lng?new d.N(s.lng+360,s.lat):s)}}class us{constructor(e,s,l){this.bounds=me.convert(this.validateBounds(e)),this.minzoom=s||0,this.maxzoom=l||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const s=Math.pow(2,e.z),l=Math.floor(d.O(this.bounds.getWest())*s),u=Math.floor(d.Q(this.bounds.getNorth())*s),p=Math.ceil(d.O(this.bounds.getEast())*s),v=Math.ceil(d.Q(this.bounds.getSouth())*s);return e.x>=l&&e.x<p&&e.y>=u&&e.y<v}}class Vo extends d.E{constructor(e,s,l,u){if(super(),this.id=e,this.dispatcher=l,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,d.e(this,d.M(s,["url","scheme","tileSize","promoteId"])),this._options=d.e({type:"vector"},s),this._collectResourceTiming=s.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(u)}load(){return d._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new d.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield Bs(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(d.e(this,e),e.bounds&&(this.tileBounds=new us(e.bounds,this.minzoom,this.maxzoom)),this.fire(new d.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new d.j(e))}})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return d.e({},this._options)}loadTile(e){return d._(this,void 0,void 0,function*(){const s=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l={request:this.map._requestManager.transformRequest(s,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};l.request.collectResourceTiming=this._collectResourceTiming;let u="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise((p,v)=>{e.reloadPromise={resolve:p,reject:v}})}else e.actor=this.dispatcher.getActor(),u="LT";e.abortController=new AbortController;try{const p=yield e.actor.sendAsync({type:u,data:l},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,p)}catch(p){if(delete e.abortController,e.aborted)return;if(p&&p.status!==404)throw p;this._afterTileLoadWorkerResponse(e,null)}})}_afterTileLoadWorkerResponse(e,s){if(s&&s.resourceTiming&&(e.resourceTiming=s.resourceTiming),s&&this.map._refreshExpiredTiles&&e.setExpiryData(s),e.loadVectorData(s,this.map.painter),e.reloadPromise){const l=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(l.resolve).catch(l.reject)}}abortTile(e){return d._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))})}unloadTile(e){return d._(this,void 0,void 0,function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class zt extends d.E{constructor(e,s,l,u){super(),this.id=e,this.dispatcher=l,this.setEventedParent(u),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=d.e({type:"raster"},s),d.e(this,d.M(s,["url","scheme","tileSize"]))}load(){return d._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new d.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield Bs(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,e&&(d.e(this,e),e.bounds&&(this.tileBounds=new us(e.bounds,this.minzoom,this.maxzoom)),this.fire(new d.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new d.j(e))}})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}serialize(){return d.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return d._(this,void 0,void 0,function*(){const s=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const l=yield de.getImage(this.map._requestManager.transformRequest(s,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(l&&l.data){this.map._refreshExpiredTiles&&l.cacheControl&&l.expires&&e.setExpiryData({cacheControl:l.cacheControl,expires:l.expires});const u=this.map.painter.context,p=u.gl,v=l.data;e.texture=this.map.painter.getTileTexture(v.width),e.texture?e.texture.update(v,{useMipmap:!0}):(e.texture=new _t(u,v,p.RGBA,{useMipmap:!0}),e.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE,p.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(l){if(delete e.abortController,e.aborted)e.state="unloaded";else if(l)throw e.state="errored",l}})}abortTile(e){return d._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)})}unloadTile(e){return d._(this,void 0,void 0,function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)})}hasTransition(){return!1}}class Jt extends zt{constructor(e,s,l,u){super(e,s,l,u),this.type="raster-dem",this.maxzoom=22,this._options=d.e({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox",this.redFactor=s.redFactor,this.greenFactor=s.greenFactor,this.blueFactor=s.blueFactor,this.baseShift=s.baseShift}loadTile(e){return d._(this,void 0,void 0,function*(){const s=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l=this.map._requestManager.transformRequest(s,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const u=yield de.getImage(l,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(u&&u.data){const p=u.data;this.map._refreshExpiredTiles&&u.cacheControl&&u.expires&&e.setExpiryData({cacheControl:u.cacheControl,expires:u.expires});const v=d.b(p)&&d.U()?p:yield this.readImageNow(p),w={type:this.type,uid:e.uid,source:this.id,rawImageData:v,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();const T=yield e.actor.sendAsync({type:"LDT",data:w});e.dem=T,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(u){if(delete e.abortController,e.aborted)e.state="unloaded";else if(u)throw e.state="errored",u}})}readImageNow(e){return d._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&d.V()){const s=e.width+2,l=e.height+2;try{return new d.R({width:s,height:l},yield d.W(e,-1,-1,s,l))}catch{}}return re.getImageData(e,1)})}_getNeighboringTiles(e){const s=e.canonical,l=Math.pow(2,s.z),u=(s.x-1+l)%l,p=s.x===0?e.wrap-1:e.wrap,v=(s.x+1+l)%l,w=s.x+1===l?e.wrap+1:e.wrap,T={};return T[new d.S(e.overscaledZ,p,s.z,u,s.y).key]={backfilled:!1},T[new d.S(e.overscaledZ,w,s.z,v,s.y).key]={backfilled:!1},s.y>0&&(T[new d.S(e.overscaledZ,p,s.z,u,s.y-1).key]={backfilled:!1},T[new d.S(e.overscaledZ,e.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},T[new d.S(e.overscaledZ,w,s.z,v,s.y-1).key]={backfilled:!1}),s.y+1<l&&(T[new d.S(e.overscaledZ,p,s.z,u,s.y+1).key]={backfilled:!1},T[new d.S(e.overscaledZ,e.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},T[new d.S(e.overscaledZ,w,s.z,v,s.y+1).key]={backfilled:!1}),T}unloadTile(e){return d._(this,void 0,void 0,function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))})}}class jo extends d.E{constructor(e,s,l,u){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=l.getActor(),this.setEventedParent(u),this._data=s.data,this._options=d.e({},s),this._collectResourceTiming=s.collectResourceTiming,s.maxzoom!==void 0&&(this.maxzoom=s.maxzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId;const p=d.X/this.tileSize;s.clusterMaxZoom!==void 0&&this.maxzoom<=s.clusterMaxZoom&&d.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${s.clusterMaxZoom}".`),this.workerOptions=d.e({source:this.id,cluster:s.cluster||!1,geojsonVtOptions:{buffer:(s.buffer!==void 0?s.buffer:128)*p,tolerance:(s.tolerance!==void 0?s.tolerance:.375)*p,extent:d.X,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:s.clusterMaxZoom!==void 0?s.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,s.clusterMinPoints||2),extent:d.X,radius:(s.clusterRadius||50)*p,log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter},s.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return d._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(e){return this._updateWorkerData(e),this}getData(){return d._(this,void 0,void 0,function*(){const e=d.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})})}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=e.clusterRadius),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=e.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,s,l){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:s,offset:l}})}_updateWorkerData(e){return d._(this,void 0,void 0,function*(){const s=d.e({type:this.type},this.workerOptions);e?s.dataDiff=e:typeof this._data=="string"?(s.request=this.map._requestManager.transformRequest(re.resolveURL(this._data),"Source"),s.request.collectResourceTiming=this._collectResourceTiming):s.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new d.k("dataloading",{dataType:"source"}));try{const l=yield this.actor.sendAsync({type:"LD",data:s});if(this._pendingLoads--,this._removed||l.abandoned)return void this.fire(new d.k("dataabort",{dataType:"source"}));let u=null;l.resourceTiming&&l.resourceTiming[this.id]&&(u=l.resourceTiming[this.id].slice(0));const p={dataType:"source"};this._collectResourceTiming&&u&&u.length>0&&d.e(p,{resourceTiming:u}),this.fire(new d.k("data",Object.assign(Object.assign({},p),{sourceDataType:"metadata"}))),this.fire(new d.k("data",Object.assign(Object.assign({},p),{sourceDataType:"content"})))}catch(l){if(this._pendingLoads--,this._removed)return void this.fire(new d.k("dataabort",{dataType:"source"}));this.fire(new d.j(l))}})}loaded(){return this._pendingLoads===0}loadTile(e){return d._(this,void 0,void 0,function*(){const s=e.actor?"RT":"LT";e.actor=this.actor;const l={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};e.abortController=new AbortController;const u=yield this.actor.sendAsync({type:s,data:l},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(u,this.map.painter,s==="RT")})}abortTile(e){return d._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0})}unloadTile(e){return d._(this,void 0,void 0,function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return d.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var qn=d.Y([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Pn extends d.E{constructor(e,s,l,u){super(),this.id=e,this.dispatcher=l,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(u),this.options=s}load(e){return d._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new d.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const s=yield de.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,s&&s.data&&(this.image=s.data,e&&(this.coordinates=e),this._finishLoading())}catch(s){this._request=null,this._loaded=!0,this.fire(new d.j(s))}})}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new d.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const s=e.map(d.Z.fromLngLat);this.tileID=function(u){let p=1/0,v=1/0,w=-1/0,T=-1/0;for(const F of u)p=Math.min(p,F.x),v=Math.min(v,F.y),w=Math.max(w,F.x),T=Math.max(T,F.y);const P=Math.max(w-p,T-v),z=Math.max(0,Math.floor(-Math.log(P)/Math.LN2)),M=Math.pow(2,z);return new d.a1(z,Math.floor((p+w)/2*M),Math.floor((v+T)/2*M))}(s),this.minzoom=this.maxzoom=this.tileID.z;const l=s.map(u=>this.tileID.getTilePoint(u)._round());return this._boundsArray=new d.$,this._boundsArray.emplaceBack(l[0].x,l[0].y,0,0),this._boundsArray.emplaceBack(l[1].x,l[1].y,d.X,0),this._boundsArray.emplaceBack(l[3].x,l[3].y,0,d.X),this._boundsArray.emplaceBack(l[2].x,l[2].y,d.X,d.X),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new d.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,s=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,qn.members)),this.boundsSegments||(this.boundsSegments=d.a0.simpleSegment(0,0,4,2)),this.texture||(this.texture=new _t(e,this.image,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));let l=!1;for(const u in this.tiles){const p=this.tiles[u];p.state!=="loaded"&&(p.state="loaded",p.texture=this.texture,l=!0)}l&&this.fire(new d.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return d._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Os extends Pn{constructor(e,s,l,u){super(e,s,l,u),this.roundZoom=!0,this.type="video",this.options=s}load(){return d._(this,void 0,void 0,function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const s of e.urls)this.urls.push(this.map._requestManager.transformRequest(s,"Source").url);try{const s=yield d.a3(this.urls);if(this._loaded=!0,!s)return;this.video=s,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(s){this.fire(new d.j(s))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const s=this.video.seekable;e<s.start(0)||e>s.end(0)?this.fire(new d.j(new d.a2(`sources.${this.id}`,null,`Playback for this video can be set only between the ${s.start(0)} and ${s.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,s=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,qn.members)),this.boundsSegments||(this.boundsSegments=d.a0.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.video)):(this.texture=new _t(e,this.video,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));let l=!1;for(const u in this.tiles){const p=this.tiles[u];p.state!=="loaded"&&(p.state="loaded",p.texture=this.texture,l=!0)}l&&this.fire(new d.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Ii extends Pn{constructor(e,s,l,u){super(e,s,l,u),s.coordinates?Array.isArray(s.coordinates)&&s.coordinates.length===4&&!s.coordinates.some(p=>!Array.isArray(p)||p.length!==2||p.some(v=>typeof v!="number"))||this.fire(new d.j(new d.a2(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new d.j(new d.a2(`sources.${e}`,null,'missing required property "coordinates"'))),s.animate&&typeof s.animate!="boolean"&&this.fire(new d.j(new d.a2(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),s.canvas?typeof s.canvas=="string"||s.canvas instanceof HTMLCanvasElement||this.fire(new d.j(new d.a2(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new d.j(new d.a2(`sources.${e}`,null,'missing required property "canvas"'))),this.options=s,this.animate=s.animate===void 0||s.animate}load(){return d._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new d.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const s=this.map.painter.context,l=s.gl;this.boundsBuffer||(this.boundsBuffer=s.createVertexBuffer(this._boundsArray,qn.members)),this.boundsSegments||(this.boundsSegments=d.a0.simpleSegment(0,0,4,2)),this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new _t(s,this.canvas,l.RGBA,{premultiply:!0});let u=!1;for(const p in this.tiles){const v=this.tiles[p];v.state!=="loaded"&&(v.state="loaded",v.texture=this.texture,u=!0)}u&&this.fire(new d.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const Uo={},$o=f=>{switch(f){case"geojson":return jo;case"image":return Pn;case"raster":return zt;case"raster-dem":return Jt;case"vector":return Vo;case"video":return Os;case"canvas":return Ii}return Uo[f]},Ie="RTLPluginLoaded";class hn extends d.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=No()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch(s=>{throw this.status="error",s})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return d._(this,arguments,void 0,function*(s,l=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=re.resolveURL(s),!this.url)throw new Error(`requested url ${s} is invalid`);if(this.status==="unavailable"){if(!l)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return d._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new d.k(Ie))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let $r=null;function dn(){return $r||($r=new hn),$r}class Gn{constructor(e,s){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=d.a4(),this.uses=0,this.tileSize=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const s=e+this.timeAdded;s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,s,l){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(u,p){const v={};if(!p)return v;for(const w of u){const T=w.layerIds.map(P=>p.getLayer(P)).filter(Boolean);if(T.length!==0){w.layers=T,w.stateDependentLayerIds&&(w.stateDependentLayers=w.stateDependentLayerIds.map(P=>T.filter(z=>z.id===P)[0]));for(const P of T)v[P.id]=w}}return v}(e.buckets,s.style),this.hasSymbolBuckets=!1;for(const u in this.buckets){const p=this.buckets[u];if(p instanceof d.a6){if(this.hasSymbolBuckets=!0,!l)break;p.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const u in this.buckets){const p=this.buckets[u];if(p instanceof d.a6&&p.hasRTLText){this.hasRTLText=!0,dn().lazyLoad();break}}this.queryPadding=0;for(const u in this.buckets){const p=this.buckets[u];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(u).queryRadius(p))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new d.a5}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const l in this.buckets){const u=this.buckets[l];u.uploadPending()&&u.upload(e)}const s=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new _t(e,this.imageAtlas.image,s.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new _t(e,this.glyphAtlasImage,s.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,s,l,u,p,v,w,T,P,z){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:u,cameraQueryGeometry:p,scale:v,tileSize:this.tileSize,pixelPosMatrix:z,transform:T,params:w,queryPadding:this.queryPadding*P},e,s,l):{}}querySourceFeatures(e,s){const l=this.latestFeatureIndex;if(!l||!l.rawTileData)return;const u=l.loadVTLayers(),p=s&&s.sourceLayer?s.sourceLayer:"",v=u._geojsonTileLayer||u[p];if(!v)return;const w=d.a7(s&&s.filter),{z:T,x:P,y:z}=this.tileID.canonical,M={z:T,x:P,y:z};for(let F=0;F<v.length;F++){const V=v.feature(F);if(w.needGeometry){const K=d.a8(V,!0);if(!w.filter(new d.z(this.tileID.overscaledZ),K,this.tileID.canonical))continue}else if(!w.filter(new d.z(this.tileID.overscaledZ),V))continue;const j=l.getId(V,p),G=new d.a9(V,T,P,z,j);G.tile=M,e.push(G)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const s=this.expirationTime;if(e.cacheControl){const l=d.aa(e.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const l=Date.now();let u=!1;if(this.expirationTime>l)u=!1;else if(s)if(this.expirationTime<s)u=!0;else{const p=this.expirationTime-s;p?this.expirationTime=l+Math.max(p,3e4):u=!0}else u=!0;u?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,s){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const l=this.latestFeatureIndex.loadVTLayers();for(const u in this.buckets){if(!s.style.hasLayer(u))continue;const p=this.buckets[u],v=p.layers[0].sourceLayer||"_geojsonTileLayer",w=l[v],T=e[v];if(!w||!T||Object.keys(T).length===0)continue;p.update(T,w,this.imageAtlas&&this.imageAtlas.patternPositions||{});const P=s&&s.style&&s.style.getLayer(u);P&&(this.queryPadding=Math.max(this.queryPadding,P.queryRadius(p)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<re.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=re.now()+e}setDependencies(e,s){const l={};for(const u of s)l[u]=!0;this.dependencies[e]=l}hasDependency(e,s){for(const l of e){const u=this.dependencies[l];if(u){for(const p of s)if(u[p])return!0}}return!1}}class Ae{constructor(e,s){this.max=e,this.onRemove=s,this.reset()}reset(){for(const e in this.data)for(const s of this.data[e])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(e,s,l){const u=e.wrapped().key;this.data[u]===void 0&&(this.data[u]=[]);const p={value:s,timeout:void 0};if(l!==void 0&&(p.timeout=setTimeout(()=>{this.remove(e,p)},l)),this.data[u].push(p),this.order.push(u),this.order.length>this.max){const v=this._getAndRemoveByKey(this.order[0]);v&&this.onRemove(v)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const s=this.data[e].shift();return s.timeout&&clearTimeout(s.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),s.value}getByKey(e){const s=this.data[e];return s?s[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,s){if(!this.has(e))return this;const l=e.wrapped().key,u=s===void 0?0:this.data[l].indexOf(s),p=this.data[l][u];return this.data[l].splice(u,1),p.timeout&&clearTimeout(p.timeout),this.data[l].length===0&&delete this.data[l],this.onRemove(p.value),this.order.splice(this.order.indexOf(l),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(e){const s=[];for(const l in this.data)for(const u of this.data[l])e(u.value)||s.push(u);for(const l of s)this.remove(l.value.tileID,l)}}class ft{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,s,l){const u=String(s);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][u]=this.stateChanges[e][u]||{},d.e(this.stateChanges[e][u],l),this.deletedStates[e]===null){this.deletedStates[e]={};for(const p in this.state[e])p!==u&&(this.deletedStates[e][p]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][u]===null){this.deletedStates[e][u]={};for(const p in this.state[e][u])l[p]||(this.deletedStates[e][u][p]=null)}else for(const p in l)this.deletedStates[e]&&this.deletedStates[e][u]&&this.deletedStates[e][u][p]===null&&delete this.deletedStates[e][u][p]}removeFeatureState(e,s,l){if(this.deletedStates[e]===null)return;const u=String(s);if(this.deletedStates[e]=this.deletedStates[e]||{},l&&s!==void 0)this.deletedStates[e][u]!==null&&(this.deletedStates[e][u]=this.deletedStates[e][u]||{},this.deletedStates[e][u][l]=null);else if(s!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][u])for(l in this.deletedStates[e][u]={},this.stateChanges[e][u])this.deletedStates[e][u][l]=null;else this.deletedStates[e][u]=null;else this.deletedStates[e]=null}getState(e,s){const l=String(s),u=d.e({},(this.state[e]||{})[l],(this.stateChanges[e]||{})[l]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const p=this.deletedStates[e][s];if(p===null)return{};for(const v in p)delete u[v]}return u}initializeTileState(e,s){e.setFeatureState(this.state,s)}coalesceChanges(e,s){const l={};for(const u in this.stateChanges){this.state[u]=this.state[u]||{};const p={};for(const v in this.stateChanges[u])this.state[u][v]||(this.state[u][v]={}),d.e(this.state[u][v],this.stateChanges[u][v]),p[v]=this.state[u][v];l[u]=p}for(const u in this.deletedStates){this.state[u]=this.state[u]||{};const p={};if(this.deletedStates[u]===null)for(const v in this.state[u])p[v]={},this.state[u][v]={};else for(const v in this.deletedStates[u]){if(this.deletedStates[u][v]===null)this.state[u][v]={};else for(const w of Object.keys(this.deletedStates[u][v]))delete this.state[u][v][w];p[v]=this.state[u][v]}l[u]=l[u]||{},d.e(l[u],p)}if(this.stateChanges={},this.deletedStates={},Object.keys(l).length!==0)for(const u in e)e[u].setFeatureState(l,s)}}class st extends d.E{constructor(e,s,l){super(),this.id=e,this.dispatcher=l,this.on("data",u=>this._dataHandler(u)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((u,p,v,w)=>{const T=new($o(p.type))(u,p,v,w);if(T.id!==u)throw new Error(`Expected Source id to be ${u} instead of ${T.id}`);return T})(e,s,l,this),this._tiles={},this._cache=new Ae(0,u=>this._unloadTile(u)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new ft,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const s=this._tiles[e];if(s.state!=="loaded"&&s.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,s,l){return d._(this,void 0,void 0,function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,s,l)}catch(u){e.state="errored",u.status!==404?this._source.fire(new d.j(u,{tile:e})):this.update(this.transform,this.terrain)}})}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new d.k("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const s in this._tiles){const l=this._tiles[s];l.upload(e),l.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(ti).map(e=>e.key)}getRenderableIds(e){const s=[];for(const l in this._tiles)this._isIdRenderable(l,e)&&s.push(this._tiles[l]);return e?s.sort((l,u)=>{const p=l.tileID,v=u.tileID,w=new d.P(p.canonical.x,p.canonical.y)._rotate(this.transform.angle),T=new d.P(v.canonical.x,v.canonical.y)._rotate(this.transform.angle);return p.overscaledZ-v.overscaledZ||T.y-w.y||T.x-w.x}).map(l=>l.tileID.key):s.map(l=>l.tileID).sort(ti).map(l=>l.key)}hasRenderableParent(e){const s=this.findLoadedParent(e,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(e,s){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(s||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(e,"reloading")}}_reloadTile(e,s){return d._(this,void 0,void 0,function*(){const l=this._tiles[e];l&&(l.state!=="loading"&&(l.state=s),yield this._loadTile(l,e,s))})}_tileLoaded(e,s,l){e.timeAdded=re.now(),l==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(s,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new d.k("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const s=this.getRenderableIds();for(let u=0;u<s.length;u++){const p=s[u];if(e.neighboringTiles&&e.neighboringTiles[p]){const v=this.getTileByID(p);l(e,v),l(v,e)}}function l(u,p){u.needsHillshadePrepare=!0,u.needsTerrainPrepare=!0;let v=p.tileID.canonical.x-u.tileID.canonical.x;const w=p.tileID.canonical.y-u.tileID.canonical.y,T=Math.pow(2,u.tileID.canonical.z),P=p.tileID.key;v===0&&w===0||Math.abs(w)>1||(Math.abs(v)>1&&(Math.abs(v+T)===1?v+=T:Math.abs(v-T)===1&&(v-=T)),p.dem&&u.dem&&(u.dem.backfillBorder(p.dem,v,w),u.neighboringTiles&&u.neighboringTiles[P]&&(u.neighboringTiles[P].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,s,l,u){for(const p in this._tiles){let v=this._tiles[p];if(u[p]||!v.hasData()||v.tileID.overscaledZ<=s||v.tileID.overscaledZ>l)continue;let w=v.tileID;for(;v&&v.tileID.overscaledZ>s+1;){const P=v.tileID.scaledTo(v.tileID.overscaledZ-1);v=this._tiles[P.key],v&&v.hasData()&&(w=P)}let T=w;for(;T.overscaledZ>s;)if(T=T.scaledTo(T.overscaledZ-1),e[T.key]){u[w.key]=w;break}}}findLoadedParent(e,s){if(e.key in this._loadedParentTiles){const l=this._loadedParentTiles[e.key];return l&&l.tileID.overscaledZ>=s?l:null}for(let l=e.overscaledZ-1;l>=s;l--){const u=e.scaledTo(l),p=this._getLoadedTile(u);if(p)return p}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){const s=this._tiles[e.key];return s&&s.hasData()?s:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){const s=Math.ceil(e.width/this._source.tileSize)+1,l=Math.ceil(e.height/this._source.tileSize)+1,u=Math.floor(s*l*(this._maxTileCacheZoomLevels===null?d.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),p=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,u):u;this._cache.setMaxSize(p)}handleWrapJump(e){const s=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,s){const l={};for(const u in this._tiles){const p=this._tiles[u];p.tileID=p.tileID.unwrapTo(p.tileID.wrap+s),l[p.tileID.key]=p}this._tiles=l;for(const u in this._timers)clearTimeout(this._timers[u]),delete this._timers[u];for(const u in this._tiles)this._setTileReloadTimer(u,this._tiles[u])}}_updateCoveredAndRetainedTiles(e,s,l,u,p,v){const w={},T={},P=Object.keys(e),z=re.now();for(const M of P){const F=e[M],V=this._tiles[M];if(!V||V.fadeEndTime!==0&&V.fadeEndTime<=z)continue;const j=this.findLoadedParent(F,s),G=this.findLoadedSibling(F),K=j||G||null;K&&(this._addTile(K.tileID),w[K.tileID.key]=K.tileID),T[M]=F}this._retainLoadedChildren(T,u,l,e);for(const M in w)e[M]||(this._coveredTiles[M]=!0,e[M]=w[M]);if(v){const M={},F={};for(const V of p)this._tiles[V.key].hasData()?M[V.key]=V:F[V.key]=V;for(const V in F){const j=F[V].children(this._source.maxzoom);this._tiles[j[0].key]&&this._tiles[j[1].key]&&this._tiles[j[2].key]&&this._tiles[j[3].key]&&(M[j[0].key]=e[j[0].key]=j[0],M[j[1].key]=e[j[1].key]=j[1],M[j[2].key]=e[j[2].key]=j[2],M[j[3].key]=e[j[3].key]=j[3],delete F[V])}for(const V in F){const j=F[V],G=this.findLoadedParent(j,this._source.minzoom),K=this.findLoadedSibling(j),Y=G||K||null;if(Y){M[Y.tileID.key]=e[Y.tileID.key]=Y.tileID;for(const Q in M)M[Q].isChildOf(Y.tileID)&&delete M[Q]}}for(const V in this._tiles)M[V]||(this._coveredTiles[V]=!0)}}update(e,s){if(!this._sourceLoaded||this._paused)return;let l;this.transform=e,this.terrain=s,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?l=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(z=>new d.S(z.canonical.z,z.wrap,z.canonical.z,z.canonical.x,z.canonical.y)):(l=e.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:s}),this._source.hasTile&&(l=l.filter(z=>this._source.hasTile(z)))):l=[];const u=e.coveringZoomLevel(this._source),p=Math.max(u-st.maxOverzooming,this._source.minzoom),v=Math.max(u+st.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const z={};for(const M of l)if(M.canonical.z>this._source.minzoom){const F=M.scaledTo(M.canonical.z-1);z[F.key]=F;const V=M.scaledTo(Math.max(this._source.minzoom,Math.min(M.canonical.z,5)));z[V.key]=V}l=l.concat(Object.values(z))}const w=l.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,w&&this.fire(new d.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const T=this._updateRetainedTiles(l,u);$i(this._source.type)&&this._updateCoveredAndRetainedTiles(T,p,v,u,l,s);for(const z in T)this._tiles[z].clearFadeHold();const P=d.ab(this._tiles,T);for(const z of P){const M=this._tiles[z];M.hasSymbolBuckets&&!M.holdingForFade()?M.setHoldDuration(this.map._fadeDuration):M.hasSymbolBuckets&&!M.symbolFadeFinished()||this._removeTile(z)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,s){var l;const u={},p={},v=Math.max(s-st.maxOverzooming,this._source.minzoom),w=Math.max(s+st.maxUnderzooming,this._source.minzoom),T={};for(const P of e){const z=this._addTile(P);u[P.key]=P,z.hasData()||s<this._source.maxzoom&&(T[P.key]=P)}this._retainLoadedChildren(T,s,w,u);for(const P of e){let z=this._tiles[P.key];if(z.hasData())continue;if(s+1>this._source.maxzoom){const F=P.children(this._source.maxzoom)[0],V=this.getTile(F);if(V&&V.hasData()){u[F.key]=F;continue}}else{const F=P.children(this._source.maxzoom);if(u[F[0].key]&&u[F[1].key]&&u[F[2].key]&&u[F[3].key])continue}let M=z.wasRequested();for(let F=P.overscaledZ-1;F>=v;--F){const V=P.scaledTo(F);if(p[V.key])break;if(p[V.key]=!0,z=this.getTile(V),!z&&M&&(z=this._addTile(V)),z){const j=z.hasData();if((j||!(!((l=this.map)===null||l===void 0)&&l.cancelPendingTileRequestsWhileZooming)||M)&&(u[V.key]=V),M=z.wasRequested(),j)break}}}return u}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const s=[];let l,u=this._tiles[e].tileID;for(;u.overscaledZ>0;){if(u.key in this._loadedParentTiles){l=this._loadedParentTiles[u.key];break}s.push(u.key);const p=u.scaledTo(u.overscaledZ-1);if(l=this._getLoadedTile(p),l)break;u=p}for(const p of s)this._loadedParentTiles[p]=l}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const e in this._tiles){const s=this._tiles[e].tileID,l=this._getLoadedTile(s);this._loadedSiblingTiles[s.key]=l}}_addTile(e){let s=this._tiles[e.key];if(s)return s;s=this._cache.getAndRemove(e),s&&(this._setTileReloadTimer(e.key,s),s.tileID=e,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,s)));const l=s;return s||(s=new Gn(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(s,e.key,s.state)),s.uses++,this._tiles[e.key]=s,l||this._source.fire(new d.k("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s}_setTileReloadTimer(e,s){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const l=s.getExpiryTimeout();l&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},l))}_removeTile(e){const s=this._tiles[e];s&&(s.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),s.uses>0||(s.hasData()&&s.state!=="reloading"?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}_dataHandler(e){const s=e.sourceDataType;e.dataType==="source"&&s==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&e.dataType==="source"&&s==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,s,l){const u=[],p=this.transform;if(!p)return u;const v=l?p.getCameraQueryGeometry(e):e,w=e.map(j=>p.pointCoordinate(j,this.terrain)),T=v.map(j=>p.pointCoordinate(j,this.terrain)),P=this.getIds();let z=1/0,M=1/0,F=-1/0,V=-1/0;for(const j of T)z=Math.min(z,j.x),M=Math.min(M,j.y),F=Math.max(F,j.x),V=Math.max(V,j.y);for(let j=0;j<P.length;j++){const G=this._tiles[P[j]];if(G.holdingForFade())continue;const K=G.tileID,Y=Math.pow(2,p.zoom-G.tileID.overscaledZ),Q=s*G.queryPadding*d.X/G.tileSize/Y,U=[K.getTilePoint(new d.Z(z,M)),K.getTilePoint(new d.Z(F,V))];if(U[0].x-Q<d.X&&U[0].y-Q<d.X&&U[1].x+Q>=0&&U[1].y+Q>=0){const ne=w.map(pe=>K.getTilePoint(pe)),oe=T.map(pe=>K.getTilePoint(pe));u.push({tile:G,tileID:K,queryGeometry:ne,cameraQueryGeometry:oe,scale:Y})}}return u}getVisibleCoordinates(e){const s=this.getRenderableIds(e).map(l=>this._tiles[l].tileID);for(const l of s)l.posMatrix=this.transform.calculatePosMatrix(l.toUnwrapped());return s}hasTransition(){if(this._source.hasTransition())return!0;if($i(this._source.type)){const e=re.now();for(const s in this._tiles)if(this._tiles[s].fadeEndTime>=e)return!0}return!1}setFeatureState(e,s,l){this._state.updateState(e=e||"_geojsonTileLayer",s,l)}removeFeatureState(e,s,l){this._state.removeFeatureState(e=e||"_geojsonTileLayer",s,l)}getFeatureState(e,s){return this._state.getState(e=e||"_geojsonTileLayer",s)}setDependencies(e,s,l){const u=this._tiles[e];u&&u.setDependencies(s,l)}reloadTilesForDependencies(e,s){for(const l in this._tiles)this._tiles[l].hasDependency(e,s)&&this._reloadTile(l,"reloading");this._cache.filter(l=>!l.hasDependency(e,s))}}function ti(f,e){const s=Math.abs(2*f.wrap)-+(f.wrap<0),l=Math.abs(2*e.wrap)-+(e.wrap<0);return f.overscaledZ-e.overscaledZ||l-s||e.canonical.y-f.canonical.y||e.canonical.x-f.canonical.x}function $i(f){return f==="raster"||f==="image"||f==="video"}st.maxOverzooming=10,st.maxUnderzooming=3;class ht{constructor(e,s){this.reset(e,s)}reset(e,s){this.points=e||[],this._distances=[0];for(let l=1;l<this.points.length;l++)this._distances[l]=this._distances[l-1]+this.points[l].dist(this.points[l-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=d.ac(e,0,1);let s=1,l=this._distances[s];const u=e*this.paddedLength+this.padding;for(;l<u&&s<this._distances.length;)l=this._distances[++s];const p=s-1,v=this._distances[p],w=l-v,T=w>0?(u-v)/w:0;return this.points[p].mult(1-T).add(this.points[s].mult(T))}}function pn(f,e){let s=!0;return f==="always"||f!=="never"&&e!=="never"||(s=!1),s}class Cn{constructor(e,s,l){const u=this.boxCells=[],p=this.circleCells=[];this.xCellCount=Math.ceil(e/l),this.yCellCount=Math.ceil(s/l);for(let v=0;v<this.xCellCount*this.yCellCount;v++)u.push([]),p.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=s,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,s,l,u,p){this._forEachCell(s,l,u,p,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(s),this.bboxes.push(l),this.bboxes.push(u),this.bboxes.push(p)}insertCircle(e,s,l,u){this._forEachCell(s-u,l-u,s+u,l+u,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(s),this.circles.push(l),this.circles.push(u)}_insertBoxCell(e,s,l,u,p,v){this.boxCells[p].push(v)}_insertCircleCell(e,s,l,u,p,v){this.circleCells[p].push(v)}_query(e,s,l,u,p,v,w){if(l<0||e>this.width||u<0||s>this.height)return[];const T=[];if(e<=0&&s<=0&&this.width<=l&&this.height<=u){if(p)return[{key:null,x1:e,y1:s,x2:l,y2:u}];for(let P=0;P<this.boxKeys.length;P++)T.push({key:this.boxKeys[P],x1:this.bboxes[4*P],y1:this.bboxes[4*P+1],x2:this.bboxes[4*P+2],y2:this.bboxes[4*P+3]});for(let P=0;P<this.circleKeys.length;P++){const z=this.circles[3*P],M=this.circles[3*P+1],F=this.circles[3*P+2];T.push({key:this.circleKeys[P],x1:z-F,y1:M-F,x2:z+F,y2:M+F})}}else this._forEachCell(e,s,l,u,this._queryCell,T,{hitTest:p,overlapMode:v,seenUids:{box:{},circle:{}}},w);return T}query(e,s,l,u){return this._query(e,s,l,u,!1,null)}hitTest(e,s,l,u,p,v){return this._query(e,s,l,u,!0,p,v).length>0}hitTestCircle(e,s,l,u,p){const v=e-l,w=e+l,T=s-l,P=s+l;if(w<0||v>this.width||P<0||T>this.height)return!1;const z=[];return this._forEachCell(v,T,w,P,this._queryCellCircle,z,{hitTest:!0,overlapMode:u,circle:{x:e,y:s,radius:l},seenUids:{box:{},circle:{}}},p),z.length>0}_queryCell(e,s,l,u,p,v,w,T){const{seenUids:P,hitTest:z,overlapMode:M}=w,F=this.boxCells[p];if(F!==null){const j=this.bboxes;for(const G of F)if(!P.box[G]){P.box[G]=!0;const K=4*G,Y=this.boxKeys[G];if(e<=j[K+2]&&s<=j[K+3]&&l>=j[K+0]&&u>=j[K+1]&&(!T||T(Y))&&(!z||!pn(M,Y.overlapMode))&&(v.push({key:Y,x1:j[K],y1:j[K+1],x2:j[K+2],y2:j[K+3]}),z))return!0}}const V=this.circleCells[p];if(V!==null){const j=this.circles;for(const G of V)if(!P.circle[G]){P.circle[G]=!0;const K=3*G,Y=this.circleKeys[G];if(this._circleAndRectCollide(j[K],j[K+1],j[K+2],e,s,l,u)&&(!T||T(Y))&&(!z||!pn(M,Y.overlapMode))){const Q=j[K],U=j[K+1],ne=j[K+2];if(v.push({key:Y,x1:Q-ne,y1:U-ne,x2:Q+ne,y2:U+ne}),z)return!0}}}return!1}_queryCellCircle(e,s,l,u,p,v,w,T){const{circle:P,seenUids:z,overlapMode:M}=w,F=this.boxCells[p];if(F!==null){const j=this.bboxes;for(const G of F)if(!z.box[G]){z.box[G]=!0;const K=4*G,Y=this.boxKeys[G];if(this._circleAndRectCollide(P.x,P.y,P.radius,j[K+0],j[K+1],j[K+2],j[K+3])&&(!T||T(Y))&&!pn(M,Y.overlapMode))return v.push(!0),!0}}const V=this.circleCells[p];if(V!==null){const j=this.circles;for(const G of V)if(!z.circle[G]){z.circle[G]=!0;const K=3*G,Y=this.circleKeys[G];if(this._circlesCollide(j[K],j[K+1],j[K+2],P.x,P.y,P.radius)&&(!T||T(Y))&&!pn(M,Y.overlapMode))return v.push(!0),!0}}}_forEachCell(e,s,l,u,p,v,w,T){const P=this._convertToXCellCoord(e),z=this._convertToYCellCoord(s),M=this._convertToXCellCoord(l),F=this._convertToYCellCoord(u);for(let V=P;V<=M;V++)for(let j=z;j<=F;j++)if(p.call(this,e,s,l,u,this.xCellCount*j+V,v,w,T))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,s,l,u,p,v){const w=u-e,T=p-s,P=l+v;return P*P>w*w+T*T}_circleAndRectCollide(e,s,l,u,p,v,w){const T=(v-u)/2,P=Math.abs(e-(u+T));if(P>T+l)return!1;const z=(w-p)/2,M=Math.abs(s-(p+z));if(M>z+l)return!1;if(P<=T||M<=z)return!0;const F=P-T,V=M-z;return F*F+V*V<=l*l}}function Hn(f,e,s,l,u){const p=d.H();return e?(d.K(p,p,[1/u,1/u,1]),s||d.ad(p,p,l.angle)):d.L(p,l.labelPlaneMatrix,f),p}function fn(f,e,s,l,u){if(e){const p=d.ae(f);return d.K(p,p,[u,u,1]),s||d.ad(p,p,-l.angle),p}return l.glCoordMatrix}function W(f,e,s,l){let u;l?(u=[f,e,l(f,e),1],d.af(u,u,s)):(u=[f,e,0,1],Tt(u,u,s));const p=u[3];return{point:new d.P(u[0]/p,u[1]/p),signedDistanceFromCamera:p,isOccluded:!1}}function L(f,e){return .5+f/e*.5}function D(f,e){return f.x>=-e[0]&&f.x<=e[0]&&f.y>=-e[1]&&f.y<=e[1]}function N(f,e,s,l,u,p,v,w,T,P,z,M,F,V,j){const G=l?f.textSizeData:f.iconSizeData,K=d.ag(G,s.transform.zoom),Y=[256/s.width*2+1,256/s.height*2+1],Q=l?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;Q.clear();const U=f.lineVertexArray,ne=l?f.text.placedSymbolArray:f.icon.placedSymbolArray,oe=s.transform.width/s.transform.height;let pe=!1;for(let xe=0;xe<ne.length;xe++){const Se=ne.get(xe);if(Se.hidden||Se.writingMode===d.ah.vertical&&!pe){tt(Se.numGlyphs,Q);continue}pe=!1;const Re=W(Se.anchorX,Se.anchorY,e,j);if(!D(Re.point,Y)){tt(Se.numGlyphs,Q);continue}const Ve=L(s.transform.cameraToCenterDistance,Re.signedDistanceFromCamera),Me=d.ai(G,K,Se),ze=v?Me/Ve:Me*Ve,We={getElevation:j,labelPlaneMatrix:u,lineVertexArray:U,pitchWithMap:v,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:P,tileAnchorPoint:new d.P(Se.anchorX,Se.anchorY),unwrappedTileID:z,width:M,height:F,translation:V},lt=se(We,Se,ze,!1,w,e,p,f.glyphOffsetArray,Q,oe,T);pe=lt.useVertical,(lt.notEnoughRoom||pe||lt.needsFlipping&&se(We,Se,ze,!0,w,e,p,f.glyphOffsetArray,Q,oe,T).notEnoughRoom)&&tt(Se.numGlyphs,Q)}l?f.text.dynamicLayoutVertexBuffer.updateData(Q):f.icon.dynamicLayoutVertexBuffer.updateData(Q)}function Z(f,e,s,l,u,p,v,w){const T=p.glyphStartIndex+p.numGlyphs,P=p.lineStartIndex,z=p.lineStartIndex+p.lineLength,M=e.getoffsetX(p.glyphStartIndex),F=e.getoffsetX(T-1),V=Ce(f*M,s,l,u,p.segment,P,z,w,v);if(!V)return null;const j=Ce(f*F,s,l,u,p.segment,P,z,w,v);return j?w.projectionCache.anyProjectionOccluded?null:{first:V,last:j}:null}function te(f,e,s,l){return f===d.ah.horizontal&&Math.abs(s.y-e.y)>Math.abs(s.x-e.x)*l?{useVertical:!0}:(f===d.ah.vertical?e.y<s.y:e.x>s.x)?{needsFlipping:!0}:null}function se(f,e,s,l,u,p,v,w,T,P,z){const M=s/24,F=e.lineOffsetX*M,V=e.lineOffsetY*M;let j;if(e.numGlyphs>1){const G=e.glyphStartIndex+e.numGlyphs,K=e.lineStartIndex,Y=e.lineStartIndex+e.lineLength,Q=Z(M,w,F,V,l,e,z,f);if(!Q)return{notEnoughRoom:!0};const U=W(Q.first.point.x,Q.first.point.y,v,f.getElevation).point,ne=W(Q.last.point.x,Q.last.point.y,v,f.getElevation).point;if(u&&!l){const oe=te(e.writingMode,U,ne,P);if(oe)return oe}j=[Q.first];for(let oe=e.glyphStartIndex+1;oe<G-1;oe++)j.push(Ce(M*w.getoffsetX(oe),F,V,l,e.segment,K,Y,f,z));j.push(Q.last)}else{if(u&&!l){const K=W(f.tileAnchorPoint.x,f.tileAnchorPoint.y,p,f.getElevation).point,Y=e.lineStartIndex+e.segment+1,Q=new d.P(f.lineVertexArray.getx(Y),f.lineVertexArray.gety(Y)),U=W(Q.x,Q.y,p,f.getElevation),ne=U.signedDistanceFromCamera>0?U.point:function(pe,xe,Se,Re,Ve,Me){return ue(pe,xe,Se,1,Ve,Me)}(f.tileAnchorPoint,Q,K,0,p,f),oe=te(e.writingMode,K,ne,P);if(oe)return oe}const G=Ce(M*w.getoffsetX(e.glyphStartIndex),F,V,l,e.segment,e.lineStartIndex,e.lineStartIndex+e.lineLength,f,z);if(!G||f.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};j=[G]}for(const G of j)d.aj(T,G.point,G.angle);return{}}function ue(f,e,s,l,u,p){const v=f.add(f.sub(e)._unit()),w=u!==void 0?W(v.x,v.y,u,p.getElevation).point:_e(v.x,v.y,p).point,T=s.sub(w);return s.add(T._mult(l/T.mag()))}function J(f,e,s){const l=e.projectionCache;if(l.projections[f])return l.projections[f];const u=new d.P(e.lineVertexArray.getx(f),e.lineVertexArray.gety(f)),p=_e(u.x,u.y,e);if(p.signedDistanceFromCamera>0)return l.projections[f]=p.point,l.anyProjectionOccluded=l.anyProjectionOccluded||p.isOccluded,p.point;const v=f-s.direction;return function(w,T,P,z,M){return ue(w,T,P,z,void 0,M)}(s.distanceFromAnchor===0?e.tileAnchorPoint:new d.P(e.lineVertexArray.getx(v),e.lineVertexArray.gety(v)),u,s.previousVertex,s.absOffsetX-s.distanceFromAnchor+1,e)}function _e(f,e,s){const l=f+s.translation[0],u=e+s.translation[1];let p;return!s.pitchWithMap&&s.projection.useSpecialProjectionForSymbols?(p=s.projection.projectTileCoordinates(l,u,s.unwrappedTileID,s.getElevation),p.point.x=(.5*p.point.x+.5)*s.width,p.point.y=(.5*-p.point.y+.5)*s.height):(p=W(l,u,s.labelPlaneMatrix,s.getElevation),p.isOccluded=!1),p}function we(f,e,s){return f._unit()._perp()._mult(e*s)}function fe(f,e,s,l,u,p,v,w,T){if(w.projectionCache.offsets[f])return w.projectionCache.offsets[f];const P=s.add(e);if(f+T.direction<l||f+T.direction>=u)return w.projectionCache.offsets[f]=P,P;const z=J(f+T.direction,w,T),M=we(z.sub(s),v,T.direction),F=s.add(M),V=z.add(M);return w.projectionCache.offsets[f]=d.ak(p,P,F,V)||P,w.projectionCache.offsets[f]}function Ce(f,e,s,l,u,p,v,w,T){const P=l?f-e:f+e;let z=P>0?1:-1,M=0;l&&(z*=-1,M=Math.PI),z<0&&(M+=Math.PI);let F,V=z>0?p+u:p+u+1;w.projectionCache.cachedAnchorPoint?F=w.projectionCache.cachedAnchorPoint:(F=_e(w.tileAnchorPoint.x,w.tileAnchorPoint.y,w).point,w.projectionCache.cachedAnchorPoint=F);let j,G,K=F,Y=F,Q=0,U=0;const ne=Math.abs(P),oe=[];let pe;for(;Q+U<=ne;){if(V+=z,V<p||V>=v)return null;Q+=U,Y=K,G=j;const Re={absOffsetX:ne,direction:z,distanceFromAnchor:Q,previousVertex:Y};if(K=J(V,w,Re),s===0)oe.push(Y),pe=K.sub(Y);else{let Ve;const Me=K.sub(Y);Ve=Me.mag()===0?we(J(V+z,w,Re).sub(K),s,z):we(Me,s,z),G||(G=Y.add(Ve)),j=fe(V,Ve,K,p,v,G,s,w,Re),oe.push(G),pe=j.sub(G)}U=pe.mag()}const xe=pe._mult((ne-Q)/U)._add(G||Y),Se=M+Math.atan2(K.y-Y.y,K.x-Y.x);return oe.push(xe),{point:xe,angle:T?Se:0,path:oe}}const Qe=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function tt(f,e){for(let s=0;s<f;s++){const l=e.length;e.resize(l+4),e.float32.set(Qe,3*l)}}function Tt(f,e,s){const l=e[0],u=e[1];return f[0]=s[0]*l+s[4]*u+s[12],f[1]=s[1]*l+s[5]*u+s[13],f[3]=s[3]*l+s[7]*u+s[15],f}const dt=100;class kt{constructor(e,s,l=new Cn(e.width+200,e.height+200,25),u=new Cn(e.width+200,e.height+200,25)){this.transform=e,this.mapProjection=s,this.grid=l,this.ignoredGrid=u,this.pitchFactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+dt,this.screenBottomBoundary=e.height+dt,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,s,l,u,p,v,w,T,P,z,M){const F=e.anchorPointX+T[0],V=e.anchorPointY+T[1],j=this.projectAndGetPerspectiveRatio(u,F,V,p,z),G=l*j.perspectiveRatio;let K;if(v||w)K=this._projectCollisionBox(e,G,u,p,v,w,T,j,z,M);else{const oe=j.point.x+(M?M.x*G:0),pe=j.point.y+(M?M.y*G:0);K={allPointsOccluded:!1,box:[oe+e.x1*G,pe+e.y1*G,oe+e.x2*G,pe+e.y2*G]}}const[Y,Q,U,ne]=K.box;return this.mapProjection.useSpecialProjectionForSymbols&&(v?K.allPointsOccluded:this.mapProjection.isOccluded(F,V,p))||j.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(Y,Q,U,ne)||s!=="always"&&this.grid.hitTest(Y,Q,U,ne,s,P)?{box:[Y,Q,U,ne],placeable:!1,offscreen:!1}:{box:[Y,Q,U,ne],placeable:!0,offscreen:this.isOffscreen(Y,Q,U,ne)}}placeCollisionCircles(e,s,l,u,p,v,w,T,P,z,M,F,V,j,G,K){const Y=[],Q=new d.P(s.anchorX,s.anchorY),U=this.getPerspectiveRatio(v,Q.x,Q.y,w,K),ne=(M?p/U:p*U)/d.ap,oe={getElevation:K,labelPlaneMatrix:T,lineVertexArray:l,pitchWithMap:M,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:Q,unwrappedTileID:w,width:this.transform.width,height:this.transform.height,translation:G},pe=Z(ne,u,s.lineOffsetX*ne,s.lineOffsetY*ne,!1,s,!1,oe);let xe=!1,Se=!1,Re=!0;if(pe){const Ve=.5*V*U+j,Me=new d.P(-100,-100),ze=new d.P(this.screenRightBoundary,this.screenBottomBoundary),We=new ht,lt=pe.first,De=pe.last;let Oe=[];for(let pt=lt.path.length-1;pt>=1;pt--)Oe.push(lt.path[pt]);for(let pt=1;pt<De.path.length;pt++)Oe.push(De.path[pt]);const ot=2.5*Ve;if(P){const pt=this.projectPathToScreenSpace(Oe,oe,P);Oe=pt.some(xt=>xt.signedDistanceFromCamera<=0)?[]:pt.map(xt=>xt.point)}let Gt=[];if(Oe.length>0){const pt=Oe[0].clone(),xt=Oe[0].clone();for(let Ht=1;Ht<Oe.length;Ht++)pt.x=Math.min(pt.x,Oe[Ht].x),pt.y=Math.min(pt.y,Oe[Ht].y),xt.x=Math.max(xt.x,Oe[Ht].x),xt.y=Math.max(xt.y,Oe[Ht].y);Gt=pt.x>=Me.x&&xt.x<=ze.x&&pt.y>=Me.y&&xt.y<=ze.y?[Oe]:xt.x<Me.x||pt.x>ze.x||xt.y<Me.y||pt.y>ze.y?[]:d.al([Oe],Me.x,Me.y,ze.x,ze.y)}for(const pt of Gt){We.reset(pt,.25*Ve);let xt=0;xt=We.length<=.5*Ve?1:Math.ceil(We.paddedLength/ot)+1;for(let Ht=0;Ht<xt;Ht++){const Dr=Ht/Math.max(xt-1,1),Xi=We.lerp(Dr),Wt=Xi.x+dt,ni=Xi.y+dt;Y.push(Wt,ni,Ve,0);const qr=Wt-Ve,Lr=ni-Ve,Gr=Wt+Ve,yn=ni+Ve;if(Re=Re&&this.isOffscreen(qr,Lr,Gr,yn),Se=Se||this.isInsideGrid(qr,Lr,Gr,yn),e!=="always"&&this.grid.hitTestCircle(Wt,ni,Ve,e,F)&&(xe=!0,!z))return{circles:[],offscreen:!1,collisionDetected:xe}}}}return{circles:!z&&xe||!Se||U<this.perspectiveRatioCutoff?[]:Y,offscreen:Re,collisionDetected:xe}}projectPathToScreenSpace(e,s,l){return e.map(u=>W(u.x,u.y,l,s.getElevation))}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const s=[];let l=1/0,u=1/0,p=-1/0,v=-1/0;for(const z of e){const M=new d.P(z.x+dt,z.y+dt);l=Math.min(l,M.x),u=Math.min(u,M.y),p=Math.max(p,M.x),v=Math.max(v,M.y),s.push(M)}const w=this.grid.query(l,u,p,v).concat(this.ignoredGrid.query(l,u,p,v)),T={},P={};for(const z of w){const M=z.key;if(T[M.bucketInstanceId]===void 0&&(T[M.bucketInstanceId]={}),T[M.bucketInstanceId][M.featureIndex])continue;const F=[new d.P(z.x1,z.y1),new d.P(z.x2,z.y1),new d.P(z.x2,z.y2),new d.P(z.x1,z.y2)];d.am(s,F)&&(T[M.bucketInstanceId][M.featureIndex]=!0,P[M.bucketInstanceId]===void 0&&(P[M.bucketInstanceId]=[]),P[M.bucketInstanceId].push(M.featureIndex))}return P}insertCollisionBox(e,s,l,u,p,v){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:u,featureIndex:p,collisionGroupID:v,overlapMode:s},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,s,l,u,p,v){const w=l?this.ignoredGrid:this.grid,T={bucketInstanceId:u,featureIndex:p,collisionGroupID:v,overlapMode:s};for(let P=0;P<e.length;P+=4)w.insertCircle(T,e[P],e[P+1],e[P+2])}projectAndGetPerspectiveRatio(e,s,l,u,p){let v;p?(v=[s,l,p(s,l),1],d.af(v,v,e)):(v=[s,l,0,1],Tt(v,v,e));const w=v[3];return{point:new d.P((v[0]/w+1)/2*this.transform.width+dt,(-v[1]/w+1)/2*this.transform.height+dt),perspectiveRatio:.5+this.transform.cameraToCenterDistance/w*.5,isOccluded:!1,signedDistanceFromCamera:w}}getPerspectiveRatio(e,s,l,u,p){const v=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(s,l,u,p):W(s,l,e,p);return .5+this.transform.cameraToCenterDistance/v.signedDistanceFromCamera*.5}isOffscreen(e,s,l,u){return l<dt||e>=this.screenRightBoundary||u<dt||s>this.screenBottomBoundary}isInsideGrid(e,s,l,u){return l>=0&&e<this.gridRightBoundary&&u>=0&&s<this.gridBottomBoundary}getViewportMatrix(){const e=d.an([]);return d.J(e,e,[-100,-100,0]),e}_projectCollisionBox(e,s,l,u,p,v,w,T,P,z){let M=new d.P(1,0),F=new d.P(0,1);const V=new d.P(e.anchorPointX+w[0],e.anchorPointY+w[1]);if(v&&!p){const Re=this.projectAndGetPerspectiveRatio(l,V.x+1,V.y,u,P).point.sub(T.point).unit(),Ve=Math.atan(Re.y/Re.x)+(Re.x<0?Math.PI:0),Me=Math.sin(Ve),ze=Math.cos(Ve);M=new d.P(ze,Me),F=new d.P(-Me,ze)}else if(!v&&p){const Re=-this.transform.angle,Ve=Math.sin(Re),Me=Math.cos(Re);M=new d.P(Me,Ve),F=new d.P(-Ve,Me)}let j=T.point,G=s;if(p){j=V;const Re=this.transform.zoom-Math.floor(this.transform.zoom);G=Math.pow(2,-Re),G*=this.mapProjection.getPitchedTextCorrection(this.transform,V,u),z||(G*=d.ac(.5+T.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}z&&(j=j.add(M.mult(z.x*G)).add(F.mult(z.y*G)));const K=e.x1*G,Y=e.x2*G,Q=(K+Y)/2,U=e.y1*G,ne=e.y2*G,oe=(U+ne)/2,pe=[{offsetX:K,offsetY:U},{offsetX:Q,offsetY:U},{offsetX:Y,offsetY:U},{offsetX:Y,offsetY:oe},{offsetX:Y,offsetY:ne},{offsetX:Q,offsetY:ne},{offsetX:K,offsetY:ne},{offsetX:K,offsetY:oe}];let xe=[];for(const{offsetX:Re,offsetY:Ve}of pe)xe.push(new d.P(j.x+M.x*Re+F.x*Ve,j.y+M.y*Re+F.y*Ve));let Se=!1;if(p){const Re=xe.map(Ve=>this.projectAndGetPerspectiveRatio(l,Ve.x,Ve.y,u,P));Se=Re.some(Ve=>!Ve.isOccluded),xe=Re.map(Ve=>Ve.point)}else Se=!0;return{box:d.ao(xe),allPointsOccluded:!Se}}}function vt(f,e,s){return e*(d.X/(f.tileSize*Math.pow(2,s-f.tileID.overscaledZ)))}class pr{constructor(e,s,l,u){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?s:-s))):u&&l?1:0,this.placed=l}isHidden(){return this.opacity===0&&!this.placed}}class Qt{constructor(e,s,l,u,p){this.text=new pr(e?e.text:null,s,l,p),this.icon=new pr(e?e.icon:null,s,u,p)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class mt{constructor(e,s,l){this.text=e,this.icon=s,this.skipFade=l}}class Ft{constructor(){this.invProjMatrix=d.H(),this.viewportMatrix=d.H(),this.circles=[]}}class Kt{constructor(e,s,l,u,p){this.bucketInstanceId=e,this.featureIndex=s,this.sourceLayerIndex=l,this.bucketIndex=u,this.tileID=p}}class wr{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const s=++this.maxGroupID;this.collisionGroups[e]={ID:s,predicate:l=>l.collisionGroupID===s}}return this.collisionGroups[e]}}function Ir(f,e,s,l,u){const{horizontalAlign:p,verticalAlign:v}=d.au(f);return new d.P(-(p-.5)*e+l[0]*u,-(v-.5)*s+l[1]*u)}class Zr{constructor(e,s,l,u,p,v){this.transform=e.clone(),this.terrain=l,this.collisionIndex=new kt(this.transform,s),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new wr(p),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const s=this.terrain;return s?(l,u)=>s.getElevation(e,l,u):null}getBucketParts(e,s,l,u){const p=l.getBucket(s),v=l.latestFeatureIndex;if(!p||!v||s.id!==p.layerIds[0])return;const w=l.collisionBoxArray,T=p.layers[0].layout,P=p.layers[0].paint,z=Math.pow(2,this.transform.zoom-l.tileID.overscaledZ),M=l.tileSize/d.X,F=l.tileID.toUnwrapped(),V=this.transform.calculatePosMatrix(F),j=T.get("text-pitch-alignment")==="map",G=T.get("text-rotation-alignment")==="map",K=vt(l,1,this.transform.zoom),Y=this.collisionIndex.mapProjection.translatePosition(this.transform,l,P.get("text-translate"),P.get("text-translate-anchor")),Q=this.collisionIndex.mapProjection.translatePosition(this.transform,l,P.get("icon-translate"),P.get("icon-translate-anchor")),U=Hn(V,j,G,this.transform,K);let ne=null;if(j){const pe=fn(V,j,G,this.transform,K);ne=d.L([],this.transform.labelPlaneMatrix,pe)}this.retainedQueryData[p.bucketInstanceId]=new Kt(p.bucketInstanceId,v,p.sourceLayerIndex,p.index,l.tileID);const oe={bucket:p,layout:T,translationText:Y,translationIcon:Q,posMatrix:V,unwrappedTileID:F,textLabelPlaneMatrix:U,labelToScreenMatrix:ne,scale:z,textPixelRatio:M,holdingForFade:l.holdingForFade(),collisionBoxArray:w,partiallyEvaluatedTextSize:d.ag(p.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(p.sourceID)};if(u)for(const pe of p.sortKeyRanges){const{sortKey:xe,symbolInstanceStart:Se,symbolInstanceEnd:Re}=pe;e.push({sortKey:xe,symbolInstanceStart:Se,symbolInstanceEnd:Re,parameters:oe})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:p.symbolInstances.length,parameters:oe})}attemptAnchorPlacement(e,s,l,u,p,v,w,T,P,z,M,F,V,j,G,K,Y,Q,U){const ne=d.aq[e.textAnchor],oe=[e.textOffset0,e.textOffset1],pe=Ir(ne,l,u,oe,p),xe=this.collisionIndex.placeCollisionBox(s,F,T,P,z,w,v,K,M.predicate,U,pe);if((!Q||this.collisionIndex.placeCollisionBox(Q,F,T,P,z,w,v,Y,M.predicate,U,pe).placeable)&&xe.placeable){let Se;if(this.prevPlacement&&this.prevPlacement.variableOffsets[V.crossTileID]&&this.prevPlacement.placements[V.crossTileID]&&this.prevPlacement.placements[V.crossTileID].text&&(Se=this.prevPlacement.variableOffsets[V.crossTileID].anchor),V.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[V.crossTileID]={textOffset:oe,width:l,height:u,anchor:ne,textBoxScale:p,prevAnchor:Se},this.markUsedJustification(j,ne,V,G),j.allowVerticalPlacement&&(this.markUsedOrientation(j,G,V),this.placedOrientations[V.crossTileID]=G),{shift:pe,placedGlyphBoxes:xe}}}placeLayerBucketPart(e,s,l){const{bucket:u,layout:p,translationText:v,translationIcon:w,posMatrix:T,unwrappedTileID:P,textLabelPlaneMatrix:z,labelToScreenMatrix:M,textPixelRatio:F,holdingForFade:V,collisionBoxArray:j,partiallyEvaluatedTextSize:G,collisionGroup:K}=e.parameters,Y=p.get("text-optional"),Q=p.get("icon-optional"),U=d.ar(p,"text-overlap","text-allow-overlap"),ne=U==="always",oe=d.ar(p,"icon-overlap","icon-allow-overlap"),pe=oe==="always",xe=p.get("text-rotation-alignment")==="map",Se=p.get("text-pitch-alignment")==="map",Re=p.get("icon-text-fit")!=="none",Ve=p.get("symbol-z-order")==="viewport-y",Me=ne&&(pe||!u.hasIconData()||Q),ze=pe&&(ne||!u.hasTextData()||Y);!u.collisionArrays&&j&&u.deserializeCollisionBoxes(j);const We=this._getTerrainElevationFunc(this.retainedQueryData[u.bucketInstanceId].tileID),lt=(De,Oe,ot)=>{var Gt,pt;if(s[De.crossTileID])return;if(V)return void(this.placements[De.crossTileID]=new mt(!1,!1,!1));let xt=!1,Ht=!1,Dr=!0,Xi=null,Wt={box:null,placeable:!1,offscreen:null},ni={placeable:!1},qr=null,Lr=null,Gr=null,yn=0,oo=0,ll=0;Oe.textFeatureIndex?yn=Oe.textFeatureIndex:De.useRuntimeCollisionCircles&&(yn=De.featureIndex),Oe.verticalTextFeatureIndex&&(oo=Oe.verticalTextFeatureIndex);const ao=Oe.textBox;if(ao){const Ai=Er=>{let Rr=d.ah.horizontal;if(u.allowVerticalPlacement&&!Er&&this.prevPlacement){const vi=this.prevPlacement.placedOrientations[De.crossTileID];vi&&(this.placedOrientations[De.crossTileID]=vi,Rr=vi,this.markUsedOrientation(u,Rr,De))}return Rr},Di=(Er,Rr)=>{if(u.allowVerticalPlacement&&De.numVerticalGlyphVertices>0&&Oe.verticalTextBox){for(const vi of u.writingModes)if(vi===d.ah.vertical?(Wt=Rr(),ni=Wt):Wt=Er(),Wt&&Wt.placeable)break}else Wt=Er()},Kn=De.textAnchorOffsetStartIndex,Ki=De.textAnchorOffsetEndIndex;if(Ki===Kn){const Er=(Rr,vi)=>{const bt=this.collisionIndex.placeCollisionBox(Rr,U,F,T,P,Se,xe,v,K.predicate,We);return bt&&bt.placeable&&(this.markUsedOrientation(u,vi,De),this.placedOrientations[De.crossTileID]=vi),bt};Di(()=>Er(ao,d.ah.horizontal),()=>{const Rr=Oe.verticalTextBox;return u.allowVerticalPlacement&&De.numVerticalGlyphVertices>0&&Rr?Er(Rr,d.ah.vertical):{box:null,offscreen:null}}),Ai(Wt&&Wt.placeable)}else{let Er=d.aq[(pt=(Gt=this.prevPlacement)===null||Gt===void 0?void 0:Gt.variableOffsets[De.crossTileID])===null||pt===void 0?void 0:pt.anchor];const Rr=(bt,bs,lo)=>{const uo=bt.x2-bt.x1,Mh=bt.y2-bt.y1,Up=De.textBoxScale,Ah=Re&&oe==="never"?bs:null;let Yn=null,Dh=U==="never"?1:2,cl="never";Er&&Dh++;for(let ua=0;ua<Dh;ua++){for(let hl=Kn;hl<Ki;hl++){const dl=u.textAnchorOffsets.get(hl);if(Er&&dl.textAnchor!==Er)continue;const co=this.attemptAnchorPlacement(dl,bt,uo,Mh,Up,xe,Se,F,T,P,K,cl,De,u,lo,v,w,Ah,We);if(co&&(Yn=co.placedGlyphBoxes,Yn&&Yn.placeable))return xt=!0,Xi=co.shift,Yn}Er?Er=null:cl=U}return l&&!Yn&&(Yn={box:this.collisionIndex.placeCollisionBox(ao,"always",F,T,P,Se,xe,v,K.predicate,We,new d.P(0,0)).box,offscreen:!1,placeable:!1}),Yn};Di(()=>Rr(ao,Oe.iconBox,d.ah.horizontal),()=>{const bt=Oe.verticalTextBox;return u.allowVerticalPlacement&&(!Wt||!Wt.placeable)&&De.numVerticalGlyphVertices>0&&bt?Rr(bt,Oe.verticalIconBox,d.ah.vertical):{box:null,occluded:!0,offscreen:null}}),Wt&&(xt=Wt.placeable,Dr=Wt.offscreen);const vi=Ai(Wt&&Wt.placeable);if(!xt&&this.prevPlacement){const bt=this.prevPlacement.variableOffsets[De.crossTileID];bt&&(this.variableOffsets[De.crossTileID]=bt,this.markUsedJustification(u,bt.anchor,De,vi))}}}if(qr=Wt,xt=qr&&qr.placeable,Dr=qr&&qr.offscreen,De.useRuntimeCollisionCircles){const Ai=u.text.placedSymbolArray.get(De.centerJustifiedTextSymbolIndex),Di=d.ai(u.textSizeData,G,Ai),Kn=p.get("text-padding");Lr=this.collisionIndex.placeCollisionCircles(U,Ai,u.lineVertexArray,u.glyphOffsetArray,Di,T,P,z,M,l,Se,K.predicate,De.collisionCircleDiameter,Kn,v,We),Lr.circles.length&&Lr.collisionDetected&&!l&&d.w("Collisions detected, but collision boxes are not shown"),xt=ne||Lr.circles.length>0&&!Lr.collisionDetected,Dr=Dr&&Lr.offscreen}if(Oe.iconFeatureIndex&&(ll=Oe.iconFeatureIndex),Oe.iconBox){const Ai=Di=>this.collisionIndex.placeCollisionBox(Di,oe,F,T,P,Se,xe,w,K.predicate,We,Re&&Xi?Xi:void 0);ni&&ni.placeable&&Oe.verticalIconBox?(Gr=Ai(Oe.verticalIconBox),Ht=Gr.placeable):(Gr=Ai(Oe.iconBox),Ht=Gr.placeable),Dr=Dr&&Gr.offscreen}const Mi=Y||De.numHorizontalGlyphVertices===0&&De.numVerticalGlyphVertices===0,ul=Q||De.numIconVertices===0;Mi||ul?ul?Mi||(Ht=Ht&&xt):xt=Ht&&xt:Ht=xt=Ht&&xt;const Zu=Ht&&Gr.placeable;if(xt&&qr.placeable&&this.collisionIndex.insertCollisionBox(qr.box,U,p.get("text-ignore-placement"),u.bucketInstanceId,ni&&ni.placeable&&oo?oo:yn,K.ID),Zu&&this.collisionIndex.insertCollisionBox(Gr.box,oe,p.get("icon-ignore-placement"),u.bucketInstanceId,ll,K.ID),Lr&&xt&&this.collisionIndex.insertCollisionCircles(Lr.circles,U,p.get("text-ignore-placement"),u.bucketInstanceId,yn,K.ID),l&&this.storeCollisionData(u.bucketInstanceId,ot,Oe,qr,Gr,Lr),De.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(u.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[De.crossTileID]=new mt(xt||Me,Ht||ze,Dr||u.justReloaded),s[De.crossTileID]=!0};if(Ve){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const De=u.getSortedSymbolIndexes(this.transform.angle);for(let Oe=De.length-1;Oe>=0;--Oe){const ot=De[Oe];lt(u.symbolInstances.get(ot),u.collisionArrays[ot],ot)}}else for(let De=e.symbolInstanceStart;De<e.symbolInstanceEnd;De++)lt(u.symbolInstances.get(De),u.collisionArrays[De],De);if(l&&u.bucketInstanceId in this.collisionCircleArrays){const De=this.collisionCircleArrays[u.bucketInstanceId];d.as(De.invProjMatrix,T),De.viewportMatrix=this.collisionIndex.getViewportMatrix()}u.justReloaded=!1}storeCollisionData(e,s,l,u,p,v){if(l.textBox||l.iconBox){let w,T;this.collisionBoxArrays.has(e)?w=this.collisionBoxArrays.get(e):(w=new Map,this.collisionBoxArrays.set(e,w)),w.has(s)?T=w.get(s):(T={text:null,icon:null},w.set(s,T)),l.textBox&&(T.text=u.box),l.iconBox&&(T.icon=p.box)}if(v){let w=this.collisionCircleArrays[e];w===void 0&&(w=this.collisionCircleArrays[e]=new Ft);for(let T=0;T<v.circles.length;T+=4)w.circles.push(v.circles[T+0]),w.circles.push(v.circles[T+1]),w.circles.push(v.circles[T+2]),w.circles.push(v.collisionDetected?1:0)}}markUsedJustification(e,s,l,u){let p;p=u===d.ah.vertical?l.verticalPlacedTextSymbolIndex:{left:l.leftJustifiedTextSymbolIndex,center:l.centerJustifiedTextSymbolIndex,right:l.rightJustifiedTextSymbolIndex}[d.at(s)];const v=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex,l.verticalPlacedTextSymbolIndex];for(const w of v)w>=0&&(e.text.placedSymbolArray.get(w).crossTileID=p>=0&&w!==p?0:l.crossTileID)}markUsedOrientation(e,s,l){const u=s===d.ah.horizontal||s===d.ah.horizontalOnly?s:0,p=s===d.ah.vertical?s:0,v=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex];for(const w of v)e.text.placedSymbolArray.get(w).placedOrientation=u;l.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(l.verticalPlacedTextSymbolIndex).placedOrientation=p)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const s=this.prevPlacement;let l=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;const u=s?s.symbolFadeChange(e):1,p=s?s.opacities:{},v=s?s.variableOffsets:{},w=s?s.placedOrientations:{};for(const T in this.placements){const P=this.placements[T],z=p[T];z?(this.opacities[T]=new Qt(z,u,P.text,P.icon),l=l||P.text!==z.text.placed||P.icon!==z.icon.placed):(this.opacities[T]=new Qt(null,u,P.text,P.icon,P.skipFade),l=l||P.text||P.icon)}for(const T in p){const P=p[T];if(!this.opacities[T]){const z=new Qt(P,u,!1,!1);z.isHidden()||(this.opacities[T]=z,l=l||P.text.placed||P.icon.placed)}}for(const T in v)this.variableOffsets[T]||!this.opacities[T]||this.opacities[T].isHidden()||(this.variableOffsets[T]=v[T]);for(const T in w)this.placedOrientations[T]||!this.opacities[T]||this.opacities[T].isHidden()||(this.placedOrientations[T]=w[T]);if(s&&s.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");l?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:e)}updateLayerOpacities(e,s){const l={};for(const u of s){const p=u.getBucket(e);p&&u.latestFeatureIndex&&e.id===p.layerIds[0]&&this.updateBucketOpacities(p,u.tileID,l,u.collisionBoxArray)}}updateBucketOpacities(e,s,l,u){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const p=e.layers[0],v=p.layout,w=new Qt(null,0,!1,!1,!0),T=v.get("text-allow-overlap"),P=v.get("icon-allow-overlap"),z=p._unevaluatedLayout.hasValue("text-variable-anchor")||p._unevaluatedLayout.hasValue("text-variable-anchor-offset"),M=v.get("text-rotation-alignment")==="map",F=v.get("text-pitch-alignment")==="map",V=v.get("icon-text-fit")!=="none",j=new Qt(null,0,T&&(P||!e.hasIconData()||v.get("icon-optional")),P&&(T||!e.hasTextData()||v.get("text-optional")),!0);!e.collisionArrays&&u&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(u);const G=(Y,Q,U)=>{for(let ne=0;ne<Q/4;ne++)Y.opacityVertexArray.emplaceBack(U);Y.hasVisibleVertices=Y.hasVisibleVertices||U!==Vs},K=this.collisionBoxArrays.get(e.bucketInstanceId);for(let Y=0;Y<e.symbolInstances.length;Y++){const Q=e.symbolInstances.get(Y),{numHorizontalGlyphVertices:U,numVerticalGlyphVertices:ne,crossTileID:oe}=Q;let pe=this.opacities[oe];l[oe]?pe=w:pe||(pe=j,this.opacities[oe]=pe),l[oe]=!0;const xe=Q.numIconVertices>0,Se=this.placedOrientations[Q.crossTileID],Re=Se===d.ah.vertical,Ve=Se===d.ah.horizontal||Se===d.ah.horizontalOnly;if(U>0||ne>0){const ze=gi(pe.text);G(e.text,U,Re?Vs:ze),G(e.text,ne,Ve?Vs:ze);const We=pe.text.isHidden();[Q.rightJustifiedTextSymbolIndex,Q.centerJustifiedTextSymbolIndex,Q.leftJustifiedTextSymbolIndex].forEach(Oe=>{Oe>=0&&(e.text.placedSymbolArray.get(Oe).hidden=We||Re?1:0)}),Q.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(Q.verticalPlacedTextSymbolIndex).hidden=We||Ve?1:0);const lt=this.variableOffsets[Q.crossTileID];lt&&this.markUsedJustification(e,lt.anchor,Q,Se);const De=this.placedOrientations[Q.crossTileID];De&&(this.markUsedJustification(e,"left",Q,De),this.markUsedOrientation(e,De,Q))}if(xe){const ze=gi(pe.icon),We=!(V&&Q.verticalPlacedIconSymbolIndex&&Re);Q.placedIconSymbolIndex>=0&&(G(e.icon,Q.numIconVertices,We?ze:Vs),e.icon.placedSymbolArray.get(Q.placedIconSymbolIndex).hidden=pe.icon.isHidden()),Q.verticalPlacedIconSymbolIndex>=0&&(G(e.icon,Q.numVerticalIconVertices,We?Vs:ze),e.icon.placedSymbolArray.get(Q.verticalPlacedIconSymbolIndex).hidden=pe.icon.isHidden())}const Me=K&&K.has(Y)?K.get(Y):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const ze=e.collisionArrays[Y];if(ze){let We=new d.P(0,0);if(ze.textBox||ze.verticalTextBox){let lt=!0;if(z){const De=this.variableOffsets[oe];De?(We=Ir(De.anchor,De.width,De.height,De.textOffset,De.textBoxScale),M&&We._rotate(F?this.transform.angle:-this.transform.angle)):lt=!1}if(ze.textBox||ze.verticalTextBox){let De;ze.textBox&&(De=Re),ze.verticalTextBox&&(De=Ve),Ns(e.textCollisionBox.collisionVertexArray,pe.text.placed,!lt||De,Me.text,We.x,We.y)}}if(ze.iconBox||ze.verticalIconBox){const lt=!!(!Ve&&ze.verticalIconBox);let De;ze.iconBox&&(De=lt),ze.verticalIconBox&&(De=!lt),Ns(e.iconCollisionBox.collisionVertexArray,pe.icon.placed,De,Me.icon,V?We.x:0,V?We.y:0)}}}}if(e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);if(e.bucketInstanceId in this.collisionCircleArrays){const Y=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=Y.invProjMatrix,e.placementViewportMatrix=Y.viewportMatrix,e.collisionCircleArray=Y.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,s){const l=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*l>e}setStale(){this.stale=!0}}function Ns(f,e,s,l,u,p){l&&l.length!==0||(l=[0,0,0,0]);const v=l[0]-dt,w=l[1]-dt,T=l[2]-dt,P=l[3]-dt;f.emplaceBack(e?1:0,s?1:0,u||0,p||0,v,w),f.emplaceBack(e?1:0,s?1:0,u||0,p||0,T,w),f.emplaceBack(e?1:0,s?1:0,u||0,p||0,T,P),f.emplaceBack(e?1:0,s?1:0,u||0,p||0,v,P)}const Bt=Math.pow(2,25),tu=Math.pow(2,24),ru=Math.pow(2,17),fi=Math.pow(2,16),mi=Math.pow(2,9),gp=Math.pow(2,8),Ei=Math.pow(2,1);function gi(f){if(f.opacity===0&&!f.placed)return 0;if(f.opacity===1&&f.placed)return 4294967295;const e=f.placed?1:0,s=Math.floor(127*f.opacity);return s*Bt+e*tu+s*ru+e*fi+s*mi+e*gp+s*Ei+e}const Vs=0;function cs(){return{isOccluded:(f,e,s)=>!1,getPitchedTextCorrection:(f,e,s)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(f,e,s,l){throw new Error("Not implemented.")},translatePosition:(f,e,s,l)=>function(u,p,v,w,T=!1){if(!v[0]&&!v[1])return[0,0];const P=T?w==="map"?u.angle:0:w==="viewport"?-u.angle:0;if(P){const z=Math.sin(P),M=Math.cos(P);v=[v[0]*M-v[1]*z,v[0]*z+v[1]*M]}return[T?v[0]:vt(p,v[0],u.zoom),T?v[1]:vt(p,v[1],u.zoom)]}(f,e,s,l),getCircleRadiusCorrection:f=>1}}class fr{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,s,l,u,p){const v=this._bucketParts;for(;this._currentTileIndex<e.length;)if(s.getBucketParts(v,u,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,p())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,v.sort((w,T)=>w.sortKey-T.sortKey));this._currentPartIndex<v.length;)if(s.placeLayerBucketPart(v[this._currentPartIndex],this._seenCrossTileIDs,l),this._currentPartIndex++,p())return!0;return!1}}class Zo{constructor(e,s,l,u,p,v,w,T){this.placement=new Zr(e,cs(),s,v,w,T),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=u,this._showCollisionBoxes=p,this._done=!1}isDone(){return this._done}continuePlacement(e,s,l){const u=re.now(),p=()=>!this._forceFullPlacement&&re.now()-u>2;for(;this._currentPlacementIndex>=0;){const v=s[e[this._currentPlacementIndex]],w=this.placement.collisionIndex.transform.zoom;if(v.type==="symbol"&&(!v.minzoom||v.minzoom<=w)&&(!v.maxzoom||v.maxzoom>w)){if(this._inProgressLayer||(this._inProgressLayer=new fr(v)),this._inProgressLayer.continuePlacement(l[v.source],this.placement,this._showCollisionBoxes,v,p))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const Zi=512/d.X/2;class lr{constructor(e,s,l){this.tileID=e,this.bucketInstanceId=l,this._symbolsByKey={};const u=new Map;for(let p=0;p<s.length;p++){const v=s.get(p),w=v.key,T=u.get(w);T?T.push(v):u.set(w,[v])}for(const[p,v]of u){const w={positions:v.map(T=>({x:Math.floor(T.anchorX*Zi),y:Math.floor(T.anchorY*Zi)})),crossTileIDs:v.map(T=>T.crossTileID)};if(w.positions.length>128){const T=new d.av(w.positions.length,16,Uint16Array);for(const{x:P,y:z}of w.positions)T.add(P,z);T.finish(),delete w.positions,w.index=T}this._symbolsByKey[p]=w}}getScaledCoordinates(e,s){const{x:l,y:u,z:p}=this.tileID.canonical,{x:v,y:w,z:T}=s.canonical,P=Zi/Math.pow(2,T-p),z=(w*d.X+e.anchorY)*P,M=u*d.X*Zi;return{x:Math.floor((v*d.X+e.anchorX)*P-l*d.X*Zi),y:Math.floor(z-M)}}findMatches(e,s,l){const u=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z);for(let p=0;p<e.length;p++){const v=e.get(p);if(v.crossTileID)continue;const w=this._symbolsByKey[v.key];if(!w)continue;const T=this.getScaledCoordinates(v,s);if(w.index){const P=w.index.range(T.x-u,T.y-u,T.x+u,T.y+u).sort();for(const z of P){const M=w.crossTileIDs[z];if(!l[M]){l[M]=!0,v.crossTileID=M;break}}}else if(w.positions)for(let P=0;P<w.positions.length;P++){const z=w.positions[P],M=w.crossTileIDs[P];if(Math.abs(z.x-T.x)<=u&&Math.abs(z.y-T.y)<=u&&!l[M]){l[M]=!0,v.crossTileID=M;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:e})=>e)}}class Ma{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class qi{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const s=Math.round((e-this.lng)/360);if(s!==0)for(const l in this.indexes){const u=this.indexes[l],p={};for(const v in u){const w=u[v];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+s),p[w.tileID.key]=w}this.indexes[l]=p}this.lng=e}addBucket(e,s,l){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let p=0;p<s.symbolInstances.length;p++)s.symbolInstances.get(p).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const u=this.usedCrossTileIDs[e.overscaledZ];for(const p in this.indexes){const v=this.indexes[p];if(Number(p)>e.overscaledZ)for(const w in v){const T=v[w];T.tileID.isChildOf(e)&&T.findMatches(s.symbolInstances,e,u)}else{const w=v[e.scaledTo(Number(p)).key];w&&w.findMatches(s.symbolInstances,e,u)}}for(let p=0;p<s.symbolInstances.length;p++){const v=s.symbolInstances.get(p);v.crossTileID||(v.crossTileID=l.generate(),u[v.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new lr(e,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(e,s){for(const l of s.getCrossTileIDsLists())for(const u of l)delete this.usedCrossTileIDs[e][u]}removeStaleBuckets(e){let s=!1;for(const l in this.indexes){const u=this.indexes[l];for(const p in u)e[u[p].bucketInstanceId]||(this.removeBucketCrossTileIDs(l,u[p]),delete u[p],s=!0)}return s}}class iu{constructor(){this.layerIndexes={},this.crossTileIDs=new Ma,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,s,l){let u=this.layerIndexes[e.id];u===void 0&&(u=this.layerIndexes[e.id]=new qi);let p=!1;const v={};u.handleWrapJump(l);for(const w of s){const T=w.getBucket(e);T&&e.id===T.layerIds[0]&&(T.bucketInstanceId||(T.bucketInstanceId=++this.maxBucketInstanceId),u.addBucket(w.tileID,T,this.crossTileIDs)&&(p=!0),v[T.bucketInstanceId]=!0)}return u.removeStaleBuckets(v)&&(p=!0),p}pruneUnusedLayers(e){const s={};e.forEach(l=>{s[l]=!0});for(const l in this.layerIndexes)s[l]||delete this.layerIndexes[l]}}const Gi=(f,e)=>d.t(f,e&&e.filter(s=>s.identifier!=="source.canvas")),_p=d.aw();class Aa extends d.E{constructor(e,s={}){super(),this._rtlPluginLoaded=()=>{for(const l in this.sourceCaches){const u=this.sourceCaches[l].getSource().type;u!=="vector"&&u!=="geojson"||this.sourceCaches[l].reload()}},this.map=e,this.dispatcher=new ls(as(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",(l,u)=>this.getGlyphs(l,u)),this.dispatcher.registerMessageHandler("GI",(l,u)=>this.getImages(l,u)),this.imageManager=new ir,this.imageManager.setEventedParent(this),this.glyphManager=new Jr(e._requestManager,s.localIdeographFontFamily),this.lineAtlas=new ji(256,512),this.crossTileSymbolIndex=new iu,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new d.ax,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",d.ay()),dn().on(Ie,this._rtlPluginLoaded),this.on("data",l=>{if(l.dataType!=="source"||l.sourceDataType!=="metadata")return;const u=this.sourceCaches[l.sourceId];if(!u)return;const p=u.getSource();if(p&&p.vectorLayerIds)for(const v in this._layers){const w=this._layers[v];w.source===p.id&&this._validateLayer(w)}})}loadURL(e,s={},l){this.fire(new d.k("dataloading",{dataType:"style"})),s.validate=typeof s.validate!="boolean"||s.validate;const u=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const p=this._loadStyleRequest;d.h(u,this._loadStyleRequest).then(v=>{this._loadStyleRequest=null,this._load(v.data,s,l)}).catch(v=>{this._loadStyleRequest=null,v&&!p.signal.aborted&&this.fire(new d.j(v))})}loadJSON(e,s={},l){this.fire(new d.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,re.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,s.validate=s.validate!==!1,this._load(e,s,l)}).catch(()=>{})}loadEmpty(){this.fire(new d.k("dataloading",{dataType:"style"})),this._load(_p,{validate:!1})}_load(e,s,l){var u;const p=s.transformStyle?s.transformStyle(l,e):e;if(!s.validate||!Gi(this,d.u(p))){this._loaded=!0,this.stylesheet=p;for(const v in p.sources)this.addSource(v,p.sources[v],{validate:!1});p.sprite?this._loadSprite(p.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(p.glyphs),this._createLayers(),this.light=new ct(this.stylesheet.light),this.sky=new Rt(this.stylesheet.sky),this.map.setTerrain((u=this.stylesheet.terrain)!==null&&u!==void 0?u:null),this.fire(new d.k("data",{dataType:"style"})),this.fire(new d.k("style.load"))}}_createLayers(){const e=d.az(this.stylesheet.layers);this.dispatcher.broadcast("SL",e),this._order=e.map(s=>s.id),this._layers={},this._serializedLayers=null;for(const s of e){const l=d.aA(s);l.setEventedParent(this,{layer:{id:s.id}}),this._layers[s.id]=l}}_loadSprite(e,s=!1,l=void 0){let u;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(p,v,w,T){return d._(this,void 0,void 0,function*(){const P=At(p),z=w>1?"@2x":"",M={},F={};for(const{id:V,url:j}of P){const G=v.transformRequest(gt(j,z,".json"),"SpriteJSON");M[V]=d.h(G,T);const K=v.transformRequest(gt(j,z,".png"),"SpriteImage");F[V]=de.getImage(K,T)}return yield Promise.all([...Object.values(M),...Object.values(F)]),function(V,j){return d._(this,void 0,void 0,function*(){const G={};for(const K in V){G[K]={};const Y=re.getImageCanvasContext((yield j[K]).data),Q=(yield V[K]).data;for(const U in Q){const{width:ne,height:oe,x:pe,y:xe,sdf:Se,pixelRatio:Re,stretchX:Ve,stretchY:Me,content:ze,textFitWidth:We,textFitHeight:lt}=Q[U];G[K][U]={data:null,pixelRatio:Re,sdf:Se,stretchX:Ve,stretchY:Me,content:ze,textFitWidth:We,textFitHeight:lt,spriteData:{width:ne,height:oe,x:pe,y:xe,context:Y}}}}return G})}(M,F)})}(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(p=>{if(this._spriteRequest=null,p)for(const v in p){this._spritesImagesIds[v]=[];const w=this._spritesImagesIds[v]?this._spritesImagesIds[v].filter(T=>!(T in p)):[];for(const T of w)this.imageManager.removeImage(T),this._changedImages[T]=!0;for(const T in p[v]){const P=v==="default"?T:`${v}:${T}`;this._spritesImagesIds[v].push(P),P in this.imageManager.images?this.imageManager.updateImage(P,p[v][T],!1):this.imageManager.addImage(P,p[v][T]),s&&(this._changedImages[P]=!0)}}}).catch(p=>{this._spriteRequest=null,u=p,this.fire(new d.j(u))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),s&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.k("data",{dataType:"style"})),l&&l(u)})}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.k("data",{dataType:"style"}))}_validateLayer(e){const s=this.sourceCaches[e.source];if(!s)return;const l=e.sourceLayer;if(!l)return;const u=s.getSource();(u.type==="geojson"||u.vectorLayerIds&&u.vectorLayerIds.indexOf(l)===-1)&&this.fire(new d.j(new Error(`Source layer "${l}" does not exist on source "${u.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,s=!1){const l=this._serializedAllLayers();if(!e||e.length===0)return Object.values(s?d.aB(l):l);const u=[];for(const p of e)if(l[p]){const v=s?d.aB(l[p]):l[p];u.push(v)}return u}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const s=Object.keys(this._layers);for(const l of s){const u=this._layers[l];u.type!=="custom"&&(e[l]=u.serialize())}return e}hasTransitions(){if(this.light&&this.light.hasTransition()||this.sky&&this.sky.hasTransition())return!0;for(const e in this.sourceCaches)if(this.sourceCaches[e].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const s=this._changed;if(s){const u=Object.keys(this._updatedLayers),p=Object.keys(this._removedLayers);(u.length||p.length)&&this._updateWorkerLayers(u,p);for(const v in this._updatedSources){const w=this._updatedSources[v];if(w==="reload")this._reloadSource(v);else{if(w!=="clear")throw new Error(`Invalid action ${w}`);this._clearSource(v)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const v in this._updatedPaintProps)this._layers[v].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const l={};for(const u in this.sourceCaches){const p=this.sourceCaches[u];l[u]=p.used,p.used=!1}for(const u of this._order){const p=this._layers[u];p.recalculate(e,this._availableImages),!p.isHidden(e.zoom)&&p.source&&(this.sourceCaches[p.source].used=!0)}for(const u in l){const p=this.sourceCaches[u];!!l[u]!=!!p.used&&p.fire(new d.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:u}))}this.light.recalculate(e),this.sky.recalculate(e),this.z=e.zoom,s&&this.fire(new d.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const s in this.sourceCaches)this.sourceCaches[s].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,s){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:s})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,s={}){var l;this._checkLoaded();const u=this.serialize();if(e=s.transformStyle?s.transformStyle(u,e):e,((l=s.validate)===null||l===void 0||l)&&Gi(this,d.u(e)))return!1;(e=d.aB(e)).layers=d.az(e.layers);const p=d.aC(u,e),v=this._getOperationsToPerform(p);if(v.unimplemented.length>0)throw new Error(`Unimplemented: ${v.unimplemented.join(", ")}.`);if(v.operations.length===0)return!1;for(const w of v.operations)w();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const s=[],l=[];for(const u of e)switch(u.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":s.push(()=>this.addLayer.apply(this,u.args));break;case"removeLayer":s.push(()=>this.removeLayer.apply(this,u.args));break;case"setPaintProperty":s.push(()=>this.setPaintProperty.apply(this,u.args));break;case"setLayoutProperty":s.push(()=>this.setLayoutProperty.apply(this,u.args));break;case"setFilter":s.push(()=>this.setFilter.apply(this,u.args));break;case"addSource":s.push(()=>this.addSource.apply(this,u.args));break;case"removeSource":s.push(()=>this.removeSource.apply(this,u.args));break;case"setLayerZoomRange":s.push(()=>this.setLayerZoomRange.apply(this,u.args));break;case"setLight":s.push(()=>this.setLight.apply(this,u.args));break;case"setGeoJSONSourceData":s.push(()=>this.setGeoJSONSourceData.apply(this,u.args));break;case"setGlyphs":s.push(()=>this.setGlyphs.apply(this,u.args));break;case"setSprite":s.push(()=>this.setSprite.apply(this,u.args));break;case"setSky":s.push(()=>this.setSky.apply(this,u.args));break;case"setTerrain":s.push(()=>this.map.setTerrain.apply(this,u.args));break;case"setTransition":s.push(()=>{});break;default:l.push(u.command)}return{operations:s,unimplemented:l}}addImage(e,s){if(this.getImage(e))return this.fire(new d.j(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,s),this._afterImageUpdated(e)}updateImage(e,s){this.imageManager.updateImage(e,s)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new d.j(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,s,l={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(d.u.source,`sources.${e}`,s,null,l))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);const u=this.sourceCaches[e]=new st(e,s,this.dispatcher);u.style=this,u.setEventedParent(this,()=>({isSourceLoaded:u.loaded(),source:u.serialize(),sourceId:e})),u.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(const l in this._layers)if(this._layers[l].source===e)return this.fire(new d.j(new Error(`Source "${e}" cannot be removed while layer "${l}" is using it.`)));const s=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],s.fire(new d.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),s.setEventedParent(null),s.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,s){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const l=this.sourceCaches[e].getSource();if(l.type!=="geojson")throw new Error(`geojsonSource.type is ${l.type}, which is !== 'geojson`);l.setData(s),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,s,l={}){this._checkLoaded();const u=e.id;if(this.getLayer(u))return void this.fire(new d.j(new Error(`Layer "${u}" already exists on this map.`)));let p;if(e.type==="custom"){if(Gi(this,d.aD(e)))return;p=d.aA(e)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(u,e.source),e=d.aB(e),e=d.e(e,{source:u})),this._validate(d.u.layer,`layers.${u}`,e,{arrayIndex:-1},l))return;p=d.aA(e),this._validateLayer(p),p.setEventedParent(this,{layer:{id:u}})}const v=s?this._order.indexOf(s):this._order.length;if(s&&v===-1)this.fire(new d.j(new Error(`Cannot add layer "${u}" before non-existing layer "${s}".`)));else{if(this._order.splice(v,0,u),this._layerOrderChanged=!0,this._layers[u]=p,this._removedLayers[u]&&p.source&&p.type!=="custom"){const w=this._removedLayers[u];delete this._removedLayers[u],w.type!==p.type?this._updatedSources[p.source]="clear":(this._updatedSources[p.source]="reload",this.sourceCaches[p.source].pause())}this._updateLayer(p),p.onAdd&&p.onAdd(this.map)}}moveLayer(e,s){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new d.j(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===s)return;const l=this._order.indexOf(e);this._order.splice(l,1);const u=s?this._order.indexOf(s):this._order.length;s&&u===-1?this.fire(new d.j(new Error(`Cannot move layer "${e}" before non-existing layer "${s}".`))):(this._order.splice(u,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const s=this._layers[e];if(!s)return void this.fire(new d.j(new Error(`Cannot remove non-existing layer "${e}".`)));s.setEventedParent(null);const l=this._order.indexOf(e);this._order.splice(l,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=s,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],s.onRemove&&s.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,s,l){this._checkLoaded();const u=this.getLayer(e);u?u.minzoom===s&&u.maxzoom===l||(s!=null&&(u.minzoom=s),l!=null&&(u.maxzoom=l),this._updateLayer(u)):this.fire(new d.j(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,s,l={}){this._checkLoaded();const u=this.getLayer(e);if(u){if(!d.aE(u.filter,s))return s==null?(u.filter=void 0,void this._updateLayer(u)):void(this._validate(d.u.filter,`layers.${u.id}.filter`,s,null,l)||(u.filter=d.aB(s),this._updateLayer(u)))}else this.fire(new d.j(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return d.aB(this.getLayer(e).filter)}setLayoutProperty(e,s,l,u={}){this._checkLoaded();const p=this.getLayer(e);p?d.aE(p.getLayoutProperty(s),l)||(p.setLayoutProperty(s,l,u),this._updateLayer(p)):this.fire(new d.j(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,s){const l=this.getLayer(e);if(l)return l.getLayoutProperty(s);this.fire(new d.j(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,s,l,u={}){this._checkLoaded();const p=this.getLayer(e);p?d.aE(p.getPaintProperty(s),l)||(p.setPaintProperty(s,l,u)&&this._updateLayer(p),this._changed=!0,this._updatedPaintProps[e]=!0,this._serializedLayers=null):this.fire(new d.j(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,s){return this.getLayer(e).getPaintProperty(s)}setFeatureState(e,s){this._checkLoaded();const l=e.source,u=e.sourceLayer,p=this.sourceCaches[l];if(p===void 0)return void this.fire(new d.j(new Error(`The source '${l}' does not exist in the map's style.`)));const v=p.getSource().type;v==="geojson"&&u?this.fire(new d.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):v!=="vector"||u?(e.id===void 0&&this.fire(new d.j(new Error("The feature id parameter must be provided."))),p.setFeatureState(u,e.id,s)):this.fire(new d.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,s){this._checkLoaded();const l=e.source,u=this.sourceCaches[l];if(u===void 0)return void this.fire(new d.j(new Error(`The source '${l}' does not exist in the map's style.`)));const p=u.getSource().type,v=p==="vector"?e.sourceLayer:void 0;p!=="vector"||v?s&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new d.j(new Error("A feature id is required to remove its specific state property."))):u.removeFeatureState(v,e.id,s):this.fire(new d.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const s=e.source,l=e.sourceLayer,u=this.sourceCaches[s];if(u!==void 0)return u.getSource().type!=="vector"||l?(e.id===void 0&&this.fire(new d.j(new Error("The feature id parameter must be provided."))),u.getFeatureState(l,e.id)):void this.fire(new d.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new d.j(new Error(`The source '${s}' does not exist in the map's style.`)))}getTransition(){return d.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=d.aF(this.sourceCaches,p=>p.serialize()),s=this._serializeByIds(this._order,!0),l=this.map.getTerrain()||void 0,u=this.stylesheet;return d.aG({version:u.version,name:u.name,metadata:u.metadata,light:u.light,sky:u.sky,center:u.center,zoom:u.zoom,bearing:u.bearing,pitch:u.pitch,sprite:u.sprite,glyphs:u.glyphs,transition:u.transition,sources:e,layers:s,terrain:l},p=>p!==void 0)}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const s=v=>this._layers[v].type==="fill-extrusion",l={},u=[];for(let v=this._order.length-1;v>=0;v--){const w=this._order[v];if(s(w)){l[w]=v;for(const T of e){const P=T[w];if(P)for(const z of P)u.push(z)}}}u.sort((v,w)=>w.intersectionZ-v.intersectionZ);const p=[];for(let v=this._order.length-1;v>=0;v--){const w=this._order[v];if(s(w))for(let T=u.length-1;T>=0;T--){const P=u[T].feature;if(l[P.layer.id]<v)break;p.push(P),u.pop()}else for(const T of e){const P=T[w];if(P)for(const z of P)p.push(z.feature)}}return p}queryRenderedFeatures(e,s,l){s&&s.filter&&this._validate(d.u.filter,"queryRenderedFeatures.filter",s.filter,null,s);const u={};if(s&&s.layers){if(!Array.isArray(s.layers))return this.fire(new d.j(new Error("parameters.layers must be an Array."))),[];for(const w of s.layers){const T=this._layers[w];if(!T)return this.fire(new d.j(new Error(`The layer '${w}' does not exist in the map's style and cannot be queried for features.`))),[];u[T.source]=!0}}const p=[];s.availableImages=this._availableImages;const v=this._serializedAllLayers();for(const w in this.sourceCaches)s.layers&&!u[w]||p.push($n(this.sourceCaches[w],this._layers,v,e,s,l));return this.placement&&p.push(function(w,T,P,z,M,F,V){const j={},G=F.queryRenderedSymbols(z),K=[];for(const Y of Object.keys(G).map(Number))K.push(V[Y]);K.sort(Zn);for(const Y of K){const Q=Y.featureIndex.lookupSymbolFeatures(G[Y.bucketInstanceId],T,Y.bucketIndex,Y.sourceLayerIndex,M.filter,M.layers,M.availableImages,w);for(const U in Q){const ne=j[U]=j[U]||[],oe=Q[U];oe.sort((pe,xe)=>{const Se=Y.featureSortOrder;if(Se){const Re=Se.indexOf(pe.featureIndex);return Se.indexOf(xe.featureIndex)-Re}return xe.featureIndex-pe.featureIndex});for(const pe of oe)ne.push(pe)}}for(const Y in j)j[Y].forEach(Q=>{const U=Q.feature,ne=P[w[Y].source].getFeatureState(U.layer["source-layer"],U.id);U.source=U.layer.source,U.layer["source-layer"]&&(U.sourceLayer=U.layer["source-layer"]),U.state=ne});return j}(this._layers,v,this.sourceCaches,e,s,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(p)}querySourceFeatures(e,s){s&&s.filter&&this._validate(d.u.filter,"querySourceFeatures.filter",s.filter,null,s);const l=this.sourceCaches[e];return l?function(u,p){const v=u.getRenderableIds().map(P=>u.getTileByID(P)),w=[],T={};for(let P=0;P<v.length;P++){const z=v[P],M=z.tileID.canonical.key;T[M]||(T[M]=!0,z.querySourceFeatures(w,p))}return w}(l,s):[]}getLight(){return this.light.getLight()}setLight(e,s={}){this._checkLoaded();const l=this.light.getLight();let u=!1;for(const v in e)if(!d.aE(e[v],l[v])){u=!0;break}if(!u)return;const p={now:re.now(),transition:d.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,s),this.light.updateTransitions(p)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,s={}){const l=this.getSky();let u=!1;if(!e&&!l)return;if(e&&!l)u=!0;else if(!e&&l)u=!0;else for(const v in e)if(!d.aE(e[v],l[v])){u=!0;break}if(!u)return;const p={now:re.now(),transition:d.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,s),this.sky.updateTransitions(p)}_validate(e,s,l,u,p={}){return(!p||p.validate!==!1)&&Gi(this,e.call(d.u,d.e({key:s,style:this.serialize(),value:l,styleSpec:d.v},u)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),dn().off(Ie,this._rtlPluginLoaded);for(const s in this._layers)this._layers[s].setEventedParent(null);for(const s in this.sourceCaches){const l=this.sourceCaches[s];l.setEventedParent(null),l.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const s in this.sourceCaches)this.sourceCaches[s].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,s,l,u,p=!1){let v=!1,w=!1;const T={};for(const P of this._order){const z=this._layers[P];if(z.type!=="symbol")continue;if(!T[z.source]){const F=this.sourceCaches[z.source];T[z.source]=F.getRenderableIds(!0).map(V=>F.getTileByID(V)).sort((V,j)=>j.tileID.overscaledZ-V.tileID.overscaledZ||(V.tileID.isLessThan(j.tileID)?-1:1))}const M=this.crossTileSymbolIndex.addLayer(z,T[z.source],e.center.lng);v=v||M}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((p=p||this._layerOrderChanged||l===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(re.now(),e.zoom))&&(this.pauseablePlacement=new Zo(e,this.map.terrain,this._order,p,s,l,u,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,T),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(re.now()),w=!0),v&&this.pauseablePlacement.placement.setStale()),w||v)for(const P of this._order){const z=this._layers[P];z.type==="symbol"&&this.placement.updateLayerOpacities(z,T[z.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(re.now())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,s){return d._(this,void 0,void 0,function*(){const l=yield this.imageManager.getImages(s.icons);this._updateTilesForChangedImages();const u=this.sourceCaches[s.source];return u&&u.setDependencies(s.tileID.key,s.type,s.icons),l})}getGlyphs(e,s){return d._(this,void 0,void 0,function*(){const l=yield this.glyphManager.getGlyphs(s.stacks),u=this.sourceCaches[s.source];return u&&u.setDependencies(s.tileID.key,s.type,[""]),l})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,s={}){this._checkLoaded(),e&&this._validate(d.u.glyphs,"glyphs",e,null,s)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,s,l={},u){this._checkLoaded();const p=[{id:e,url:s}],v=[...At(this.stylesheet.sprite),...p];this._validate(d.u.sprite,"sprite",v,null,l)||(this.stylesheet.sprite=v,this._loadSprite(p,!0,u))}removeSprite(e){this._checkLoaded();const s=At(this.stylesheet.sprite);if(s.find(l=>l.id===e)){if(this._spritesImagesIds[e])for(const l of this._spritesImagesIds[e])this.imageManager.removeImage(l),this._changedImages[l]=!0;s.splice(s.findIndex(l=>l.id===e),1),this.stylesheet.sprite=s.length>0?s:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.k("data",{dataType:"style"}))}else this.fire(new d.j(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return At(this.stylesheet.sprite)}setSprite(e,s={},l){this._checkLoaded(),e&&this._validate(d.u.sprite,"sprite",e,null,s)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,l):(this._unloadSprite(),l&&l(null)))}}var hs=d.Y([{name:"a_pos",type:"Int16",components:2}]);const Wn={prelude:Mt(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Mt(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Mt(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Mt(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Mt("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Mt(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,get_elevation(floor(a_pos*0.5)),1);gl_Position=u_matrix*pos;}`),heatmapTexture:Mt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Mt("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Mt("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Mt("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Mt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Mt(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Mt(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Mt(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Mt(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Mt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Mt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Mt(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Mt(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Mt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Mt(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Mt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Mt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Mt(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Mt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Mt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Mt("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;varying vec2 v_texture_pos;varying float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture2D(u_texture,v_texture_pos);if (v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);gl_FragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {gl_FragColor=surface_color;}}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform mat4 u_fog_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:Mt("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:Mt("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);}"),sky:Mt("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform float u_horizon;uniform float u_sky_horizon_blend;void main() {float y=gl_FragCoord.y;if (y > u_horizon) {float blend=y-u_horizon;if (blend < u_sky_horizon_blend) {gl_FragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {gl_FragColor=u_sky_color;}}}","attribute vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function Mt(f,e){const s=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,l=e.match(/attribute ([\w]+) ([\w]+)/g),u=f.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),p=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),v=p?p.concat(u):u,w={};return{fragmentSource:f=f.replace(s,(T,P,z,M,F)=>(w[F]=!0,P==="define"?`
#ifndef HAS_UNIFORM_u_${F}
varying ${z} ${M} ${F};
#else
uniform ${z} ${M} u_${F};
#endif
`:`
#ifdef HAS_UNIFORM_u_${F}
    ${z} ${M} ${F} = u_${F};
#endif
`)),vertexSource:e=e.replace(s,(T,P,z,M,F)=>{const V=M==="float"?"vec2":"vec4",j=F.match(/color/)?"color":V;return w[F]?P==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
attribute ${z} ${V} a_${F};
varying ${z} ${M} ${F};
#else
uniform ${z} ${M} u_${F};
#endif
`:j==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = a_${F};
#else
    ${z} ${M} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = unpack_mix_${j}(a_${F}, u_${F}_t);
#else
    ${z} ${M} ${F} = u_${F};
#endif
`:P==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
attribute ${z} ${V} a_${F};
#else
uniform ${z} ${M} u_${F};
#endif
`:j==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${z} ${M} ${F} = a_${F};
#else
    ${z} ${M} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    ${z} ${M} ${F} = unpack_mix_${j}(a_${F}, u_${F}_t);
#else
    ${z} ${M} ${F} = u_${F};
#endif
`}),staticAttributes:l,staticUniforms:v}}class nu{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,s,l,u,p,v,w,T,P){this.context=e;let z=this.boundPaintVertexBuffers.length!==u.length;for(let M=0;!z&&M<u.length;M++)this.boundPaintVertexBuffers[M]!==u[M]&&(z=!0);!this.vao||this.boundProgram!==s||this.boundLayoutVertexBuffer!==l||z||this.boundIndexBuffer!==p||this.boundVertexOffset!==v||this.boundDynamicVertexBuffer!==w||this.boundDynamicVertexBuffer2!==T||this.boundDynamicVertexBuffer3!==P?this.freshBind(s,l,u,p,v,w,T,P):(e.bindVertexArray.set(this.vao),w&&w.bind(),p&&p.dynamicDraw&&p.bind(),T&&T.bind(),P&&P.bind())}freshBind(e,s,l,u,p,v,w,T){const P=e.numAttributes,z=this.context,M=z.gl;this.vao&&this.destroy(),this.vao=z.createVertexArray(),z.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=l,this.boundIndexBuffer=u,this.boundVertexOffset=p,this.boundDynamicVertexBuffer=v,this.boundDynamicVertexBuffer2=w,this.boundDynamicVertexBuffer3=T,s.enableAttributes(M,e);for(const F of l)F.enableAttributes(M,e);v&&v.enableAttributes(M,e),w&&w.enableAttributes(M,e),T&&T.enableAttributes(M,e),s.bind(),s.setVertexAttribPointers(M,e,p);for(const F of l)F.bind(),F.setVertexAttribPointers(M,e,p);v&&(v.bind(),v.setVertexAttribPointers(M,e,p)),u&&u.bind(),w&&(w.bind(),w.setVertexAttribPointers(M,e,p)),T&&(T.bind(),T.setVertexAttribPointers(M,e,p)),z.currentNumAttributes=P}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const su=(f,e,s,l,u)=>({u_matrix:f,u_texture:0,u_ele_delta:e,u_fog_matrix:s,u_fog_color:l?l.properties.get("fog-color"):d.aM.white,u_fog_ground_blend:l?l.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:l?l.calculateFogBlendOpacity(u):0,u_horizon_color:l?l.properties.get("horizon-color"):d.aM.white,u_horizon_fog_blend:l?l.properties.get("horizon-fog-blend"):1});function js(f){const e=[];for(let s=0;s<f.length;s++){if(f[s]===null)continue;const l=f[s].split(" ");e.push(l.pop())}return e}class ou{constructor(e,s,l,u,p,v){const w=e.gl;this.program=w.createProgram();const T=js(s.staticAttributes),P=l?l.getBinderAttributes():[],z=T.concat(P),M=Wn.prelude.staticUniforms?js(Wn.prelude.staticUniforms):[],F=s.staticUniforms?js(s.staticUniforms):[],V=l?l.getBinderUniforms():[],j=M.concat(F).concat(V),G=[];for(const pe of j)G.indexOf(pe)<0&&G.push(pe);const K=l?l.defines():[];p&&K.push("#define OVERDRAW_INSPECTOR;"),v&&K.push("#define TERRAIN3D;");const Y=K.concat(Wn.prelude.fragmentSource,s.fragmentSource).join(`
`),Q=K.concat(Wn.prelude.vertexSource,s.vertexSource).join(`
`),U=w.createShader(w.FRAGMENT_SHADER);if(w.isContextLost())return void(this.failedToCreate=!0);if(w.shaderSource(U,Y),w.compileShader(U),!w.getShaderParameter(U,w.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${w.getShaderInfoLog(U)}`);w.attachShader(this.program,U);const ne=w.createShader(w.VERTEX_SHADER);if(w.isContextLost())return void(this.failedToCreate=!0);if(w.shaderSource(ne,Q),w.compileShader(ne),!w.getShaderParameter(ne,w.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${w.getShaderInfoLog(ne)}`);w.attachShader(this.program,ne),this.attributes={};const oe={};this.numAttributes=z.length;for(let pe=0;pe<this.numAttributes;pe++)z[pe]&&(w.bindAttribLocation(this.program,pe,z[pe]),this.attributes[z[pe]]=pe);if(w.linkProgram(this.program),!w.getProgramParameter(this.program,w.LINK_STATUS))throw new Error(`Program failed to link: ${w.getProgramInfoLog(this.program)}`);w.deleteShader(ne),w.deleteShader(U);for(let pe=0;pe<G.length;pe++){const xe=G[pe];if(xe&&!oe[xe]){const Se=w.getUniformLocation(this.program,xe);Se&&(oe[xe]=Se)}}this.fixedUniforms=u(e,oe),this.terrainUniforms=((pe,xe)=>({u_depth:new d.aH(pe,xe.u_depth),u_terrain:new d.aH(pe,xe.u_terrain),u_terrain_dim:new d.aI(pe,xe.u_terrain_dim),u_terrain_matrix:new d.aJ(pe,xe.u_terrain_matrix),u_terrain_unpack:new d.aK(pe,xe.u_terrain_unpack),u_terrain_exaggeration:new d.aI(pe,xe.u_terrain_exaggeration)}))(e,oe),this.binderUniforms=l?l.getUniforms(e,oe):[]}draw(e,s,l,u,p,v,w,T,P,z,M,F,V,j,G,K,Y,Q){const U=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(l),e.setStencilMode(u),e.setColorMode(p),e.setCullFace(v),T){e.activeTexture.set(U.TEXTURE2),U.bindTexture(U.TEXTURE_2D,T.depthTexture),e.activeTexture.set(U.TEXTURE3),U.bindTexture(U.TEXTURE_2D,T.texture);for(const oe in this.terrainUniforms)this.terrainUniforms[oe].set(T[oe])}for(const oe in this.fixedUniforms)this.fixedUniforms[oe].set(w[oe]);G&&G.setUniforms(e,this.binderUniforms,V,{zoom:j});let ne=0;switch(s){case U.LINES:ne=2;break;case U.TRIANGLES:ne=3;break;case U.LINE_STRIP:ne=1}for(const oe of F.get()){const pe=oe.vaos||(oe.vaos={});(pe[P]||(pe[P]=new nu)).bind(e,this,z,G?G.getPaintVertexBuffers():[],M,oe.vertexOffset,K,Y,Q),U.drawElements(s,oe.primitiveLength*ne,U.UNSIGNED_SHORT,oe.primitiveOffset*ne*2)}}}function Da(f,e,s){const l=1/vt(s,1,e.transform.tileZoom),u=Math.pow(2,s.tileID.overscaledZ),p=s.tileSize*Math.pow(2,e.transform.tileZoom)/u,v=p*(s.tileID.canonical.x+s.tileID.wrap*u),w=p*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture.size,u_scale:[l,f.fromScale,f.toScale],u_fade:f.t,u_pixel_coord_upper:[v>>16,w>>16],u_pixel_coord_lower:[65535&v,65535&w]}}const qo=(f,e,s,l)=>{const u=e.style.light,p=u.properties.get("position"),v=[p.x,p.y,p.z],w=function(){var P=new d.A(9);return d.A!=Float32Array&&(P[1]=0,P[2]=0,P[3]=0,P[5]=0,P[6]=0,P[7]=0),P[0]=1,P[4]=1,P[8]=1,P}();u.properties.get("anchor")==="viewport"&&function(P,z){var M=Math.sin(z),F=Math.cos(z);P[0]=F,P[1]=M,P[2]=0,P[3]=-M,P[4]=F,P[5]=0,P[6]=0,P[7]=0,P[8]=1}(w,-e.transform.angle),function(P,z,M){var F=z[0],V=z[1],j=z[2];P[0]=F*M[0]+V*M[3]+j*M[6],P[1]=F*M[1]+V*M[4]+j*M[7],P[2]=F*M[2]+V*M[5]+j*M[8]}(v,v,w);const T=u.properties.get("color");return{u_matrix:f,u_lightpos:v,u_lightintensity:u.properties.get("intensity"),u_lightcolor:[T.r,T.g,T.b],u_vertical_gradient:+s,u_opacity:l}},La=(f,e,s,l,u,p,v)=>d.e(qo(f,e,s,l),Da(p,e,v),{u_height_factor:-Math.pow(2,u.overscaledZ)/v.tileSize/8}),Us=f=>({u_matrix:f}),Jc=(f,e,s,l)=>d.e(Us(f),Da(s,e,l)),yp=(f,e)=>({u_matrix:f,u_world:e}),Qc=(f,e,s,l,u)=>d.e(Jc(f,e,s,l),{u_world:u}),vp=(f,e,s,l)=>{const u=f.transform;let p,v;if(l.paint.get("circle-pitch-alignment")==="map"){const w=vt(s,1,u.zoom);p=!0,v=[w,w]}else p=!1,v=u.pixelsToGLUnits;return{u_camera_to_center_distance:u.cameraToCenterDistance,u_scale_with_map:+(l.paint.get("circle-pitch-scale")==="map"),u_matrix:f.translatePosMatrix(e.posMatrix,s,l.paint.get("circle-translate"),l.paint.get("circle-translate-anchor")),u_pitch_with_map:+p,u_device_pixel_ratio:f.pixelRatio,u_extrude_scale:v}},ds=(f,e,s)=>({u_matrix:f,u_inv_matrix:e,u_camera_to_center_distance:s.cameraToCenterDistance,u_viewport_size:[s.width,s.height]}),Go=(f,e,s=1)=>({u_matrix:f,u_color:e,u_overlay:0,u_overlay_scale:s}),ri=f=>({u_matrix:f}),ii=(f,e,s,l)=>({u_matrix:f,u_extrude_scale:vt(e,1,s),u_intensity:l}),Ra=(f,e,s,l)=>{const u=d.H();d.aP(u,0,f.width,f.height,0,0,1);const p=f.context.gl;return{u_matrix:u,u_world:[p.drawingBufferWidth,p.drawingBufferHeight],u_image:s,u_color_ramp:l,u_opacity:e.paint.get("heatmap-opacity")}};function Fa(f,e){const s=Math.pow(2,e.canonical.z),l=e.canonical.y;return[new d.Z(0,l/s).toLngLat().lat,new d.Z(0,(l+1)/s).toLngLat().lat]}const Ba=(f,e,s,l)=>{const u=f.transform;return{u_matrix:rh(f,e,s,l),u_ratio:1/vt(e,1,u.zoom),u_device_pixel_ratio:f.pixelRatio,u_units_to_pixels:[1/u.pixelsToGLUnits[0],1/u.pixelsToGLUnits[1]]}},eh=(f,e,s,l,u)=>d.e(Ba(f,e,s,u),{u_image:0,u_image_height:l}),$s=(f,e,s,l,u)=>{const p=f.transform,v=th(e,p);return{u_matrix:rh(f,e,s,u),u_texsize:e.imageAtlasTexture.size,u_ratio:1/vt(e,1,p.zoom),u_device_pixel_ratio:f.pixelRatio,u_image:0,u_scale:[v,l.fromScale,l.toScale],u_fade:l.t,u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]]}},xp=(f,e,s,l,u,p)=>{const v=f.lineAtlas,w=th(e,f.transform),T=s.layout.get("line-cap")==="round",P=v.getDash(l.from,T),z=v.getDash(l.to,T),M=P.width*u.fromScale,F=z.width*u.toScale;return d.e(Ba(f,e,s,p),{u_patternscale_a:[w/M,-P.height/2],u_patternscale_b:[w/F,-z.height/2],u_sdfgamma:v.width/(256*Math.min(M,F)*f.pixelRatio)/2,u_image:0,u_tex_y_a:P.y,u_tex_y_b:z.y,u_mix:u.t})};function th(f,e){return 1/vt(f,1,e.tileZoom)}function rh(f,e,s,l){return f.translatePosMatrix(l?l.posMatrix:e.tileID.posMatrix,e,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}const wp=(f,e,s,l,u)=>{return{u_matrix:f,u_tl_parent:e,u_scale_parent:s,u_buffer_scale:1,u_fade_t:l.mix,u_opacity:l.opacity*u.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:u.paint.get("raster-brightness-min"),u_brightness_high:u.paint.get("raster-brightness-max"),u_saturation_factor:(v=u.paint.get("raster-saturation"),v>0?1-1/(1.001-v):-v),u_contrast_factor:(p=u.paint.get("raster-contrast"),p>0?1/(1-p):1+p),u_spin_weights:bp(u.paint.get("raster-hue-rotate"))};var p,v};function bp(f){f*=Math.PI/180;const e=Math.sin(f),s=Math.cos(f);return[(2*s+1)/3,(-Math.sqrt(3)*e-s+1)/3,(Math.sqrt(3)*e-s+1)/3]}const ih=(f,e,s,l,u,p,v,w,T,P,z,M,F,V)=>{const j=v.transform;return{u_is_size_zoom_constant:+(f==="constant"||f==="source"),u_is_size_feature_constant:+(f==="constant"||f==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:j.cameraToCenterDistance,u_pitch:j.pitch/360*2*Math.PI,u_rotate_symbol:+s,u_aspect_ratio:j.width/j.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_matrix:w,u_label_plane_matrix:T,u_coord_matrix:P,u_is_text:+M,u_pitch_with_map:+l,u_is_along_line:u,u_is_variable_anchor:p,u_texsize:F,u_texture:0,u_translation:z,u_pitched_scale:V}},Ho=(f,e,s,l,u,p,v,w,T,P,z,M,F,V,j)=>{const G=v.transform;return d.e(ih(f,e,s,l,u,p,v,w,T,P,z,M,F,j),{u_gamma_scale:l?Math.cos(G._pitch)*G.cameraToCenterDistance:1,u_device_pixel_ratio:v.pixelRatio,u_is_halo:1})},au=(f,e,s,l,u,p,v,w,T,P,z,M,F,V)=>d.e(Ho(f,e,s,l,u,p,v,w,T,P,z,!0,M,!0,V),{u_texsize_icon:F,u_texture_icon:1}),Oa=(f,e,s)=>({u_matrix:f,u_opacity:e,u_color:s}),lu=(f,e,s,l,u,p)=>d.e(function(v,w,T,P){const z=T.imageManager.getPattern(v.from.toString()),M=T.imageManager.getPattern(v.to.toString()),{width:F,height:V}=T.imageManager.getPixelSize(),j=Math.pow(2,P.tileID.overscaledZ),G=P.tileSize*Math.pow(2,T.transform.tileZoom)/j,K=G*(P.tileID.canonical.x+P.tileID.wrap*j),Y=G*P.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:z.tl,u_pattern_br_a:z.br,u_pattern_tl_b:M.tl,u_pattern_br_b:M.br,u_texsize:[F,V],u_mix:w.t,u_pattern_size_a:z.displaySize,u_pattern_size_b:M.displaySize,u_scale_a:w.fromScale,u_scale_b:w.toScale,u_tile_units_to_pixels:1/vt(P,1,T.transform.tileZoom),u_pixel_coord_upper:[K>>16,Y>>16],u_pixel_coord_lower:[65535&K,65535&Y]}}(l,p,s,u),{u_matrix:f,u_opacity:e}),uu={fillExtrusion:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_lightpos:new d.aN(f,e.u_lightpos),u_lightintensity:new d.aI(f,e.u_lightintensity),u_lightcolor:new d.aN(f,e.u_lightcolor),u_vertical_gradient:new d.aI(f,e.u_vertical_gradient),u_opacity:new d.aI(f,e.u_opacity)}),fillExtrusionPattern:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_lightpos:new d.aN(f,e.u_lightpos),u_lightintensity:new d.aI(f,e.u_lightintensity),u_lightcolor:new d.aN(f,e.u_lightcolor),u_vertical_gradient:new d.aI(f,e.u_vertical_gradient),u_height_factor:new d.aI(f,e.u_height_factor),u_image:new d.aH(f,e.u_image),u_texsize:new d.aO(f,e.u_texsize),u_pixel_coord_upper:new d.aO(f,e.u_pixel_coord_upper),u_pixel_coord_lower:new d.aO(f,e.u_pixel_coord_lower),u_scale:new d.aN(f,e.u_scale),u_fade:new d.aI(f,e.u_fade),u_opacity:new d.aI(f,e.u_opacity)}),fill:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix)}),fillPattern:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_image:new d.aH(f,e.u_image),u_texsize:new d.aO(f,e.u_texsize),u_pixel_coord_upper:new d.aO(f,e.u_pixel_coord_upper),u_pixel_coord_lower:new d.aO(f,e.u_pixel_coord_lower),u_scale:new d.aN(f,e.u_scale),u_fade:new d.aI(f,e.u_fade)}),fillOutline:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_world:new d.aO(f,e.u_world)}),fillOutlinePattern:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_world:new d.aO(f,e.u_world),u_image:new d.aH(f,e.u_image),u_texsize:new d.aO(f,e.u_texsize),u_pixel_coord_upper:new d.aO(f,e.u_pixel_coord_upper),u_pixel_coord_lower:new d.aO(f,e.u_pixel_coord_lower),u_scale:new d.aN(f,e.u_scale),u_fade:new d.aI(f,e.u_fade)}),circle:(f,e)=>({u_camera_to_center_distance:new d.aI(f,e.u_camera_to_center_distance),u_scale_with_map:new d.aH(f,e.u_scale_with_map),u_pitch_with_map:new d.aH(f,e.u_pitch_with_map),u_extrude_scale:new d.aO(f,e.u_extrude_scale),u_device_pixel_ratio:new d.aI(f,e.u_device_pixel_ratio),u_matrix:new d.aJ(f,e.u_matrix)}),collisionBox:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_pixel_extrude_scale:new d.aO(f,e.u_pixel_extrude_scale)}),collisionCircle:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_inv_matrix:new d.aJ(f,e.u_inv_matrix),u_camera_to_center_distance:new d.aI(f,e.u_camera_to_center_distance),u_viewport_size:new d.aO(f,e.u_viewport_size)}),debug:(f,e)=>({u_color:new d.aL(f,e.u_color),u_matrix:new d.aJ(f,e.u_matrix),u_overlay:new d.aH(f,e.u_overlay),u_overlay_scale:new d.aI(f,e.u_overlay_scale)}),clippingMask:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix)}),heatmap:(f,e)=>({u_extrude_scale:new d.aI(f,e.u_extrude_scale),u_intensity:new d.aI(f,e.u_intensity),u_matrix:new d.aJ(f,e.u_matrix)}),heatmapTexture:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_world:new d.aO(f,e.u_world),u_image:new d.aH(f,e.u_image),u_color_ramp:new d.aH(f,e.u_color_ramp),u_opacity:new d.aI(f,e.u_opacity)}),hillshade:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_image:new d.aH(f,e.u_image),u_latrange:new d.aO(f,e.u_latrange),u_light:new d.aO(f,e.u_light),u_shadow:new d.aL(f,e.u_shadow),u_highlight:new d.aL(f,e.u_highlight),u_accent:new d.aL(f,e.u_accent)}),hillshadePrepare:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_image:new d.aH(f,e.u_image),u_dimension:new d.aO(f,e.u_dimension),u_zoom:new d.aI(f,e.u_zoom),u_unpack:new d.aK(f,e.u_unpack)}),line:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_ratio:new d.aI(f,e.u_ratio),u_device_pixel_ratio:new d.aI(f,e.u_device_pixel_ratio),u_units_to_pixels:new d.aO(f,e.u_units_to_pixels)}),lineGradient:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_ratio:new d.aI(f,e.u_ratio),u_device_pixel_ratio:new d.aI(f,e.u_device_pixel_ratio),u_units_to_pixels:new d.aO(f,e.u_units_to_pixels),u_image:new d.aH(f,e.u_image),u_image_height:new d.aI(f,e.u_image_height)}),linePattern:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_texsize:new d.aO(f,e.u_texsize),u_ratio:new d.aI(f,e.u_ratio),u_device_pixel_ratio:new d.aI(f,e.u_device_pixel_ratio),u_image:new d.aH(f,e.u_image),u_units_to_pixels:new d.aO(f,e.u_units_to_pixels),u_scale:new d.aN(f,e.u_scale),u_fade:new d.aI(f,e.u_fade)}),lineSDF:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_ratio:new d.aI(f,e.u_ratio),u_device_pixel_ratio:new d.aI(f,e.u_device_pixel_ratio),u_units_to_pixels:new d.aO(f,e.u_units_to_pixels),u_patternscale_a:new d.aO(f,e.u_patternscale_a),u_patternscale_b:new d.aO(f,e.u_patternscale_b),u_sdfgamma:new d.aI(f,e.u_sdfgamma),u_image:new d.aH(f,e.u_image),u_tex_y_a:new d.aI(f,e.u_tex_y_a),u_tex_y_b:new d.aI(f,e.u_tex_y_b),u_mix:new d.aI(f,e.u_mix)}),raster:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_tl_parent:new d.aO(f,e.u_tl_parent),u_scale_parent:new d.aI(f,e.u_scale_parent),u_buffer_scale:new d.aI(f,e.u_buffer_scale),u_fade_t:new d.aI(f,e.u_fade_t),u_opacity:new d.aI(f,e.u_opacity),u_image0:new d.aH(f,e.u_image0),u_image1:new d.aH(f,e.u_image1),u_brightness_low:new d.aI(f,e.u_brightness_low),u_brightness_high:new d.aI(f,e.u_brightness_high),u_saturation_factor:new d.aI(f,e.u_saturation_factor),u_contrast_factor:new d.aI(f,e.u_contrast_factor),u_spin_weights:new d.aN(f,e.u_spin_weights)}),symbolIcon:(f,e)=>({u_is_size_zoom_constant:new d.aH(f,e.u_is_size_zoom_constant),u_is_size_feature_constant:new d.aH(f,e.u_is_size_feature_constant),u_size_t:new d.aI(f,e.u_size_t),u_size:new d.aI(f,e.u_size),u_camera_to_center_distance:new d.aI(f,e.u_camera_to_center_distance),u_pitch:new d.aI(f,e.u_pitch),u_rotate_symbol:new d.aH(f,e.u_rotate_symbol),u_aspect_ratio:new d.aI(f,e.u_aspect_ratio),u_fade_change:new d.aI(f,e.u_fade_change),u_matrix:new d.aJ(f,e.u_matrix),u_label_plane_matrix:new d.aJ(f,e.u_label_plane_matrix),u_coord_matrix:new d.aJ(f,e.u_coord_matrix),u_is_text:new d.aH(f,e.u_is_text),u_pitch_with_map:new d.aH(f,e.u_pitch_with_map),u_is_along_line:new d.aH(f,e.u_is_along_line),u_is_variable_anchor:new d.aH(f,e.u_is_variable_anchor),u_texsize:new d.aO(f,e.u_texsize),u_texture:new d.aH(f,e.u_texture),u_translation:new d.aO(f,e.u_translation),u_pitched_scale:new d.aI(f,e.u_pitched_scale)}),symbolSDF:(f,e)=>({u_is_size_zoom_constant:new d.aH(f,e.u_is_size_zoom_constant),u_is_size_feature_constant:new d.aH(f,e.u_is_size_feature_constant),u_size_t:new d.aI(f,e.u_size_t),u_size:new d.aI(f,e.u_size),u_camera_to_center_distance:new d.aI(f,e.u_camera_to_center_distance),u_pitch:new d.aI(f,e.u_pitch),u_rotate_symbol:new d.aH(f,e.u_rotate_symbol),u_aspect_ratio:new d.aI(f,e.u_aspect_ratio),u_fade_change:new d.aI(f,e.u_fade_change),u_matrix:new d.aJ(f,e.u_matrix),u_label_plane_matrix:new d.aJ(f,e.u_label_plane_matrix),u_coord_matrix:new d.aJ(f,e.u_coord_matrix),u_is_text:new d.aH(f,e.u_is_text),u_pitch_with_map:new d.aH(f,e.u_pitch_with_map),u_is_along_line:new d.aH(f,e.u_is_along_line),u_is_variable_anchor:new d.aH(f,e.u_is_variable_anchor),u_texsize:new d.aO(f,e.u_texsize),u_texture:new d.aH(f,e.u_texture),u_gamma_scale:new d.aI(f,e.u_gamma_scale),u_device_pixel_ratio:new d.aI(f,e.u_device_pixel_ratio),u_is_halo:new d.aH(f,e.u_is_halo),u_translation:new d.aO(f,e.u_translation),u_pitched_scale:new d.aI(f,e.u_pitched_scale)}),symbolTextAndIcon:(f,e)=>({u_is_size_zoom_constant:new d.aH(f,e.u_is_size_zoom_constant),u_is_size_feature_constant:new d.aH(f,e.u_is_size_feature_constant),u_size_t:new d.aI(f,e.u_size_t),u_size:new d.aI(f,e.u_size),u_camera_to_center_distance:new d.aI(f,e.u_camera_to_center_distance),u_pitch:new d.aI(f,e.u_pitch),u_rotate_symbol:new d.aH(f,e.u_rotate_symbol),u_aspect_ratio:new d.aI(f,e.u_aspect_ratio),u_fade_change:new d.aI(f,e.u_fade_change),u_matrix:new d.aJ(f,e.u_matrix),u_label_plane_matrix:new d.aJ(f,e.u_label_plane_matrix),u_coord_matrix:new d.aJ(f,e.u_coord_matrix),u_is_text:new d.aH(f,e.u_is_text),u_pitch_with_map:new d.aH(f,e.u_pitch_with_map),u_is_along_line:new d.aH(f,e.u_is_along_line),u_is_variable_anchor:new d.aH(f,e.u_is_variable_anchor),u_texsize:new d.aO(f,e.u_texsize),u_texsize_icon:new d.aO(f,e.u_texsize_icon),u_texture:new d.aH(f,e.u_texture),u_texture_icon:new d.aH(f,e.u_texture_icon),u_gamma_scale:new d.aI(f,e.u_gamma_scale),u_device_pixel_ratio:new d.aI(f,e.u_device_pixel_ratio),u_is_halo:new d.aH(f,e.u_is_halo),u_translation:new d.aO(f,e.u_translation),u_pitched_scale:new d.aI(f,e.u_pitched_scale)}),background:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_opacity:new d.aI(f,e.u_opacity),u_color:new d.aL(f,e.u_color)}),backgroundPattern:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_opacity:new d.aI(f,e.u_opacity),u_image:new d.aH(f,e.u_image),u_pattern_tl_a:new d.aO(f,e.u_pattern_tl_a),u_pattern_br_a:new d.aO(f,e.u_pattern_br_a),u_pattern_tl_b:new d.aO(f,e.u_pattern_tl_b),u_pattern_br_b:new d.aO(f,e.u_pattern_br_b),u_texsize:new d.aO(f,e.u_texsize),u_mix:new d.aI(f,e.u_mix),u_pattern_size_a:new d.aO(f,e.u_pattern_size_a),u_pattern_size_b:new d.aO(f,e.u_pattern_size_b),u_scale_a:new d.aI(f,e.u_scale_a),u_scale_b:new d.aI(f,e.u_scale_b),u_pixel_coord_upper:new d.aO(f,e.u_pixel_coord_upper),u_pixel_coord_lower:new d.aO(f,e.u_pixel_coord_lower),u_tile_units_to_pixels:new d.aI(f,e.u_tile_units_to_pixels)}),terrain:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_texture:new d.aH(f,e.u_texture),u_ele_delta:new d.aI(f,e.u_ele_delta),u_fog_matrix:new d.aJ(f,e.u_fog_matrix),u_fog_color:new d.aL(f,e.u_fog_color),u_fog_ground_blend:new d.aI(f,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new d.aI(f,e.u_fog_ground_blend_opacity),u_horizon_color:new d.aL(f,e.u_horizon_color),u_horizon_fog_blend:new d.aI(f,e.u_horizon_fog_blend)}),terrainDepth:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_ele_delta:new d.aI(f,e.u_ele_delta)}),terrainCoords:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_texture:new d.aH(f,e.u_texture),u_terrain_coords_id:new d.aI(f,e.u_terrain_coords_id),u_ele_delta:new d.aI(f,e.u_ele_delta)}),sky:(f,e)=>({u_sky_color:new d.aL(f,e.u_sky_color),u_horizon_color:new d.aL(f,e.u_horizon_color),u_horizon:new d.aI(f,e.u_horizon),u_sky_horizon_blend:new d.aI(f,e.u_sky_horizon_blend)})};class mn{constructor(e,s,l){this.context=e;const u=e.gl;this.buffer=u.createBuffer(),this.dynamicDraw=!!l,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),u.bufferData(u.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?u.DYNAMIC_DRAW:u.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const s=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Sp={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class cu{constructor(e,s,l,u){this.length=s.length,this.attributes=l,this.itemSize=s.bytesPerElement,this.dynamicDraw=u,this.context=e;const p=e.gl;this.buffer=p.createBuffer(),e.bindVertexBuffer.set(this.buffer),p.bufferData(p.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,s){for(let l=0;l<this.attributes.length;l++){const u=s.attributes[this.attributes[l].name];u!==void 0&&e.enableVertexAttribArray(u)}}setVertexAttribPointers(e,s,l){for(let u=0;u<this.attributes.length;u++){const p=this.attributes[u],v=s.attributes[p.name];v!==void 0&&e.vertexAttribPointer(v,p.components,e[Sp[p.type]],!1,this.itemSize,p.offset+this.itemSize*(l||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ps=new WeakMap;function Xn(f){var e;if(ps.has(f))return ps.get(f);{const s=(e=f.getParameter(f.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return ps.set(f,s),s}}class Dt{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Na extends Dt{getDefault(){return d.aM.transparent}set(e){const s=this.current;(e.r!==s.r||e.g!==s.g||e.b!==s.b||e.a!==s.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Tp extends Dt{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class Zs extends Dt{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class kp extends Dt{getDefault(){return[!0,!0,!0,!0]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||e[2]!==s[2]||e[3]!==s[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class nh extends Dt{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class Ip extends Dt{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class sh extends Dt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const s=this.current;(e.func!==s.func||e.ref!==s.ref||e.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class hu extends Dt{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||e[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class oh extends Dt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=e,this.dirty=!1}}class ah extends Dt{getDefault(){return[0,1]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class lh extends Dt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=e,this.dirty=!1}}class uh extends Dt{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class fs extends Dt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.BLEND):s.disable(s.BLEND),this.current=e,this.dirty=!1}}class ch extends Dt{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class Ep extends Dt{getDefault(){return d.aM.transparent}set(e){const s=this.current;(e.r!==s.r||e.g!==s.g||e.b!==s.b||e.a!==s.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class hh extends Dt{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class Wo extends Dt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=e,this.dirty=!1}}class Pp extends Dt{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class Va extends Dt{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class Cp extends Dt{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class zp extends Dt{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class dh extends Dt{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||e[2]!==s[2]||e[3]!==s[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class ph extends Dt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class fh extends Dt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class du extends Dt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindTexture(s.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class mh extends Dt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class ja extends Dt{getDefault(){return null}set(e){const s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class zn extends Dt{getDefault(){return null}set(e){var s;if(e===this.current&&!this.dirty)return;const l=this.gl;Xn(l)?l.bindVertexArray(e):(s=l.getExtension("OES_vertex_array_object"))===null||s===void 0||s.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class pu extends Dt{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class fu extends Dt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class mu extends Dt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class Ua extends Dt{constructor(e,s){super(e),this.context=e,this.parent=s}getDefault(){return null}}class gu extends Ua{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class ms extends Ua{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class _u extends Ua{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Mp{constructor(e,s,l,u,p){this.context=e,this.width=s,this.height=l;const v=e.gl,w=this.framebuffer=v.createFramebuffer();if(this.colorAttachment=new gu(e,w),u)this.depthAttachment=p?new _u(e,w):new ms(e,w);else if(p)throw new Error("Stencil cannot be set without depth");if(v.checkFramebufferStatus(v.FRAMEBUFFER)!==v.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const e=this.context.gl,s=this.colorAttachment.get();if(s&&e.deleteTexture(s),this.depthAttachment){const l=this.depthAttachment.get();l&&e.deleteRenderbuffer(l)}e.deleteFramebuffer(this.framebuffer)}}class nr{constructor(e,s,l){this.blendFunction=e,this.blendColor=s,this.mask=l}}nr.Replace=[1,0],nr.disabled=new nr(nr.Replace,d.aM.transparent,[!1,!1,!1,!1]),nr.unblended=new nr(nr.Replace,d.aM.transparent,[!0,!0,!0,!0]),nr.alphaBlended=new nr([1,771],d.aM.transparent,[!0,!0,!0,!0]);class Ap{constructor(e){var s,l;if(this.gl=e,this.clearColor=new Na(this),this.clearDepth=new Tp(this),this.clearStencil=new Zs(this),this.colorMask=new kp(this),this.depthMask=new nh(this),this.stencilMask=new Ip(this),this.stencilFunc=new sh(this),this.stencilOp=new hu(this),this.stencilTest=new oh(this),this.depthRange=new ah(this),this.depthTest=new lh(this),this.depthFunc=new uh(this),this.blend=new fs(this),this.blendFunc=new ch(this),this.blendColor=new Ep(this),this.blendEquation=new hh(this),this.cullFace=new Wo(this),this.cullFaceSide=new Pp(this),this.frontFace=new Va(this),this.program=new Cp(this),this.activeTexture=new zp(this),this.viewport=new dh(this),this.bindFramebuffer=new ph(this),this.bindRenderbuffer=new fh(this),this.bindTexture=new du(this),this.bindVertexBuffer=new mh(this),this.bindElementBuffer=new ja(this),this.bindVertexArray=new zn(this),this.pixelStoreUnpack=new pu(this),this.pixelStoreUnpackPremultiplyAlpha=new fu(this),this.pixelStoreUnpackFlipY=new mu(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),Xn(e)){this.HALF_FLOAT=e.HALF_FLOAT;const u=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(s=e.RGBA16F)!==null&&s!==void 0?s:u==null?void 0:u.RGBA16F_EXT,this.RGB16F=(l=e.RGB16F)!==null&&l!==void 0?l:u==null?void 0:u.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const u=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=u==null?void 0:u.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,s){return new mn(this,e,s)}createVertexBuffer(e,s,l){return new cu(this,e,s,l)}createRenderbuffer(e,s,l){const u=this.gl,p=u.createRenderbuffer();return this.bindRenderbuffer.set(p),u.renderbufferStorage(u.RENDERBUFFER,e,s,l),this.bindRenderbuffer.set(null),p}createFramebuffer(e,s,l,u){return new Mp(this,e,s,l,u)}clear({color:e,depth:s,stencil:l}){const u=this.gl;let p=0;e&&(p|=u.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),s!==void 0&&(p|=u.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),l!==void 0&&(p|=u.STENCIL_BUFFER_BIT,this.clearStencil.set(l),this.stencilMask.set(255)),u.clear(p)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){d.aE(e.blendFunction,nr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return Xn(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var s;return Xn(this.gl)?this.gl.deleteVertexArray(e):(s=this.gl.getExtension("OES_vertex_array_object"))===null||s===void 0?void 0:s.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}class yt{constructor(e,s,l){this.func=e,this.mask=s,this.range=l}}yt.ReadOnly=!1,yt.ReadWrite=!0,yt.disabled=new yt(519,yt.ReadOnly,[0,1]);const $a=7680;class Ut{constructor(e,s,l,u,p,v){this.test=e,this.ref=s,this.mask=l,this.fail=u,this.depthFail=p,this.pass=v}}Ut.disabled=new Ut({func:519,mask:0},0,0,$a,$a,$a);class Ot{constructor(e,s,l){this.enable=e,this.mode=s,this.frontFace=l}}let gs;function Xo(f,e,s,l,u){const p=f.context,v=p.gl,w=f.useProgram("collisionBox"),T=[];let P=0,z=0;for(let Y=0;Y<l.length;Y++){const Q=l[Y],U=e.getTile(Q).getBucket(s);if(!U)continue;const ne=u?U.textCollisionBox:U.iconCollisionBox,oe=U.collisionCircleArray;if(oe.length>0){const pe=d.H();d.aQ(pe,U.placementInvProjMatrix,f.transform.glCoordMatrix),d.aQ(pe,pe,U.placementViewportMatrix),T.push({circleArray:oe,circleOffset:z,transform:Q.posMatrix,invTransform:pe,coord:Q}),P+=oe.length/4,z=P}ne&&w.draw(p,v.LINES,yt.disabled,Ut.disabled,f.colorModeForRenderPass(),Ot.disabled,{u_matrix:Q.posMatrix,u_pixel_extrude_scale:[1/(M=f.transform).width,1/M.height]},f.style.map.terrain&&f.style.map.terrain.getTerrainData(Q),s.id,ne.layoutVertexBuffer,ne.indexBuffer,ne.segments,null,f.transform.zoom,null,null,ne.collisionVertexBuffer)}var M;if(!u||!T.length)return;const F=f.useProgram("collisionCircle"),V=new d.aR;V.resize(4*P),V._trim();let j=0;for(const Y of T)for(let Q=0;Q<Y.circleArray.length/4;Q++){const U=4*Q,ne=Y.circleArray[U+0],oe=Y.circleArray[U+1],pe=Y.circleArray[U+2],xe=Y.circleArray[U+3];V.emplace(j++,ne,oe,pe,xe,0),V.emplace(j++,ne,oe,pe,xe,1),V.emplace(j++,ne,oe,pe,xe,2),V.emplace(j++,ne,oe,pe,xe,3)}(!gs||gs.length<2*P)&&(gs=function(Y){const Q=2*Y,U=new d.aT;U.resize(Q),U._trim();for(let ne=0;ne<Q;ne++){const oe=6*ne;U.uint16[oe+0]=4*ne+0,U.uint16[oe+1]=4*ne+1,U.uint16[oe+2]=4*ne+2,U.uint16[oe+3]=4*ne+2,U.uint16[oe+4]=4*ne+3,U.uint16[oe+5]=4*ne+0}return U}(P));const G=p.createIndexBuffer(gs,!0),K=p.createVertexBuffer(V,d.aS.members,!0);for(const Y of T){const Q=ds(Y.transform,Y.invTransform,f.transform);F.draw(p,v.TRIANGLES,yt.disabled,Ut.disabled,f.colorModeForRenderPass(),Ot.disabled,Q,f.style.map.terrain&&f.style.map.terrain.getTerrainData(Y.coord),s.id,K,G,d.a0.simpleSegment(0,2*Y.circleOffset,Y.circleArray.length,Y.circleArray.length/2),null,f.transform.zoom,null,null,null)}K.destroy(),G.destroy()}Ot.disabled=new Ot(!1,1029,2305),Ot.backCCW=new Ot(!0,1029,2305);const Ko=d.an(new Float32Array(16));function yu(f,e,s,l,u,p){const{horizontalAlign:v,verticalAlign:w}=d.au(f);return new d.P((-(v-.5)*e/u+l[0])*p,(-(w-.5)*s/u+l[1])*p)}function _s(f,e,s,l,u,p){const v=e.tileAnchorPoint.add(new d.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let w=l.mult(p);s||(w=w.rotate(-u));const T=v.add(w);return W(T.x,T.y,e.labelPlaneMatrix,e.getElevation).point}if(s){const w=_e(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(f),T=Math.atan(w.y/w.x)+(w.x<0?Math.PI:0);return f.add(l.rotate(T))}return f.add(l)}function qs(f,e,s,l,u,p,v,w,T,P,z,M,F,V){const j=f.text.placedSymbolArray,G=f.text.dynamicLayoutVertexArray,K=f.icon.dynamicLayoutVertexArray,Y={};G.clear();for(let Q=0;Q<j.length;Q++){const U=j.get(Q),ne=U.hidden||!U.crossTileID||f.allowVerticalPlacement&&!U.placedOrientation?null:l[U.crossTileID];if(ne){const oe=new d.P(U.anchorX,U.anchorY),pe={getElevation:V,width:u.width,height:u.height,labelPlaneMatrix:p,pitchWithMap:s,projection:z,tileAnchorPoint:oe,translation:M,unwrappedTileID:F},xe=s?W(oe.x,oe.y,v,V):_e(oe.x,oe.y,pe),Se=L(u.cameraToCenterDistance,xe.signedDistanceFromCamera);let Re=d.ai(f.textSizeData,T,U)*Se/d.ap;s&&(Re*=f.tilePixelRatio/w);const{width:Ve,height:Me,anchor:ze,textOffset:We,textBoxScale:lt}=ne,De=yu(ze,Ve,Me,We,lt,Re),Oe=z.getPitchedTextCorrection(u,oe.add(new d.P(M[0],M[1])),F),ot=_s(xe.point,pe,e,De,u.angle,Oe),Gt=f.allowVerticalPlacement&&U.placedOrientation===d.ah.vertical?Math.PI/2:0;for(let pt=0;pt<U.numGlyphs;pt++)d.aj(G,ot,Gt);P&&U.associatedIconIndex>=0&&(Y[U.associatedIconIndex]={shiftedAnchor:ot,angle:Gt})}else tt(U.numGlyphs,G)}if(P){K.clear();const Q=f.icon.placedSymbolArray;for(let U=0;U<Q.length;U++){const ne=Q.get(U);if(ne.hidden)tt(ne.numGlyphs,K);else{const oe=Y[U];if(oe)for(let pe=0;pe<ne.numGlyphs;pe++)d.aj(K,oe.shiftedAnchor,oe.angle);else tt(ne.numGlyphs,K)}}f.icon.dynamicLayoutVertexBuffer.updateData(K)}f.text.dynamicLayoutVertexBuffer.updateData(G)}function Pi(f,e,s){return s.iconsInText&&e?"symbolTextAndIcon":f?"symbolSDF":"symbolIcon"}function vu(f,e,s,l,u,p,v,w,T,P,z,M){const F=f.context,V=F.gl,j=f.transform,G=cs(),K=w==="map",Y=T==="map",Q=w!=="viewport"&&s.layout.get("symbol-placement")!=="point",U=K&&!Y&&!Q,ne=!Y&&Q,oe=!s.layout.get("symbol-sort-key").isConstant();let pe=!1;const xe=f.depthModeForSublayer(0,yt.ReadOnly),Se=s._unevaluatedLayout.hasValue("text-variable-anchor")||s._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Re=[],Ve=G.getCircleRadiusCorrection(j);for(const Me of l){const ze=e.getTile(Me),We=ze.getBucket(s);if(!We)continue;const lt=u?We.text:We.icon;if(!lt||!lt.segments.get().length||!lt.hasVisibleVertices)continue;const De=lt.programConfigurations.get(s.id),Oe=u||We.sdfIcons,ot=u?We.textSizeData:We.iconSizeData,Gt=Y||j.pitch!==0,pt=f.useProgram(Pi(Oe,u,We),De),xt=d.ag(ot,j.zoom),Ht=f.style.map.terrain&&f.style.map.terrain.getTerrainData(Me);let Dr,Xi,Wt,ni,qr=[0,0],Lr=null;if(u)Xi=ze.glyphAtlasTexture,Wt=V.LINEAR,Dr=ze.glyphAtlasTexture.size,We.iconsInText&&(qr=ze.imageAtlasTexture.size,Lr=ze.imageAtlasTexture,ni=Gt||f.options.rotating||f.options.zooming||ot.kind==="composite"||ot.kind==="camera"?V.LINEAR:V.NEAREST);else{const bt=s.layout.get("icon-size").constantOr(0)!==1||We.iconsNeedLinear;Xi=ze.imageAtlasTexture,Wt=Oe||f.options.rotating||f.options.zooming||bt||Gt?V.LINEAR:V.NEAREST,Dr=ze.imageAtlasTexture.size}const Gr=vt(ze,1,f.transform.zoom),yn=ne?Me.posMatrix:Ko,oo=Hn(yn,Y,K,f.transform,Gr),ll=fn(yn,Y,K,f.transform,Gr),ao=fn(Me.posMatrix,Y,K,f.transform,Gr),Mi=G.translatePosition(f.transform,ze,p,v),ul=Se&&We.hasTextData(),Zu=s.layout.get("icon-text-fit")!=="none"&&ul&&We.hasIconData();if(Q){const bt=f.style.map.terrain?(lo,uo)=>f.style.map.terrain.getElevation(Me,lo,uo):null,bs=s.layout.get("text-rotation-alignment")==="map";N(We,Me.posMatrix,f,u,oo,ao,Y,P,bs,G,Me.toUnwrapped(),j.width,j.height,Mi,bt)}const Ai=Me.posMatrix,Di=u&&Se||Zu,Kn=Q||Di?Ko:oo,Ki=ll,Er=Oe&&s.paint.get(u?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Rr;Rr=Oe?We.iconsInText?au(ot.kind,xt,U,Y,Q,Di,f,Ai,Kn,Ki,Mi,Dr,qr,Ve):Ho(ot.kind,xt,U,Y,Q,Di,f,Ai,Kn,Ki,Mi,u,Dr,!0,Ve):ih(ot.kind,xt,U,Y,Q,Di,f,Ai,Kn,Ki,Mi,u,Dr,Ve);const vi={program:pt,buffers:lt,uniformValues:Rr,atlasTexture:Xi,atlasTextureIcon:Lr,atlasInterpolation:Wt,atlasInterpolationIcon:ni,isSDF:Oe,hasHalo:Er};if(oe&&We.canOverlap){pe=!0;const bt=lt.segments.get();for(const bs of bt)Re.push({segments:new d.a0([bs]),sortKey:bs.sortKey,state:vi,terrainData:Ht})}else Re.push({segments:lt.segments,sortKey:0,state:vi,terrainData:Ht})}pe&&Re.sort((Me,ze)=>Me.sortKey-ze.sortKey);for(const Me of Re){const ze=Me.state;if(F.activeTexture.set(V.TEXTURE0),ze.atlasTexture.bind(ze.atlasInterpolation,V.CLAMP_TO_EDGE),ze.atlasTextureIcon&&(F.activeTexture.set(V.TEXTURE1),ze.atlasTextureIcon&&ze.atlasTextureIcon.bind(ze.atlasInterpolationIcon,V.CLAMP_TO_EDGE)),ze.isSDF){const We=ze.uniformValues;ze.hasHalo&&(We.u_is_halo=1,xu(ze.buffers,Me.segments,s,f,ze.program,xe,z,M,We,Me.terrainData)),We.u_is_halo=0}xu(ze.buffers,Me.segments,s,f,ze.program,xe,z,M,ze.uniformValues,Me.terrainData)}}function xu(f,e,s,l,u,p,v,w,T,P){const z=l.context;u.draw(z,z.gl.TRIANGLES,p,v,w,Ot.disabled,T,P,s.id,f.layoutVertexBuffer,f.indexBuffer,e,s.paint,l.transform.zoom,f.programConfigurations.get(s.id),f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer)}function wu(f,e,s,l){const u=f.context,p=u.gl,v=Ut.disabled,w=new nr([p.ONE,p.ONE],d.aM.transparent,[!0,!0,!0,!0]),T=e.getBucket(s);if(!T)return;const P=l.key;let z=s.heatmapFbos.get(P);z||(z=Yo(u,e.tileSize,e.tileSize),s.heatmapFbos.set(P,z)),u.bindFramebuffer.set(z.framebuffer),u.viewport.set([0,0,e.tileSize,e.tileSize]),u.clear({color:d.aM.transparent});const M=T.programConfigurations.get(s.id),F=f.useProgram("heatmap",M),V=f.style.map.terrain.getTerrainData(l);F.draw(u,p.TRIANGLES,yt.disabled,v,w,Ot.disabled,ii(l.posMatrix,e,f.transform.zoom,s.paint.get("heatmap-intensity")),V,s.id,T.layoutVertexBuffer,T.indexBuffer,T.segments,s.paint,f.transform.zoom,M)}function ys(f,e,s){const l=f.context,u=l.gl;l.setColorMode(f.colorModeForRenderPass());const p=Jo(l,e),v=s.key,w=e.heatmapFbos.get(v);w&&(l.activeTexture.set(u.TEXTURE0),u.bindTexture(u.TEXTURE_2D,w.colorAttachment.get()),l.activeTexture.set(u.TEXTURE1),p.bind(u.LINEAR,u.CLAMP_TO_EDGE),f.useProgram("heatmapTexture").draw(l,u.TRIANGLES,yt.disabled,Ut.disabled,f.colorModeForRenderPass(),Ot.disabled,Ra(f,e,0,1),null,e.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments,e.paint,f.transform.zoom),w.destroy(),e.heatmapFbos.delete(v))}function Yo(f,e,s){var l,u;const p=f.gl,v=p.createTexture();p.bindTexture(p.TEXTURE_2D,v),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.LINEAR),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.LINEAR);const w=(l=f.HALF_FLOAT)!==null&&l!==void 0?l:p.UNSIGNED_BYTE,T=(u=f.RGBA16F)!==null&&u!==void 0?u:p.RGBA;p.texImage2D(p.TEXTURE_2D,0,T,e,s,0,p.RGBA,w,null);const P=f.createFramebuffer(e,s,!1,!1);return P.colorAttachment.set(v),P}function Jo(f,e){return e.colorRampTexture||(e.colorRampTexture=new _t(f,e.colorRamp,f.gl.RGBA)),e.colorRampTexture}function Gs(f,e,s,l,u){if(!s||!l||!l.imageAtlas)return;const p=l.imageAtlas.patternPositions;let v=p[s.to.toString()],w=p[s.from.toString()];if(!v&&w&&(v=w),!w&&v&&(w=v),!v||!w){const T=u.getPaintProperty(e);v=p[T],w=p[T]}v&&w&&f.setConstantPatternPositions(v,w)}function Qo(f,e,s,l,u,p,v){const w=f.context.gl,T="fill-pattern",P=s.paint.get(T),z=P&&P.constantOr(1),M=s.getCrossfadeParameters();let F,V,j,G,K;v?(V=z&&!s.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",F=w.LINES):(V=z?"fillPattern":"fill",F=w.TRIANGLES);const Y=P.constantOr(null);for(const Q of l){const U=e.getTile(Q);if(z&&!U.patternsLoaded())continue;const ne=U.getBucket(s);if(!ne)continue;const oe=ne.programConfigurations.get(s.id),pe=f.useProgram(V,oe),xe=f.style.map.terrain&&f.style.map.terrain.getTerrainData(Q);z&&(f.context.activeTexture.set(w.TEXTURE0),U.imageAtlasTexture.bind(w.LINEAR,w.CLAMP_TO_EDGE),oe.updatePaintBuffers(M)),Gs(oe,T,Y,U,s);const Se=xe?Q:null,Re=f.translatePosMatrix(Se?Se.posMatrix:Q.posMatrix,U,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor"));if(v){G=ne.indexBuffer2,K=ne.segments2;const Ve=[w.drawingBufferWidth,w.drawingBufferHeight];j=V==="fillOutlinePattern"&&z?Qc(Re,f,M,U,Ve):yp(Re,Ve)}else G=ne.indexBuffer,K=ne.segments,j=z?Jc(Re,f,M,U):Us(Re);pe.draw(f.context,F,u,f.stencilModeForClipping(Q),p,Ot.disabled,j,xe,s.id,ne.layoutVertexBuffer,G,K,s.paint,f.transform.zoom,oe)}}function Za(f,e,s,l,u,p,v){const w=f.context,T=w.gl,P="fill-extrusion-pattern",z=s.paint.get(P),M=z.constantOr(1),F=s.getCrossfadeParameters(),V=s.paint.get("fill-extrusion-opacity"),j=z.constantOr(null);for(const G of l){const K=e.getTile(G),Y=K.getBucket(s);if(!Y)continue;const Q=f.style.map.terrain&&f.style.map.terrain.getTerrainData(G),U=Y.programConfigurations.get(s.id),ne=f.useProgram(M?"fillExtrusionPattern":"fillExtrusion",U);M&&(f.context.activeTexture.set(T.TEXTURE0),K.imageAtlasTexture.bind(T.LINEAR,T.CLAMP_TO_EDGE),U.updatePaintBuffers(F)),Gs(U,P,j,K,s);const oe=f.translatePosMatrix(G.posMatrix,K,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),pe=s.paint.get("fill-extrusion-vertical-gradient"),xe=M?La(oe,f,pe,V,G,F,K):qo(oe,f,pe,V);ne.draw(w,w.gl.TRIANGLES,u,p,v,Ot.backCCW,xe,Q,s.id,Y.layoutVertexBuffer,Y.indexBuffer,Y.segments,s.paint,f.transform.zoom,U,f.style.map.terrain&&Y.centroidVertexBuffer)}}function Hs(f,e,s,l,u,p,v){const w=f.context,T=w.gl,P=s.fbo;if(!P)return;const z=f.useProgram("hillshade"),M=f.style.map.terrain&&f.style.map.terrain.getTerrainData(e);w.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,P.colorAttachment.get()),z.draw(w,T.TRIANGLES,u,p,v,Ot.disabled,((F,V,j,G)=>{const K=j.paint.get("hillshade-shadow-color"),Y=j.paint.get("hillshade-highlight-color"),Q=j.paint.get("hillshade-accent-color");let U=j.paint.get("hillshade-illumination-direction")*(Math.PI/180);j.paint.get("hillshade-illumination-anchor")==="viewport"&&(U-=F.transform.angle);const ne=!F.options.moving;return{u_matrix:G?G.posMatrix:F.transform.calculatePosMatrix(V.tileID.toUnwrapped(),ne),u_image:0,u_latrange:Fa(0,V.tileID),u_light:[j.paint.get("hillshade-exaggeration"),U],u_shadow:K,u_highlight:Y,u_accent:Q}})(f,s,l,M?e:null),M,l.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments)}function Ws(f,e,s,l,u,p){const v=f.context,w=v.gl,T=e.dem;if(T&&T.data){const P=T.dim,z=T.stride,M=T.getPixels();if(v.activeTexture.set(w.TEXTURE1),v.pixelStoreUnpackPremultiplyAlpha.set(!1),e.demTexture=e.demTexture||f.getTileTexture(z),e.demTexture){const V=e.demTexture;V.update(M,{premultiply:!1}),V.bind(w.NEAREST,w.CLAMP_TO_EDGE)}else e.demTexture=new _t(v,M,w.RGBA,{premultiply:!1}),e.demTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE);v.activeTexture.set(w.TEXTURE0);let F=e.fbo;if(!F){const V=new _t(v,{width:P,height:P,data:null},w.RGBA);V.bind(w.LINEAR,w.CLAMP_TO_EDGE),F=e.fbo=v.createFramebuffer(P,P,!0,!1),F.colorAttachment.set(V.texture)}v.bindFramebuffer.set(F.framebuffer),v.viewport.set([0,0,P,P]),f.useProgram("hillshadePrepare").draw(v,w.TRIANGLES,l,u,p,Ot.disabled,((V,j)=>{const G=j.stride,K=d.H();return d.aP(K,0,d.X,-d.X,0,0,1),d.J(K,K,[0,-d.X,0]),{u_matrix:K,u_image:1,u_dimension:[G,G],u_zoom:V.overscaledZ,u_unpack:j.getUnpackVector()}})(e.tileID,T),null,s.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments),e.needsHillshadePrepare=!1}}function gh(f,e,s,l,u,p){const v=l.paint.get("raster-fade-duration");if(!p&&v>0){const w=re.now(),T=(w-f.timeAdded)/v,P=e?(w-e.timeAdded)/v:-1,z=s.getSource(),M=u.coveringZoomLevel({tileSize:z.tileSize,roundZoom:z.roundZoom}),F=!e||Math.abs(e.tileID.overscaledZ-M)>Math.abs(f.tileID.overscaledZ-M),V=F&&f.refreshedUponExpiration?1:d.ac(F?T:1-P,0,1);return f.refreshedUponExpiration&&T>=1&&(f.refreshedUponExpiration=!1),e?{opacity:1,mix:1-V}:{opacity:V,mix:0}}return{opacity:1,mix:0}}const bu=new d.aM(1,0,0,1),Et=new d.aM(0,1,0,1),qa=new d.aM(0,0,1,1),Dp=new d.aM(1,0,1,1),_h=new d.aM(0,1,1,1);function Xs(f,e,s,l){Ga(f,0,e+s/2,f.transform.width,s,l)}function yh(f,e,s,l){Ga(f,e-s/2,0,s,f.transform.height,l)}function Ga(f,e,s,l,u,p){const v=f.context,w=v.gl;w.enable(w.SCISSOR_TEST),w.scissor(e*f.pixelRatio,s*f.pixelRatio,l*f.pixelRatio,u*f.pixelRatio),v.clear({color:p}),w.disable(w.SCISSOR_TEST)}function vh(f,e,s){const l=f.context,u=l.gl,p=s.posMatrix,v=f.useProgram("debug"),w=yt.disabled,T=Ut.disabled,P=f.colorModeForRenderPass(),z="$debug",M=f.style.map.terrain&&f.style.map.terrain.getTerrainData(s);l.activeTexture.set(u.TEXTURE0);const F=e.getTileByID(s.key).latestRawTileData,V=Math.floor((F&&F.byteLength||0)/1024),j=e.getTile(s).tileSize,G=512/Math.min(j,512)*(s.overscaledZ/f.transform.zoom)*.5;let K=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(K+=` => ${s.overscaledZ}`),function(Y,Q){Y.initDebugOverlayCanvas();const U=Y.debugOverlayCanvas,ne=Y.context.gl,oe=Y.debugOverlayCanvas.getContext("2d");oe.clearRect(0,0,U.width,U.height),oe.shadowColor="white",oe.shadowBlur=2,oe.lineWidth=1.5,oe.strokeStyle="white",oe.textBaseline="top",oe.font="bold 36px Open Sans, sans-serif",oe.fillText(Q,5,5),oe.strokeText(Q,5,5),Y.debugOverlayTexture.update(U),Y.debugOverlayTexture.bind(ne.LINEAR,ne.CLAMP_TO_EDGE)}(f,`${K} ${V}kB`),v.draw(l,u.TRIANGLES,w,T,nr.alphaBlended,Ot.disabled,Go(p,d.aM.transparent,G),null,z,f.debugBuffer,f.quadTriangleIndexBuffer,f.debugSegments),v.draw(l,u.LINE_STRIP,w,T,P,Ot.disabled,Go(p,d.aM.red),M,z,f.debugBuffer,f.tileBorderIndexBuffer,f.debugSegments)}function xh(f,e,s){const l=f.context,u=l.gl,p=f.colorModeForRenderPass(),v=new yt(u.LEQUAL,yt.ReadWrite,f.depthRangeFor3D),w=f.useProgram("terrain"),T=e.getTerrainMesh();l.bindFramebuffer.set(null),l.viewport.set([0,0,f.width,f.height]);for(const P of s){const z=f.renderToTexture.getTexture(P),M=e.getTerrainData(P.tileID);l.activeTexture.set(u.TEXTURE0),u.bindTexture(u.TEXTURE_2D,z.texture);const F=f.transform.calculatePosMatrix(P.tileID.toUnwrapped()),V=e.getMeshFrameDelta(f.transform.zoom),j=f.transform.calculateFogMatrix(P.tileID.toUnwrapped()),G=su(F,V,j,f.style.sky,f.transform.pitch);w.draw(l,u.TRIANGLES,v,Ut.disabled,p,Ot.backCCW,G,M,"terrain",T.vertexBuffer,T.indexBuffer,T.segments)}}class Ha{constructor(e,s,l){this.vertexBuffer=e,this.indexBuffer=s,this.segments=l}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}class Wa{constructor(e,s){this.context=new Ap(e),this.transform=s,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:d.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=st.maxUnderzooming+st.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new iu}resize(e,s,l){if(this.width=Math.floor(e*l),this.height=Math.floor(s*l),this.pixelRatio=l,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const u of this.style._order)this.style._layers[u].resize()}setup(){const e=this.context,s=new d.aX;s.emplaceBack(0,0),s.emplaceBack(d.X,0),s.emplaceBack(0,d.X),s.emplaceBack(d.X,d.X),this.tileExtentBuffer=e.createVertexBuffer(s,hs.members),this.tileExtentSegments=d.a0.simpleSegment(0,0,4,2);const l=new d.aX;l.emplaceBack(0,0),l.emplaceBack(d.X,0),l.emplaceBack(0,d.X),l.emplaceBack(d.X,d.X),this.debugBuffer=e.createVertexBuffer(l,hs.members),this.debugSegments=d.a0.simpleSegment(0,0,4,5);const u=new d.$;u.emplaceBack(0,0,0,0),u.emplaceBack(d.X,0,d.X,0),u.emplaceBack(0,d.X,0,d.X),u.emplaceBack(d.X,d.X,d.X,d.X),this.rasterBoundsBuffer=e.createVertexBuffer(u,qn.members),this.rasterBoundsSegments=d.a0.simpleSegment(0,0,4,2);const p=new d.aX;p.emplaceBack(0,0),p.emplaceBack(1,0),p.emplaceBack(0,1),p.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(p,hs.members),this.viewportSegments=d.a0.simpleSegment(0,0,4,2);const v=new d.aZ;v.emplaceBack(0),v.emplaceBack(1),v.emplaceBack(3),v.emplaceBack(2),v.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(v);const w=new d.aY;w.emplaceBack(0,1,2),w.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(w);const T=this.context.gl;this.stencilClearMode=new Ut({func:T.ALWAYS,mask:0},0,255,T.ZERO,T.ZERO,T.ZERO)}clearStencil(){const e=this.context,s=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const l=d.H();d.aP(l,0,this.width,this.height,0,0,1),d.K(l,l,[s.drawingBufferWidth,s.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(e,s.TRIANGLES,yt.disabled,this.stencilClearMode,nr.disabled,Ot.disabled,ri(l),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,s){if(this.currentStencilSource===e.source||!e.isTileClipped()||!s||!s.length)return;this.currentStencilSource=e.source;const l=this.context,u=l.gl;this.nextStencilID+s.length>256&&this.clearStencil(),l.setColorMode(nr.disabled),l.setDepthMode(yt.disabled);const p=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const v of s){const w=this._tileClippingMaskIDs[v.key]=this.nextStencilID++,T=this.style.map.terrain&&this.style.map.terrain.getTerrainData(v);p.draw(l,u.TRIANGLES,yt.disabled,new Ut({func:u.ALWAYS,mask:0},w,255,u.KEEP,u.KEEP,u.REPLACE),nr.disabled,Ot.disabled,ri(v.posMatrix),T,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,s=this.context.gl;return new Ut({func:s.NOTEQUAL,mask:255},e,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(e){const s=this.context.gl;return new Ut({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,s.KEEP,s.KEEP,s.REPLACE)}stencilConfigForOverlap(e){const s=this.context.gl,l=e.sort((v,w)=>w.overscaledZ-v.overscaledZ),u=l[l.length-1].overscaledZ,p=l[0].overscaledZ-u+1;if(p>1){this.currentStencilSource=void 0,this.nextStencilID+p>256&&this.clearStencil();const v={};for(let w=0;w<p;w++)v[w+u]=new Ut({func:s.GEQUAL,mask:255},w+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=p,[v,l]}return[{[u]:Ut.disabled},l]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new nr([e.CONSTANT_COLOR,e.ONE],new d.aM(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?nr.unblended:nr.alphaBlended}depthModeForSublayer(e,s,l){if(!this.opaquePassEnabledForLayer())return yt.disabled;const u=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new yt(l||this.context.gl.LEQUAL,s,[u,u])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,s){this.style=e,this.options=s,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(re.now()),this.imageManager.beginFrame();const l=this.style._order,u=this.style.sourceCaches,p={},v={},w={};for(const T in u){const P=u[T];P.used&&P.prepare(this.context),p[T]=P.getVisibleCoordinates(),v[T]=p[T].slice().reverse(),w[T]=P.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let T=0;T<l.length;T++)if(this.style._layers[l[T]].is3D()){this.opaquePassCutoff=T;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const T of l){const P=this.style._layers[T];if(!P.hasOffscreenPass()||P.isHidden(this.transform.zoom))continue;const z=v[P.source];(P.type==="custom"||z.length)&&this.renderLayer(this,u[P.source],P,z)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:s.showOverdrawInspector?d.aM.black:d.aM.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(T,P){const z=T.context,M=z.gl,F=((Y,Q,U)=>({u_sky_color:Y.properties.get("sky-color"),u_horizon_color:Y.properties.get("horizon-color"),u_horizon:(Q.height/2+Q.getHorizon())*U,u_sky_horizon_blend:Y.properties.get("sky-horizon-blend")*Q.height/2*U}))(P,T.style.map.transform,T.pixelRatio),V=new yt(M.LEQUAL,yt.ReadWrite,[0,1]),j=Ut.disabled,G=T.colorModeForRenderPass(),K=T.useProgram("sky");if(!P.mesh){const Y=new d.aX;Y.emplaceBack(-1,-1),Y.emplaceBack(1,-1),Y.emplaceBack(1,1),Y.emplaceBack(-1,1);const Q=new d.aY;Q.emplaceBack(0,1,2),Q.emplaceBack(0,2,3),P.mesh=new Ha(z.createVertexBuffer(Y,hs.members),z.createIndexBuffer(Q),d.a0.simpleSegment(0,0,Y.length,Q.length))}K.draw(z,M.TRIANGLES,V,j,G,Ot.disabled,F,void 0,"sky",P.mesh.vertexBuffer,P.mesh.indexBuffer,P.mesh.segments)}(this,this.style.sky),this._showOverdrawInspector=s.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=l.length-1;this.currentLayer>=0;this.currentLayer--){const T=this.style._layers[l[this.currentLayer]],P=u[T.source],z=p[T.source];this._renderTileClippingMasks(T,z),this.renderLayer(this,P,T,z)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<l.length;this.currentLayer++){const T=this.style._layers[l[this.currentLayer]],P=u[T.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(T))continue;const z=(T.type==="symbol"?w:v)[T.source];this._renderTileClippingMasks(T,p[T.source]),this.renderLayer(this,P,T,z)}if(this.options.showTileBoundaries){const T=function(P,z){let M=null;const F=Object.values(P._layers).flatMap(K=>K.source&&!K.isHidden(z)?[P.sourceCaches[K.source]]:[]),V=F.filter(K=>K.getSource().type==="vector"),j=F.filter(K=>K.getSource().type!=="vector"),G=K=>{(!M||M.getSource().maxzoom<K.getSource().maxzoom)&&(M=K)};return V.forEach(K=>G(K)),M||j.forEach(K=>G(K)),M}(this.style,this.transform.zoom);T&&function(P,z,M){for(let F=0;F<M.length;F++)vh(P,z,M[F])}(this,T,T.getVisibleCoordinates())}this.options.showPadding&&function(T){const P=T.transform.padding;Xs(T,T.transform.height-(P.top||0),3,bu),Xs(T,P.bottom||0,3,Et),yh(T,P.left||0,3,qa),yh(T,T.transform.width-(P.right||0),3,Dp);const z=T.transform.centerPoint;(function(M,F,V,j){Ga(M,F-1,V-10,2,20,j),Ga(M,F-10,V-1,20,2,j)})(T,z.x,T.transform.height-z.y,_h)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const s=this.terrainFacilitator.matrix,l=this.transform.modelViewProjectionMatrix;let u=this.terrainFacilitator.dirty;u||(u=e?!d.a_(s,l):!d.a$(s,l)),u||(u=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),u&&(d.b0(s,l),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(p,v){const w=p.context,T=w.gl,P=nr.unblended,z=new yt(T.LEQUAL,yt.ReadWrite,[0,1]),M=v.getTerrainMesh(),F=v.sourceCache.getRenderableTiles(),V=p.useProgram("terrainDepth");w.bindFramebuffer.set(v.getFramebuffer("depth").framebuffer),w.viewport.set([0,0,p.width/devicePixelRatio,p.height/devicePixelRatio]),w.clear({color:d.aM.transparent,depth:1});for(const j of F){const G=v.getTerrainData(j.tileID),K={u_matrix:p.transform.calculatePosMatrix(j.tileID.toUnwrapped()),u_ele_delta:v.getMeshFrameDelta(p.transform.zoom)};V.draw(w,T.TRIANGLES,z,Ut.disabled,P,Ot.backCCW,K,G,"terrain",M.vertexBuffer,M.indexBuffer,M.segments)}w.bindFramebuffer.set(null),w.viewport.set([0,0,p.width,p.height])}(this,this.style.map.terrain),function(p,v){const w=p.context,T=w.gl,P=nr.unblended,z=new yt(T.LEQUAL,yt.ReadWrite,[0,1]),M=v.getTerrainMesh(),F=v.getCoordsTexture(),V=v.sourceCache.getRenderableTiles(),j=p.useProgram("terrainCoords");w.bindFramebuffer.set(v.getFramebuffer("coords").framebuffer),w.viewport.set([0,0,p.width/devicePixelRatio,p.height/devicePixelRatio]),w.clear({color:d.aM.transparent,depth:1}),v.coordsIndex=[];for(const G of V){const K=v.getTerrainData(G.tileID);w.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,F.texture);const Y={u_matrix:p.transform.calculatePosMatrix(G.tileID.toUnwrapped()),u_terrain_coords_id:(255-v.coordsIndex.length)/255,u_texture:0,u_ele_delta:v.getMeshFrameDelta(p.transform.zoom)};j.draw(w,T.TRIANGLES,z,Ut.disabled,P,Ot.backCCW,Y,K,"terrain",M.vertexBuffer,M.indexBuffer,M.segments),v.coordsIndex.push(G.tileID.key)}w.bindFramebuffer.set(null),w.viewport.set([0,0,p.width,p.height])}(this,this.style.map.terrain))}renderLayer(e,s,l,u){if(!l.isHidden(this.transform.zoom)&&(l.type==="background"||l.type==="custom"||(u||[]).length))switch(this.id=l.id,l.type){case"symbol":(function(p,v,w,T,P){if(p.renderPass!=="translucent")return;const z=Ut.disabled,M=p.colorModeForRenderPass();(w._unevaluatedLayout.hasValue("text-variable-anchor")||w._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(F,V,j,G,K,Y,Q,U,ne){const oe=V.transform,pe=cs(),xe=K==="map",Se=Y==="map";for(const Re of F){const Ve=G.getTile(Re),Me=Ve.getBucket(j);if(!Me||!Me.text||!Me.text.segments.get().length)continue;const ze=d.ag(Me.textSizeData,oe.zoom),We=vt(Ve,1,V.transform.zoom),lt=Hn(Re.posMatrix,Se,xe,V.transform,We),De=j.layout.get("icon-text-fit")!=="none"&&Me.hasIconData();if(ze){const Oe=Math.pow(2,oe.zoom-Ve.tileID.overscaledZ),ot=V.style.map.terrain?(pt,xt)=>V.style.map.terrain.getElevation(Re,pt,xt):null,Gt=pe.translatePosition(oe,Ve,Q,U);qs(Me,xe,Se,ne,oe,lt,Re.posMatrix,Oe,ze,De,pe,Gt,Re.toUnwrapped(),ot)}}}(T,p,w,v,w.layout.get("text-rotation-alignment"),w.layout.get("text-pitch-alignment"),w.paint.get("text-translate"),w.paint.get("text-translate-anchor"),P),w.paint.get("icon-opacity").constantOr(1)!==0&&vu(p,v,w,T,!1,w.paint.get("icon-translate"),w.paint.get("icon-translate-anchor"),w.layout.get("icon-rotation-alignment"),w.layout.get("icon-pitch-alignment"),w.layout.get("icon-keep-upright"),z,M),w.paint.get("text-opacity").constantOr(1)!==0&&vu(p,v,w,T,!0,w.paint.get("text-translate"),w.paint.get("text-translate-anchor"),w.layout.get("text-rotation-alignment"),w.layout.get("text-pitch-alignment"),w.layout.get("text-keep-upright"),z,M),v.map.showCollisionBoxes&&(Xo(p,v,w,T,!0),Xo(p,v,w,T,!1))})(e,s,l,u,this.style.placement.variableOffsets);break;case"circle":(function(p,v,w,T){if(p.renderPass!=="translucent")return;const P=w.paint.get("circle-opacity"),z=w.paint.get("circle-stroke-width"),M=w.paint.get("circle-stroke-opacity"),F=!w.layout.get("circle-sort-key").isConstant();if(P.constantOr(1)===0&&(z.constantOr(1)===0||M.constantOr(1)===0))return;const V=p.context,j=V.gl,G=p.depthModeForSublayer(0,yt.ReadOnly),K=Ut.disabled,Y=p.colorModeForRenderPass(),Q=[];for(let U=0;U<T.length;U++){const ne=T[U],oe=v.getTile(ne),pe=oe.getBucket(w);if(!pe)continue;const xe=pe.programConfigurations.get(w.id),Se=p.useProgram("circle",xe),Re=pe.layoutVertexBuffer,Ve=pe.indexBuffer,Me=p.style.map.terrain&&p.style.map.terrain.getTerrainData(ne),ze={programConfiguration:xe,program:Se,layoutVertexBuffer:Re,indexBuffer:Ve,uniformValues:vp(p,ne,oe,w),terrainData:Me};if(F){const We=pe.segments.get();for(const lt of We)Q.push({segments:new d.a0([lt]),sortKey:lt.sortKey,state:ze})}else Q.push({segments:pe.segments,sortKey:0,state:ze})}F&&Q.sort((U,ne)=>U.sortKey-ne.sortKey);for(const U of Q){const{programConfiguration:ne,program:oe,layoutVertexBuffer:pe,indexBuffer:xe,uniformValues:Se,terrainData:Re}=U.state;oe.draw(V,j.TRIANGLES,G,K,Y,Ot.disabled,Se,Re,w.id,pe,xe,U.segments,w.paint,p.transform.zoom,ne)}})(e,s,l,u);break;case"heatmap":(function(p,v,w,T){if(w.paint.get("heatmap-opacity")===0)return;const P=p.context;if(p.style.map.terrain){for(const z of T){const M=v.getTile(z);v.hasRenderableParent(z)||(p.renderPass==="offscreen"?wu(p,M,w,z):p.renderPass==="translucent"&&ys(p,w,z))}P.viewport.set([0,0,p.width,p.height])}else p.renderPass==="offscreen"?function(z,M,F,V){const j=z.context,G=j.gl,K=Ut.disabled,Y=new nr([G.ONE,G.ONE],d.aM.transparent,[!0,!0,!0,!0]);(function(Q,U,ne){const oe=Q.gl;Q.activeTexture.set(oe.TEXTURE1),Q.viewport.set([0,0,U.width/4,U.height/4]);let pe=ne.heatmapFbos.get(d.aU);pe?(oe.bindTexture(oe.TEXTURE_2D,pe.colorAttachment.get()),Q.bindFramebuffer.set(pe.framebuffer)):(pe=Yo(Q,U.width/4,U.height/4),ne.heatmapFbos.set(d.aU,pe))})(j,z,F),j.clear({color:d.aM.transparent});for(let Q=0;Q<V.length;Q++){const U=V[Q];if(M.hasRenderableParent(U))continue;const ne=M.getTile(U),oe=ne.getBucket(F);if(!oe)continue;const pe=oe.programConfigurations.get(F.id),xe=z.useProgram("heatmap",pe),{zoom:Se}=z.transform;xe.draw(j,G.TRIANGLES,yt.disabled,K,Y,Ot.disabled,ii(U.posMatrix,ne,Se,F.paint.get("heatmap-intensity")),null,F.id,oe.layoutVertexBuffer,oe.indexBuffer,oe.segments,F.paint,z.transform.zoom,pe)}j.viewport.set([0,0,z.width,z.height])}(p,v,w,T):p.renderPass==="translucent"&&function(z,M){const F=z.context,V=F.gl;F.setColorMode(z.colorModeForRenderPass());const j=M.heatmapFbos.get(d.aU);j&&(F.activeTexture.set(V.TEXTURE0),V.bindTexture(V.TEXTURE_2D,j.colorAttachment.get()),F.activeTexture.set(V.TEXTURE1),Jo(F,M).bind(V.LINEAR,V.CLAMP_TO_EDGE),z.useProgram("heatmapTexture").draw(F,V.TRIANGLES,yt.disabled,Ut.disabled,z.colorModeForRenderPass(),Ot.disabled,Ra(z,M,0,1),null,M.id,z.viewportBuffer,z.quadTriangleIndexBuffer,z.viewportSegments,M.paint,z.transform.zoom))}(p,w)})(e,s,l,u);break;case"line":(function(p,v,w,T){if(p.renderPass!=="translucent")return;const P=w.paint.get("line-opacity"),z=w.paint.get("line-width");if(P.constantOr(1)===0||z.constantOr(1)===0)return;const M=p.depthModeForSublayer(0,yt.ReadOnly),F=p.colorModeForRenderPass(),V=w.paint.get("line-dasharray"),j=w.paint.get("line-pattern"),G=j.constantOr(1),K=w.paint.get("line-gradient"),Y=w.getCrossfadeParameters(),Q=G?"linePattern":V?"lineSDF":K?"lineGradient":"line",U=p.context,ne=U.gl;let oe=!0;for(const pe of T){const xe=v.getTile(pe);if(G&&!xe.patternsLoaded())continue;const Se=xe.getBucket(w);if(!Se)continue;const Re=Se.programConfigurations.get(w.id),Ve=p.context.program.get(),Me=p.useProgram(Q,Re),ze=oe||Me.program!==Ve,We=p.style.map.terrain&&p.style.map.terrain.getTerrainData(pe),lt=j.constantOr(null);if(lt&&xe.imageAtlas){const ot=xe.imageAtlas,Gt=ot.patternPositions[lt.to.toString()],pt=ot.patternPositions[lt.from.toString()];Gt&&pt&&Re.setConstantPatternPositions(Gt,pt)}const De=We?pe:null,Oe=G?$s(p,xe,w,Y,De):V?xp(p,xe,w,V,Y,De):K?eh(p,xe,w,Se.lineClipsArray.length,De):Ba(p,xe,w,De);if(G)U.activeTexture.set(ne.TEXTURE0),xe.imageAtlasTexture.bind(ne.LINEAR,ne.CLAMP_TO_EDGE),Re.updatePaintBuffers(Y);else if(V&&(ze||p.lineAtlas.dirty))U.activeTexture.set(ne.TEXTURE0),p.lineAtlas.bind(U);else if(K){const ot=Se.gradients[w.id];let Gt=ot.texture;if(w.gradientVersion!==ot.version){let pt=256;if(w.stepInterpolant){const xt=v.getSource().maxzoom,Ht=pe.canonical.z===xt?Math.ceil(1<<p.transform.maxZoom-pe.canonical.z):1;pt=d.ac(d.aV(Se.maxLineLength/d.X*1024*Ht),256,U.maxTextureSize)}ot.gradient=d.aW({expression:w.gradientExpression(),evaluationKey:"lineProgress",resolution:pt,image:ot.gradient||void 0,clips:Se.lineClipsArray}),ot.texture?ot.texture.update(ot.gradient):ot.texture=new _t(U,ot.gradient,ne.RGBA),ot.version=w.gradientVersion,Gt=ot.texture}U.activeTexture.set(ne.TEXTURE0),Gt.bind(w.stepInterpolant?ne.NEAREST:ne.LINEAR,ne.CLAMP_TO_EDGE)}Me.draw(U,ne.TRIANGLES,M,p.stencilModeForClipping(pe),F,Ot.disabled,Oe,We,w.id,Se.layoutVertexBuffer,Se.indexBuffer,Se.segments,w.paint,p.transform.zoom,Re,Se.layoutVertexBuffer2),oe=!1}})(e,s,l,u);break;case"fill":(function(p,v,w,T){const P=w.paint.get("fill-color"),z=w.paint.get("fill-opacity");if(z.constantOr(1)===0)return;const M=p.colorModeForRenderPass(),F=w.paint.get("fill-pattern"),V=p.opaquePassEnabledForLayer()&&!F.constantOr(1)&&P.constantOr(d.aM.transparent).a===1&&z.constantOr(0)===1?"opaque":"translucent";if(p.renderPass===V){const j=p.depthModeForSublayer(1,p.renderPass==="opaque"?yt.ReadWrite:yt.ReadOnly);Qo(p,v,w,T,j,M,!1)}if(p.renderPass==="translucent"&&w.paint.get("fill-antialias")){const j=p.depthModeForSublayer(w.getPaintProperty("fill-outline-color")?2:0,yt.ReadOnly);Qo(p,v,w,T,j,M,!0)}})(e,s,l,u);break;case"fill-extrusion":(function(p,v,w,T){const P=w.paint.get("fill-extrusion-opacity");if(P!==0&&p.renderPass==="translucent"){const z=new yt(p.context.gl.LEQUAL,yt.ReadWrite,p.depthRangeFor3D);if(P!==1||w.paint.get("fill-extrusion-pattern").constantOr(1))Za(p,v,w,T,z,Ut.disabled,nr.disabled),Za(p,v,w,T,z,p.stencilModeFor3D(),p.colorModeForRenderPass());else{const M=p.colorModeForRenderPass();Za(p,v,w,T,z,Ut.disabled,M)}}})(e,s,l,u);break;case"hillshade":(function(p,v,w,T){if(p.renderPass!=="offscreen"&&p.renderPass!=="translucent")return;const P=p.context,z=p.depthModeForSublayer(0,yt.ReadOnly),M=p.colorModeForRenderPass(),[F,V]=p.renderPass==="translucent"?p.stencilConfigForOverlap(T):[{},T];for(const j of V){const G=v.getTile(j);G.needsHillshadePrepare!==void 0&&G.needsHillshadePrepare&&p.renderPass==="offscreen"?Ws(p,G,w,z,Ut.disabled,M):p.renderPass==="translucent"&&Hs(p,j,G,w,z,F[j.overscaledZ],M)}P.viewport.set([0,0,p.width,p.height])})(e,s,l,u);break;case"raster":(function(p,v,w,T){if(p.renderPass!=="translucent"||w.paint.get("raster-opacity")===0||!T.length)return;const P=p.context,z=P.gl,M=v.getSource(),F=p.useProgram("raster"),V=p.colorModeForRenderPass(),[j,G]=M instanceof Pn?[{},T]:p.stencilConfigForOverlap(T),K=G[G.length-1].overscaledZ,Y=!p.options.moving;for(const Q of G){const U=p.depthModeForSublayer(Q.overscaledZ-K,w.paint.get("raster-opacity")===1?yt.ReadWrite:yt.ReadOnly,z.LESS),ne=v.getTile(Q);ne.registerFadeDuration(w.paint.get("raster-fade-duration"));const oe=v.findLoadedParent(Q,0),pe=v.findLoadedSibling(Q),xe=gh(ne,oe||pe||null,v,w,p.transform,p.style.map.terrain);let Se,Re;const Ve=w.paint.get("raster-resampling")==="nearest"?z.NEAREST:z.LINEAR;P.activeTexture.set(z.TEXTURE0),ne.texture.bind(Ve,z.CLAMP_TO_EDGE,z.LINEAR_MIPMAP_NEAREST),P.activeTexture.set(z.TEXTURE1),oe?(oe.texture.bind(Ve,z.CLAMP_TO_EDGE,z.LINEAR_MIPMAP_NEAREST),Se=Math.pow(2,oe.tileID.overscaledZ-ne.tileID.overscaledZ),Re=[ne.tileID.canonical.x*Se%1,ne.tileID.canonical.y*Se%1]):ne.texture.bind(Ve,z.CLAMP_TO_EDGE,z.LINEAR_MIPMAP_NEAREST),ne.texture.useMipmap&&P.extTextureFilterAnisotropic&&p.transform.pitch>20&&z.texParameterf(z.TEXTURE_2D,P.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,P.extTextureFilterAnisotropicMax);const Me=p.style.map.terrain&&p.style.map.terrain.getTerrainData(Q),ze=Me?Q:null,We=ze?ze.posMatrix:p.transform.calculatePosMatrix(Q.toUnwrapped(),Y),lt=wp(We,Re||[0,0],Se||1,xe,w);M instanceof Pn?F.draw(P,z.TRIANGLES,U,Ut.disabled,V,Ot.disabled,lt,Me,w.id,M.boundsBuffer,p.quadTriangleIndexBuffer,M.boundsSegments):F.draw(P,z.TRIANGLES,U,j[Q.overscaledZ],V,Ot.disabled,lt,Me,w.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments)}})(e,s,l,u);break;case"background":(function(p,v,w,T){const P=w.paint.get("background-color"),z=w.paint.get("background-opacity");if(z===0)return;const M=p.context,F=M.gl,V=p.transform,j=V.tileSize,G=w.paint.get("background-pattern");if(p.isPatternMissing(G))return;const K=!G&&P.a===1&&z===1&&p.opaquePassEnabledForLayer()?"opaque":"translucent";if(p.renderPass!==K)return;const Y=Ut.disabled,Q=p.depthModeForSublayer(0,K==="opaque"?yt.ReadWrite:yt.ReadOnly),U=p.colorModeForRenderPass(),ne=p.useProgram(G?"backgroundPattern":"background"),oe=T||V.coveringTiles({tileSize:j,terrain:p.style.map.terrain});G&&(M.activeTexture.set(F.TEXTURE0),p.imageManager.bind(p.context));const pe=w.getCrossfadeParameters();for(const xe of oe){const Se=T?xe.posMatrix:p.transform.calculatePosMatrix(xe.toUnwrapped()),Re=G?lu(Se,z,p,G,{tileID:xe,tileSize:j},pe):Oa(Se,z,P),Ve=p.style.map.terrain&&p.style.map.terrain.getTerrainData(xe);ne.draw(M,F.TRIANGLES,Q,Y,U,Ot.disabled,Re,Ve,w.id,p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}})(e,0,l,u);break;case"custom":(function(p,v,w){const T=p.context,P=w.implementation;if(p.renderPass==="offscreen"){const z=P.prerender;z&&(p.setCustomLayerDefaults(),T.setColorMode(p.colorModeForRenderPass()),z.call(P,T.gl,p.transform.customLayerMatrix()),T.setDirty(),p.setBaseState())}else if(p.renderPass==="translucent"){p.setCustomLayerDefaults(),T.setColorMode(p.colorModeForRenderPass()),T.setStencilMode(Ut.disabled);const z=P.renderingMode==="3d"?new yt(p.context.gl.LEQUAL,yt.ReadWrite,p.depthRangeFor3D):p.depthModeForSublayer(0,yt.ReadOnly);T.setDepthMode(z),P.render(T.gl,p.transform.customLayerMatrix(),{farZ:p.transform.farZ,nearZ:p.transform.nearZ,fov:p.transform._fov,modelViewProjectionMatrix:p.transform.modelViewProjectionMatrix,projectionMatrix:p.transform.projectionMatrix}),T.setDirty(),p.setBaseState(),T.bindFramebuffer.set(null)}})(e,0,l)}}translatePosMatrix(e,s,l,u,p){if(!l[0]&&!l[1])return e;const v=p?u==="map"?this.transform.angle:0:u==="viewport"?-this.transform.angle:0;if(v){const P=Math.sin(v),z=Math.cos(v);l=[l[0]*z-l[1]*P,l[0]*P+l[1]*z]}const w=[p?l[0]:vt(s,l[0],this.transform.zoom),p?l[1]:vt(s,l[1],this.transform.zoom),0],T=new Float32Array(16);return d.J(T,e,w),T}saveTileTexture(e){const s=this._tileTextures[e.size[0]];s?s.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const s=this._tileTextures[e];return s&&s.length>0?s.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const s=this.imageManager.getPattern(e.from.toString()),l=this.imageManager.getPattern(e.to.toString());return!s||!l}useProgram(e,s){this.cache=this.cache||{};const l=e+(s?s.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[l]||(this.cache[l]=new ou(this.context,Wn[e],s,uu[e],this._showOverdrawInspector,this.style.map.terrain)),this.cache[l]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new _t(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:s}=this.context.gl;return this.width!==e||this.height!==s}}class Ks{constructor(e,s){this.points=e,this.planes=s}static fromInvProjectionMatrix(e,s,l){const u=Math.pow(2,l),p=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(w=>{const T=1/(w=d.af([],w,e))[3]/s*u;return d.b1(w,w,[T,T,1/w[3],T])}),v=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(w=>{const T=function(F,V){var j=V[0],G=V[1],K=V[2],Y=j*j+G*G+K*K;return Y>0&&(Y=1/Math.sqrt(Y)),F[0]=V[0]*Y,F[1]=V[1]*Y,F[2]=V[2]*Y,F}([],function(F,V,j){var G=V[0],K=V[1],Y=V[2],Q=j[0],U=j[1],ne=j[2];return F[0]=K*ne-Y*U,F[1]=Y*Q-G*ne,F[2]=G*U-K*Q,F}([],qe([],p[w[0]],p[w[1]]),qe([],p[w[2]],p[w[1]]))),P=-((z=T)[0]*(M=p[w[1]])[0]+z[1]*M[1]+z[2]*M[2]);var z,M;return T.concat(P)});return new Ks(p,v)}}class Ys{constructor(e,s){this.min=e,this.max=s,this.center=function(l,u,p){return l[0]=.5*u[0],l[1]=.5*u[1],l[2]=.5*u[2],l}([],function(l,u,p){return l[0]=u[0]+p[0],l[1]=u[1]+p[1],l[2]=u[2]+p[2],l}([],this.min,this.max))}quadrant(e){const s=[e%2==0,e<2],l=je(this.min),u=je(this.max);for(let p=0;p<s.length;p++)l[p]=s[p]?this.min[p]:this.center[p],u[p]=s[p]?this.center[p]:this.max[p];return u[2]=this.max[2],new Ys(l,u)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersects(e){const s=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let l=!0;for(let u=0;u<e.planes.length;u++){const p=e.planes[u];let v=0;for(let w=0;w<s.length;w++)d.b2(p,s[w])>=0&&v++;if(v===0)return 0;v!==s.length&&(l=!1)}if(l)return 2;for(let u=0;u<3;u++){let p=Number.MAX_VALUE,v=-Number.MAX_VALUE;for(let w=0;w<e.points.length;w++){const T=e.points[w][u]-this.min[u];p=Math.min(p,T),v=Math.max(v,T)}if(v<0||p>this.max[u]-this.min[u])return 0}return 1}}class Js{constructor(e=0,s=0,l=0,u=0){if(isNaN(e)||e<0||isNaN(s)||s<0||isNaN(l)||l<0||isNaN(u)||u<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=s,this.left=l,this.right=u}interpolate(e,s,l){return s.top!=null&&e.top!=null&&(this.top=d.y.number(e.top,s.top,l)),s.bottom!=null&&e.bottom!=null&&(this.bottom=d.y.number(e.bottom,s.bottom,l)),s.left!=null&&e.left!=null&&(this.left=d.y.number(e.left,s.left,l)),s.right!=null&&e.right!=null&&(this.right=d.y.number(e.right,s.right,l)),this}getCenter(e,s){const l=d.ac((this.left+e-this.right)/2,0,e),u=d.ac((this.top+s-this.bottom)/2,0,s);return new d.P(l,u)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new Js(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Su=85.051129;class Qs{constructor(e,s,l,u,p){this.tileSize=512,this._renderWorldCopies=p===void 0||!!p,this._minZoom=e||0,this._maxZoom=s||22,this._minPitch=l??0,this._maxPitch=u??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new d.N(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Js,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={},this.minElevationForCurrentTile=0}clone(){const e=new Qs(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return e.apply(this),e}apply(e){this.tileSize=e.tileSize,this.latRange=e.latRange,this.lngRange=e.lngRange,this.width=e.width,this.height=e.height,this._center=e._center,this._elevation=e._elevation,this.minElevationForCurrentTile=e.minElevationForCurrentTile,this.zoom=e.zoom,this.angle=e.angle,this._fov=e._fov,this._pitch=e._pitch,this._unmodified=e._unmodified,this._edgeInsets=e._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new d.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(e){const s=-d.b3(e,-180,180)*Math.PI/180;this.angle!==s&&(this._unmodified=!1,this.angle=s,this._calcMatrices(),this.rotationMatrix=function(){var l=new d.A(4);return d.A!=Float32Array&&(l[1]=0,l[2]=0),l[0]=1,l[3]=1,l}(),function(l,u,p){var v=u[0],w=u[1],T=u[2],P=u[3],z=Math.sin(p),M=Math.cos(p);l[0]=v*M+T*z,l[1]=w*M+P*z,l[2]=v*-z+T*M,l[3]=w*-z+P*M}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){const s=d.ac(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==s&&(this._unmodified=!1,this._pitch=s,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=e/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(e){const s=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==s&&(this._unmodified=!1,this._zoom=s,this.tileZoom=Math.max(0,Math.floor(s)),this.scale=this.zoomScale(s),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,s,l){this._unmodified=!1,this._edgeInsets.interpolate(e,s,l),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){const s=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,s)}getVisibleUnwrappedCoordinates(e){const s=[new d.b4(0,e)];if(this._renderWorldCopies){const l=this.pointCoordinate(new d.P(0,0)),u=this.pointCoordinate(new d.P(this.width,0)),p=this.pointCoordinate(new d.P(this.width,this.height)),v=this.pointCoordinate(new d.P(0,this.height)),w=Math.floor(Math.min(l.x,u.x,p.x,v.x)),T=Math.floor(Math.max(l.x,u.x,p.x,v.x)),P=1;for(let z=w-P;z<=T+P;z++)z!==0&&s.push(new d.b4(z,e))}return s}coveringTiles(e){var s,l;let u=this.coveringZoomLevel(e);const p=u;if(e.minzoom!==void 0&&u<e.minzoom)return[];e.maxzoom!==void 0&&u>e.maxzoom&&(u=e.maxzoom);const v=this.pointCoordinate(this.getCameraPoint()),w=d.Z.fromLngLat(this.center),T=Math.pow(2,u),P=[T*v.x,T*v.y,0],z=[T*w.x,T*w.y,0],M=Ks.fromInvProjectionMatrix(this.invModelViewProjectionMatrix,this.worldSize,u);let F=e.minzoom||0;!e.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(F=u);const V=e.terrain?2/Math.min(this.tileSize,e.tileSize)*this.tileSize:3,j=U=>({aabb:new Ys([U*T,0,0],[(U+1)*T,T,0]),zoom:0,x:0,y:0,wrap:U,fullyVisible:!1}),G=[],K=[],Y=u,Q=e.reparseOverscaled?p:u;if(this._renderWorldCopies)for(let U=1;U<=3;U++)G.push(j(-U)),G.push(j(U));for(G.push(j(0));G.length>0;){const U=G.pop(),ne=U.x,oe=U.y;let pe=U.fullyVisible;if(!pe){const Me=U.aabb.intersects(M);if(Me===0)continue;pe=Me===2}const xe=e.terrain?P:z,Se=U.aabb.distanceX(xe),Re=U.aabb.distanceY(xe),Ve=Math.max(Math.abs(Se),Math.abs(Re));if(U.zoom===Y||Ve>V+(1<<Y-U.zoom)-2&&U.zoom>=F){const Me=Y-U.zoom,ze=P[0]-.5-(ne<<Me),We=P[1]-.5-(oe<<Me);K.push({tileID:new d.S(U.zoom===Y?Q:U.zoom,U.wrap,U.zoom,ne,oe),distanceSq:rt([z[0]-.5-ne,z[1]-.5-oe]),tileDistanceToCamera:Math.sqrt(ze*ze+We*We)})}else for(let Me=0;Me<4;Me++){const ze=(ne<<1)+Me%2,We=(oe<<1)+(Me>>1),lt=U.zoom+1;let De=U.aabb.quadrant(Me);if(e.terrain){const Oe=new d.S(lt,U.wrap,lt,ze,We),ot=e.terrain.getMinMaxElevation(Oe),Gt=(s=ot.minElevation)!==null&&s!==void 0?s:this.elevation,pt=(l=ot.maxElevation)!==null&&l!==void 0?l:this.elevation;De=new Ys([De.min[0],De.min[1],Gt],[De.max[0],De.max[1],pt])}G.push({aabb:De,zoom:lt,x:ze,y:We,wrap:U.wrap,fullyVisible:pe})}}return K.sort((U,ne)=>U.distanceSq-ne.distanceSq).map(U=>U.tileID)}resize(e,s){this.width=e,this.height=s,this.pixelsToGLUnits=[2/e,-2/s],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(e){const s=d.ac(e.lat,-85.051129,Su);return new d.P(d.O(e.lng)*this.worldSize,d.Q(s)*this.worldSize)}unproject(e){return new d.Z(e.x/this.worldSize,e.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(e){const s=this.elevation,l=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,u=this.pointLocation(this.centerPoint,e),p=e.getElevationForLngLatZoom(u,this.tileZoom);if(!(this.elevation-p))return;const v=l+s-p,w=Math.cos(this._pitch)*this.cameraToCenterDistance/v/d.b5(1,u.lat),T=this.scaleZoom(w/this.tileSize);this._elevation=p,this._center=u,this.zoom=T}setLocationAtPoint(e,s){const l=this.pointCoordinate(s),u=this.pointCoordinate(this.centerPoint),p=this.locationCoordinate(e),v=new d.Z(p.x-(l.x-u.x),p.y-(l.y-u.y));this.center=this.coordinateLocation(v),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(e,s){return s?this.coordinatePoint(this.locationCoordinate(e),s.getElevationForLngLatZoom(e,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(e))}pointLocation(e,s){return this.coordinateLocation(this.pointCoordinate(e,s))}locationCoordinate(e){return d.Z.fromLngLat(e)}coordinateLocation(e){return e&&e.toLngLat()}pointCoordinate(e,s){if(s){const F=s.pointCoordinate(e);if(F!=null)return F}const l=[e.x,e.y,0,1],u=[e.x,e.y,1,1];d.af(l,l,this.pixelMatrixInverse),d.af(u,u,this.pixelMatrixInverse);const p=l[3],v=u[3],w=l[1]/p,T=u[1]/v,P=l[2]/p,z=u[2]/v,M=P===z?0:(0-P)/(z-P);return new d.Z(d.y.number(l[0]/p,u[0]/v,M)/this.worldSize,d.y.number(w,T,M)/this.worldSize)}coordinatePoint(e,s=0,l=this.pixelMatrix){const u=[e.x*this.worldSize,e.y*this.worldSize,s,1];return d.af(u,u,l),new d.P(u[0]/u[3],u[1]/u[3])}getBounds(){const e=Math.max(0,this.height/2-this.getHorizon());return new me().extend(this.pointLocation(new d.P(0,e))).extend(this.pointLocation(new d.P(this.width,e))).extend(this.pointLocation(new d.P(this.width,this.height))).extend(this.pointLocation(new d.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new me([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(e){e?(this.lngRange=[e.getWest(),e.getEast()],this.latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,Su])}calculateTileMatrix(e){const s=e.canonical,l=this.worldSize/this.zoomScale(s.z),u=s.x+Math.pow(2,s.z)*e.wrap,p=d.an(new Float64Array(16));return d.J(p,p,[u*l,s.y*l,0]),d.K(p,p,[l/d.X,l/d.X,1]),p}calculatePosMatrix(e,s=!1){const l=e.key,u=s?this._alignedPosMatrixCache:this._posMatrixCache;if(u[l])return u[l];const p=this.calculateTileMatrix(e);return d.L(p,s?this.alignedModelViewProjectionMatrix:this.modelViewProjectionMatrix,p),u[l]=new Float32Array(p),u[l]}calculateFogMatrix(e){const s=e.key,l=this._fogMatrixCache;if(l[s])return l[s];const u=this.calculateTileMatrix(e);return d.L(u,this.fogMatrix,u),l[s]=new Float32Array(u),l[s]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(e,s){s=d.ac(+s,this.minZoom,this.maxZoom);const l={center:new d.N(e.lng,e.lat),zoom:s};let u=this.lngRange;if(!this._renderWorldCopies&&u===null){const U=179.9999999999;u=[-U,U]}const p=this.tileSize*this.zoomScale(l.zoom);let v=0,w=p,T=0,P=p,z=0,M=0;const{x:F,y:V}=this.size;if(this.latRange){const U=this.latRange;v=d.Q(U[1])*p,w=d.Q(U[0])*p,w-v<V&&(z=V/(w-v))}u&&(T=d.b3(d.O(u[0])*p,0,p),P=d.b3(d.O(u[1])*p,0,p),P<T&&(P+=p),P-T<F&&(M=F/(P-T)));const{x:j,y:G}=this.project.call({worldSize:p},e);let K,Y;const Q=Math.max(M||0,z||0);if(Q){const U=new d.P(M?(P+T)/2:j,z?(w+v)/2:G);return l.center=this.unproject.call({worldSize:p},U).wrap(),l.zoom+=this.scaleZoom(Q),l}if(this.latRange){const U=V/2;G-U<v&&(Y=v+U),G+U>w&&(Y=w-U)}if(u){const U=(T+P)/2;let ne=j;this._renderWorldCopies&&(ne=d.b3(j,U-p/2,U+p/2));const oe=F/2;ne-oe<T&&(K=T+oe),ne+oe>P&&(K=P-oe)}if(K!==void 0||Y!==void 0){const U=new d.P(K??j,Y??G);l.center=this.unproject.call({worldSize:p},U).wrap()}return l}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:s,zoom:l}=this.getConstrained(this.center,this.zoom);this.center=s,this.zoom=l,this._unmodified=e,this._constraining=!1}_calcMatrices(){if(!this.height)return;const e=this.centerOffset,s=this.point.x,l=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=d.b5(1,this.center.lat)*this.worldSize;let u=d.an(new Float64Array(16));d.K(u,u,[this.width/2,-this.height/2,1]),d.J(u,u,[1,-1,0]),this.labelPlaneMatrix=u,u=d.an(new Float64Array(16)),d.K(u,u,[1,-1,1]),d.J(u,u,[-1,-1,0]),d.K(u,u,[2/this.width,2/this.height,1]),this.glCoordMatrix=u;const p=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),v=Math.min(this.elevation,this.minElevationForCurrentTile),w=p-v*this._pixelPerMeter/Math.cos(this._pitch),T=v<0?w:p,P=Math.PI/2+this._pitch,z=this._fov*(.5+e.y/this.height),M=Math.sin(z)*T/Math.sin(d.ac(Math.PI-P-z,.01,Math.PI-.01)),F=this.getHorizon(),V=2*Math.atan(F/this.cameraToCenterDistance)*(.5+e.y/(2*F)),j=Math.sin(V)*T/Math.sin(d.ac(Math.PI-P-V,.01,Math.PI-.01)),G=Math.min(M,j);this.farZ=1.01*(Math.cos(Math.PI/2-this._pitch)*G+T),this.nearZ=this.height/50,u=new Float64Array(16),d.b6(u,this._fov,this.width/this.height,this.nearZ,this.farZ),u[8]=2*-e.x/this.width,u[9]=2*e.y/this.height,this.projectionMatrix=d.ae(u),d.K(u,u,[1,-1,1]),d.J(u,u,[0,0,-this.cameraToCenterDistance]),d.b7(u,u,this._pitch),d.ad(u,u,this.angle),d.J(u,u,[-s,-l,0]),this.mercatorMatrix=d.K([],u,[this.worldSize,this.worldSize,this.worldSize]),d.K(u,u,[1,1,this._pixelPerMeter]),this.pixelMatrix=d.L(new Float64Array(16),this.labelPlaneMatrix,u),d.J(u,u,[0,0,-this.elevation]),this.modelViewProjectionMatrix=u,this.invModelViewProjectionMatrix=d.as([],u),this.fogMatrix=new Float64Array(16),d.b6(this.fogMatrix,this._fov,this.width/this.height,p,this.farZ),this.fogMatrix[8]=2*-e.x/this.width,this.fogMatrix[9]=2*e.y/this.height,d.K(this.fogMatrix,this.fogMatrix,[1,-1,1]),d.J(this.fogMatrix,this.fogMatrix,[0,0,-this.cameraToCenterDistance]),d.b7(this.fogMatrix,this.fogMatrix,this._pitch),d.ad(this.fogMatrix,this.fogMatrix,this.angle),d.J(this.fogMatrix,this.fogMatrix,[-s,-l,0]),d.K(this.fogMatrix,this.fogMatrix,[1,1,this._pixelPerMeter]),d.J(this.fogMatrix,this.fogMatrix,[0,0,-this.elevation]),this.pixelMatrix3D=d.L(new Float64Array(16),this.labelPlaneMatrix,u);const K=this.width%2/2,Y=this.height%2/2,Q=Math.cos(this.angle),U=Math.sin(this.angle),ne=s-Math.round(s)+Q*K+U*Y,oe=l-Math.round(l)+Q*Y+U*K,pe=new Float64Array(u);if(d.J(pe,pe,[ne>.5?ne-1:ne,oe>.5?oe-1:oe,0]),this.alignedModelViewProjectionMatrix=pe,u=d.as(new Float64Array(16),this.pixelMatrix),!u)throw new Error("failed to invert matrix");this.pixelMatrixInverse=u,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const e=this.pointCoordinate(new d.P(0,0)),s=[e.x*this.worldSize,e.y*this.worldSize,0,1];return d.af(s,s,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new d.P(0,e))}getCameraQueryGeometry(e){const s=this.getCameraPoint();if(e.length===1)return[e[0],s];{let l=s.x,u=s.y,p=s.x,v=s.y;for(const w of e)l=Math.min(l,w.x),u=Math.min(u,w.y),p=Math.max(p,w.x),v=Math.max(v,w.y);return[new d.P(l,u),new d.P(p,u),new d.P(p,v),new d.P(l,v),new d.P(l,u)]}}lngLatToCameraDepth(e,s){const l=this.locationCoordinate(e),u=[l.x*this.worldSize,l.y*this.worldSize,s,1];return d.af(u,u,this.modelViewProjectionMatrix),u[2]/u[3]}}function ea(f,e){let s,l=!1,u=null,p=null;const v=()=>{u=null,l&&(f.apply(p,s),u=setTimeout(v,e),l=!1)};return(...w)=>(l=!0,p=this,s=w,u||v(),u)}class Xa{constructor(e){this._getCurrentHash=()=>{const s=window.location.hash.replace("#","");if(this._hashName){let l;return s.split("&").map(u=>u.split("=")).forEach(u=>{u[0]===this._hashName&&(l=u)}),(l&&l[1]||"").split("/")}return s.split("/")},this._onHashChange=()=>{const s=this._getCurrentHash();if(s.length>=3&&!s.some(l=>isNaN(l))){const l=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(s[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:l,pitch:+(s[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const s=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,s)},this._removeHash=()=>{const s=this._getCurrentHash();if(s.length===0)return;const l=s.join("/");let u=l;u.split("&").length>0&&(u=u.split("&")[0]),this._hashName&&(u=`${this._hashName}=${l}`);let p=window.location.hash.replace(u,"");p.startsWith("#&")?p=p.slice(0,1)+p.slice(2):p==="#"&&(p="");let v=window.location.href.replace(/(#.+)?$/,p);v=v.replace("&&","&"),window.history.replaceState(window.history.state,null,v)},this._updateHash=ea(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const s=this._map.getCenter(),l=Math.round(100*this._map.getZoom())/100,u=Math.ceil((l*Math.LN2+Math.log(512/360/.5))/Math.LN10),p=Math.pow(10,u),v=Math.round(s.lng*p)/p,w=Math.round(s.lat*p)/p,T=this._map.getBearing(),P=this._map.getPitch();let z="";if(z+=e?`/${v}/${w}/${l}`:`${l}/${w}/${v}`,(T||P)&&(z+="/"+Math.round(10*T)/10),P&&(z+=`/${Math.round(P)}`),this._hashName){const M=this._hashName;let F=!1;const V=window.location.hash.slice(1).split("&").map(j=>{const G=j.split("=")[0];return G===M?(F=!0,`${G}=${z}`):j}).filter(j=>j);return F||V.push(`${M}=${z}`),`#${V.join("&")}`}return`#${z}`}}const Ka={linearity:.3,easing:d.b8(0,0,.3,1)},Tu=d.e({deceleration:2500,maxSpeed:1400},Ka),Lp=d.e({deceleration:20,maxSpeed:1400},Ka),wh=d.e({deceleration:1e3,maxSpeed:360},Ka),Ya=d.e({deceleration:1e3,maxSpeed:90},Ka);class ku{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:re.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,s=re.now();for(;e.length>0&&s-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const s={zoom:0,bearing:0,pitch:0,pan:new d.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:p}of this._inertiaBuffer)s.zoom+=p.zoomDelta||0,s.bearing+=p.bearingDelta||0,s.pitch+=p.pitchDelta||0,p.panDelta&&s.pan._add(p.panDelta),p.around&&(s.around=p.around),p.pinchAround&&(s.pinchAround=p.pinchAround);const l=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,u={};if(s.pan.mag()){const p=ra(s.pan.mag(),l,d.e({},Tu,e||{}));u.offset=s.pan.mult(p.amount/s.pan.mag()),u.center=this._map.transform.center,ta(u,p)}if(s.zoom){const p=ra(s.zoom,l,Lp);u.zoom=this._map.transform.zoom+p.amount,ta(u,p)}if(s.bearing){const p=ra(s.bearing,l,wh);u.bearing=this._map.transform.bearing+d.ac(p.amount,-179,179),ta(u,p)}if(s.pitch){const p=ra(s.pitch,l,Ya);u.pitch=this._map.transform.pitch+p.amount,ta(u,p)}if(u.zoom||u.bearing){const p=s.pinchAround===void 0?s.around:s.pinchAround;u.around=p?this._map.unproject(p):this._map.getCenter()}return this.clear(),d.e(u,{noMoveStart:!0})}}function ta(f,e){(!f.duration||f.duration<e.duration)&&(f.duration=e.duration,f.easing=e.easing)}function ra(f,e,s){const{maxSpeed:l,linearity:u,deceleration:p}=s,v=d.ac(f*u/(e/1e3),-l,l),w=Math.abs(v)/(p*u);return{easing:s.easing,duration:1e3*w,amount:v*(w/2)}}class Ar extends d.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,s,l,u={}){const p=q.mousePos(s.getCanvas(),l),v=s.unproject(p);super(e,d.e({point:p,lngLat:v,originalEvent:l},u)),this._defaultPrevented=!1,this.target=s}}class vs extends d.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,s,l){const u=e==="touchend"?l.changedTouches:l.touches,p=q.touchPos(s.getCanvasContainer(),u),v=p.map(T=>s.unproject(T)),w=p.reduce((T,P,z,M)=>T.add(P.div(M.length)),new d.P(0,0));super(e,{points:p,point:w,lngLats:v,lngLat:s.unproject(w),originalEvent:l}),this._defaultPrevented=!1}}class bh extends d.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,s,l){super(e,{originalEvent:l}),this._defaultPrevented=!1}}class Sh{constructor(e,s){this._map=e,this._clickTolerance=s.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new bh(e.type,this._map,e))}mousedown(e,s){return this._mousedownPos=s,this._firePreventable(new Ar(e.type,this._map,e))}mouseup(e){this._map.fire(new Ar(e.type,this._map,e))}click(e,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||this._map.fire(new Ar(e.type,this._map,e))}dblclick(e){return this._firePreventable(new Ar(e.type,this._map,e))}mouseover(e){this._map.fire(new Ar(e.type,this._map,e))}mouseout(e){this._map.fire(new Ar(e.type,this._map,e))}touchstart(e){return this._firePreventable(new vs(e.type,this._map,e))}touchmove(e){this._map.fire(new vs(e.type,this._map,e))}touchend(e){this._map.fire(new vs(e.type,this._map,e))}touchcancel(e){this._map.fire(new vs(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class sr{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new Ar(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ar("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new Ar(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Hi{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.pointLocation(d.P.convert(e),this._map.terrain)}}class _i{constructor(e,s){this._map=e,this._tr=new Hi(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,s){this.isEnabled()&&e.shiftKey&&e.button===0&&(q.disableDrag(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(e,s){if(!this._active)return;const l=s;if(this._lastPos.equals(l)||!this._box&&l.dist(this._startPos)<this._clickTolerance)return;const u=this._startPos;this._lastPos=l,this._box||(this._box=q.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const p=Math.min(u.x,l.x),v=Math.max(u.x,l.x),w=Math.min(u.y,l.y),T=Math.max(u.y,l.y);q.setTransform(this._box,`translate(${p}px,${w}px)`),this._box.style.width=v-p+"px",this._box.style.height=T-w+"px"}mouseupWindow(e,s){if(!this._active||e.button!==0)return;const l=this._startPos,u=s;if(this.reset(),q.suppressClick(),l.x!==u.x||l.y!==u.y)return this._map.fire(new d.k("boxzoomend",{originalEvent:e})),{cameraAnimation:p=>p.fitScreenCoordinates(l,u,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(q.remove(this._box),this._box=null),q.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,s){return this._map.fire(new d.k(e,{originalEvent:s}))}}function ia(f,e){if(f.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${f.length}, points ${e.length}`);const s={};for(let l=0;l<f.length;l++)s[f[l].identifier]=e[l];return s}class Iu{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,s,l){(this.centroid||l.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),l.length===this.numTouches&&(this.centroid=function(u){const p=new d.P(0,0);for(const v of u)p._add(v);return p.div(u.length)}(s),this.touches=ia(l,s)))}touchmove(e,s,l){if(this.aborted||!this.centroid)return;const u=ia(l,s);for(const p in this.touches){const v=u[p];(!v||v.dist(this.touches[p])>30)&&(this.aborted=!0)}}touchend(e,s,l){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),l.length===0){const u=!this.aborted&&this.centroid;if(this.reset(),u)return u}}}class Ja{constructor(e){this.singleTap=new Iu(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,s,l){this.singleTap.touchstart(e,s,l)}touchmove(e,s,l){this.singleTap.touchmove(e,s,l)}touchend(e,s,l){const u=this.singleTap.touchend(e,s,l);if(u){const p=e.timeStamp-this.lastTime<500,v=!this.lastTap||this.lastTap.dist(u)<30;if(p&&v||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=u,this.count===this.numTaps)return this.reset(),u}}}class eo{constructor(e){this._tr=new Hi(e),this._zoomIn=new Ja({numTouches:1,numTaps:2}),this._zoomOut=new Ja({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,s,l){this._zoomIn.touchstart(e,s,l),this._zoomOut.touchstart(e,s,l)}touchmove(e,s,l){this._zoomIn.touchmove(e,s,l),this._zoomOut.touchmove(e,s,l)}touchend(e,s,l){const u=this._zoomIn.touchend(e,s,l),p=this._zoomOut.touchend(e,s,l),v=this._tr;return u?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:v.zoom+1,around:v.unproject(u)},{originalEvent:e})}):p?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:v.zoom-1,around:v.unproject(p)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Mn{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const s=this._moveFunction(...e);if(s.bearingDelta||s.pitchDelta||s.around||s.panDelta)return this._active=!0,s}dragStart(e,s){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=s.length?s[0]:s,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,s){if(!this.isEnabled())return;const l=this._lastPoint;if(!l)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const u=s.length?s[0]:s;return!this._moved&&u.dist(l)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=u,this._move(l,u))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&q.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Eu={0:1,2:2};class Qa{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const s=q.mouseButton(e);this._eventButton=s}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!function(s,l){const u=Eu[l];return s.buttons===void 0||(s.buttons&u)!==u}(e,this._eventButton)}isValidEndEvent(e){return q.mouseButton(e)===this._eventButton}}class Pu{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}const el=f=>{f.mousedown=f.dragStart,f.mousemoveWindow=f.dragMove,f.mouseup=f.dragEnd,f.contextmenu=e=>{e.preventDefault()}},Cu=({enable:f,clickTolerance:e,bearingDegreesPerPixelMoved:s=.8})=>{const l=new Qa({checkCorrectEvent:u=>q.mouseButton(u)===0&&u.ctrlKey||q.mouseButton(u)===2});return new Mn({clickTolerance:e,move:(u,p)=>({bearingDelta:(p.x-u.x)*s}),moveStateManager:l,enable:f,assignEvents:el})},zu=({enable:f,clickTolerance:e,pitchDegreesPerPixelMoved:s=-.5})=>{const l=new Qa({checkCorrectEvent:u=>q.mouseButton(u)===0&&u.ctrlKey||q.mouseButton(u)===2});return new Mn({clickTolerance:e,move:(u,p)=>({pitchDelta:(p.y-u.y)*s}),moveStateManager:l,enable:f,assignEvents:el})};class xs{constructor(e,s){this._clickTolerance=e.clickTolerance||1,this._map=s,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new d.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,s,l){return this._calculateTransform(e,s,l)}touchmove(e,s,l){if(this._active){if(!this._shouldBePrevented(l.length))return e.preventDefault(),this._calculateTransform(e,s,l);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,s,l){this._calculateTransform(e,s,l),this._active&&this._shouldBePrevented(l.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,s,l){l.length>0&&(this._active=!0);const u=ia(l,s),p=new d.P(0,0),v=new d.P(0,0);let w=0;for(const P in u){const z=u[P],M=this._touches[P];M&&(p._add(z),v._add(z.sub(M)),w++,u[P]=z)}if(this._touches=u,this._shouldBePrevented(w)||!v.mag())return;const T=v.div(w);return this._sum._add(T),this._sum.mag()<this._clickTolerance?void 0:{around:p.div(w),panDelta:T}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class tl{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,s,l){this._firstTwoTouches||l.length<2||(this._firstTwoTouches=[l[0].identifier,l[1].identifier],this._start([s[0],s[1]]))}touchmove(e,s,l){if(!this._firstTwoTouches)return;e.preventDefault();const[u,p]=this._firstTwoTouches,v=na(l,s,u),w=na(l,s,p);if(!v||!w)return;const T=this._aroundCenter?null:v.add(w).div(2);return this._move([v,w],T,e)}touchend(e,s,l){if(!this._firstTwoTouches)return;const[u,p]=this._firstTwoTouches,v=na(l,s,u),w=na(l,s,p);v&&w||(this._active&&q.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function na(f,e,s){for(let l=0;l<f.length;l++)if(f[l].identifier===s)return e[l]}function Mu(f,e){return Math.log(f/e)/Math.LN2}class Au extends tl{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,s){const l=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(Mu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Mu(this._distance,l),pinchAround:s}}}function Du(f,e){return 180*f.angleWith(e)/Math.PI}class Lu extends tl{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,s,l){const u=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Du(this._vector,u),pinchAround:s}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const s=25/(Math.PI*this._minDiameter)*360,l=Du(e,this._startVector);return Math.abs(l)<s}}function rl(f){return Math.abs(f.y)>Math.abs(f.x)}class sa extends tl{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,s,l){super.touchstart(e,s,l),this._currentTouchCount=l.length}_start(e){this._lastPoints=e,rl(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,s,l){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const u=e[0].sub(this._lastPoints[0]),p=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(u,p,l.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(u.y+p.y)/2*-.5}):void 0}gestureBeginsVertically(e,s,l){if(this._valid!==void 0)return this._valid;const u=e.mag()>=2,p=s.mag()>=2;if(!u&&!p)return;if(!u||!p)return this._firstMove===void 0&&(this._firstMove=l),l-this._firstMove<100&&void 0;const v=e.y>0==s.y>0;return rl(e)&&rl(s)&&v}}const Th={panStep:100,bearingStep:15,pitchStep:10};class Ci{constructor(e){this._tr=new Hi(e);const s=Th;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let s=0,l=0,u=0,p=0,v=0;switch(e.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:e.shiftKey?l=-1:(e.preventDefault(),p=-1);break;case 39:e.shiftKey?l=1:(e.preventDefault(),p=1);break;case 38:e.shiftKey?u=1:(e.preventDefault(),v=-1);break;case 40:e.shiftKey?u=-1:(e.preventDefault(),v=1);break;default:return}return this._rotationDisabled&&(l=0,u=0),{cameraAnimation:w=>{const T=this._tr;w.easeTo({duration:300,easeId:"keyboardHandler",easing:gn,zoom:s?Math.round(T.zoom)+s*(e.shiftKey?2:1):T.zoom,bearing:T.bearing+l*this._bearingStep,pitch:T.pitch+u*this._pitchStep,offset:[-p*this._panStep,-v*this._panStep],center:T.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function gn(f){return f*(2-f)}const Ru=4.000244140625;class Wi{constructor(e,s){this._onTimeout=l=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},this._map=e,this._tr=new Hi(e),this._triggerRenderFrame=s,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let s=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const l=re.now(),u=l-(this._lastWheelEventTime||0);this._lastWheelEventTime=l,s!==0&&s%Ru==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":u>400?(this._type=null,this._lastValue=s,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(u*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),e.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=e,this._delta-=s,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const s=q.mousePos(this._map.getCanvas(),e),l=this._tr;this._around=s.y>l.transform.height/2-l.transform.getHorizon()?d.N.convert(this._aroundCenter?l.center:l.unproject(s)):d.N.convert(l.center),this._aroundPoint=l.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._tr.transform;if(this._delta!==0){const T=this._type==="wheel"&&Math.abs(this._delta)>Ru?this._wheelZoomRate:this._defaultZoomRate;let P=2/(1+Math.exp(-Math.abs(this._delta*T)));this._delta<0&&P!==0&&(P=1/P);const z=typeof this._targetZoom=="number"?e.zoomScale(this._targetZoom):e.scale;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(z*P))),this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const s=typeof this._targetZoom=="number"?this._targetZoom:e.zoom,l=this._startZoom,u=this._easing;let p,v=!1;const w=re.now()-this._lastWheelEventTime;if(this._type==="wheel"&&l&&u&&w){const T=Math.min(w/200,1),P=u(T);p=d.y.number(l,s,P),T<1?this._frameId||(this._frameId=!0):v=!0}else p=s,v=!0;return this._active=!0,v&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!v,zoomDelta:p-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let s=d.b9;if(this._prevEase){const l=this._prevEase,u=(re.now()-l.start)/l.duration,p=l.easing(u+.01)-l.easing(u),v=.27/Math.sqrt(p*p+1e-4)*.01,w=Math.sqrt(.0729-v*v);s=d.b8(v,w,.25,1)}return this._prevEase={start:re.now(),duration:e,easing:s},s}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class ws{constructor(e,s){this._clickZoom=e,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Rp{constructor(e){this._tr=new Hi(e),this.reset()}reset(){this._active=!1}dblclick(e,s){return e.preventDefault(),{cameraAnimation:l=>{l.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(s)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Fp{constructor(){this._tap=new Ja({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,s,l){if(!this._swipePoint)if(this._tapTime){const u=s[0],p=e.timeStamp-this._tapTime<500,v=this._tapPoint.dist(u)<30;p&&v?l.length>0&&(this._swipePoint=u,this._swipeTouch=l[0].identifier):this.reset()}else this._tap.touchstart(e,s,l)}touchmove(e,s,l){if(this._tapTime){if(this._swipePoint){if(l[0].identifier!==this._swipeTouch)return;const u=s[0],p=u.y-this._swipePoint.y;return this._swipePoint=u,e.preventDefault(),this._active=!0,{zoomDelta:p/128}}}else this._tap.touchmove(e,s,l)}touchend(e,s,l){if(this._tapTime)this._swipePoint&&l.length===0&&this.reset();else{const u=this._tap.touchend(e,s,l);u&&(this._tapTime=e.timeStamp,this._tapPoint=u)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class kh{constructor(e,s,l){this._el=e,this._mousePan=s,this._touchPan=l}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Ih{constructor(e,s,l){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=s,this._mousePitch=l}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Fu{constructor(e,s,l,u){this._el=e,this._touchZoom=s,this._touchRotate=l,this._tapDragZoom=u,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class to{constructor(e,s){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=s,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=q.create("div","maplibregl-cooperative-gesture-screen",e);let s=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(s=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const l=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),u=document.createElement("div");u.className="maplibregl-desktop-message",u.textContent=s,this._container.appendChild(u);const p=document.createElement("div");p.className="maplibregl-mobile-message",p.textContent=l,this._container.appendChild(p),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(q.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,s){this._enabled&&(this._map.fire(new d.k("cooperativegestureprevented",{gestureType:e,originalEvent:s})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const zi=f=>f.zoom||f.drag||f.pitch||f.rotate;class $e extends d.k{}function il(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class Bu{constructor(e,s){this.handleWindowEvent=u=>{this.handleEvent(u,`${u.type}Window`)},this.handleEvent=(u,p)=>{if(u.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const v=u.type==="renderFrame"?void 0:u,w={needsRenderFrame:!1},T={},P={},z=u.touches,M=z?this._getMapTouches(z):void 0,F=M?q.touchPos(this._map.getCanvas(),M):q.mousePos(this._map.getCanvas(),u);for(const{handlerName:G,handler:K,allowed:Y}of this._handlers){if(!K.isEnabled())continue;let Q;this._blockedByActive(P,Y,G)?K.reset():K[p||u.type]&&(Q=K[p||u.type](u,F,M),this.mergeHandlerResult(w,T,Q,G,v),Q&&Q.needsRenderFrame&&this._triggerRenderFrame()),(Q||K.isActive())&&(P[G]=K)}const V={};for(const G in this._previousActiveHandlers)P[G]||(V[G]=v);this._previousActiveHandlers=P,(Object.keys(V).length||il(w))&&(this._changes.push([w,T,V]),this._triggerRenderFrame()),(Object.keys(P).length||il(w))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:j}=w;j&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],j(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new ku(e),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(s);const l=this._el;this._listeners=[[l,"touchstart",{passive:!0}],[l,"touchmove",{passive:!1}],[l,"touchend",void 0],[l,"touchcancel",void 0],[l,"mousedown",void 0],[l,"mousemove",void 0],[l,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[l,"mouseover",void 0],[l,"mouseout",void 0],[l,"dblclick",void 0],[l,"click",void 0],[l,"keydown",{capture:!1}],[l,"keyup",void 0],[l,"wheel",{passive:!1}],[l,"contextmenu",void 0],[window,"blur",void 0]];for(const[u,p,v]of this._listeners)q.addEventListener(u,p,u===document?this.handleWindowEvent:this.handleEvent,v)}destroy(){for(const[e,s,l]of this._listeners)q.removeEventListener(e,s,e===document?this.handleWindowEvent:this.handleEvent,l)}_addDefaultHandlers(e){const s=this._map,l=s.getCanvasContainer();this._add("mapEvent",new Sh(s,e));const u=s.boxZoom=new _i(s,e);this._add("boxZoom",u),e.interactive&&e.boxZoom&&u.enable();const p=s.cooperativeGestures=new to(s,e.cooperativeGestures);this._add("cooperativeGestures",p),e.cooperativeGestures&&p.enable();const v=new eo(s),w=new Rp(s);s.doubleClickZoom=new ws(w,v),this._add("tapZoom",v),this._add("clickZoom",w),e.interactive&&e.doubleClickZoom&&s.doubleClickZoom.enable();const T=new Fp;this._add("tapDragZoom",T);const P=s.touchPitch=new sa(s);this._add("touchPitch",P),e.interactive&&e.touchPitch&&s.touchPitch.enable(e.touchPitch);const z=Cu(e),M=zu(e);s.dragRotate=new Ih(e,z,M),this._add("mouseRotate",z,["mousePitch"]),this._add("mousePitch",M,["mouseRotate"]),e.interactive&&e.dragRotate&&s.dragRotate.enable();const F=(({enable:Q,clickTolerance:U})=>{const ne=new Qa({checkCorrectEvent:oe=>q.mouseButton(oe)===0&&!oe.ctrlKey});return new Mn({clickTolerance:U,move:(oe,pe)=>({around:pe,panDelta:pe.sub(oe)}),activateOnStart:!0,moveStateManager:ne,enable:Q,assignEvents:el})})(e),V=new xs(e,s);s.dragPan=new kh(l,F,V),this._add("mousePan",F),this._add("touchPan",V,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&s.dragPan.enable(e.dragPan);const j=new Lu,G=new Au;s.touchZoomRotate=new Fu(l,G,j,T),this._add("touchRotate",j,["touchPan","touchZoom"]),this._add("touchZoom",G,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&s.touchZoomRotate.enable(e.touchZoomRotate);const K=s.scrollZoom=new Wi(s,()=>this._triggerRenderFrame());this._add("scrollZoom",K,["mousePan"]),e.interactive&&e.scrollZoom&&s.scrollZoom.enable(e.scrollZoom);const Y=s.keyboard=new Ci(s);this._add("keyboard",Y),e.interactive&&e.keyboard&&s.keyboard.enable(),this._add("blockableMapEvent",new sr(s))}_add(e,s,l){this._handlers.push({handlerName:e,handler:s,allowed:l}),this._handlersById[e]=s}stop(e){if(!this._updatingCamera){for(const{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!zi(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,s,l){for(const u in e)if(u!==l&&(!s||s.indexOf(u)<0))return!0;return!1}_getMapTouches(e){const s=[];for(const l of e)this._el.contains(l.target)&&s.push(l);return s}mergeHandlerResult(e,s,l,u,p){if(!l)return;d.e(e,l);const v={handlerName:u,originalEvent:l.originalEvent||p};l.zoomDelta!==void 0&&(s.zoom=v),l.panDelta!==void 0&&(s.drag=v),l.pitchDelta!==void 0&&(s.pitch=v),l.bearingDelta!==void 0&&(s.rotate=v)}_applyChanges(){const e={},s={},l={};for(const[u,p,v]of this._changes)u.panDelta&&(e.panDelta=(e.panDelta||new d.P(0,0))._add(u.panDelta)),u.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+u.zoomDelta),u.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+u.bearingDelta),u.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+u.pitchDelta),u.around!==void 0&&(e.around=u.around),u.pinchAround!==void 0&&(e.pinchAround=u.pinchAround),u.noInertia&&(e.noInertia=u.noInertia),d.e(s,p),d.e(l,v);this._updateMapTransform(e,s,l),this._changes=[]}_updateMapTransform(e,s,l){const u=this._map,p=u._getTransformForUpdate(),v=u.terrain;if(!(il(e)||v&&this._terrainMovement))return this._fireEvents(s,l,!0);let{panDelta:w,zoomDelta:T,bearingDelta:P,pitchDelta:z,around:M,pinchAround:F}=e;F!==void 0&&(M=F),u._stop(!0),M=M||u.transform.centerPoint;const V=p.pointLocation(w?M.sub(w):M);P&&(p.bearing+=P),z&&(p.pitch+=z),T&&(p.zoom+=T),v?this._terrainMovement||!s.drag&&!s.zoom?s.drag&&this._terrainMovement?p.center=p.pointLocation(p.centerPoint.sub(w)):p.setLocationAtPoint(V,M):(this._terrainMovement=!0,this._map._elevationFreeze=!0,p.setLocationAtPoint(V,M)):p.setLocationAtPoint(V,M),u._applyUpdatedTransform(p),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(s,l,!0)}_fireEvents(e,s,l){const u=zi(this._eventsInProgress),p=zi(e),v={};for(const M in e){const{originalEvent:F}=e[M];this._eventsInProgress[M]||(v[`${M}start`]=F),this._eventsInProgress[M]=e[M]}!u&&p&&this._fireEvent("movestart",p.originalEvent);for(const M in v)this._fireEvent(M,v[M]);p&&this._fireEvent("move",p.originalEvent);for(const M in e){const{originalEvent:F}=e[M];this._fireEvent(M,F)}const w={};let T;for(const M in this._eventsInProgress){const{handlerName:F,originalEvent:V}=this._eventsInProgress[M];this._handlersById[F].isActive()||(delete this._eventsInProgress[M],T=s[F]||V,w[`${M}end`]=T)}for(const M in w)this._fireEvent(M,w[M]);const P=zi(this._eventsInProgress),z=(u||p)&&!P;if(z&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const M=this._map._getTransformForUpdate();M.recalculateZoom(this._map.terrain),this._map._applyUpdatedTransform(M)}if(l&&z){this._updatingCamera=!0;const M=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),F=V=>V!==0&&-this._bearingSnap<V&&V<this._bearingSnap;!M||!M.essential&&re.prefersReducedMotion?(this._map.fire(new d.k("moveend",{originalEvent:T})),F(this._map.getBearing())&&this._map.resetNorth()):(F(M.bearing||this._map.getBearing())&&(M.bearing=0),M.freezeElevation=!0,this._map.easeTo(M,{originalEvent:T})),this._updatingCamera=!1}}_fireEvent(e,s){this._map.fire(new d.k(e,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{delete this._frameId,this.handleEvent(new $e("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Eh extends d.E{constructor(e,s){super(),this._renderFrameCallback=()=>{const l=Math.min((re.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(l)),l<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=s.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new d.N(this.transform.center.lng,this.transform.center.lat)}setCenter(e,s){return this.jumpTo({center:e},s)}panBy(e,s,l){return e=d.P.convert(e).mult(-1),this.panTo(this.transform.center,d.e({offset:e},s),l)}panTo(e,s,l){return this.easeTo(d.e({center:e},s),l)}getZoom(){return this.transform.zoom}setZoom(e,s){return this.jumpTo({zoom:e},s),this}zoomTo(e,s,l){return this.easeTo(d.e({zoom:e},s),l)}zoomIn(e,s){return this.zoomTo(this.getZoom()+1,e,s),this}zoomOut(e,s){return this.zoomTo(this.getZoom()-1,e,s),this}getBearing(){return this.transform.bearing}setBearing(e,s){return this.jumpTo({bearing:e},s),this}getPadding(){return this.transform.padding}setPadding(e,s){return this.jumpTo({padding:e},s),this}rotateTo(e,s,l){return this.easeTo(d.e({bearing:e},s),l)}resetNorth(e,s){return this.rotateTo(0,d.e({duration:1e3},e),s),this}resetNorthPitch(e,s){return this.easeTo(d.e({bearing:0,pitch:0,duration:1e3},e),s),this}snapToNorth(e,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,s):this}getPitch(){return this.transform.pitch}setPitch(e,s){return this.jumpTo({pitch:e},s),this}cameraForBounds(e,s){e=me.convert(e).adjustAntiMeridian();const l=s&&s.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),l,s)}_cameraForBoxAndBearing(e,s,l,u){const p={top:0,bottom:0,right:0,left:0};if(typeof(u=d.e({padding:p,offset:[0,0],maxZoom:this.transform.maxZoom},u)).padding=="number"){const Me=u.padding;u.padding={top:Me,bottom:Me,right:Me,left:Me}}u.padding=d.e(p,u.padding);const v=this.transform,w=v.padding,T=new me(e,s),P=v.project(T.getNorthWest()),z=v.project(T.getNorthEast()),M=v.project(T.getSouthEast()),F=v.project(T.getSouthWest()),V=d.ba(-l),j=P.rotate(V),G=z.rotate(V),K=M.rotate(V),Y=F.rotate(V),Q=new d.P(Math.max(j.x,G.x,Y.x,K.x),Math.max(j.y,G.y,Y.y,K.y)),U=new d.P(Math.min(j.x,G.x,Y.x,K.x),Math.min(j.y,G.y,Y.y,K.y)),ne=Q.sub(U),oe=(v.width-(w.left+w.right+u.padding.left+u.padding.right))/ne.x,pe=(v.height-(w.top+w.bottom+u.padding.top+u.padding.bottom))/ne.y;if(pe<0||oe<0)return void d.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const xe=Math.min(v.scaleZoom(v.scale*Math.min(oe,pe)),u.maxZoom),Se=d.P.convert(u.offset),Re=new d.P((u.padding.left-u.padding.right)/2,(u.padding.top-u.padding.bottom)/2).rotate(d.ba(l)),Ve=Se.add(Re).mult(v.scale/v.zoomScale(xe));return{center:v.unproject(P.add(M).div(2).sub(Ve)),zoom:xe,bearing:l}}fitBounds(e,s,l){return this._fitInternal(this.cameraForBounds(e,s),s,l)}fitScreenCoordinates(e,s,l,u,p){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(d.P.convert(e)),this.transform.pointLocation(d.P.convert(s)),l,u),u,p)}_fitInternal(e,s,l){return e?(delete(s=d.e(e,s)).padding,s.linear?this.easeTo(s,l):this.flyTo(s,l)):this}jumpTo(e,s){this.stop();const l=this._getTransformForUpdate();let u=!1,p=!1,v=!1;return"zoom"in e&&l.zoom!==+e.zoom&&(u=!0,l.zoom=+e.zoom),e.center!==void 0&&(l.center=d.N.convert(e.center)),"bearing"in e&&l.bearing!==+e.bearing&&(p=!0,l.bearing=+e.bearing),"pitch"in e&&l.pitch!==+e.pitch&&(v=!0,l.pitch=+e.pitch),e.padding==null||l.isPaddingEqual(e.padding)||(l.padding=e.padding),this._applyUpdatedTransform(l),this.fire(new d.k("movestart",s)).fire(new d.k("move",s)),u&&this.fire(new d.k("zoomstart",s)).fire(new d.k("zoom",s)).fire(new d.k("zoomend",s)),p&&this.fire(new d.k("rotatestart",s)).fire(new d.k("rotate",s)).fire(new d.k("rotateend",s)),v&&this.fire(new d.k("pitchstart",s)).fire(new d.k("pitch",s)).fire(new d.k("pitchend",s)),this.fire(new d.k("moveend",s))}calculateCameraOptionsFromTo(e,s,l,u=0){const p=d.Z.fromLngLat(e,s),v=d.Z.fromLngLat(l,u),w=v.x-p.x,T=v.y-p.y,P=v.z-p.z,z=Math.hypot(w,T,P);if(z===0)throw new Error("Can't calculate camera options with same From and To");const M=Math.hypot(w,T),F=this.transform.scaleZoom(this.transform.cameraToCenterDistance/z/this.transform.tileSize),V=180*Math.atan2(w,-T)/Math.PI;let j=180*Math.acos(M/z)/Math.PI;return j=P<0?90-j:90+j,{center:v.toLngLat(),zoom:F,pitch:j,bearing:V}}easeTo(e,s){var l;this._stop(!1,e.easeId),((e=d.e({offset:[0,0],duration:500,easing:d.b9},e)).animate===!1||!e.essential&&re.prefersReducedMotion)&&(e.duration=0);const u=this._getTransformForUpdate(),p=u.zoom,v=u.bearing,w=u.pitch,T=u.padding,P="bearing"in e?this._normalizeBearing(e.bearing,v):v,z="pitch"in e?+e.pitch:w,M="padding"in e?e.padding:u.padding,F=d.P.convert(e.offset);let V=u.centerPoint.add(F);const j=u.pointLocation(V),{center:G,zoom:K}=u.getConstrained(d.N.convert(e.center||j),(l=e.zoom)!==null&&l!==void 0?l:p);this._normalizeCenter(G,u);const Y=u.project(j),Q=u.project(G).sub(Y),U=u.zoomScale(K-p);let ne,oe;e.around&&(ne=d.N.convert(e.around),oe=u.locationPoint(ne));const pe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||K!==p,this._rotating=this._rotating||v!==P,this._pitching=this._pitching||z!==w,this._padding=!u.isPaddingEqual(M),this._easeId=e.easeId,this._prepareEase(s,e.noMoveStart,pe),this.terrain&&this._prepareElevation(G),this._ease(xe=>{if(this._zooming&&(u.zoom=d.y.number(p,K,xe)),this._rotating&&(u.bearing=d.y.number(v,P,xe)),this._pitching&&(u.pitch=d.y.number(w,z,xe)),this._padding&&(u.interpolatePadding(T,M,xe),V=u.centerPoint.add(F)),this.terrain&&!e.freezeElevation&&this._updateElevation(xe),ne)u.setLocationAtPoint(ne,oe);else{const Se=u.zoomScale(u.zoom-p),Re=K>p?Math.min(2,U):Math.max(.5,U),Ve=Math.pow(Re,1-xe),Me=u.unproject(Y.add(Q.mult(xe*Ve)).mult(Se));u.setLocationAtPoint(u.renderWorldCopies?Me.wrap():Me,V)}this._applyUpdatedTransform(u),this._fireMoveEvents(s)},xe=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(s,xe)},e),this}_prepareEase(e,s,l={}){this._moving=!0,s||l.moving||this.fire(new d.k("movestart",e)),this._zooming&&!l.zooming&&this.fire(new d.k("zoomstart",e)),this._rotating&&!l.rotating&&this.fire(new d.k("rotatestart",e)),this._pitching&&!l.pitching&&this.fire(new d.k("pitchstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const s=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&s!==this._elevationTarget){const l=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(l-(s-(l*e+this._elevationStart))/(1-e)),this._elevationTarget=s}this.transform.elevation=d.y.number(this._elevationStart,this._elevationTarget,e)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){const s=e.getCameraPosition(),l=this.terrain.getElevationForLngLatZoom(s.lngLat,e.zoom);if(s.altitude<l){const u=this.calculateCameraOptionsFromTo(s.lngLat,l,e.center,e.elevation);return{pitch:u.pitch,zoom:u.zoom}}return{}}_applyUpdatedTransform(e){const s=[];if(this.terrain&&s.push(u=>this._elevateCameraIfInsideTerrain(u)),this.transformCameraUpdate&&s.push(u=>this.transformCameraUpdate(u)),!s.length)return;const l=e.clone();for(const u of s){const p=l.clone(),{center:v,zoom:w,pitch:T,bearing:P,elevation:z}=u(p);v&&(p.center=v),w!==void 0&&(p.zoom=w),T!==void 0&&(p.pitch=T),P!==void 0&&(p.bearing=P),z!==void 0&&(p.elevation=z),l.apply(p)}this.transform.apply(l)}_fireMoveEvents(e){this.fire(new d.k("move",e)),this._zooming&&this.fire(new d.k("zoom",e)),this._rotating&&this.fire(new d.k("rotate",e)),this._pitching&&this.fire(new d.k("pitch",e))}_afterEase(e,s){if(this._easeId&&s&&this._easeId===s)return;delete this._easeId;const l=this._zooming,u=this._rotating,p=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,l&&this.fire(new d.k("zoomend",e)),u&&this.fire(new d.k("rotateend",e)),p&&this.fire(new d.k("pitchend",e)),this.fire(new d.k("moveend",e))}flyTo(e,s){var l;if(!e.essential&&re.prefersReducedMotion){const Oe=d.M(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Oe,s)}this.stop(),e=d.e({offset:[0,0],speed:1.2,curve:1.42,easing:d.b9},e);const u=this._getTransformForUpdate(),p=u.zoom,v=u.bearing,w=u.pitch,T=u.padding,P="bearing"in e?this._normalizeBearing(e.bearing,v):v,z="pitch"in e?+e.pitch:w,M="padding"in e?e.padding:u.padding,F=d.P.convert(e.offset);let V=u.centerPoint.add(F);const j=u.pointLocation(V),{center:G,zoom:K}=u.getConstrained(d.N.convert(e.center||j),(l=e.zoom)!==null&&l!==void 0?l:p);this._normalizeCenter(G,u);const Y=u.zoomScale(K-p),Q=u.project(j),U=u.project(G).sub(Q);let ne=e.curve;const oe=Math.max(u.width,u.height),pe=oe/Y,xe=U.mag();if("minZoom"in e){const Oe=d.ac(Math.min(e.minZoom,p,K),u.minZoom,u.maxZoom),ot=oe/u.zoomScale(Oe-p);ne=Math.sqrt(ot/xe*2)}const Se=ne*ne;function Re(Oe){const ot=(pe*pe-oe*oe+(Oe?-1:1)*Se*Se*xe*xe)/(2*(Oe?pe:oe)*Se*xe);return Math.log(Math.sqrt(ot*ot+1)-ot)}function Ve(Oe){return(Math.exp(Oe)-Math.exp(-Oe))/2}function Me(Oe){return(Math.exp(Oe)+Math.exp(-Oe))/2}const ze=Re(!1);let We=function(Oe){return Me(ze)/Me(ze+ne*Oe)},lt=function(Oe){return oe*((Me(ze)*(Ve(ot=ze+ne*Oe)/Me(ot))-Ve(ze))/Se)/xe;var ot},De=(Re(!0)-ze)/ne;if(Math.abs(xe)<1e-6||!isFinite(De)){if(Math.abs(oe-pe)<1e-6)return this.easeTo(e,s);const Oe=pe<oe?-1:1;De=Math.abs(Math.log(pe/oe))/ne,lt=()=>0,We=ot=>Math.exp(Oe*ne*ot)}return e.duration="duration"in e?+e.duration:1e3*De/("screenSpeed"in e?+e.screenSpeed/ne:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=v!==P,this._pitching=z!==w,this._padding=!u.isPaddingEqual(M),this._prepareEase(s,!1),this.terrain&&this._prepareElevation(G),this._ease(Oe=>{const ot=Oe*De,Gt=1/We(ot);u.zoom=Oe===1?K:p+u.scaleZoom(Gt),this._rotating&&(u.bearing=d.y.number(v,P,Oe)),this._pitching&&(u.pitch=d.y.number(w,z,Oe)),this._padding&&(u.interpolatePadding(T,M,Oe),V=u.centerPoint.add(F)),this.terrain&&!e.freezeElevation&&this._updateElevation(Oe);const pt=Oe===1?G:u.unproject(Q.add(U.mult(lt(ot))).mult(Gt));u.setLocationAtPoint(u.renderWorldCopies?pt.wrap():pt,V),this._applyUpdatedTransform(u),this._fireMoveEvents(s)},()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(s)},e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,s){var l;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const u=this._onEaseEnd;delete this._onEaseEnd,u.call(this,s)}return e||(l=this.handlers)===null||l===void 0||l.stop(!1),this}_ease(e,s,l){l.animate===!1||l.duration===0?(e(1),s()):(this._easeStart=re.now(),this._easeOptions=l,this._onEaseFrame=e,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,s){e=d.b3(e,-180,180);const l=Math.abs(e-s);return Math.abs(e-360-s)<l&&(e-=360),Math.abs(e+360-s)<l&&(e+=360),e}_normalizeCenter(e,s){if(!s.renderWorldCopies||s.lngRange)return;const l=e.lng-s.center.lng;e.lng+=l>180?-360:l<-180?360:0}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(d.N.convert(e),this.transform.tileZoom)-this.transform.elevation:null}}const ro={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class io{constructor(e=ro){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=s=>{!s||s.sourceDataType!=="metadata"&&s.sourceDataType!=="visibility"&&s.dataType!=="style"&&s.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=q.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=q.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=q.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){q.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,s){const l=this._map._getUIString(`AttributionControl.${s}`);e.title=l,e.setAttribute("aria-label",l)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map(u=>typeof u!="string"?"":u)):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const u=this._map.style.stylesheet;this.styleOwner=u.owner,this.styleId=u.id}const s=this._map.style.sourceCaches;for(const u in s){const p=s[u];if(p.used||p.usedForTerrain){const v=p.getSource();v.attribution&&e.indexOf(v.attribution)<0&&e.push(v.attribution)}}e=e.filter(u=>String(u).trim()),e.sort((u,p)=>u.length-p.length),e=e.filter((u,p)=>{for(let v=p+1;v<e.length;v++)if(e[v].indexOf(u)>=0)return!1;return!0});const l=e.join(" | ");l!==this._attribHTML&&(this._attribHTML=l,e.length?(this._innerContainer.innerHTML=l,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Ou{constructor(e={}){this._updateCompact=()=>{const s=this._container.children;if(s.length){const l=s[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&l.classList.add("maplibregl-compact"):l.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=q.create("div","maplibregl-ctrl");const s=q.create("a","maplibregl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://maplibre.org/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){q.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class wt{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const s=++this._id;return this._queue.push({callback:e,id:s,cancelled:!1}),s}remove(e){const s=this._currentlyRunning,l=s?this._queue.concat(s):this._queue;for(const u of l)if(u.id===e)return void(u.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const s=this._currentlyRunning=this._queue;this._queue=[];for(const l of s)if(!l.cancelled&&(l.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Nu=d.Y([{name:"a_pos3d",type:"Int16",components:3}]);class Bp extends d.E{constructor(e){super(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,e.usedForTerrain=!0,e.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,s){this.sourceCache.update(e,s),this._renderableTilesKeys=[];const l={};for(const u of e.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:s}))l[u.key]=!0,this._renderableTilesKeys.push(u.key),this._tiles[u.key]||(u.posMatrix=new Float64Array(16),d.aP(u.posMatrix,0,d.X,0,d.X,0,1),this._tiles[u.key]=new Gn(u,this.tileSize));for(const u in this._tiles)l[u]||delete this._tiles[u]}freeRtt(e){for(const s in this._tiles){const l=this._tiles[s];(!e||l.tileID.equals(e)||l.tileID.isChildOf(e)||e.isChildOf(l.tileID))&&(l.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(e=>this.getTileByID(e))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e){const s={};for(const l of this._renderableTilesKeys){const u=this._tiles[l].tileID;if(u.canonical.equals(e.canonical)){const p=e.clone();p.posMatrix=new Float64Array(16),d.aP(p.posMatrix,0,d.X,0,d.X,0,1),s[l]=p}else if(u.canonical.isChildOf(e.canonical)){const p=e.clone();p.posMatrix=new Float64Array(16);const v=u.canonical.z-e.canonical.z,w=u.canonical.x-(u.canonical.x>>v<<v),T=u.canonical.y-(u.canonical.y>>v<<v),P=d.X>>v;d.aP(p.posMatrix,0,P,0,P,0,1),d.J(p.posMatrix,p.posMatrix,[-w*P,-T*P,0]),s[l]=p}else if(e.canonical.isChildOf(u.canonical)){const p=e.clone();p.posMatrix=new Float64Array(16);const v=e.canonical.z-u.canonical.z,w=e.canonical.x-(e.canonical.x>>v<<v),T=e.canonical.y-(e.canonical.y>>v<<v),P=d.X>>v;d.aP(p.posMatrix,0,d.X,0,d.X,0,1),d.J(p.posMatrix,p.posMatrix,[w*P,T*P,0]),d.K(p.posMatrix,p.posMatrix,[1/2**v,1/2**v,0]),s[l]=p}}return s}getSourceTile(e,s){const l=this.sourceCache._source;let u=e.overscaledZ-this.deltaZoom;if(u>l.maxzoom&&(u=l.maxzoom),u<l.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(u).key);let p=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!p||!p.dem)&&s)for(;u>=l.minzoom&&(!p||!p.dem);)p=this.sourceCache.getTileByID(e.scaledTo(u--).key);return p}tilesAfterTime(e=Date.now()){return Object.values(this._tiles).filter(s=>s.timeAdded>=e)}}class Vu{constructor(e,s,l){this.painter=e,this.sourceCache=new Bp(s),this.options=l,this.exaggeration=typeof l.exaggeration=="number"?l.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,s,l,u=d.X){var p;if(!(s>=0&&s<u&&l>=0&&l<u))return 0;const v=this.getTerrainData(e),w=(p=v.tile)===null||p===void 0?void 0:p.dem;if(!w)return 0;const T=function(j,G,K){var Y=G[0],Q=G[1];return j[0]=K[0]*Y+K[4]*Q+K[12],j[1]=K[1]*Y+K[5]*Q+K[13],j}([],[s/u*d.X,l/u*d.X],v.u_terrain_matrix),P=[T[0]*w.dim,T[1]*w.dim],z=Math.floor(P[0]),M=Math.floor(P[1]),F=P[0]-z,V=P[1]-M;return w.get(z,M)*(1-F)*(1-V)+w.get(z+1,M)*F*(1-V)+w.get(z,M+1)*(1-F)*V+w.get(z+1,M+1)*F*V}getElevationForLngLatZoom(e,s){if(!d.bb(s,e.wrap()))return 0;const{tileID:l,mercatorX:u,mercatorY:p}=this._getOverscaledTileIDFromLngLatZoom(e,s);return this.getElevation(l,u%d.X,p%d.X,d.X)}getElevation(e,s,l,u=d.X){return this.getDEMElevation(e,s,l,u)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const u=this.painter.context,p=new d.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new _t(u,p,u.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new _t(u,new d.R({width:1,height:1}),u.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(u.gl.NEAREST,u.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=d.an([])}const s=this.sourceCache.getSourceTile(e,!0);if(s&&s.dem&&(!s.demTexture||s.needsTerrainPrepare)){const u=this.painter.context;s.demTexture=this.painter.getTileTexture(s.dem.stride),s.demTexture?s.demTexture.update(s.dem.getPixels(),{premultiply:!1}):s.demTexture=new _t(u,s.dem.getPixels(),u.gl.RGBA,{premultiply:!1}),s.demTexture.bind(u.gl.NEAREST,u.gl.CLAMP_TO_EDGE),s.needsTerrainPrepare=!1}const l=s&&s+s.tileID.key+e.key;if(l&&!this._demMatrixCache[l]){const u=this.sourceCache.sourceCache._source.maxzoom;let p=e.canonical.z-s.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=u?p=e.canonical.z-u:d.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const v=e.canonical.x-(e.canonical.x>>p<<p),w=e.canonical.y-(e.canonical.y>>p<<p),T=d.bc(new Float64Array(16),[1/(d.X<<p),1/(d.X<<p),0]);d.J(T,T,[v*d.X,w*d.X,0]),this._demMatrixCache[e.key]={matrix:T,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:s&&s.dem&&s.dem.dim||1,u_terrain_matrix:l?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:s&&s.dem&&s.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(s&&s.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:s}}getFramebuffer(e){const s=this.painter,l=s.width/devicePixelRatio,u=s.height/devicePixelRatio;return!this._fbo||this._fbo.width===l&&this._fbo.height===u||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new _t(s.context,{width:l,height:u,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new _t(s.context,{width:l,height:u,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=s.context.createFramebuffer(l,u,!0,!1),this._fbo.depthAttachment.set(s.context.createRenderbuffer(s.context.gl.DEPTH_COMPONENT16,l,u))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const s=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let p=0,v=0;p<this._coordsTextureSize;p++)for(let w=0;w<this._coordsTextureSize;w++,v+=4)s[v+0]=255&w,s[v+1]=255&p,s[v+2]=w>>8<<4|p>>8,s[v+3]=0;const l=new d.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(s.buffer)),u=new _t(e,l,e.gl.RGBA,{premultiply:!1});return u.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=u,u}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const s=new Uint8Array(4),l=this.painter.context,u=l.gl,p=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),v=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),w=Math.round(this.painter.height/devicePixelRatio);l.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),u.readPixels(p,w-v-1,1,1,u.RGBA,u.UNSIGNED_BYTE,s),l.bindFramebuffer.set(null);const T=s[0]+(s[2]>>4<<8),P=s[1]+((15&s[2])<<8),z=this.coordsIndex[255-s[3]],M=z&&this.sourceCache.getTileByID(z);if(!M)return null;const F=this._coordsTextureSize,V=(1<<M.tileID.canonical.z)*F;return new d.Z((M.tileID.canonical.x*F+T)/V+M.tileID.wrap,(M.tileID.canonical.y*F+P)/V,this.getElevation(M.tileID,T,P,F))}depthAtPoint(e){const s=new Uint8Array(4),l=this.painter.context,u=l.gl;return l.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),u.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,u.RGBA,u.UNSIGNED_BYTE,s),l.bindFramebuffer.set(null),(s[0]/16777216+s[1]/65536+s[2]/256+s[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const e=this.painter.context,s=new d.bd,l=new d.aY,u=this.meshSize,p=d.X/u,v=u*u;for(let M=0;M<=u;M++)for(let F=0;F<=u;F++)s.emplaceBack(F*p,M*p,0);for(let M=0;M<v;M+=u+1)for(let F=0;F<u;F++)l.emplaceBack(F+M,u+F+M+1,u+F+M+2),l.emplaceBack(F+M,u+F+M+2,F+M+1);const w=s.length,T=w+2*(u+1);for(const M of[0,1])for(let F=0;F<=u;F++)for(const V of[0,1])s.emplaceBack(F*p,M*d.X,V);for(let M=0;M<2*u;M+=2)l.emplaceBack(T+M,T+M+1,T+M+3),l.emplaceBack(T+M,T+M+3,T+M+2),l.emplaceBack(w+M,w+M+3,w+M+1),l.emplaceBack(w+M,w+M+2,w+M+3);const P=s.length,z=P+2*(u+1);for(const M of[0,1])for(let F=0;F<=u;F++)for(const V of[0,1])s.emplaceBack(M*d.X,F*p,V);for(let M=0;M<2*u;M+=2)l.emplaceBack(P+M,P+M+1,P+M+3),l.emplaceBack(P+M,P+M+3,P+M+2),l.emplaceBack(z+M,z+M+3,z+M+1),l.emplaceBack(z+M,z+M+2,z+M+3);return this._mesh=new Ha(e.createVertexBuffer(s,Nu.members),e.createIndexBuffer(l),d.a0.simpleSegment(0,0,s.length,l.length)),this._mesh}getMeshFrameDelta(e){return 2*Math.PI*d.be/Math.pow(2,e)/5}getMinTileElevationForLngLatZoom(e,s){var l;const{tileID:u}=this._getOverscaledTileIDFromLngLatZoom(e,s);return(l=this.getMinMaxElevation(u).minElevation)!==null&&l!==void 0?l:0}getMinMaxElevation(e){const s=this.getTerrainData(e).tile,l={minElevation:null,maxElevation:null};return s&&s.dem&&(l.minElevation=s.dem.min*this.exaggeration,l.maxElevation=s.dem.max*this.exaggeration),l}_getOverscaledTileIDFromLngLatZoom(e,s){const l=d.Z.fromLngLat(e.wrap()),u=(1<<s)*d.X,p=l.x*u,v=l.y*u,w=Math.floor(p/d.X),T=Math.floor(v/d.X);return{tileID:new d.S(s,0,s,w,T),mercatorX:p,mercatorY:v}}}class Op{constructor(e,s,l){this._context=e,this._size=s,this._tileSize=l,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const s=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),l=new _t(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return l.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),s.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),s.colorAttachment.set(l.texture),{id:e,fbo:s,texture:l,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(s=>e.id!==s),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const s of this._recentlyUsed)if(!this._objects[s].inUse)return this._objects[s];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(e=>!e.inUse)===!1}}const no={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Ph{constructor(e,s){this.painter=e,this.terrain=s,this.pool=new Op(e.context,30,s.sourceCache.tileSize*s.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,s){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter(l=>!e._layers[l].isHidden(s)),this._coordsDescendingInv={};for(const l in e.sourceCaches){this._coordsDescendingInv[l]={};const u=e.sourceCaches[l].getVisibleCoordinates();for(const p of u){const v=this.terrain.sourceCache.getTerrainCoords(p);for(const w in v)this._coordsDescendingInv[l][w]||(this._coordsDescendingInv[l][w]=[]),this._coordsDescendingInv[l][w].push(v[w])}}this._coordsDescendingInvStr={};for(const l of e._order){const u=e._layers[l],p=u.source;if(no[u.type]&&!this._coordsDescendingInvStr[p]){this._coordsDescendingInvStr[p]={};for(const v in this._coordsDescendingInv[p])this._coordsDescendingInvStr[p][v]=this._coordsDescendingInv[p][v].map(w=>w.key).sort().join()}}for(const l of this._renderableTiles)for(const u in this._coordsDescendingInvStr){const p=this._coordsDescendingInvStr[u][l.tileID.key];p&&p!==l.rttCoords[u]&&(l.rtt=[])}}renderLayer(e){if(e.isHidden(this.painter.transform.zoom))return!1;const s=e.type,l=this.painter,u=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(no[s]&&(this._prevType&&no[this._prevType]||this._stacks.push([]),this._prevType=s,this._stacks[this._stacks.length-1].push(e.id),!u))return!0;if(no[this._prevType]||no[s]&&u){this._prevType=s;const p=this._stacks.length-1,v=this._stacks[p]||[];for(const w of this._renderableTiles){if(this.pool.isFull()&&(xh(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(w),w.rtt[p]){const P=this.pool.getObjectForId(w.rtt[p].id);if(P.stamp===w.rtt[p].stamp){this.pool.useObject(P);continue}}const T=this.pool.getOrCreateFreeObject();this.pool.useObject(T),this.pool.stampObject(T),w.rtt[p]={id:T.id,stamp:T.stamp},l.context.bindFramebuffer.set(T.fbo.framebuffer),l.context.clear({color:d.aM.transparent,stencil:0}),l.currentStencilSource=void 0;for(let P=0;P<v.length;P++){const z=l.style._layers[v[P]],M=z.source?this._coordsDescendingInv[z.source][w.tileID.key]:[w.tileID];l.context.viewport.set([0,0,T.fbo.width,T.fbo.height]),l._renderTileClippingMasks(z,M),l.renderLayer(l,l.style.sourceCaches[z.source],z,M),z.source&&(w.rttCoords[z.source]=this._coordsDescendingInvStr[z.source][w.tileID.key])}}return xh(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),no[s]}return!1}}const ju={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Ch=H,Np={hash:!1,interactive:!0,bearingSnap:7,attributionControl:ro,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,refreshExpiredTiles:!0,scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:d.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},Uu=f=>{f.touchstart=f.dragStart,f.touchmoveWindow=f.dragMove,f.touchend=f.dragEnd},Vp={showCompass:!0,showZoom:!0,visualizePitch:!1};class jp{constructor(e,s,l=!1){this.mousedown=v=>{this.startMouse(d.e({},v,{ctrlKey:!0,preventDefault:()=>v.preventDefault()}),q.mousePos(this.element,v)),q.addEventListener(window,"mousemove",this.mousemove),q.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=v=>{this.moveMouse(v,q.mousePos(this.element,v))},this.mouseup=v=>{this.mouseRotate.dragEnd(v),this.mousePitch&&this.mousePitch.dragEnd(v),this.offTemp()},this.touchstart=v=>{v.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=q.touchPos(this.element,v.targetTouches)[0],this.startTouch(v,this._startPos),q.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),q.addEventListener(window,"touchend",this.touchend))},this.touchmove=v=>{v.targetTouches.length!==1?this.reset():(this._lastPos=q.touchPos(this.element,v.targetTouches)[0],this.moveTouch(v,this._lastPos))},this.touchend=v=>{v.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const u=e.dragRotate._mouseRotate.getClickTolerance(),p=e.dragRotate._mousePitch.getClickTolerance();this.element=s,this.mouseRotate=Cu({clickTolerance:u,enable:!0}),this.touchRotate=(({enable:v,clickTolerance:w,bearingDegreesPerPixelMoved:T=.8})=>{const P=new Pu;return new Mn({clickTolerance:w,move:(z,M)=>({bearingDelta:(M.x-z.x)*T}),moveStateManager:P,enable:v,assignEvents:Uu})})({clickTolerance:u,enable:!0}),this.map=e,l&&(this.mousePitch=zu({clickTolerance:p,enable:!0}),this.touchPitch=(({enable:v,clickTolerance:w,pitchDegreesPerPixelMoved:T=-.5})=>{const P=new Pu;return new Mn({clickTolerance:w,move:(z,M)=>({pitchDelta:(M.y-z.y)*T}),moveStateManager:P,enable:v,assignEvents:Uu})})({clickTolerance:p,enable:!0})),q.addEventListener(s,"mousedown",this.mousedown),q.addEventListener(s,"touchstart",this.touchstart,{passive:!1}),q.addEventListener(s,"touchcancel",this.reset)}startMouse(e,s){this.mouseRotate.dragStart(e,s),this.mousePitch&&this.mousePitch.dragStart(e,s),q.disableDrag()}startTouch(e,s){this.touchRotate.dragStart(e,s),this.touchPitch&&this.touchPitch.dragStart(e,s),q.disableDrag()}moveMouse(e,s){const l=this.map,{bearingDelta:u}=this.mouseRotate.dragMove(e,s)||{};if(u&&l.setBearing(l.getBearing()+u),this.mousePitch){const{pitchDelta:p}=this.mousePitch.dragMove(e,s)||{};p&&l.setPitch(l.getPitch()+p)}}moveTouch(e,s){const l=this.map,{bearingDelta:u}=this.touchRotate.dragMove(e,s)||{};if(u&&l.setBearing(l.getBearing()+u),this.touchPitch){const{pitchDelta:p}=this.touchPitch.dragMove(e,s)||{};p&&l.setPitch(l.getPitch()+p)}}off(){const e=this.element;q.removeEventListener(e,"mousedown",this.mousedown),q.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),q.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),q.removeEventListener(window,"touchend",this.touchend),q.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){q.enableDrag(),q.removeEventListener(window,"mousemove",this.mousemove),q.removeEventListener(window,"mouseup",this.mouseup),q.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),q.removeEventListener(window,"touchend",this.touchend)}}let yi;function qt(f,e,s){const l=new d.N(f.lng,f.lat);if(f=new d.N(f.lng,f.lat),e){const u=new d.N(f.lng-360,f.lat),p=new d.N(f.lng+360,f.lat),v=s.locationPoint(f).distSqr(e);s.locationPoint(u).distSqr(e)<v?f=u:s.locationPoint(p).distSqr(e)<v&&(f=p)}for(;Math.abs(f.lng-s.center.lng)>180;){const u=s.locationPoint(f);if(u.x>=0&&u.y>=0&&u.x<=s.width&&u.y<=s.height)break;f.lng>s.center.lng?f.lng-=360:f.lng+=360}return f.lng!==l.lng&&s.locationPoint(f).y>s.height/2-s.getHorizon()?f:l}const so={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function nl(f,e,s){const l=f.classList;for(const u in so)l.remove(`maplibregl-${s}-anchor-${u}`);l.add(`maplibregl-${s}-anchor-${e}`)}class sl extends d.E{constructor(e){if(super(),this._onKeyPress=s=>{const l=s.code,u=s.charCode||s.keyCode;l!=="Space"&&l!=="Enter"&&u!==32&&u!==13||this.togglePopup()},this._onMapClick=s=>{const l=s.originalEvent.target,u=this._element;this._popup&&(l===u||u.contains(l))&&this.togglePopup()},this._update=s=>{var l;if(!this._map)return;const u=this._map.loaded()&&!this._map.isMoving();((s==null?void 0:s.type)==="terrain"||(s==null?void 0:s.type)==="render"&&!u)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?qt(this._lngLat,this._flatPos,this._map.transform):(l=this._lngLat)===null||l===void 0?void 0:l.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let p="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?p=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(p=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let v="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?v="rotateX(0deg)":this._pitchAlignment==="map"&&(v=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||s&&s.type!=="moveend"||(this._pos=this._pos.round()),q.setTransform(this._element,`${so[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${v} ${p}`),re.frameAsync(new AbortController).then(()=>{this._updateOpacity(s&&s.type==="moveend")}).catch(()=>{})},this._onMove=s=>{if(!this._isDragging){const l=this._clickTolerance||this._map._clickTolerance;this._isDragging=s.point.dist(this._pointerdownPos)>=l}this._isDragging&&(this._pos=s.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new d.k("dragstart"))),this.fire(new d.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new d.k("dragend")),this._state="inactive"},this._addDragHandler=s=>{this._element.contains(s.originalEvent.target)&&(s.preventDefault(),this._positionDelta=s.point.sub(this._pos).add(this._offset),this._pointerdownPos=s.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(e==null?void 0:e.opacity,e==null?void 0:e.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=d.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=q.create("div");const s=q.createNS("http://www.w3.org/2000/svg","svg"),l=41,u=27;s.setAttributeNS(null,"display","block"),s.setAttributeNS(null,"height",`${l}px`),s.setAttributeNS(null,"width",`${u}px`),s.setAttributeNS(null,"viewBox",`0 0 ${u} ${l}`);const p=q.createNS("http://www.w3.org/2000/svg","g");p.setAttributeNS(null,"stroke","none"),p.setAttributeNS(null,"stroke-width","1"),p.setAttributeNS(null,"fill","none"),p.setAttributeNS(null,"fill-rule","evenodd");const v=q.createNS("http://www.w3.org/2000/svg","g");v.setAttributeNS(null,"fill-rule","nonzero");const w=q.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"transform","translate(3.0, 29.0)"),w.setAttributeNS(null,"fill","#000000");const T=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Y of T){const Q=q.createNS("http://www.w3.org/2000/svg","ellipse");Q.setAttributeNS(null,"opacity","0.04"),Q.setAttributeNS(null,"cx","10.5"),Q.setAttributeNS(null,"cy","5.80029008"),Q.setAttributeNS(null,"rx",Y.rx),Q.setAttributeNS(null,"ry",Y.ry),w.appendChild(Q)}const P=q.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"fill",this._color);const z=q.createNS("http://www.w3.org/2000/svg","path");z.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),P.appendChild(z);const M=q.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"opacity","0.25"),M.setAttributeNS(null,"fill","#000000");const F=q.createNS("http://www.w3.org/2000/svg","path");F.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),M.appendChild(F);const V=q.createNS("http://www.w3.org/2000/svg","g");V.setAttributeNS(null,"transform","translate(6.0, 7.0)"),V.setAttributeNS(null,"fill","#FFFFFF");const j=q.createNS("http://www.w3.org/2000/svg","g");j.setAttributeNS(null,"transform","translate(8.0, 8.0)");const G=q.createNS("http://www.w3.org/2000/svg","circle");G.setAttributeNS(null,"fill","#000000"),G.setAttributeNS(null,"opacity","0.25"),G.setAttributeNS(null,"cx","5.5"),G.setAttributeNS(null,"cy","5.5"),G.setAttributeNS(null,"r","5.4999962");const K=q.createNS("http://www.w3.org/2000/svg","circle");K.setAttributeNS(null,"fill","#FFFFFF"),K.setAttributeNS(null,"cx","5.5"),K.setAttributeNS(null,"cy","5.5"),K.setAttributeNS(null,"r","5.4999962"),j.appendChild(G),j.appendChild(K),v.appendChild(w),v.appendChild(P),v.appendChild(M),v.appendChild(V),v.appendChild(j),s.appendChild(v),s.setAttributeNS(null,"height",l*this._scale+"px"),s.setAttributeNS(null,"width",u*this._scale+"px"),this._element.appendChild(s),this._offset=d.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",s=>{s.preventDefault()}),this._element.addEventListener("mousedown",s=>{s.preventDefault()}),nl(this._element,this._anchor,"marker"),e&&e.className)for(const s of e.className.split(" "))this._element.classList.add(s);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),q.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=d.N.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const u=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[u,-1*(38.1-13.5+u)],"bottom-right":[-u,-1*(38.1-13.5+u)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var s,l;if(!(!((s=this._map)===null||s===void 0)&&s.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const u=this._map,p=u.terrain.depthAtPoint(this._pos),v=u.terrain.getElevationForLngLatZoom(this._lngLat,u.transform.tileZoom);if(u.transform.lngLatToCameraDepth(this._lngLat,v)-p<.006)return void(this._element.style.opacity=this._opacity);const w=-this._offset.y/u.transform._pixelPerMeter,T=Math.sin(u.getPitch()*Math.PI/180)*w,P=u.terrain.depthAtPoint(new d.P(this._pos.x,this._pos.y-this._offset.y)),z=u.transform.lngLatToCameraDepth(this._lngLat,v+T)-P>.006;!((l=this._popup)===null||l===void 0)&&l.isOpen()&&z&&this._popup.remove(),this._element.style.opacity=z?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=d.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,s){return e===void 0&&s===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),s!==void 0&&(this._opacityWhenCovered=s),this._map&&this._updateOpacity(!0),this}}const zh={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let oa=0,aa=!1;const _n={maxWidth:100,unit:"metric"};function la(f,e,s){const l=s&&s.maxWidth||100,u=f._container.clientHeight/2,p=f.unproject([0,u]),v=f.unproject([l,u]),w=p.distanceTo(v);if(s&&s.unit==="imperial"){const T=3.2808*w;T>5280?He(e,l,T/5280,f._getUIString("ScaleControl.Miles")):He(e,l,T,f._getUIString("ScaleControl.Feet"))}else s&&s.unit==="nautical"?He(e,l,w/1852,f._getUIString("ScaleControl.NauticalMiles")):w>=1e3?He(e,l,w/1e3,f._getUIString("ScaleControl.Kilometers")):He(e,l,w,f._getUIString("ScaleControl.Meters"))}function He(f,e,s,l){const u=function(p){const v=Math.pow(10,`${Math.floor(p)}`.length-1);let w=p/v;return w=w>=10?10:w>=5?5:w>=3?3:w>=2?2:w>=1?1:function(T){const P=Math.pow(10,Math.ceil(-Math.log(T)/Math.LN10));return Math.round(T*P)/P}(w),v*w}(s);f.style.width=e*(u/s)+"px",f.innerHTML=`${u}&nbsp;${l}`}const nt={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},ol=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function al(f){if(f){if(typeof f=="number"){const e=Math.round(Math.abs(f)/Math.SQRT2);return{center:new d.P(0,0),top:new d.P(0,f),"top-left":new d.P(e,e),"top-right":new d.P(-e,e),bottom:new d.P(0,-f),"bottom-left":new d.P(e,-e),"bottom-right":new d.P(-e,-e),left:new d.P(f,0),right:new d.P(-f,0)}}if(f instanceof d.P||Array.isArray(f)){const e=d.P.convert(f);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:d.P.convert(f.center||[0,0]),top:d.P.convert(f.top||[0,0]),"top-left":d.P.convert(f["top-left"]||[0,0]),"top-right":d.P.convert(f["top-right"]||[0,0]),bottom:d.P.convert(f.bottom||[0,0]),"bottom-left":d.P.convert(f["bottom-left"]||[0,0]),"bottom-right":d.P.convert(f["bottom-right"]||[0,0]),left:d.P.convert(f.left||[0,0]),right:d.P.convert(f.right||[0,0])}}return al(new d.P(0,0))}const $u=H;S.AJAXError=d.bh,S.Evented=d.E,S.LngLat=d.N,S.MercatorCoordinate=d.Z,S.Point=d.P,S.addProtocol=d.bi,S.config=d.a,S.removeProtocol=d.bj,S.AttributionControl=io,S.BoxZoomHandler=_i,S.CanvasSource=Ii,S.CooperativeGesturesHandler=to,S.DoubleClickZoomHandler=ws,S.DragPanHandler=kh,S.DragRotateHandler=Ih,S.EdgeInsets=Js,S.FullscreenControl=class extends d.E{constructor(f={}){super(),this._onFullscreenChange=()=>{var e;let s=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=s==null?void 0:s.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)s=s.shadowRoot.fullscreenElement;s===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,f&&f.container&&(f.container instanceof HTMLElement?this._container=f.container:d.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=q.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){q.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const f=this._fullscreenButton=q.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);q.create("span","maplibregl-ctrl-icon",f).setAttribute("aria-hidden","true"),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.title=f}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new d.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new d.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},S.GeoJSONSource=jo,S.GeolocateControl=class extends d.E{constructor(f){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new d.k("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new d.k("geolocate",e)),this._finish()}},this._updateCamera=e=>{const s=new d.N(e.coords.longitude,e.coords.latitude),l=e.coords.accuracy,u=this._map.getBearing(),p=d.e({bearing:u},this.options.fitBoundsOptions),v=me.fromLngLat(s,l);this._map.fitBounds(v,p,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const s=new d.N(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(s).addTo(this._map),this._userLocationDotMarker.setLngLat(s).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(this.options.trackUserLocation)if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&aa)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new d.k("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=q.create("button","maplibregl-ctrl-geolocate",this._container),q.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){d.w("Geolocation support is not available so the GeolocateControl will be disabled.");const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}else{const s=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=q.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new sl({element:this._dotElement}),this._circleElement=q.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new sl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",s=>{s.geolocateSource||this._watchState!=="ACTIVE_LOCK"||s.originalEvent&&s.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new d.k("trackuserlocationend")),this.fire(new d.k("userlocationlostfocus")))})}},this.options=d.e({},zh,f)}onAdd(f){return this._map=f,this._container=q.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return d._(this,arguments,void 0,function*(e=!1){if(yi!==void 0&&!e)return yi;if(window.navigator.permissions===void 0)return yi=!!window.navigator.geolocation,yi;try{yi=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{yi=!!window.navigator.geolocation}return yi})}().then(e=>this._finishSetupUI(e)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),q.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,oa=0,aa=!1}_isOutOfMapMaxBounds(f){const e=this._map.getMaxBounds(),s=f.coords;return e&&(s.longitude<e.getWest()||s.longitude>e.getEast()||s.latitude<e.getSouth()||s.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const f=this._map.getBounds(),e=f.getSouthEast(),s=f.getNorthEast(),l=e.distanceTo(s),u=Math.ceil(this._accuracy/(l/this._map._container.clientHeight)*2);this._circleElement.style.width=`${u}px`,this._circleElement.style.height=`${u}px`}trigger(){if(!this._setup)return d.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new d.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":oa--,aa=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new d.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new d.k("trackuserlocationstart")),this.fire(new d.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let f;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),oa++,oa>1?(f={maximumAge:6e5,timeout:0},aa=!0):(f=this.options.positionOptions,aa=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,f)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},S.Hash=Xa,S.ImageSource=Pn,S.KeyboardHandler=Ci,S.LngLatBounds=me,S.LogoControl=Ou,S.Map=class extends Eh{constructor(f){d.bf.mark(d.bg.create);const e=Object.assign(Object.assign({},Np),f);if(e.minZoom!=null&&e.maxZoom!=null&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(e.minPitch!=null&&e.maxPitch!=null&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(e.minPitch!=null&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(e.maxPitch!=null&&e.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Qs(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies),{bearingSnap:e.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new wt,this._controls=[],this._mapId=d.a4(),this._contextLost=s=>{s.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new d.k("webglcontextlost",{originalEvent:s}))},this._contextRestored=s=>{this._setupPainter(),this.resize(),this._update(),this.fire(new d.k("webglcontextrestored",{originalEvent:s}))},this._onMapScroll=s=>{if(s.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=e.interactive,this._maxTileCacheSize=e.maxTileCacheSize,this._maxTileCacheZoomLevels=e.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat===!0,this._preserveDrawingBuffer=e.preserveDrawingBuffer===!0,this._antialias=e.antialias===!0,this._trackResize=e.trackResize===!0,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles===!0,this._fadeDuration=e.fadeDuration,this._crossSourceCollisions=e.crossSourceCollisions===!0,this._collectResourceTiming=e.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},ju),e.locale),this._clickTolerance=e.clickTolerance,this._overridePixelRatio=e.pixelRatio,this._maxCanvasSize=e.maxCanvasSize,this.transformCameraUpdate=e.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=e.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=de.addThrottleControl(()=>this.isMoving()),this._requestManager=new Te(e.transformRequest),typeof e.container=="string"){if(this._container=document.getElementById(e.container),!this._container)throw new Error(`Container '${e.container}' not found.`)}else{if(!(e.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(e.maxBounds&&this.setMaxBounds(e.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)).on("moveend",()=>this._update(!1)).on("zoom",()=>this._update(!0)).on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}).once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let s=!1;const l=ea(u=>{this._trackResize&&!this._removed&&(this.resize(u),this.redraw())},50);this._resizeObserver=new ResizeObserver(u=>{s?l(u):s=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Bu(this,e),this._hash=e.hash&&new Xa(typeof e.hash=="string"&&e.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(this.resize(),this.fitBounds(e.bounds,d.e({},e.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=e.localIdeographFontFamily,this._validateStyle=e.validateStyle,e.style&&this.setStyle(e.style,{localIdeographFontFamily:e.localIdeographFontFamily}),e.attributionControl&&this.addControl(new io(typeof e.attributionControl=="boolean"?void 0:e.attributionControl)),e.maplibreLogo&&this.addControl(new Ou,e.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",s=>{this._update(s.dataType==="style"),this.fire(new d.k(`${s.dataType}data`,s))}),this.on("dataloading",s=>{this.fire(new d.k(`${s.dataType}dataloading`,s))}),this.on("dataabort",s=>{this.fire(new d.k("sourcedataabort",s))})}_getMapId(){return this._mapId}addControl(f,e){if(e===void 0&&(e=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new d.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const s=f.onAdd(this);this._controls.push(f);const l=this._controlPositions[e];return e.indexOf("bottom")!==-1?l.insertBefore(s,l.firstChild):l.appendChild(s),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new d.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(f);return e>-1&&this._controls.splice(e,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}calculateCameraOptionsFromTo(f,e,s,l){return l==null&&this.terrain&&(l=this.terrain.getElevationForLngLatZoom(s,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(f,e,s,l)}resize(f){var e;const s=this._containerDimensions(),l=s[0],u=s[1],p=this._getClampedPixelRatio(l,u);if(this._resizeCanvas(l,u,p),this.painter.resize(l,u,p),this.painter.overLimit()){const w=this.painter.context.gl;this._maxCanvasSize=[w.drawingBufferWidth,w.drawingBufferHeight];const T=this._getClampedPixelRatio(l,u);this._resizeCanvas(l,u,T),this.painter.resize(l,u,T)}this.transform.resize(l,u),(e=this._requestedCameraState)===null||e===void 0||e.resize(l,u);const v=!this._moving;return v&&(this.stop(),this.fire(new d.k("movestart",f)).fire(new d.k("move",f))),this.fire(new d.k("resize",f)),v&&this.fire(new d.k("moveend",f)),this}_getClampedPixelRatio(f,e){const{0:s,1:l}=this._maxCanvasSize,u=this.getPixelRatio(),p=f*u,v=e*u;return Math.min(p>s?s/p:1,v>l?l/v:1)*u}getPixelRatio(){var f;return(f=this._overridePixelRatio)!==null&&f!==void 0?f:devicePixelRatio}setPixelRatio(f){this._overridePixelRatio=f,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(f){return this.transform.setMaxBounds(me.convert(f)),this._update()}setMinZoom(f){if((f=f??-2)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f&&this.setZoom(f),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=f??22)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f&&this.setZoom(f),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=f??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f&&this.setPitch(f),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=f??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f&&this.setPitch(f),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this._update()}project(f){return this.transform.locationPoint(d.N.convert(f),this.style&&this.terrain)}unproject(f){return this.transform.pointLocation(d.P.convert(f),this.terrain)}isMoving(){var f;return this._moving||((f=this.handlers)===null||f===void 0?void 0:f.isMoving())}isZooming(){var f;return this._zooming||((f=this.handlers)===null||f===void 0?void 0:f.isZooming())}isRotating(){var f;return this._rotating||((f=this.handlers)===null||f===void 0?void 0:f.isRotating())}_createDelegatedListener(f,e,s){if(f==="mouseenter"||f==="mouseover"){let l=!1;return{layers:e,listener:s,delegates:{mousemove:p=>{const v=e.filter(T=>this.getLayer(T)),w=v.length!==0?this.queryRenderedFeatures(p.point,{layers:v}):[];w.length?l||(l=!0,s.call(this,new Ar(f,this,p.originalEvent,{features:w}))):l=!1},mouseout:()=>{l=!1}}}}if(f==="mouseleave"||f==="mouseout"){let l=!1;return{layers:e,listener:s,delegates:{mousemove:v=>{const w=e.filter(T=>this.getLayer(T));(w.length!==0?this.queryRenderedFeatures(v.point,{layers:w}):[]).length?l=!0:l&&(l=!1,s.call(this,new Ar(f,this,v.originalEvent)))},mouseout:v=>{l&&(l=!1,s.call(this,new Ar(f,this,v.originalEvent)))}}}}{const l=u=>{const p=e.filter(w=>this.getLayer(w)),v=p.length!==0?this.queryRenderedFeatures(u.point,{layers:p}):[];v.length&&(u.features=v,s.call(this,u),delete u.features)};return{layers:e,listener:s,delegates:{[f]:l}}}}_saveDelegatedListener(f,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(e)}_removeDelegatedListener(f,e,s){if(!this._delegatedListeners||!this._delegatedListeners[f])return;const l=this._delegatedListeners[f];for(let u=0;u<l.length;u++){const p=l[u];if(p.listener===s&&p.layers.length===e.length&&p.layers.every(v=>e.includes(v))){for(const v in p.delegates)this.off(v,p.delegates[v]);return void l.splice(u,1)}}}on(f,e,s){if(s===void 0)return super.on(f,e);const l=this._createDelegatedListener(f,typeof e=="string"?[e]:e,s);this._saveDelegatedListener(f,l);for(const u in l.delegates)this.on(u,l.delegates[u]);return this}once(f,e,s){if(s===void 0)return super.once(f,e);const l=typeof e=="string"?[e]:e,u=this._createDelegatedListener(f,l,s);for(const p in u.delegates){const v=u.delegates[p];u.delegates[p]=(...w)=>{this._removeDelegatedListener(f,l,s),v(...w)}}this._saveDelegatedListener(f,u);for(const p in u.delegates)this.once(p,u.delegates[p]);return this}off(f,e,s){return s===void 0?super.off(f,e):(this._removeDelegatedListener(f,typeof e=="string"?[e]:e,s),this)}queryRenderedFeatures(f,e){if(!this.style)return[];let s;const l=f instanceof d.P||Array.isArray(f),u=l?f:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(l?{}:f)||{},u instanceof d.P||typeof u[0]=="number")s=[d.P.convert(u)];else{const p=d.P.convert(u[0]),v=d.P.convert(u[1]);s=[p,new d.P(v.x,p.y),v,new d.P(p.x,v.y),p]}return this.style.queryRenderedFeatures(s,e,this.transform)}querySourceFeatures(f,e){return this.style.querySourceFeatures(f,e)}setStyle(f,e){return(e=d.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&f?(this._diffStyle(f,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(f,e))}setTransformRequest(f){return this._requestManager.setTransformRequest(f),this}_getUIString(f){const e=this._locale[f];if(e==null)throw new Error(`Missing UI string '${f}'`);return e}_updateStyle(f,e){if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(f,e));const s=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!f)),f?(this.style=new Aa(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof f=="string"?this.style.loadURL(f,e,s):this.style.loadJSON(f,e,s),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Aa(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(f,e){if(typeof f=="string"){const s=this._requestManager.transformRequest(f,"Style");d.h(s,new AbortController).then(l=>{this._updateDiff(l.data,e)}).catch(l=>{l&&this.fire(new d.j(l))})}else typeof f=="object"&&this._updateDiff(f,e)}_updateDiff(f,e){try{this.style.setState(f,e)&&this._update(!0)}catch(s){d.w(`Unable to perform style diff: ${s.message||s.error||s}.  Rebuilding the style from scratch.`),this._updateStyle(f,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():d.w("There is no style added to the map.")}addSource(f,e){return this._lazyInitEmptyStyle(),this.style.addSource(f,e),this._update(!0)}isSourceLoaded(f){const e=this.style&&this.style.sourceCaches[f];if(e!==void 0)return e.loaded();this.fire(new d.j(new Error(`There is no source with ID '${f}'`)))}setTerrain(f){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),f){const e=this.style.sourceCaches[f.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${f.source}`);this.terrain===null&&e.reload();for(const s in this.style._layers){const l=this.style._layers[s];l.type==="hillshade"&&l.source===f.source&&d.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Vu(this.painter,e,f),this.painter.renderToTexture=new Ph(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=s=>{s.dataType==="style"?this.terrain.sourceCache.freeRtt():s.dataType==="source"&&s.tile&&(s.sourceId!==f.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(s.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new d.k("terrain",{terrain:f})),this}getTerrain(){var f,e;return(e=(f=this.terrain)===null||f===void 0?void 0:f.options)!==null&&e!==void 0?e:null}areTilesLoaded(){const f=this.style&&this.style.sourceCaches;for(const e in f){const s=f[e]._tiles;for(const l in s){const u=s[l];if(u.state!=="loaded"&&u.state!=="errored")return!1}}return!0}removeSource(f){return this.style.removeSource(f),this._update(!0)}getSource(f){return this.style.getSource(f)}addImage(f,e,s={}){const{pixelRatio:l=1,sdf:u=!1,stretchX:p,stretchY:v,content:w,textFitWidth:T,textFitHeight:P}=s;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||d.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new d.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:z,height:M,data:F}=e,V=e;return this.style.addImage(f,{data:new d.R({width:z,height:M},new Uint8Array(F)),pixelRatio:l,stretchX:p,stretchY:v,content:w,textFitWidth:T,textFitHeight:P,sdf:u,version:0,userImage:V}),V.onAdd&&V.onAdd(this,f),this}}{const{width:z,height:M,data:F}=re.getImageData(e);this.style.addImage(f,{data:new d.R({width:z,height:M},F),pixelRatio:l,stretchX:p,stretchY:v,content:w,textFitWidth:T,textFitHeight:P,sdf:u,version:0})}}updateImage(f,e){const s=this.style.getImage(f);if(!s)return this.fire(new d.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const l=e instanceof HTMLImageElement||d.b(e)?re.getImageData(e):e,{width:u,height:p,data:v}=l;if(u===void 0||p===void 0)return this.fire(new d.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(u!==s.data.width||p!==s.data.height)return this.fire(new d.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const w=!(e instanceof HTMLImageElement||d.b(e));return s.data.replace(v,w),this.style.updateImage(f,s),this}getImage(f){return this.style.getImage(f)}hasImage(f){return f?!!this.style.getImage(f):(this.fire(new d.j(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(f)}loadImage(f){return de.getImage(this._requestManager.transformRequest(f,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(f,e){return this._lazyInitEmptyStyle(),this.style.addLayer(f,e),this._update(!0)}moveLayer(f,e){return this.style.moveLayer(f,e),this._update(!0)}removeLayer(f){return this.style.removeLayer(f),this._update(!0)}getLayer(f){return this.style.getLayer(f)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(f,e,s){return this.style.setLayerZoomRange(f,e,s),this._update(!0)}setFilter(f,e,s={}){return this.style.setFilter(f,e,s),this._update(!0)}getFilter(f){return this.style.getFilter(f)}setPaintProperty(f,e,s,l={}){return this.style.setPaintProperty(f,e,s,l),this._update(!0)}getPaintProperty(f,e){return this.style.getPaintProperty(f,e)}setLayoutProperty(f,e,s,l={}){return this.style.setLayoutProperty(f,e,s,l),this._update(!0)}getLayoutProperty(f,e){return this.style.getLayoutProperty(f,e)}setGlyphs(f,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(f,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(f,e,s={}){return this._lazyInitEmptyStyle(),this.style.addSprite(f,e,s,l=>{l||this._update(!0)}),this}removeSprite(f){return this._lazyInitEmptyStyle(),this.style.removeSprite(f),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(f,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(f,e,s=>{s||this._update(!0)}),this}setLight(f,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(f,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(f){return this._lazyInitEmptyStyle(),this.style.setSky(f),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(f,e){return this.style.setFeatureState(f,e),this._update()}removeFeatureState(f,e){return this.style.removeFeatureState(f,e),this._update()}getFeatureState(f){return this.style.getFeatureState(f)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let f=0,e=0;return this._container&&(f=this._container.clientWidth||400,e=this._container.clientHeight||300),[f,e]}_setupContainer(){const f=this._container;f.classList.add("maplibregl-map");const e=this._canvasContainer=q.create("div","maplibregl-canvas-container",f);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=q.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const s=this._containerDimensions(),l=this._getClampedPixelRatio(s[0],s[1]);this._resizeCanvas(s[0],s[1],l);const u=this._controlContainer=q.create("div","maplibregl-control-container",f),p=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(v=>{p[v]=q.create("div",`maplibregl-ctrl-${v} `,u)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(f,e,s){this._canvas.width=Math.floor(s*f),this._canvas.height=Math.floor(s*e),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const f={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let e=null;this._canvas.addEventListener("webglcontextcreationerror",l=>{e={requestedAttributes:f},l&&(e.statusMessage=l.statusMessage,e.type=l.type)},{once:!0});const s=this._canvas.getContext("webgl2",f)||this._canvas.getContext("webgl",f);if(!s){const l="Failed to initialize WebGL";throw e?(e.message=l,new Error(JSON.stringify(e))):new Error(l)}this.painter=new Wa(s,this.transform),ke.testSupport(s)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(f){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_render(f){const e=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(f),this._removed)return;let s=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const u=this.transform.zoom,p=re.now();this.style.zoomHistory.update(u,p);const v=new d.z(u,{now:p,fadeDuration:e,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),w=v.crossFadingFactor();w===1&&w===this._crossFadingFactor||(s=!0,this._crossFadingFactor=w),this.style.update(v)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,e,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:e,showPadding:this.showPadding}),this.fire(new d.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,d.bf.mark(d.bg.load),this.fire(new d.k("load"))),this.style&&(this.style.hasTransitions()||s)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const l=this._sourcesDirty||this._styleDirty||this._placementDirty;return l||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new d.k("idle")),!this._loaded||this._fullyLoaded||l||(this._fullyLoaded=!0,d.bf.mark(d.bg.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var f;this._hash&&this._hash.remove();for(const s of this._controls)s.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),de.removeThrottleControl(this._imageQueueHandle),(f=this._resizeObserver)===null||f===void 0||f.disconnect();const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e!=null&&e.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),q.remove(this._canvasContainer),q.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),d.bf.clearMetrics(),this._removed=!0,this.fire(new d.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,re.frameAsync(this._frameRequest).then(f=>{d.bf.frame(f),this._frameRequest=null,this._render(f)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}get version(){return Ch}getCameraTargetElevation(){return this.transform.elevation}},S.MapMouseEvent=Ar,S.MapTouchEvent=vs,S.MapWheelEvent=bh,S.Marker=sl,S.NavigationControl=class{constructor(f){this._updateZoomButtons=()=>{const e=this._map.getZoom(),s=e===this._map.getMaxZoom(),l=e===this._map.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=l,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",l.toString())},this._rotateCompassArrow=()=>{const e=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=e},this._setButtonTitle=(e,s)=>{const l=this._map._getUIString(`NavigationControl.${s}`);e.title=l,e.setAttribute("aria-label",l)},this.options=d.e({},Vp,f),this._container=q.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",e=>this._map.zoomIn({},{originalEvent:e})),q.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",e=>this._map.zoomOut({},{originalEvent:e})),q.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})}),this._compassIcon=q.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new jp(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){q.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(f,e){const s=q.create("button",f,this._container);return s.type="button",s.addEventListener("click",e),s}},S.Popup=class extends d.E{constructor(f){super(),this.remove=()=>(this._content&&q.remove(this._content),this._container&&(q.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new d.k("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{var s;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=q.create("div","maplibregl-popup",this._map.getContainer()),this._tip=q.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const w of this.options.className.split(" "))this._container.classList.add(w);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?qt(this._lngLat,this._flatPos,this._map.transform):(s=this._lngLat)===null||s===void 0?void 0:s.wrap(),this._trackPointer&&!e)return;const l=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationPoint(this._lngLat));let u=this.options.anchor;const p=al(this.options.offset);if(!u){const w=this._container.offsetWidth,T=this._container.offsetHeight;let P;P=l.y+p.bottom.y<T?["top"]:l.y>this._map.transform.height-T?["bottom"]:[],l.x<w/2?P.push("left"):l.x>this._map.transform.width-w/2&&P.push("right"),u=P.length===0?"bottom":P.join("-")}let v=l.add(p[u]);this.options.subpixelPositioning||(v=v.round()),q.setTransform(this._container,`${so[u]} translate(${v.x}px,${v.y}px)`),nl(this._container,u,"popup")},this._onClose=()=>{this.remove()},this.options=d.e(Object.create(nt),f)}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new d.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(f){return this._lngLat=d.N.convert(f),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(document.createTextNode(f))}setHTML(f){const e=document.createDocumentFragment(),s=document.createElement("body");let l;for(s.innerHTML=f;l=s.firstChild,l;)e.appendChild(l);return this.setDOMContent(e)}getMaxWidth(){var f;return(f=this._container)===null||f===void 0?void 0:f.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=q.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(f),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(f){return this._container&&this._container.classList.add(f),this}removeClassName(f){return this._container&&this._container.classList.remove(f),this}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){if(this._container)return this._container.classList.toggle(f)}setSubpixelPositioning(f){this.options.subpixelPositioning=f}_createCloseButton(){this.options.closeButton&&(this._closeButton=q.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const f=this._container.querySelector(ol);f&&f.focus()}},S.RasterDEMTileSource=Jt,S.RasterTileSource=zt,S.ScaleControl=class{constructor(f){this._onMove=()=>{la(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,la(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},_n),f)}getDefaultPosition(){return"bottom-left"}onAdd(f){return this._map=f,this._container=q.create("div","maplibregl-ctrl maplibregl-ctrl-scale",f.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){q.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},S.ScrollZoomHandler=Wi,S.Style=Aa,S.TerrainControl=class{constructor(f){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=f}onAdd(f){return this._map=f,this._container=q.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=q.create("button","maplibregl-ctrl-terrain",this._container),q.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){q.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},S.TwoFingersTouchPitchHandler=sa,S.TwoFingersTouchRotateHandler=Lu,S.TwoFingersTouchZoomHandler=Au,S.TwoFingersTouchZoomRotateHandler=Fu,S.VectorTileSource=Vo,S.VideoSource=Os,S.addSourceType=(f,e)=>d._(void 0,void 0,void 0,function*(){if($o(f))throw new Error(`A source type called "${f}" already exists.`);((s,l)=>{Uo[s]=l})(f,e)}),S.clearPrewarmedResources=function(){const f=xr;f&&(f.isPreloaded()&&f.numActive()===1?(f.release(Mr),xr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},S.getMaxParallelImageRequests=function(){return d.a.MAX_PARALLEL_IMAGE_REQUESTS},S.getRTLTextPluginStatus=function(){return dn().getRTLTextPluginStatus()},S.getVersion=function(){return $u},S.getWorkerCount=function(){return Qr.workerCount},S.getWorkerUrl=function(){return d.a.WORKER_URL},S.importScriptInWorkers=function(f){return No().broadcast("IS",f)},S.prewarm=function(){as().acquire(Mr)},S.setMaxParallelImageRequests=function(f){d.a.MAX_PARALLEL_IMAGE_REQUESTS=f},S.setRTLTextPlugin=function(f,e){return dn().setRTLTextPlugin(f,e)},S.setWorkerCount=function(f){Qr.workerCount=f},S.setWorkerUrl=function(f){d.a.WORKER_URL=f}});var I=h;return I})})(r1);var zS=r1.exports;const Nv=Jm(zS),n1=[{id:"krakow-market",name:"Krakw Main Market Square",coordinates:[19.9366,50.0617],description:"Europe's largest medieval square, home to the Cloth Hall and St. Mary's Basilica. The square dates back to the 13th century and is the heart of Krakw's social life.",keywords:["history","architecture","krakow","medieval"],image:"/assets/krakow-market.webp",youtubeId:"z8JtqB3n-w8"},{id:"warsaw-oldtown",name:"Warsaw Old Town",coordinates:[21.0118,52.2477],description:"Beautifully reconstructed UNESCO site, a symbol of resilience after WWII destruction. The Royal Castle and Old Town Square are must-sees.",keywords:["warsaw","reconstruction","unesco","history"],image:"/assets/warsaw-oldtown.webp",youtubeId:"gD7Q1c1822w"},{id:"gdansk-crane",name:"Gdask Crane (uraw)",coordinates:[18.6575,54.3503],description:"A historic port crane and one of the most distinctive landmarks on the Motawa River. It was both a port crane and a city gate.",keywords:["port","gdansk","maritime","trade"],image:"/assets/gdansk-crane.webp",youtubeId:"lKjR5f9-w1E"},{id:"malbork-castle",name:"Malbork Castle",coordinates:[19.035,54.039],description:"The largest castle in the world by land area, built by the Teutonic Knights. It's a UNESCO World Heritage site and a masterpiece of Gothic architecture.",keywords:["castle","medieval","teutonic","unesco"],image:"/assets/malbork-castle.webp",youtubeId:"Y3QY6t03j1U"},{id:"auschwitz-birkenau",name:"Auschwitz-Birkenau Memorial",coordinates:[19.2033,50.0326],description:"The site of the largest German Nazi concentration and extermination camp, preserved as a memorial to the victims of the Holocaust.",keywords:["history","memorial","wwii","oswiecim"],image:"/assets/auschwitz.webp",youtubeId:"PqFqO0n3q3Y"},{id:"tatras-mountains",name:"Tatra Mountains (Zakopane)",coordinates:[19.95,49.27],description:"The highest range in the Carpathian Mountains, offering stunning alpine landscapes, hiking, and winter sports near the town of Zakopane.",keywords:["nature","mountains","hiking","zakopane"],image:"/assets/tatras.webp",youtubeId:"QkXF9mN0A2k"}],MS={},Vv=i=>{let o;const h=new Set,_=(ye,re)=>{const q=typeof ye=="function"?ye(o):ye;if(!Object.is(q,o)){const ke=o;o=re??(typeof q!="object"||q===null)?q:Object.assign({},o,q),h.forEach(Pe=>Pe(o,ke))}},b=()=>o,H={setState:_,getState:b,getInitialState:()=>le,subscribe:ye=>(h.add(ye),()=>h.delete(ye)),destroy:()=>{(MS?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),h.clear()}},le=o=i(_,b,H);return H},AS=i=>i?Vv(i):Vv;var s1={exports:{}},o1={},a1={exports:{}},l1={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Yl=Nn;function DS(i,o){return i===o&&(i!==0||1/i===1/o)||i!==i&&o!==o}var LS=typeof Object.is=="function"?Object.is:DS,RS=Yl.useState,FS=Yl.useEffect,BS=Yl.useLayoutEffect,OS=Yl.useDebugValue;function NS(i,o){var h=o(),_=RS({inst:{value:h,getSnapshot:o}}),b=_[0].inst,I=_[1];return BS(function(){b.value=h,b.getSnapshot=o,nm(b)&&I({inst:b})},[i,h,o]),FS(function(){return nm(b)&&I({inst:b}),i(function(){nm(b)&&I({inst:b})})},[i]),OS(h),h}function nm(i){var o=i.getSnapshot;i=i.value;try{var h=o();return!LS(i,h)}catch{return!0}}function VS(i,o){return o()}var jS=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?VS:NS;l1.useSyncExternalStore=Yl.useSyncExternalStore!==void 0?Yl.useSyncExternalStore:jS;a1.exports=l1;var US=a1.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var mp=Nn,$S=US;function ZS(i,o){return i===o&&(i!==0||1/i===1/o)||i!==i&&o!==o}var qS=typeof Object.is=="function"?Object.is:ZS,GS=$S.useSyncExternalStore,HS=mp.useRef,WS=mp.useEffect,XS=mp.useMemo,KS=mp.useDebugValue;o1.useSyncExternalStoreWithSelector=function(i,o,h,_,b){var I=HS(null);if(I.current===null){var S={hasValue:!1,value:null};I.current=S}else S=I.current;I=XS(function(){function H(ke){if(!le){if(le=!0,ye=ke,ke=_(ke),b!==void 0&&S.hasValue){var Pe=S.value;if(b(Pe,ke))return re=Pe}return re=ke}if(Pe=re,qS(ye,ke))return Pe;var Fe=_(ke);return b!==void 0&&b(Pe,Fe)?(ye=ke,Pe):(ye=ke,re=Fe)}var le=!1,ye,re,q=h===void 0?null:h;return[function(){return H(o())},q===null?void 0:function(){return H(q())}]},[o,h,_,b]);var d=GS(i,I[0],I[1]);return WS(function(){S.hasValue=!0,S.value=d},[d]),KS(d),d};s1.exports=o1;var YS=s1.exports;const JS=Jm(YS),u1={},{useDebugValue:QS}=Qv,{useSyncExternalStoreWithSelector:eT}=JS;let jv=!1;const tT=i=>i;function rT(i,o=tT,h){(u1?"production":void 0)!=="production"&&h&&!jv&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),jv=!0);const _=eT(i.subscribe,i.getState,i.getServerState||i.getInitialState,o,h);return QS(_),_}const Uv=i=>{(u1?"production":void 0)!=="production"&&typeof i!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const o=typeof i=="function"?AS(i):i,h=(_,b)=>rT(o,_,b);return Object.assign(h,o),h},iT=i=>i?Uv(i):Uv,c1=iT(i=>({selectedPlaceId:null,isSidebarOpen:!1,currentMode:"2D",isDarkMode:!0,openSidebar:o=>i({selectedPlaceId:o,isSidebarOpen:!0}),closeSidebar:()=>i({isSidebarOpen:!1,selectedPlaceId:null}),toggleTheme:()=>i(o=>({isDarkMode:!o.isDarkMode}))})),nT=()=>{const i=Nn.useRef(null),o=Nn.useRef(null),{openSidebar:h}=c1();return Nn.useEffect(()=>{if(!o.current)return o.current=new Nv.Map({container:i.current,style:"https://api.maptiler.com/maps/streets-v2/style.json?key=qouYd4hDXkrIIxMJOXH8",center:[19.15,51.92],zoom:6}),o.current.on("load",()=>{n1.forEach(_=>{const b=document.createElement("div");b.className="map-marker",new Nv.Marker({element:b,anchor:"bottom"}).setLngLat(_.coordinates).addTo(o.current),b.addEventListener("click",()=>{o.current.flyTo({center:_.coordinates,zoom:8}),h(_.id)})})}),()=>{var _;return(_=o.current)==null?void 0:_.remove()}},[h]),jr.jsx("div",{ref:i,className:"w-full h-full"})};/**
 * @license lucide-react v0.364.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var sT={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.364.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oT=i=>i.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase();/**
 * @license lucide-react v0.364.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aT=(i,o)=>{const h=Nn.forwardRef(({color:_="currentColor",size:b=24,strokeWidth:I=2,absoluteStrokeWidth:S,className:d="",children:H,...le},ye)=>Nn.createElement("svg",{ref:ye,...sT,width:b,height:b,stroke:_,strokeWidth:S?Number(I)*24/Number(b):I,className:["lucide",`lucide-${oT(i)}`,d].join(" "),...le},[...o.map(([re,q])=>Nn.createElement(re,q)),...Array.isArray(H)?H:[H]]));return h.displayName=`${i}`,h};/**
 * @license lucide-react v0.364.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lT=aT("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),uT=()=>{const{selectedPlaceId:i,closeSidebar:o}=c1(),h=n1.find(_=>_.id===i);return h?jr.jsxs("div",{className:"fixed top-0 right-0 h-full w-80 bg-white shadow-2xl z-50 p-6 overflow-y-auto",children:[jr.jsx("button",{onClick:o,className:"absolute top-4 right-4 p-2 hover:bg-gray-100 rounded-full",children:jr.jsx(lT,{size:24})}),jr.jsx("h2",{className:"text-2xl font-bold mt-8 mb-4",children:h.name}),jr.jsx("p",{className:"text-gray-600 mb-6",children:h.description}),h.youtubeId&&jr.jsx("div",{className:"relative aspect-video w-full rounded-lg overflow-hidden bg-black mb-6",children:jr.jsx("iframe",{className:"absolute inset-0 w-full h-full",src:`https://www.youtube.com/embed/${h.youtubeId}`,title:"YouTube video",allowFullScreen:!0})})]}):null},cT=()=>jr.jsx("div",{className:"fixed top-6 left-1/2 -translate-x-1/2 z-40",children:jr.jsx("div",{className:"bg-white/90 backdrop-blur-md border border-slate-200 px-8 py-3 rounded-full shadow-2xl",children:jr.jsxs("h1",{className:"text-xl font-bold bg-gradient-to-r from-indigo-600 to-blue-500 bg-clip-text text-transparent",children:[" Poland Odyssey"," ",jr.jsx("span",{className:"text-xs font-normal text-slate-400 ml-2",children:"v2.0"})]})})});function hT(){return jr.jsxs("main",{className:"relative w-screen h-screen overflow-hidden",children:[jr.jsx(cT,{}),jr.jsx(nT,{}),jr.jsx(uT,{})]})}sm.createRoot(document.getElementById("root")).render(jr.jsx(Qv.StrictMode,{children:jr.jsx(hT,{})}));
